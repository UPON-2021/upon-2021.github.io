<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>标签: pyobfuscate - UPONのblog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="UPONのblog"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="UPONのblog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="UPON-2021の屋子"><meta property="og:url" content="https://upon-2021.github.io/"><meta property="og:site_name" content="UPON-2021の屋子"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://upon-2021.github.io/img/avatar.png"><meta property="article:author" content="UPON-2021"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/avatar.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"xn--upon-eu0gs25bb4r113aow1c.googles.icu"},"headline":"UPONのblog","image":["/img/og_image.png"],"author":{"@type":"Person","name":"UPON2021"},"description":""}</script><link rel="icon" href="/img/favicon.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.0.2"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="UPONのblog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">标签</a></li><li class="is-active"><a href="#" aria-current="page">pyobfuscate</a></li></ul></nav></div></div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2023-06-17  <a class="commentCountImg" href="/2023/06/17/%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8East%E7%9A%84python%E5%8F%8D%E6%B7%B7%E6%B7%86%E6%80%9D%E8%B7%AF/#comment-container"><span class="display-none-class">3fa64ebf17e214bb08f85781e6760472</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="3fa64ebf17e214bb08f85781e6760472">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>25 分钟  <i class="fas fa-pencil-alt"> </i>3.8 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/17/%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8East%E7%9A%84python%E5%8F%8D%E6%B7%B7%E6%B7%86%E6%80%9D%E8%B7%AF/">一次基于ast的python反混淆尝试</a></h1><div class="content"><h1 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h1><p>之前看到一个python混淆的网站，感觉很不错，就拿过来研究了一下，当时霸王硬上弓(指扔给idea美化代码之后然后插print)硬是给撅出来了</p>
<p><img src="/images/obfuscate/2.png"><br><img src="/images/obfuscate/3.png"></p>
<p>当时硬print的时候就在想，能否以python解释器的方法来处理分析这些内容，然后就接触到一个东西”AST”。</p>
<p>最近刚好看到他们家换了新的混淆方法，就拿过来好好研究怎么用AST分析了。<br><img src="/images/obfuscate/1.png"></p>
<h1 id="0x01-前置内容"><a href="#0x01-前置内容" class="headerlink" title="0x01 前置内容"></a>0x01 前置内容</h1><h3 id="Python-源码编译过程"><a href="#Python-源码编译过程" class="headerlink" title="Python 源码编译过程"></a>Python 源码编译过程</h3><p>Python 源码到机器码的过程，以 CPython 为例，编译过程如下：</p>
<pre><code>将源代码解析为解析树（Parser Tree）
将解析树转换为抽象语法树（Abstract Syntax Tree）
将抽象语法树转换到控制流图（Control Flow Graph）
根据流图将字节码（bytecode）发送给虚拟机（ceval）
</code></pre>
<p>可以使用以下模块进行操作：</p>
<pre><code>ast 模块可以控制抽象语法树的生成和编译
py-compile 模块能够将源码换成字节码（编译），保存在 __pycache__ 文件夹，以 .pyc 结尾（不可读）
dis 模块通过反汇编支持对字节码的分析（可读）
</code></pre>
<h3 id="一些简单代码的ast分析"><a href="#一些简单代码的ast分析" class="headerlink" title="一些简单代码的ast分析"></a>一些简单代码的ast分析</h3><p>这里先上一些简单的例子，为后面的分析铺垫。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line">code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">import requests</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def req_baidu():</span></span><br><span class="line"><span class="string">    r = requests.get(&#x27;https://www.baidu.com/&#x27;)</span></span><br><span class="line"><span class="string">    print(r.text)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">req_baidu()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code_ast = ast.parse(code)</span><br><span class="line">code_compile = <span class="built_in">compile</span>(code_ast, <span class="string">&#x27;&lt;string&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ast.dump(code_ast,indent=<span class="number">4</span>))</span><br><span class="line">dis.dis(code_compile)</span><br></pre></td></tr></table></figure>
<p>得到的输出是这样的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">python .\test.py</span><br><span class="line">Module(</span><br><span class="line">    body=[</span><br><span class="line">        Import(</span><br><span class="line">            names=[</span><br><span class="line">                alias(name=&#x27;requests&#x27;)]),</span><br><span class="line">        FunctionDef(</span><br><span class="line">            name=&#x27;req_baidu&#x27;,</span><br><span class="line">            args=arguments(</span><br><span class="line">                posonlyargs=[],</span><br><span class="line">                args=[],</span><br><span class="line">                kwonlyargs=[],</span><br><span class="line">                kw_defaults=[],</span><br><span class="line">                defaults=[]),</span><br><span class="line">            body=[</span><br><span class="line">                Assign(</span><br><span class="line">                    targets=[</span><br><span class="line">                        Name(id=&#x27;r&#x27;, ctx=Store())],</span><br><span class="line">                    value=Call(</span><br><span class="line">                        func=Attribute(</span><br><span class="line">                            value=Name(id=&#x27;requests&#x27;, ctx=Load()),</span><br><span class="line">                            attr=&#x27;get&#x27;,</span><br><span class="line">                            ctx=Load()),</span><br><span class="line">                        args=[</span><br><span class="line">                            Constant(value=&#x27;https://www.baidu.com/&#x27;)],</span><br><span class="line">                        keywords=[])),</span><br><span class="line">                Expr(</span><br><span class="line">                    value=Call(</span><br><span class="line">                        func=Name(id=&#x27;print&#x27;, ctx=Load()),</span><br><span class="line">                        args=[</span><br><span class="line">                            Attribute(</span><br><span class="line">                                value=Name(id=&#x27;r&#x27;, ctx=Load()),</span><br><span class="line">                                attr=&#x27;text&#x27;,</span><br><span class="line">                                ctx=Load())],</span><br><span class="line">                        keywords=[]))],</span><br><span class="line">            decorator_list=[]),</span><br><span class="line">        Expr(</span><br><span class="line">            value=Call(</span><br><span class="line">                func=Name(id=&#x27;req_baidu&#x27;, ctx=Load()),</span><br><span class="line">                args=[],</span><br><span class="line">                keywords=[]))],</span><br><span class="line">    type_ignores=[])</span><br><span class="line"></span><br><span class="line">  2           0 LOAD_CONST               0 (0)</span><br><span class="line">              2 LOAD_CONST               1 (None)</span><br><span class="line">              4 IMPORT_NAME              0 (requests)</span><br><span class="line">              6 STORE_NAME               0 (requests)</span><br><span class="line"></span><br><span class="line">  4           8 LOAD_CONST               2 (&lt;code object req_baidu at 0x000002245F825D10, file &quot;&lt;string&gt;&quot;, line 4&gt;)</span><br><span class="line">             10 LOAD_CONST               3 (&#x27;req_baidu&#x27;)</span><br><span class="line">             12 MAKE_FUNCTION            0</span><br><span class="line">             14 STORE_NAME               1 (req_baidu)</span><br><span class="line"></span><br><span class="line">  8          16 LOAD_NAME                1 (req_baidu)</span><br><span class="line">             18 CALL_FUNCTION            0</span><br><span class="line">             20 POP_TOP</span><br><span class="line">             22 LOAD_CONST               1 (None)</span><br><span class="line">             24 RETURN_VALUE</span><br><span class="line"></span><br><span class="line">Disassembly of &lt;code object req_baidu at 0x000002245F825D10, file &quot;&lt;string&gt;&quot;, line 4&gt;:</span><br><span class="line">  5           0 LOAD_GLOBAL              0 (requests)</span><br><span class="line">              2 LOAD_METHOD              1 (get)</span><br><span class="line">              4 LOAD_CONST               1 (&#x27;https://www.baidu.com/&#x27;)</span><br><span class="line">              6 CALL_METHOD              1</span><br><span class="line">              8 STORE_FAST               0 (r)</span><br><span class="line"></span><br><span class="line">  6          10 LOAD_GLOBAL              2 (print)</span><br><span class="line">             12 LOAD_FAST                0 (r)</span><br><span class="line">             14 LOAD_ATTR                3 (text)</span><br><span class="line">             16 CALL_FUNCTION            1</span><br><span class="line">             18 POP_TOP</span><br><span class="line">             20 LOAD_CONST               0 (None)</span><br><span class="line">             22 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>大致看一看，不难发现，ast处理后的python其实已经和bytecode都差不多了，相对应的位置都一样，只不过可读性比字节码好上了不少，看起来还特别的直观。</p>
<h3 id="Python-ast的抽象文法"><a href="#Python-ast的抽象文法" class="headerlink" title="Python ast的抽象文法:"></a>Python ast的抽象文法:</h3><p>这里就摘了一部分，是这次反混淆需要用到的<br><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/ast.html#module-ast">Abstract Grammar</a></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>mod</td>
<td>Module<br>Interactive<br>Expression<br>FunctionType</td>
</tr>
<tr>
<td>stmt</td>
<td>FunctionDef&lt;brReturn<br>Deleate<br>Assign<br>…</td>
</tr>
<tr>
<td>expr</td>
<td>BllOp<br>NamedExpr<br>Lambda<br>…</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p>在我们一个python代码里，出现的主要还是 stmt 里的内容，定义函数<code>FunctionDef</code>，赋值<code>Assign</code>，在这些stmt里面是各种expr</p>
<p>结合上面的语句大致对照一下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Import(names=[alias(name=&#x27;requests&#x27;)]),                             --&gt;    import requests</span><br><span class="line">FunctionDef(                                                        </span><br><span class="line">    name=&#x27;req_baidu&#x27;,                                               --&gt;    def req_baidu()</span><br><span class="line">    args=arguments(</span><br><span class="line">        posonlyargs=[],</span><br><span class="line">        args=[],</span><br><span class="line">        kwonlyargs=[],</span><br><span class="line">        kw_defaults=[],</span><br><span class="line">        defaults=[]),                                                          </span><br><span class="line">    body=[                                                          --&gt;</span><br><span class="line">        Assign(</span><br><span class="line">            targets=[                                               --&gt;r = requests.get(&#x27;https://www.baidu.com/&#x27;)</span><br><span class="line">                Name(id=&#x27;r&#x27;, ctx=Store())],</span><br><span class="line">            value=Call(</span><br><span class="line">                func=Attribute(</span><br><span class="line">                    value=Name(id=&#x27;requests&#x27;, ctx=Load()),</span><br><span class="line">                    attr=&#x27;get&#x27;,</span><br><span class="line">                    ctx=Load()),</span><br><span class="line">                args=[</span><br><span class="line">                    Constant(value=&#x27;https://www.baidu.com/&#x27;)],</span><br><span class="line">                keywords=[])),</span><br><span class="line">        Expr(                                                       --&gt; print(r.text)</span><br><span class="line">            value=Call(</span><br><span class="line">                func=Name(id=&#x27;print&#x27;, ctx=Load()),</span><br><span class="line">                args=[</span><br><span class="line">                    Attribute(</span><br><span class="line">                        value=Name(id=&#x27;r&#x27;, ctx=Load()),</span><br><span class="line">                        attr=&#x27;text&#x27;,</span><br><span class="line">                        ctx=Load())],</span><br><span class="line">                keywords=[]))],</span><br><span class="line">    decorator_list=[]),</span><br></pre></td></tr></table></figure>

<h1 id="0x02-开淦"><a href="#0x02-开淦" class="headerlink" title="0x02 开淦"></a>0x02 开淦</h1><p>这是一个<code>print(1+1)</code></p>
<p><img src="/images/obfuscate/5.png"><br>被加密&amp;混淆后的结果</p>
<p>这里先剧透一下，上面的<code>obfuscate</code>在第一层用不上，这里就先看前面的加密部分。</p>
<p>大致扫了一眼，整个代码里面，全是变量定义外加<code>lambda</code>，最后执行的表达式(expr)也被混在了这一行里面，这里仿照<code>ast.py</code>中注释给出的代码样例，搓出<code>Assign</code>和<code>Expr</code>的抽象文法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AssignExtractor</span>(ast.NodeVisitor):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.assign_nodes = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_Assign</span>(<span class="params">self, node</span>):</span><br><span class="line">        self.assign_nodes.append(node)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExprExtractor</span>(ast.NodeVisitor):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.expr_nodes = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_Expr</span>(<span class="params">self, node</span>):</span><br><span class="line">        self.expr_nodes.append(node)</span><br></pre></td></tr></table></figure>
<h3 id="开始分析"><a href="#开始分析" class="headerlink" title="开始分析:"></a>开始分析:</h3><p>先来一个<code>print(1+1)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pip install pycryptodome  , It works only v3.11 Above.</span></span><br><span class="line"><span class="keyword">import</span> random ,base64,codecs,zlib;pyobfuscate=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">obfuscate = <span class="built_in">dict</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> <span class="built_in">map</span>,<span class="built_in">dict</span>:(<span class="built_in">map</span>,<span class="built_in">dict</span>),[<span class="string">&#x27;(https://pyobfuscate.com)*(decrypt)&#x27;</span>],[<span class="string">&#x27;&#x27;&#x27;Mg9q#UDn(oW~!Zy`F!j-yD|&#x27;&#x27;&#x27;</span>.replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>)]))</span><br><span class="line"></span><br><span class="line">_=<span class="keyword">lambda</span> OO00000OOO0000OOO,c_int=<span class="number">100000</span>:(_OOOO00OO0O00O00OO:=<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">int</span>(OO00000OOO0000OOO.split()[OO00O0OO00O0O0OO0])/random.randint(<span class="number">1</span>,c_int)))<span class="keyword">for</span> OO00O0OO00O0O0OO0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(OO00000OOO0000OOO.split()))));<span class="built_in">eval</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">101</span>,<span class="number">120</span>,<span class="number">101</span>,<span class="number">99</span>]))(<span class="string">&quot;\x73\x65\x74\x61\x74\x74\x72\x28\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f\x2c\x22\x5f\x5f\x5f\x5f\x5f\x5f\x22\x2c\x70\x72\x69\x6e\x74\x29\x3b\x73\x65\x74\x61\x74\x74\x72\x28\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f\x2c\x22\x5f\x5f\x5f\x5f\x5f\x22\x2c\x65\x78\x65\x63\x29\x3b\x73\x65\x74\x61\x74\x74\x72\x28\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f\x2c\x22\x5f\x5f\x5f\x5f\x22\x2c\x65\x76\x61\x6c\x29&quot;</span>);__=<span class="string">&#x27;600840 10052792 2475510 107811 3460338 725070 743968 2892000 2595808 1123520 4498098 4658724 9505818 3510345 255392 146490 5557929 9774387 9643374 676195 8169140 8968656 7951905 2729216 6994785 2809039 2272480 238206 8998248 10083880 1132512 1887269 9978295 4040976 199290 720029 6381240 390456 4855272 5536608 8270336 5334956 137240 1950112 813888 1000864 14176 4719645 7434130 4414928 6253299 9947928 1058600 1230358 2126544 2411955 8232000 3136064 3545955 10065990 11478610 1845676 5793228 1659528 8606412 2662784 9252354 3826789 8515228 10136529 9876386 4503170 4636636 3050030 2304864 8648920 3476588 1063810 6624464 4304298 1150491 8042410 11245620 2352544 7278969 5070780 3834960 143016 6244008 3168128 11537244 1865133 1213344 1977057 519120 3126900 1538392 2683994 3910416 125890 1943840 169376 2568608 2306112 1493210 846355 4957785 3989836 8217104 10113987 6212658 6166328 5037850 7088140 89080 2665299 9719915 11920920 8955970 163995 576706 283176 3952332 6138720 8659980 10319940 3459800 1280676 161860 51870 2435250 6931656 3196522 1527030 341905 7265895 9809455 5280688 6588183 1684008 10751112 3620735 3711935 2101440 809948 7445910 7656305 6875824 7874685 7469960 4394725 5493528 3843530 1205130 2690707 1967374 2228611 1179175 1150372 171600 701454 4804904 669900 5363840 4755408 11124985 3124634 2961893 2837437 10306240 6771644 3092793 3541328 182988 7504380 2047000 2964060 3378704 8487488 7190998 3697158 1008513 9005208 7376139 3927743 9552368 2742597 5133926 6206652 2311680 3009798 833028 10506608 3530296 4332300 1356850 2624527 2751793 2669733 2394070 3060196 9653172 845520 3047668 1129650 1732414 1747310 6141852 3553786 8646840 10742180 287180 1469024 8047488 11999933 3563346 859220 420224 1719072 288032 236160 8018628 6755070 3157506 9098557 82624 8832714 3347765 2617768 861504 1658215 5273592 2594072 661024 902160 6018871 5059712 9333546 5543478 10761204 2640896 8903453 1575480 7633185 2561625 10578968 1218540 2351744 2321307 6116045 1633408 7015763 5559960 703580 194336 3119584 275968 733760 8284032 10978086 2905647 3348153 823648 7268835 6811105 2865536 6322155 8007685 196784 7085907 1614012 2185672 1955680 2770597 3622466 1278320 2700033 3743630 6963888 713088 5437432 1507305 2370048 8338983 4488036 4277988 9789636 9784072 5294239 4570980 2052020 2932737 873420 692064 2712832 1440256 493184 2269836 5935947 2087019 3347070 9042473 2466925 1163640 715299 5119400 61600 6803360 3070472 3586505 7106652 2033070 3448770 1332254 3203700 10746064 3431176 5216964 6666840 4895988 1158993 1447466 1891930 7078112 6234472 5222771 3231394 5588080 4378418 11000396 10886880 8793728 1153926 5624706 10051328 4147000 877546 3422952 2137083 9117108 160089 559164 5589552 1199496 4719258 5596015 6874390 2490348 1775612 1560720 4793584 715768 4420870 1858864 1768731 6089081 782892 9675759 443322 3954581 1434120 5588080 7513732 9453620 9258872 2909040 2799450 94254 10129700 9949920 11461032 497182 218660 779670 2491648 2679584 494368 352064 4780650 2815914 294496 7500159 7957680 3969000 180320 2806720 695360 4723901 2923730 6454392 9958698 3237507 9151509 4419136 548540 636352 2456512 1158016 760864 1530048 1579104 2585568 430784 2442792 6334013 8462433 5897208 1869828 4518740 3117160 5861968 1116906 2769468 816450 2827072 1415232 1191040 2284736 8500463 5873256 4862550 8653986 474048 4160392 11480880 2319080 5977776 4726700 1302857 2626355 2011353 6087816 4281612 7839 8072324 1344846 941040 376416 1535392 25216 1638144 940672 908128 1618464 2692032 10648056 9403706 9440490 4338990 8526326 10022230 3095680 5052656 1556850 3580776 899200 322624 1953120 70272 295072 4593225 1466046 1091200 6202410 2524200 3669480 7108528 2021742 3980813 775188 2749880 879060 7325537 2466936 3110290 5079795 2893968 18560 2327936 929024 2551104 2492384 250208 2255232 2757472 1236384 1442994 8935815 6523840 4058288 758816 5608275 159264 4936678 7766440 635360 3872280 3241388 98154 46120 2160368 1370625 2638555 1671604 1677458 10174381 1842902 2885703 1477056 2982847 11056675 3048096 4126658 5386576 8473294 255852 9015797 5719266 523215 5380544 7602876 3131200 3952665 5033820 6584982 3005160 3080910 7898256 1513884 2341428 858130 2530240 1594784 2112896 2613536 9160801 10402320 9666407 2264229 3761800 3583302 3224816 6873656 7062880 2358440 1934464 2074850 443128 2641596 11325900 7407946 5716016 5132800 3202520 2705549 2412399 473240 41376 1962080 2383136 2582624 116230 8708018 5645880 6635178 8949913 7043904 9106580 3237618 801350 193792 558464 1907744 2121536 7285534 6910080 4454403 7914654 3865800 9856668 3906900 1701828 590760 464890&#x27;</span>;why,are,you,reading,this,thing,huh=<span class="string">&quot;\x5f\x5f\x5f\x5f&quot;</span>,<span class="string">&quot;\x69\x6e\x28\x63\x68\x72\x28\x69\x29\x20\x66\x6f&quot;</span>,<span class="string">&quot;\x28\x22\x22\x2e\x6a\x6f&quot;</span>,<span class="string">&quot;\x72\x20\x69\x20\x69\x6e\x20\x5b\x31\x30\x31\x2c\x31\x32\x30\x2c&quot;</span>,<span class="string">&quot;\x31\x30\x31\x2c\x39\x39&quot;</span>,<span class="string">&quot;\x5f\x5f\x29\x29&quot;</span>,<span class="string">&quot;\x5d\x29\x29\x28\x5f\x28&quot;</span>;b=<span class="string">&#x27;eJxzdK8wccz1A+IwYyBt6OheketYHmYKAFuyB3k=&#x27;</span>;____(<span class="string">&quot;&quot;</span>.join (<span class="built_in">chr</span> (<span class="built_in">int</span> (OO00O0OO00O0O0OO00 /<span class="number">2</span> ))<span class="keyword">for</span> OO00O0OO00O0O0OO00 <span class="keyword">in</span> [<span class="number">202</span> ,<span class="number">240</span> ,<span class="number">202</span> ,<span class="number">198</span> ] <span class="keyword">if</span> _____!=______))(<span class="string">f&#x27;\x5f\x5f\x5f\x5f\x28\x22\x22\x2e\x6a\x6f\x69\x6e\x28\x63\x68\x72\x28\x69\x29\x20\x66\x6f\x72\x20\x69\x20\x69\x6e\x20\x5b\x31\x30\x31\x2c\x31\x32\x30\x2c\x31\x30\x31\x2c\x39\x39\x5d\x29\x29(<span class="subst">&#123;____(base64.b64decode(codecs.decode(zlib.decompress(base64.b64decode(<span class="string">b&quot;eJw9kN1ygjAUhF8JIkzlMo6mEnIcHVIM3AGtoPIT2wSSPH2p7fTu252d2T3n3MkyK896dLvrSMIeaGxEGn0l/rpiLu3hlXm5yxDmO8tQZIDoeUQLr4oWePxk8VZfBpr9af8mXdzLTk8swRbP25bNzPvP8qwWJDRA8RX4vhLkfvuk0QRl3DOUekDC9xHZVnBcyUnXY7mtBrIOBDEKXNRl3KiBBor25l5MN7U5qSA/HsJiVpfsVIQ/Hj4dgoSYOndx+7tZLZ2m3qA4AFpUD6RDsbLXB2m0dPuPZa8GblvoGm/gthdI+8PxyYtnXqRLl9uiJi+xBbqtCmKm8/K3b7hsbmQ=&quot;</span>)).decode(),<span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(i/<span class="number">8</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">912</span>, <span class="number">888</span>, <span class="number">928</span>, <span class="number">392</span>, <span class="number">408</span>])).encode()))&#125;</span>)&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>乍一看，用了大量的lambda把代码写成了一行，想提取里面的代码很难，我第一次破的时候是直接扔到pycharm里面格式化到处插<code>print</code>看变量的值，为了对准<code>lambda</code>表达式后面的<code>;</code>挺痛苦的，上AST看一下。</p>
<p>因为里面的代码主要是赋值(Assign)语句，最后执行的代码(Expr)跟在了<code>lambda</code>的分号后面了，先大致拉出来看看:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> extractors <span class="keyword">import</span> AssignExtractor,ExprExtractor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./obfuscated_code.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    code = f.read()</span><br><span class="line"></span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">assignExtractor = AssignExtractor()</span><br><span class="line">assignExtractor.visit(tree)</span><br><span class="line">ass_nodes = assignExtractor.assign_nodes</span><br><span class="line"></span><br><span class="line">exprExtractor = ExprExtractor()</span><br><span class="line">exprExtractor.visit(tree)</span><br><span class="line">expr_nodes = exprExtractor.expr_nodes</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./assin_output.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ass_nodes:</span><br><span class="line">        f1.write(ast.dump(i)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f1.write(ast.unparse(i)+<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./expr_output.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> expr_nodes:</span><br><span class="line">        f2.write(ast.dump(i)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f2.write(ast.unparse(i)+<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/images/obfuscate/6.png"><br><img src="/images/obfuscate/7.png"></p>
<p>代码的结构就能很轻松地找出来，之后便可以通过在代码里插<code>print</code>的方法来确定我被混淆的代码最后哪里运行的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">____(<span class="string">&#x27;&#x27;</span>.join((<span class="built_in">chr</span>(<span class="built_in">int</span>(OO00O0OO00O0O0OO00 / <span class="number">2</span>)) <span class="keyword">for</span> OO00O0OO00O0O0OO00 <span class="keyword">in</span> [<span class="number">202</span>, <span class="number">240</span>, <span class="number">202</span>, <span class="number">198</span>] <span class="keyword">if</span> _____ != ______)))(<span class="string">f&quot;&quot;&quot;____(&quot;&quot;.join(chr(i) for i in [101,120,101,99]))(<span class="subst">&#123;____(base64.b64decode(codecs.decode(zlib.decompress(base64.b64decode(<span class="string">b&#x27;eJw9kN1ygjAUhF8JIkzlMo6mEnIcHVIM3AGtoPIT2wSSPH2p7fTu252d2T3n3MkyK896dLvrSMIeaGxEGn0l/rpiLu3hlXm5yxDmO8tQZIDoeUQLr4oWePxk8VZfBpr9af8mXdzLTk8swRbP25bNzPvP8qwWJDRA8RX4vhLkfvuk0QRl3DOUekDC9xHZVnBcyUnXY7mtBrIOBDEKXNRl3KiBBor25l5MN7U5qSA/HsJiVpfsVIQ/Hj4dgoSYOndx+7tZLZ2m3qA4AFpUD6RDsbLXB2m0dPuPZa8GblvoGm/gthdI+8PxyYtnXqRLl9uiJi+xBbqtCmKm8/K3b7hsbmQ=&#x27;</span>)).decode(), <span class="string">&#x27;&#x27;</span>.join((<span class="built_in">chr</span>(<span class="built_in">int</span>(i / <span class="number">8</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">912</span>, <span class="number">888</span>, <span class="number">928</span>, <span class="number">392</span>, <span class="number">408</span>]))).encode()))&#125;</span>)&quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>把这段代码单独拎出来，看看里面长啥样:</p>
<p>这里用<code>graphviz</code>库来做个可视化  <a target="_blank" rel="noopener" href="https://qiita.com/kaityo256/items/e83b369ba7518da0a519">Pythonの抽象構文木をGraphvizで可視化する</a></p>
<pre><code>pip install graphviz
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visit</span>(<span class="params">node, nodes, pindex, g</span>):</span><br><span class="line">    name = <span class="built_in">str</span>(<span class="built_in">type</span>(node).__name__)</span><br><span class="line">    index = <span class="built_in">len</span>(nodes)</span><br><span class="line">    nodes.append(index)</span><br><span class="line">    g.node(<span class="built_in">str</span>(index), name)</span><br><span class="line">    <span class="keyword">if</span> index != pindex:</span><br><span class="line">        g.edge(<span class="built_in">str</span>(index), <span class="built_in">str</span>(pindex))</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> ast.iter_child_nodes(node):</span><br><span class="line">        visit(n, nodes, index, g)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./obfuscated2_code.py&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    code = f.read()</span><br><span class="line"></span><br><span class="line">tree = ast.parse(code)</span><br><span class="line"></span><br><span class="line">graph = Digraph(<span class="built_in">format</span>=<span class="string">&quot;png&quot;</span>)</span><br><span class="line">visit(tree, [], <span class="number">0</span>, graph)</span><br><span class="line">graph.render(<span class="string">&quot;obfuscated2&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/obfuscate/8.png"></p>
<p>当这张图拉出来了之后，一目了然，把这个搜索改成广搜，来一层一层拨开</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random ,base64,codecs,zlib;pyobfuscate=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line">obfuscate = <span class="built_in">dict</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> <span class="built_in">map</span>,<span class="built_in">dict</span>:(<span class="built_in">map</span>,<span class="built_in">dict</span>),[<span class="string">&#x27;(https://pyobfuscate.com)*(decrypt)&#x27;</span>],[<span class="string">&#x27;&#x27;&#x27;Mg9q#UDn(oW~!Zy`F!j-yD|&#x27;&#x27;&#x27;</span>.replace(<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;&#x27;</span>)]))</span><br><span class="line"></span><br><span class="line">_=<span class="keyword">lambda</span> OO00000OOO000</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">....</span><br><span class="line">yB3k=<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ↓↓↓↓ 下面的这些代码是前面分析出来得到的最后执行的表达式</span></span><br><span class="line"><span class="string">code = &quot;&quot;&quot;</span></span><br><span class="line"><span class="string">_____(&quot;&quot;.join (chr (int (OO00O0OO00O0O0OO00 /2 ))for OO00O0OO00O0O0OO00 in [202 ,240 ,202 ,198 ] if _____!=______))(f&#x27;</span>\x5f\x5f\x5f\x5f\x28\x22\x22\x2e\x6a\x6f\x69\x6e\x28\x63\x68\x72\x28\x69\x29\x20\x66\x6f\x72\x20\x69\x20\x69\x6e\x20\x5b\x31\x30\x31\x2c\x31\x32\x30\x2c\x31\x30\x31\x2c\x39\x39\x5d\x29\x29(&#123;____(base64.b64decode(codecs.decode(zlib.decompress(base64.b64decode(<span class="string">b&quot;eJw9kN1ygjAUhF8JIkzlMo6mEnIcHVIM3AGtoPIT2wSSPH2p7fTu252d2T3n3MkyK896dLvrSMIeaGxEGn0l/rpiLu3hlXm5yxDmO8tQZIDoeUQLr4oWePxk8VZfBpr9af8mXdzLTk8swRbP25bNzPvP8qwWJDRA8RX4vhLkfvuk0QRl3DOUekDC9xHZVnBcyUnXY7mtBrIOBDEKXNRl3KiBBor25l5MN7U5qSA/HsJiVpfsVIQ/Hj4dgoSYOndx+7tZLZ2m3qA4AFpUD6RDsbLXB2m0dPuPZa8GblvoGm/gthdI+8PxyYtnXqRLl9uiJi+xBbqtCmKm8/K3b7hsbmQ=&quot;</span>)).decode(),<span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(i/<span class="number">8</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">912</span>, <span class="number">888</span>, <span class="number">928</span>, <span class="number">392</span>, <span class="number">408</span>])).encode()))&#125;)<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ↓↓↓↓ 使用广搜，一层一层分析</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def bfs_visit(root):</span></span><br><span class="line"><span class="string">    nodes = []</span></span><br><span class="line"><span class="string">    queue = deque([(root, None)])</span></span><br><span class="line"><span class="string">    while queue:</span></span><br><span class="line"><span class="string">        node, parent_index = queue.popleft()</span></span><br><span class="line"><span class="string">        index = len(nodes)</span></span><br><span class="line"><span class="string">        nodes.append(index)</span></span><br><span class="line"><span class="string">        if parent_index is not None:</span></span><br><span class="line"><span class="string">            nodes.append(index)</span></span><br><span class="line"><span class="string">        for child in ast.iter_child_nodes(node):</span></span><br><span class="line"><span class="string">            try :</span></span><br><span class="line"><span class="string">                print(&quot;[+]&quot;,eval(ast.unparse(child))) # &lt;--- 这里获取值</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">            except:</span></span><br><span class="line"><span class="string">                print(&quot;[-]&quot;,ast.unparse(child))</span></span><br><span class="line"><span class="string">                pass</span></span><br><span class="line"><span class="string">            queue.append((child, index))</span></span><br><span class="line"><span class="string">        print(&quot;---------------------------------分割线------------------------------&quot;)</span></span><br><span class="line"><span class="string">    return nodes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">tree = ast.parse(code)</span></span><br><span class="line"><span class="string">bfs_visit(tree)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p><img src="/images/obfuscate/9.png"></p>
<p>这里想到用<code>eval</code>直接打印出来变量，直接看</p>
<p><img src="/images/obfuscate/10.png"></p>
<p>我在整理笔记到这里的时候，突发奇想，既然我都能把整个逻辑弄成图，为啥不直接把对应的值也弄上去，到时候分析起来就更方便了，也就不需要到处print看值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bfs_visit</span>(<span class="params">root</span>):</span><br><span class="line">    queue = Queue()</span><br><span class="line">    queue.put((root, <span class="number">0</span>))</span><br><span class="line">    nodes = []</span><br><span class="line">    g = Digraph(<span class="built_in">format</span>=<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        node, pindex = queue.get()</span><br><span class="line">        name = <span class="built_in">str</span>(<span class="built_in">type</span>(node).__name__)</span><br><span class="line">        index = <span class="built_in">len</span>(nodes)</span><br><span class="line">        nodes.append(index)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            value = <span class="built_in">eval</span>(ast.unparse(node))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            value = ast.unparse(node)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)) + <span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(value))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)))</span><br><span class="line">        <span class="keyword">if</span> index != pindex:</span><br><span class="line">            g.edge(<span class="built_in">str</span>(index), <span class="built_in">str</span>(pindex))</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> ast.iter_child_nodes(node):</span><br><span class="line">            queue.put((n, index))</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">graph = bfs_visit(tree)</span><br><span class="line">graph.render(<span class="string">&quot;obfuscated2_plus&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这不比命令行里一条条对数据方便多了<br><img src="/images/obfuscate/11.png"></p>
<p>仔细看看，左边<code>NoneType</code>上方是<code>exec</code>，右边是个<code>JoinedStr</code>，结合这里面一堆<code>call</code>，不难看出最后执行的是<code>exec(JoinedStr)</code></p>
<p><img src="/images/obfuscate/12.png"></p>
<p>但是右边又套娃套了好几层</p>
<p><img src="/images/obfuscate/14.png"></p>
<p>用随机数特定的种子来生成特定的文字，玩的挺脏的，得到反混淆后的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> requests <span class="keyword">import</span> get</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">input</span>(<span class="string">&quot;pip install requests \\npress enter to Exit&quot;</span>)</span><br><span class="line">    <span class="built_in">__import__</span>(<span class="string">&#x27;sys&#x27;</span>).exit()</span><br><span class="line"></span><br><span class="line">fl=<span class="built_in">__import__</span>(<span class="string">&quot;requests&quot;</span>).get(<span class="string">&quot;https://pyobfuscate.com/public/pyd2/aes.txt&quot;</span>).text</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> os.path <span class="keyword">import</span> exists <span class="keyword">as</span> ex</span><br><span class="line">    <span class="keyword">from</span> os <span class="keyword">import</span> getenv <span class="keyword">as</span> ge,remove</span><br><span class="line">    loc=ge(<span class="string">&#x27;APPDATA&#x27;</span>);p1=loc+<span class="string">&quot;\\aes.txt&quot;</span>;p2=loc+<span class="string">&quot;\\rsa.txt&quot;</span>;p3=loc+<span class="string">&quot;\\aes2.txt&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ex(p1)==<span class="literal">True</span>:</span><br><span class="line">        remove(p1)</span><br><span class="line">    <span class="keyword">elif</span> ex(p2)==<span class="literal">True</span>:</span><br><span class="line">        remove(p2)</span><br><span class="line">    <span class="keyword">if</span> ex(p3)==<span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="built_in">str</span>(p3),<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> e:e.write(<span class="built_in">str</span>(fl))</span><br><span class="line">    <span class="built_in">exec</span>(<span class="built_in">open</span>(p2).read())</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">exec</span>(fl)</span><br></pre></td></tr></table></figure>

<p>简单一看，又想骂娘<br><code>https://pyobfuscate.com/public/pyd2/aes.txt</code></p>
<p>代码还是那一些，同样的思路继续干，这里把最后一个<code>Expr</code>拿出来吧，原代码太长了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_______.___________________(_______.________________(_______.________________________())[:______._ * ______._] + _______.________________(_______._______________())[______.___] + _______.________________(_______._________________([]))[______.___] + _______.________________(_______.________________________())[______._ ** ______._ + ______.__])(____, _______._______________________(), _______.________________(_______.________________________())[______._ ** ______._ + ______.__] + _______.________________(_______.______________())[______._] + _______.________________(_______.________________________())[______._ ** ______._ + ______.__] + _______.________________(_______.________________________())[______.___])</span><br></pre></td></tr></table></figure>
<p>左边exec<br><img src="/images/obfuscate/17.png"><br>右边compile<br><img src="/images/obfuscate/18.png"></p>
<p>看到这里,<code>compile</code>上加载了一个前面代码的变量，这里再改进一下代码，同时更换输出格式为<code>svg</code>，避免因为图片过大报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bfs_visit</span>(<span class="params">root</span>):</span><br><span class="line">    queue = Queue()</span><br><span class="line">    queue.put((root, <span class="number">0</span>))</span><br><span class="line">    nodes = []</span><br><span class="line">    g = Digraph(<span class="built_in">format</span>=<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        node, pindex = queue.get()</span><br><span class="line">        name = <span class="built_in">str</span>(<span class="built_in">type</span>(node).__name__)</span><br><span class="line">        index = <span class="built_in">len</span>(nodes)</span><br><span class="line">        nodes.append(index)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            value = <span class="built_in">eval</span>(ast.unparse(node))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            value = ast.unparse(node)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name == <span class="string">&#x27;Name&#x27;</span>:</span><br><span class="line">                g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)) + <span class="string">&#x27;  id:&#x27;</span>+<span class="built_in">str</span>(node.<span class="built_in">id</span>)) <span class="comment"># 添加加载变量的id</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)) + <span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(value))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)))</span><br><span class="line">        <span class="keyword">if</span> index != pindex:</span><br><span class="line">            g.edge(<span class="built_in">str</span>(index), <span class="built_in">str</span>(pindex))</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> ast.iter_child_nodes(node):</span><br><span class="line">            queue.put((n, index))</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">graph = bfs_visit(tree)</span><br><span class="line">graph.render(<span class="string">&quot;final_express&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这里放张svg图，建议新建窗口打开<br><img src="/images/obfuscate/20.svg"></p>
<p>找到了，因为变量类型是<code>ast.Moudle</code>，就用<code>ast.unpares</code>还原代码<br><img src="/images/obfuscate/22.png"></p>
<pre><code>print(ast.unparse(____))
</code></pre>
<p><img src="/images/obfuscate/21.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> random, base64, zlib, sys, string</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES, PKCS1_OAEP</span><br><span class="line">    <span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA256</span><br><span class="line">    <span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line">    <span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line">    <span class="keyword">from</span> Crypto.Signature <span class="keyword">import</span> pkcs1_15</span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">    <span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">AESEncryption</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key: <span class="built_in">bytes</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">            self.key = key</span><br><span class="line"></span><br><span class="line"><span class="meta">        @classmethod</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">from_nbits</span>(<span class="params">cls, nbits: <span class="built_in">int</span>=<span class="number">256</span></span>):</span><br><span class="line">            cls.iv = iv</span><br><span class="line">            cls.key = keys</span><br><span class="line">            cls.mode = mode</span><br><span class="line">            <span class="keyword">return</span> cls(keys)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, message: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">            cipher = AES.new(self.key, self.mode, self.iv)</span><br><span class="line">            ciphered_data = cipher.encrypt(pad(message, AES.block_size))</span><br><span class="line">            <span class="keyword">return</span> ciphered_data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, message: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">            cipher = AES.new(self.key, self.mode, self.iv)</span><br><span class="line">            decrypted_data = unpad(cipher.decrypt(message), AES.block_size)</span><br><span class="line">            <span class="keyword">return</span> decrypted_data</span><br><span class="line">    MESSAGE_LONG = get_random_bytes(<span class="number">100100</span>)</span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_uppercase + string.digits, k=<span class="number">16</span>))</span><br><span class="line">    bb = _encrypt[<span class="number">125</span>:]</span><br><span class="line">    keys = base64.b85decode(bb)</span><br><span class="line">    iv = _pubkey[<span class="number">100</span>:]</span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    aes = AESEncryption.from_nbits(<span class="number">256</span>)</span><br><span class="line">    encrypted_msg = aes.encrypt(_<span class="keyword">lambda</span>)</span><br><span class="line">    passkey2 = <span class="string">&#x27;Obfuscated by https://pyobfuscate.com&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> _key == passkey2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Decryption Key Do not Match or Missing AES Salt 256&#x27;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line">    <span class="built_in">exec</span>(zlib.decompress(aes.decrypt(_<span class="keyword">lambda</span>)).decode())</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">import</span> base64, os, hashlib, random</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">encrypted_data, key</span>):</span><br><span class="line">        encrypted_data = base64.b85decode(encrypted_data)</span><br><span class="line">        salt = encrypted_data[:<span class="number">8</span>]</span><br><span class="line">        (key, iv) = derive_key_and_iv(key, salt)</span><br><span class="line">        cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">        data = cipher.decrypt(encrypted_data[<span class="number">8</span>:])</span><br><span class="line">        <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">derive_key_and_iv</span>(<span class="params">password, salt</span>):</span><br><span class="line">        dk = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha256&#x27;</span>, password.encode(), salt, <span class="number">100000</span>)</span><br><span class="line">        key = dk[:<span class="number">16</span>]</span><br><span class="line">        iv = dk[<span class="number">16</span>:]</span><br><span class="line">        <span class="keyword">return</span> (key, iv)</span><br><span class="line">    <span class="built_in">exec</span>(aes_decrypt(<span class="built_in">list</span>(obfuscate.values())[<span class="number">0</span>], <span class="built_in">list</span>(obfuscate.keys())[<span class="number">0</span>][<span class="number">1</span>:-<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>

<p>仔细审审的话，发现上面的try必定出错，不需要管，最后得到<code>解密</code>代码是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64, os, hashlib, random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">encrypted_data, key</span>):</span><br><span class="line">    encrypted_data = base64.b85decode(encrypted_data)</span><br><span class="line">    salt = encrypted_data[:<span class="number">8</span>]</span><br><span class="line">    (key, iv) = derive_key_and_iv(key, salt)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">    data = cipher.decrypt(encrypted_data[<span class="number">8</span>:])</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">derive_key_and_iv</span>(<span class="params">password, salt</span>):</span><br><span class="line">    dk = hashlib.pbkdf2_hmac(<span class="string">&#x27;sha256&#x27;</span>, password.encode(), salt, <span class="number">100000</span>)</span><br><span class="line">    key = dk[:<span class="number">16</span>]</span><br><span class="line">    iv = dk[<span class="number">16</span>:]</span><br><span class="line">    <span class="keyword">return</span> (key, iv)</span><br><span class="line"><span class="built_in">print</span>(aes_decrypt(<span class="built_in">list</span>(obfuscate.values())[<span class="number">0</span>], <span class="built_in">list</span>(obfuscate.keys())[<span class="number">0</span>][<span class="number">1</span>:-<span class="number">1</span>]))</span><br></pre></td></tr></table></figure>

<p>嗯哼，这么强的混淆只是为了保护一个解密器的代码。</p>
<h1 id="0x03-复盘"><a href="#0x03-复盘" class="headerlink" title="0x03 复盘"></a>0x03 复盘</h1><p>其实只是破解这个混淆的话，根本不需要上<code>ast</code>来大炮打蚊子，直接把以下内容送进去混淆然后运行:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line">pdb.set_trace()</span><br></pre></td></tr></table></figure>
<p><img src="/images/obfuscate/23.png"></p>
<p>dis一下</p>
<p><img src="/images/obfuscate/24.png"></p>
<p>ast分析确实有很多好处的，首先是整个代码的就变得非常直观了，比较适合研究这个混淆的原理，能一眼看出来我这个运行的代码是如何被一步一步拼接出来的，比如这个<code>compile</code><br><img src="/images/obfuscate/25.png"></p>
<p>最后生成分析图像的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">from</span> graphviz <span class="keyword">import</span> Digraph</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bfs_visit</span>(<span class="params">root</span>):</span><br><span class="line">    queue = Queue()</span><br><span class="line">    queue.put((root, <span class="number">0</span>))</span><br><span class="line">    nodes = []</span><br><span class="line">    g = Digraph(<span class="built_in">format</span>=<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        node, pindex = queue.get()</span><br><span class="line">        name = <span class="built_in">str</span>(<span class="built_in">type</span>(node).__name__)</span><br><span class="line">        index = <span class="built_in">len</span>(nodes)</span><br><span class="line">        nodes.append(index)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            value = <span class="built_in">eval</span>(ast.unparse(node))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            value = ast.unparse(node)</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)) + <span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(value))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            g.node(<span class="built_in">str</span>(index), name+<span class="string">&#x27;  &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">type</span>(value)))</span><br><span class="line">        <span class="keyword">if</span> index != pindex:</span><br><span class="line">            g.edge(<span class="built_in">str</span>(index), <span class="built_in">str</span>(pindex))</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> ast.iter_child_nodes(node):</span><br><span class="line">            queue.put((n, index))</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">tree = ast.parse(code)</span><br><span class="line">graph = bfs_visit(tree)</span><br><span class="line">graph.render(<span class="string">&quot;obfuscated2_plus&quot;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="Refences"><a href="#Refences" class="headerlink" title="Refences"></a>Refences</h1><p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/dis.html">dis — Python 字节码反汇编器</a><br><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/ast.html">ast — 抽象语法树</a><br><a target="_blank" rel="noopener" href="https://qiita.com/kaityo256/items/e83b369ba7518da0a519">Pythonの抽象構文木をGraphvizで可視化する</a></p>
</div><div class="index-category-tag">  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/python/">python</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/ast/">ast</a><span> </span><a class="article-more button is-small link-muted index-tags" href="/tags/pyobfuscate/">pyobfuscate</a></div><hr></div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.png" alt="UPON-2021"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">UPON-2021</p><p class="is-size-6 is-block">游走于 web2 &amp; web3 的嘿阔 (很菜)</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">27</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">37</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/upon-2021" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/upon-2021/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/%E8%AF%B6%E5%98%BF%EF%BC%9F"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Next" href="/%E5%96%B5%E5%96%B5%E5%96%B5%EF%BC%9F"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.google.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">谷歌</span></span><span class="level-right"><span class="level-item tag">www.google.com</span></span></a></li><li><a class="level is-mobile" href="https://www.baidu.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">百度</span></span><span class="level-right"><span class="level-item tag">www.baidu.com</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-17T12:18:26.935Z">2023-06-17</time></p><p class="title"><a href="/2023/06/17/%E4%B8%80%E7%A7%8D%E5%9F%BA%E4%BA%8East%E7%9A%84python%E5%8F%8D%E6%B7%B7%E6%B7%86%E6%80%9D%E8%B7%AF/">一次基于ast的python反混淆尝试</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-24T10:48:16.019Z">2023-04-24</time></p><p class="title"><a href="/2023/04/24/DasctfSU6%E6%9C%88%E8%B5%9B/">DasctfSU6月赛</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-14T10:47:06.210Z">2023-04-14</time></p><p class="title"><a href="/2023/04/14/Redos/">redos</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-08T00:52:11.314Z">2023-04-08</time></p><p class="title"><a href="/2023/04/08/Go%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">Go编程学习记录</a></p><p class="categories"><a href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-05T05:58:02.820Z">2023-04-05</time></p><p class="title"><a href="/2023/04/05/ThinkPHP%E5%AD%A6%E4%B9%A0%E5%AF%84%E5%BD%95/">ThinkPHP框架 3.2.3学习记录</a></p><p class="categories"><a href="/categories/web/">web</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/reverse/"><span class="level-start"><span class="level-item">reverse</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/ssti/"><span class="level-start"><span class="level-item">ssti</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/weak/"><span class="level-start"><span class="level-item">weak</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%A4%87%E5%BF%98%E5%BD%95/"><span class="level-start"><span class="level-item">备忘录</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%A4%8D%E7%8E%B0/"><span class="level-start"><span class="level-item">复现</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/"><span class="level-start"><span class="level-item">路由器</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2023/06/"><span class="level-start"><span class="level-item">六月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/04/"><span class="level-start"><span class="level-item">四月 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/03/"><span class="level-start"><span class="level-item">三月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2023/01/"><span class="level-start"><span class="level-item">一月 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WEB/"><span class="tag">WEB</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%8D%E7%8E%B0/"><span class="tag">复现</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ETH/"><span class="tag">ETH</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RCE/"><span class="tag">RCE</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Solidity/"><span class="tag">Solidity</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ThinkPHP/"><span class="tag">ThinkPHP</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssti/"><span class="tag">ssti</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upload/"><span class="tag">upload</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blockchain/"><span class="tag">Blockchain</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Crypto/"><span class="tag">Crypto</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DOS/"><span class="tag">DOS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Javascript/"><span class="tag">Javascript</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LFI/"><span class="tag">LFI</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MITM/"><span class="tag">MITM</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag is-grey-lightest">1</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="UPONのblog" height="28"></a><p class="size-small"><span>&copy; 2023 UPON2021</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！";
        }var now = new Date();setInterval("createTime('2022/9/29 17:30:00')", 250,"");</script><br></span><div class="size-small"><span></span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="2364053447" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('be835d1ee57b9ec974c1','5b2d7f351be105e013f11fa0ebde21cbea192152','UPON-2021','upon-2021.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('be835d1ee57b9ec974c1','5b2d7f351be105e013f11fa0ebde21cbea192152','UPON-2021','upon-2021.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>